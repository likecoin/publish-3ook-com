{"version":3,"file":"BCJzMC9k.js","sources":["../../../pages/settings/index.vue"],"sourcesContent":["<template>\n  <PageBody>\n    <UAlert\n      v-if=\"error\"\n      icon=\"i-heroicons-exclamation-triangle\"\n      color=\"error\"\n      variant=\"soft\"\n      :title=\"`${error}`\"\n      :close=\"{ icon: 'i-heroicons-x-mark-20-solid', color: 'error', variant: 'link' }\"\n      @close=\"error = ''\"\n    />\n\n    <UAlert\n      v-if=\"!isStripeConnectReady\"\n      icon=\"i-heroicons-exclamation-circle\"\n      color=\"warning\"\n      variant=\"soft\"\n      :title=\"$t('user_settings.stripe_express_notice')\"\n      :description=\"$t('user_settings.stripe_express_description')\"\n    />\n\n    <template v-if=\"bookstoreApiStore.isAuthenticated\">\n      <UCard\n        :ui=\"{\n          header: 'flex justify-between items-center',\n          body: 'p-0',\n          footer: 'text-center',\n        }\"\n      >\n        <template #header>\n          <h1 class=\"text-center font-bold font-mono\">\n            {{ $t('user_settings.stripe_payout_status') }}\n          </h1>\n\n          <UTooltip\n            text=\"Refresh Status\"\n            :popper=\"{ placement: 'left' }\"\n          >\n            <UButton\n              icon=\"i-heroicons-arrow-path\"\n              variant=\"outline\"\n              :disabled=\"isLoading\"\n              @click=\"refreshStripeConnectStatus\"\n            />\n          </UTooltip>\n        </template>\n\n        <template #footer>\n          <div class=\"flex flex-col justify-center items-center gap-4\">\n            <span\n              v-if=\"currentStripeAccount?.hasAccount && isStripeConnectReady\"\n              class=\"text-sm text-gray-500\"\n              v-text=\"currentStripeAccount.email\"\n            />\n            <UButton\n              :label=\"buttonText\"\n              size=\"md\"\n              :loading=\"isLoading\"\n              :disabled=\"isLoading\"\n              color=\"neutral\"\n              variant=\"solid\"\n              @click=\"handleClickStripeButton\"\n            />\n          </div>\n        </template>\n      </UCard>\n    </template>\n  </PageBody>\n</template>\n\n<script setup lang=\"ts\">\nconst { LIKE_CO_API } = useRuntimeConfig().public\nconst { t: $t } = useI18n()\n\nconst bookstoreApiStore = useBookstoreApiStore()\nconst stripeStore = useStripeStore()\nconst { token, wallet } = storeToRefs(bookstoreApiStore)\nconst { getStripeConnectStatusByWallet } = storeToRefs(stripeStore)\n\nconst { showErrorToast } = useToastComposable()\nconst error = ref('')\nconst isLoading = ref(false)\n\nwatch(isLoading, (newIsLoading) => {\n  if (newIsLoading) { error.value = '' }\n})\n\nonMounted(async () => {\n  await stripeStore.refreshStripeConnectStatus(wallet.value)\n})\n\nconst currentStripeAccount = computed(() => getStripeConnectStatusByWallet.value(wallet.value))\nconst isStripeConnectReady = computed(() => currentStripeAccount.value?.isReady)\n\nconst buttonText = computed(() => {\n  if (!currentStripeAccount.value?.hasAccount && !isStripeConnectReady.value) {\n    return $t('user_settings.setup_stripe_connect')\n  } else if (currentStripeAccount.value?.hasAccount && !isStripeConnectReady.value) {\n    return $t('user_settings.resume_stripe_connect_setup')\n  } else if (currentStripeAccount.value?.hasAccount && isStripeConnectReady.value) {\n    return $t('user_settings.login_to_stripe')\n  }\n})\n\nasync function refreshStripeConnectStatus () {\n  try {\n    isLoading.value = true\n    await stripeStore.refreshStripeConnectStatus(wallet.value)\n  } catch (e) {\n    error.value = (e as Error).toString()\n    showErrorToast((e as Error).toString())\n  } finally {\n    isLoading.value = false\n  }\n}\n\nasync function onLoginToStripe () {\n  try {\n    isLoading.value = true\n    const data = await $fetch(`${LIKE_CO_API}/likernft/book/user/connect/login`,\n      {\n        method: 'POST',\n        headers: {\n          authorization: `Bearer ${token.value}`\n        }\n      }\n    )\n    const url = (data as { url?: string }).url\n    if (url) {\n      window.open(url)\n    } else {\n      throw new Error('CANNOT_GET_STRIPE_CONNECT_RUL')\n    }\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.error(e)\n    error.value = (e as Error).toString()\n    showErrorToast((e as Error).toString())\n  } finally {\n    isLoading.value = false\n  }\n}\n\nasync function onSetupStripe () {\n  try {\n    isLoading.value = true\n    const data = await $fetch(`${LIKE_CO_API}/likernft/book/user/connect/new`,\n      {\n        method: 'POST',\n        headers: {\n          authorization: `Bearer ${token.value}`\n        }\n      }\n    )\n    const url = (data as { url?: string }).url\n    if (url) {\n      window.open(url)\n    } else {\n      throw new Error('CANNOT_GET_STRIPE_CONNECT_RUL')\n    }\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.error(e)\n    error.value = (e as Error).toString()\n    showErrorToast((e as Error).toString())\n  } finally {\n    isLoading.value = false\n  }\n}\n\nasync function handleClickStripeButton () {\n  isLoading.value = true\n  try {\n    if (!isStripeConnectReady.value) {\n      await onSetupStripe()\n    } else {\n      await onLoginToStripe()\n    }\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.error(e)\n    error.value = (e as Error).toString()\n    showErrorToast((e as Error).toString())\n  } finally {\n    isLoading.value = false\n  }\n}\n\n</script>\n"],"names":["LIKE_CO_API","useRuntimeConfig","$t","useI18n","bookstoreApiStore","useBookstoreApiStore","stripeStore","useStripeStore","token","wallet","storeToRefs","getStripeConnectStatusByWallet","showErrorToast","useToastComposable","error","ref","isLoading","watch","newIsLoading","onMounted","currentStripeAccount","computed","isStripeConnectReady","buttonText","refreshStripeConnectStatus","onLoginToStripe","url","onSetupStripe","handleClickStripeButton","_createBlock","_component_PageBody","_unref","_component_UAlert","_component_UCard","_createElementVNode","_hoisted_1","_toDisplayString","_createVNode","_component_UTooltip","_component_UButton","_hoisted_2","_createElementBlock"],"mappings":"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"}