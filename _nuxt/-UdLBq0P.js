import{g as Q,a as X,Q as G,b as J,s as E,R as Z,w as ee,o as te,e as b,l as k,m as C,n as r,W as H,p as c,q as e,X as se,c as v,Y as ae,L as p,M as f,a1 as oe,N as A,a7 as ne,aj as K,ak as U,al as M,am as $}from"./9S2XGRg9.js";import{_ as re}from"./drKZnbC8.js";import{_ as ce}from"./CLuOJMie.js";import{u as ie}from"./DJApvAF_.js";import{u as le}from"./DOPoUBoe.js";import{u as ue}from"./Do2UJywV.js";import"./CSf5BCM0.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};i.SENTRY_RELEASE={id:"cd189bad150b481aa5ecb2e95de26ec677010e55"}}catch{}})();try{(function(){var i=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},m=new i.Error().stack;m&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[m]="6f7cd61e-2cd2-4328-a79e-b20f31f92454",i._sentryDebugIdIdentifier="sentry-dbid-6f7cd61e-2cd2-4328-a79e-b20f31f92454")})()}catch{}const de=["textContent"],me={class:"flex gap-2"},ye=["href"],_e=["textContent"],pe={class:"flex gap-2"},Te=Q({__name:"index",setup(i){const{LIKE_CO_API:m,BOOK3_URL:O}=X().public,{t}=G(),x=ie(),P=J(),{token:w,wallet:D}=E(P),V=Z(),B=le(),{getStripeConnectStatusByWallet:W}=E(B),{showErrorToast:R}=ue(),y=b(""),l=b(!1),h=b([]),S=b([]);ee(l,s=>{s&&(y.value="")}),te(async()=>{await Promise.all([L(),N(),B.refreshStripeConnectStatus(D.value)])});const z=v(()=>W.value(D.value)),j=v(()=>z.value?.isReady),T=v(()=>h.value.map(s=>{let o=s.type;switch(o){case"connectedWallet":o="royalties";break;case"channelCommission":o="channel";break}return{...s,type:o,amount:$(s.amount,s.currency),amountTotal:$(s.amountTotal,s.currency),currency:U(s.currency),timestamp:new Date(s.timestamp).toLocaleString()}})),I=v(()=>S.value.map(s=>{const{id:o,amount:n,currency:a,status:u,arrivalTs:_,createdTs:g}=s;return{id:o,amount:$(n,a),status:u,createdTs:new Date(g*1e3).toLocaleString(),arrivalTs:_?new Date(_*1e3).toLocaleString():""}}));async function L(){try{l.value=!0;const s=await $fetch(`${m}/likernft/book/user/commissions/list`,{headers:{authorization:`Bearer ${w.value}`}});h.value=s?.commissions||[],new Set(h.value.filter(n=>!!n.classId).map(n=>n.classId)).forEach(n=>x.lazyFetchClassMetadataById(n))}catch(s){console.error(s),y.value=s.toString(),R(s.toString())}finally{l.value=!1}}async function N(){try{l.value=!0;const s=await $fetch(`${m}/likernft/book/user/payouts/list`,{headers:{authorization:`Bearer ${w.value}`}});S.value=s?.payouts||[]}catch(s){y.value=s.toString(),R(s.toString())}finally{l.value=!1}}async function Y(){const s=new Date().toISOString().split("T")[0],o=[{accessorKey:"timestamp",header:t("user_settings.timestamp")},{accessorKey:"type",header:t("user_settings.commission_type")},{accessorKey:"bookName",header:t("table.book_name")},{accessorKey:"classId",header:t("user_settings.book_id")},{accessorKey:"amount",header:t("user_settings.commission")},{accessorKey:"amountTotal",header:t("user_settings.sale_amount")},{accessorKey:"currency",header:t("user_settings.currency")}],n=h.value.map(a=>({timestamp:new Date(a.timestamp).toLocaleString(),type:(()=>{let u=a.type;switch(u){case"connectedWallet":u="royalties";break;case"channelCommission":u="channel";break}return u})(),bookName:(a.classId?x.getClassMetadataById(a.classId)?.name:"")||"",classId:a.classId||"",amount:K(a.amount,a.currency),currency:U(a.currency),amountTotal:K(a.amountTotal,a.currency)}));await M(n,o,`sales-commission-history-${s}.csv`)}async function q(){const s=new Date().toISOString().split("T")[0],o=[{accessorKey:"createdTs",header:t("user_settings.created")},{accessorKey:"amount",header:t("user_settings.payout_amount")},{accessorKey:"status",header:t("user_settings.status")},{accessorKey:"arrivalTs",header:t("user_settings.arrived")},{accessorKey:"id",header:"ID"}],n=S.value.map(a=>({createdTs:new Date(a.createdTs*1e3).toLocaleString(),amount:K(a.amount,a.currency),status:a.status,arrivalTs:a.arrivalTs?new Date(a.arrivalTs*1e3).toLocaleString():"",id:a.id}));await M(n,o,`sales-payout-history-${s}.csv`)}return(s,o)=>{const n=se,a=oe,u=ne,_=re,g=ae,F=ce;return C(),k(F,null,{default:r(()=>[e(y)?(C(),k(n,{key:0,icon:"i-heroicons-exclamation-triangle",color:"error",variant:"soft",title:`${e(y)}`,close:{icon:"i-heroicons-x-mark-20-solid",color:"error",variant:"link"},onClose:o[0]||(o[0]=d=>y.value="")},null,8,["title"])):H("",!0),e(j)?H("",!0):(C(),k(n,{key:1,icon:"i-heroicons-exclamation-circle",color:"warning",variant:"soft",title:e(t)("user_settings.stripe_express_notice"),description:e(t)("user_settings.stripe_express_description")},null,8,["title","description"])),c(g,{ui:{header:"flex justify-between items-center",body:"p-0",footer:"text-center"}},{header:r(()=>[p("h1",{class:"text-center font-bold font-mono",textContent:f(e(t)("user_settings.commission_history"))},null,8,de),p("div",me,[c(a,{icon:"i-heroicons-arrow-down-tray",variant:"outline",disabled:e(l)||!e(T).length,onClick:Y},{default:r(()=>[A(f(e(t)("common.export_csv",{length:e(T).length})),1)]),_:1},8,["disabled"]),c(u,{text:e(t)("user_settings.commission_history.tooltip"),popper:{placement:"left"}},{default:r(()=>[c(a,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(l),onClick:L},null,8,["disabled"])]),_:1},8,["text"])])]),default:r(()=>[c(_,{columns:[{accessorKey:"timestamp",header:e(t)("user_settings.timestamp")},{accessorKey:"type",header:e(t)("user_settings.commission_type")},{accessorKey:"amount",header:e(t)("user_settings.commission")},{accessorKey:"classId",header:e(t)("user_settings.book_id")},{accessorKey:"currency",header:e(t)("user_settings.currency")},{accessorKey:"amountTotal",header:e(t)("user_settings.sale_amount")}],data:e(T),ui:{th:"text-center",td:"text-center"}},{"classId-cell":r(({row:d})=>[p("a",{href:`${e(O)}/store/${d.original.classId||""}`,target:"_blank"},f((d.original.classId?e(x).getClassMetadataById(d.original.classId)?.name:"")||d.original.classId||""),9,ye)]),_:1},8,["columns","data"])]),_:1}),c(g,{ui:{header:"flex justify-between items-center",body:"p-0",footer:"text-center"}},{header:r(()=>[p("h1",{class:"text-center font-bold font-mono",textContent:f(e(t)("user_settings.payout_history"))},null,8,_e),p("div",pe,[c(a,{icon:"i-heroicons-arrow-down-tray",variant:"outline",disabled:e(l)||!e(I).length,onClick:q},{default:r(()=>[A(f(e(t)("common.export_csv",{length:e(I).length})),1)]),_:1},8,["disabled"]),c(u,{text:"Refresh Status",popper:{placement:"left"}},{default:r(()=>[c(a,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(l),onClick:N},null,8,["disabled"])]),_:1})])]),default:r(()=>[c(_,{columns:[{accessorKey:"createdTs",header:e(t)("user_settings.created")},{accessorKey:"amount",header:e(t)("user_settings.payout_amount")},{accessorKey:"status",header:e(t)("user_settings.status")},{accessorKey:"arrivalTs",header:e(t)("user_settings.arrived")},{accessorKey:"details",header:e(t)("user_settings.details")}],data:e(I),ui:{th:"text-center",td:"text-center"}},{"details-cell":r(({row:d})=>[c(a,{label:e(t)("user_settings.details"),size:"sm",color:"neutral",to:e(V)({name:"sales-report-payouts-payoutId",params:{payoutId:d.original.id}})},null,8,["label","to"])]),_:1},8,["columns","data"])]),_:1})]),_:1})}}});export{Te as default};
