const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./B2LnQrQp.js","./9S2XGRg9.js","./entry.Cz7mG32V.css","./BUjaqu0r.js"])))=>i.map(i=>d[i]);
import{fg as Lh,f6 as cg,bE as lg,bF as ug,bG as hg,bH as fg,fh as ls,a_ as qh,aD as dg}from"./9S2XGRg9.js";import{b as pg,e as wt,x as $a}from"./BUjaqu0r.js";import{h as gg}from"./BP1oHQun.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"cd189bad150b481aa5ecb2e95de26ec677010e55"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new t.Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="15353b55-fa43-47a2-833e-e30261b7361d",t._sentryDebugIdIdentifier="sentry-dbid-15353b55-fa43-47a2-833e-e30261b7361d")})()}catch{}var mc=function(t,e,r){if(r||arguments.length===2)for(var i=0,s=e.length,n;i<s;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},yg=(function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t})(),wg=(function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t})(),mg=(function(){function t(e,r,i,s){this.name=e,this.version=r,this.os=i,this.bot=s,this.type="bot-device"}return t})(),bg=(function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t})(),vg=(function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t})(),Eg=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,_g=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,bc=3,xg=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Eg]],vc=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Ig(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new vg:typeof navigator<"u"?Og(navigator.userAgent):$g()}function Sg(t){return t!==""&&xg.reduce(function(e,r){var i=r[0],s=r[1];if(e)return e;var n=s.exec(t);return!!n&&[i,n]},!1)}function Og(t){var e=Sg(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new bg;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<bc&&(s=mc(mc([],s,!0),Ag(bc-s.length),!0)):s=[];var n=s.join("."),o=Dg(t),a=_g.exec(t);return a&&a[1]?new mg(r,n,o,a[1]):new yg(r,n,o)}function Dg(t){for(var e=0,r=vc.length;e<r;e++){var i=vc[e],s=i[0],n=i[1],o=n.exec(t);if(o)return s}return null}function $g(){var t=typeof process<"u"&&process.version;return t?new wg(process.version.slice(1)):null}function Ag(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Sn={};var To=function(t,e){return To=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},To(t,e)};function Pg(t,e){To(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Co=function(){return Co=Object.assign||function(e){for(var r,i=1,s=arguments.length;i<s;i++){r=arguments[i];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Co.apply(this,arguments)};function Tg(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r}function Cg(t,e,r,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(n=(s<3?o(n):s>3?o(e,r,n):o(e,r))||n);return s>3&&n&&Object.defineProperty(e,r,n),n}function Bg(t,e){return function(r,i){e(r,i,t)}}function Rg(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Ng(t,e,r,i){function s(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function a(u){try{l(i.next(u))}catch(f){o(f)}}function c(u){try{l(i.throw(u))}catch(f){o(f)}}function l(u){u.done?n(u.value):s(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function Ug(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(n=l[0]&2?s.return:l[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,l[1])).done)return n;switch(s=0,n&&(l=[l[0]&2,n.value]),l[0]){case 0:case 1:n=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,s=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!n||l[1]>n[0]&&l[1]<n[3])){r.label=l[1];break}if(l[0]===6&&r.label<n[1]){r.label=n[1],n=l;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(l);break}n[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],s=0}finally{i=n=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function kg(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function jg(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Bo(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function zh(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),s,n=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return n}function Mg(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(zh(arguments[e]));return t}function Lg(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),s=0,e=0;e<r;e++)for(var n=arguments[e],o=0,a=n.length;o<a;o++,s++)i[s]=n[o];return i}function Li(t){return this instanceof Li?(this.v=t,this):new Li(t)}function qg(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),s,n=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(h){i[h]&&(s[h]=function(p){return new Promise(function(d,g){n.push([h,p,d,g])>1||a(h,p)})})}function a(h,p){try{c(i[h](p))}catch(d){f(n[0][3],d)}}function c(h){h.value instanceof Li?Promise.resolve(h.value.v).then(l,u):f(n[0][2],h)}function l(h){a("next",h)}function u(h){a("throw",h)}function f(h,p){h(p),n.shift(),n.length&&a(n[0][0],n[0][1])}}function zg(t){var e,r;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=t[s]?function(o){return(r=!r)?{value:Li(t[s](o)),done:s==="return"}:n?n(o):o}:n}}function Fg(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Bo=="function"?Bo(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(n){r[n]=t[n]&&function(o){return new Promise(function(a,c){o=t[n](o),s(a,c,o.done,o.value)})}}function s(n,o,a,c){Promise.resolve(c).then(function(l){n({value:l,done:a})},o)}}function Vg(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Kg(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Hg(t){return t&&t.__esModule?t:{default:t}}function Wg(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Gg(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const Yg=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Co},__asyncDelegator:zg,__asyncGenerator:qg,__asyncValues:Fg,__await:Li,__awaiter:Ng,__classPrivateFieldGet:Wg,__classPrivateFieldSet:Gg,__createBinding:kg,__decorate:Cg,__exportStar:jg,__extends:Pg,__generator:Ug,__importDefault:Hg,__importStar:Kg,__makeTemplateObject:Vg,__metadata:Rg,__param:Bg,__read:zh,__rest:Tg,__spread:Mg,__spreadArrays:Lg,__values:Bo},Symbol.toStringTag,{value:"Module"})),tn=Lh(Yg);var On={},gi={},Ec;function Zg(){if(Ec)return gi;Ec=1,Object.defineProperty(gi,"__esModule",{value:!0}),gi.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return gi.delay=t,gi}var xr={},Dn={},Ir={},_c;function Jg(){return _c||(_c=1,Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.ONE_THOUSAND=Ir.ONE_HUNDRED=void 0,Ir.ONE_HUNDRED=100,Ir.ONE_THOUSAND=1e3),Ir}var $n={},xc;function Xg(){return xc||(xc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365})($n)),$n}var Ic;function Fh(){return Ic||(Ic=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=tn;e.__exportStar(Jg(),t),e.__exportStar(Xg(),t)})(Dn)),Dn}var Sc;function Qg(){if(Sc)return xr;Sc=1,Object.defineProperty(xr,"__esModule",{value:!0}),xr.fromMiliseconds=xr.toMiliseconds=void 0;const t=Fh();function e(i){return i*t.ONE_THOUSAND}xr.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return xr.fromMiliseconds=r,xr}var Oc;function ey(){return Oc||(Oc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=tn;e.__exportStar(Zg(),t),e.__exportStar(Qg(),t)})(On)),On}var Hr={},Dc;function ty(){if(Dc)return Hr;Dc=1,Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const s=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:s})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return Hr.Watch=t,Hr.default=t,Hr}var An={},yi={},$c;function ry(){if($c)return yi;$c=1,Object.defineProperty(yi,"__esModule",{value:!0}),yi.IWatch=void 0;class t{}return yi.IWatch=t,yi}var Ac;function iy(){return Ac||(Ac=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),tn.__exportStar(ry(),t)})(An)),An}var Pc;function sy(){return Pc||(Pc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=tn;e.__exportStar(ey(),t),e.__exportStar(ty(),t),e.__exportStar(iy(),t),e.__exportStar(Fh(),t)})(Sn)),Sn}var F=sy(),se={},Tc;function Vh(){if(Tc)return se;Tc=1,Object.defineProperty(se,"__esModule",{value:!0}),se.getLocalStorage=se.getLocalStorageOrThrow=se.getCrypto=se.getCryptoOrThrow=se.getLocation=se.getLocationOrThrow=se.getNavigator=se.getNavigatorOrThrow=se.getDocument=se.getDocumentOrThrow=se.getFromWindowOrThrow=se.getFromWindow=void 0;function t(h){let p;return typeof window<"u"&&typeof window[h]<"u"&&(p=window[h]),p}se.getFromWindow=t;function e(h){const p=t(h);if(!p)throw new Error(`${h} is not defined in Window`);return p}se.getFromWindowOrThrow=e;function r(){return e("document")}se.getDocumentOrThrow=r;function i(){return t("document")}se.getDocument=i;function s(){return e("navigator")}se.getNavigatorOrThrow=s;function n(){return t("navigator")}se.getNavigator=n;function o(){return e("location")}se.getLocationOrThrow=o;function a(){return t("location")}se.getLocation=a;function c(){return e("crypto")}se.getCryptoOrThrow=c;function l(){return t("crypto")}se.getCrypto=l;function u(){return e("localStorage")}se.getLocalStorageOrThrow=u;function f(){return t("localStorage")}return se.getLocalStorage=f,se}var er=Vh(),wi={},Cc;function ny(){if(Cc)return wi;Cc=1,Object.defineProperty(wi,"__esModule",{value:!0}),wi.getWindowMetadata=void 0;const t=Vh();function e(){let r,i;try{r=t.getDocumentOrThrow(),i=t.getLocationOrThrow()}catch{return null}function s(){const p=r.getElementsByTagName("link"),d=[];for(let g=0;g<p.length;g++){const m=p[g],E=m.getAttribute("rel");if(E&&E.toLowerCase().indexOf("icon")>-1){const S=m.getAttribute("href");if(S)if(S.toLowerCase().indexOf("https:")===-1&&S.toLowerCase().indexOf("http:")===-1&&S.indexOf("//")!==0){let b=i.protocol+"//"+i.host;if(S.indexOf("/")===0)b+=S;else{const x=i.pathname.split("/");x.pop();const A=x.join("/");b+=A+"/"+S}d.push(b)}else if(S.indexOf("//")===0){const b=i.protocol+S;d.push(b)}else d.push(S)}}return d}function n(...p){const d=r.getElementsByTagName("meta");for(let g=0;g<d.length;g++){const m=d[g],E=["itemprop","property","name"].map(S=>m.getAttribute(S)).filter(S=>S?p.includes(S):!1);if(E.length&&E){const S=m.getAttribute("content");if(S)return S}}return""}function o(){let p=n("name","og:site_name","og:title","twitter:title");return p||(p=r.title),p}function a(){return n("description","og:description","twitter:description","keywords")}const c=o(),l=a(),u=i.origin,f=s();return{description:l,url:u,icons:f,name:c}}return wi.getWindowMetadata=e,wi}var oy=ny();const ay="0.1.1";function cy(){return ay}class le extends Error{constructor(e,r={}){const i=(()=>{if(r.cause instanceof le){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:r.cause?.message?r.cause.message:r.details})(),s=r.cause instanceof le&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${s??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...i||s?["",i?`Details: ${i}`:void 0,s?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${cy()}`}),this.cause=r.cause,this.details=i,this.docs=o,this.docsPath=s,this.shortMessage=e}walk(e){return Kh(this,e)}}function Kh(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?Kh(t.cause,e):e?null:t}const Aa=BigInt(0),Ro=BigInt(1);function Gi(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Pa(t){if(!Gi(t))throw new Error("Uint8Array expected")}function qi(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function us(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Hh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Aa:BigInt("0x"+t)}const Wh=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",ly=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function zi(t){if(Pa(t),Wh)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=ly[t[r]];return e}const jt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Bc(t){if(t>=jt._0&&t<=jt._9)return t-jt._0;if(t>=jt.A&&t<=jt.F)return t-(jt.A-10);if(t>=jt.a&&t<=jt.f)return t-(jt.a-10)}function Us(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Wh)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=Bc(t.charCodeAt(n)),a=Bc(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function kr(t){return Hh(zi(t))}function Gh(t){return Pa(t),Hh(zi(Uint8Array.from(t).reverse()))}function Yi(t,e){return Us(t.toString(16).padStart(e*2,"0"))}function Yh(t,e){return Yi(t,e).reverse()}function ht(t,e,r){let i;if(typeof e=="string")try{i=Us(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(Gi(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}function ks(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];Pa(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}const Pn=t=>typeof t=="bigint"&&Aa<=t;function Ta(t,e,r){return Pn(t)&&Pn(e)&&Pn(r)&&e<=t&&t<r}function ni(t,e,r,i){if(!Ta(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function uy(t){let e;for(e=0;t>Aa;t>>=Ro,e+=1);return e}const rn=t=>(Ro<<BigInt(t))-Ro,Tn=t=>new Uint8Array(t),Rc=t=>Uint8Array.from(t);function hy(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=Tn(t),s=Tn(t),n=0;const o=()=>{i.fill(1),s.fill(0),n=0},a=(...f)=>r(s,i,...f),c=(f=Tn(0))=>{s=a(Rc([0]),f),i=a(),f.length!==0&&(s=a(Rc([1]),f),i=a())},l=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const h=[];for(;f<e;){i=a();const p=i.slice();h.push(p),f+=i.length}return ks(...h)};return(f,h)=>{o(),c(f);let p;for(;!(p=h(l()));)c();return o(),p}}const fy={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Gi(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function sn(t,e,r={}){const i=(s,n,o)=>{const a=fy[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(r))i(s,n,!0);return t}function Nc(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}function dy(t,e){if(Mc(t)>e)throw new Ry({givenSize:Mc(t),maxSize:e})}const Mt={zero:48,nine:57,A:65,F:70,a:97,f:102};function Uc(t){if(t>=Mt.zero&&t<=Mt.nine)return t-Mt.zero;if(t>=Mt.A&&t<=Mt.F)return t-(Mt.A-10);if(t>=Mt.a&&t<=Mt.f)return t-(Mt.a-10)}function py(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;if(t.length>i)throw new Ny({size:t.length,targetSize:i,type:"Bytes"});const s=new Uint8Array(i);for(let n=0;n<i;n++){const o=r==="right";s[o?n:i-n-1]=t[o?n:t.length-n-1]}return s}function Zh(t,e){if(br(t)>e)throw new Iy({givenSize:br(t),maxSize:e})}function gy(t,e){if(typeof e=="number"&&e>0&&e>br(t)-1)throw new Qh({offset:e,position:"start",size:br(t)})}function yy(t,e,r){if(typeof e=="number"&&typeof r=="number"&&br(t)!==r-e)throw new Qh({offset:r,position:"end",size:br(t)})}function Jh(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;const s=t.replace("0x","");if(s.length>i*2)throw new Sy({size:Math.ceil(s.length/2),targetSize:i,type:"Hex"});return`0x${s[r==="right"?"padEnd":"padStart"](i*2,"0")}`}const wy="#__bigint";function Ca(t,e,r){return JSON.stringify(t,(i,s)=>typeof s=="bigint"?s.toString()+wy:s,r)}const my=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function by(t,e={}){const{strict:r=!1}=e;if(!t)throw new kc(t);if(typeof t!="string")throw new kc(t);if(r&&!/^0x[0-9a-fA-F]*$/.test(t))throw new jc(t);if(!t.startsWith("0x"))throw new jc(t)}function vy(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function Ba(t){return t instanceof Uint8Array?js(t):Array.isArray(t)?js(new Uint8Array(t)):t}function js(t,e={}){let r="";for(let s=0;s<t.length;s++)r+=my[t[s]];const i=`0x${r}`;return typeof e.size=="number"?(Zh(i,e.size),Xh(i,e.size)):i}function Cn(t,e={}){const{signed:r,size:i}=e,s=BigInt(t);let n;i?r?n=(1n<<BigInt(i)*8n-1n)-1n:n=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&r?-n-1n:0;if(n&&s>n||s<o){const l=typeof t=="bigint"?"n":"";throw new xy({max:n?`${n}${l}`:void 0,min:`${o}${l}`,signed:r,size:i,value:`${t}${l}`})}const c=`0x${(r&&s<0?(1n<<BigInt(i*8))+BigInt(s):s).toString(16)}`;return i?Ey(c,i):c}function Ey(t,e){return Jh(t,{dir:"left",size:e})}function Xh(t,e){return Jh(t,{dir:"right",size:e})}function Wt(t,e,r,i={}){const{strict:s}=i;gy(t,e);const n=`0x${t.replace("0x","").slice((e??0)*2,(r??t.length)*2)}`;return s&&yy(n,e,r),n}function br(t){return Math.ceil((t.length-2)/2)}function _y(t,e={}){const{strict:r=!1}=e;try{return by(t,{strict:r}),!0}catch{return!1}}class xy extends le{constructor({max:e,min:r,signed:i,size:s,value:n}){super(`Number \`${n}\` is not in safe${s?` ${s*8}-bit`:""}${i?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class kc extends le{constructor(e){super(`Value \`${typeof e=="object"?Ca(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class jc extends le{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let Iy=class extends le{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class Qh extends le{constructor({offset:e,position:r,size:i}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${i}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let Sy=class extends le{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const Oy=new TextEncoder;function Dy(t){if(!(t instanceof Uint8Array)){if(!t)throw new hs(t);if(typeof t!="object")throw new hs(t);if(!("BYTES_PER_ELEMENT"in t))throw new hs(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new hs(t)}}function $y(t){return t instanceof Uint8Array?t:typeof t=="string"?Py(t):Ay(t)}function Ay(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function Py(t,e={}){const{size:r}=e;let i=t;r&&(Zh(t,r),i=Xh(t,r));let s=i.slice(2);s.length%2&&(s=`0${s}`);const n=s.length/2,o=new Uint8Array(n);for(let a=0,c=0;a<n;a++){const l=Uc(s.charCodeAt(c++)),u=Uc(s.charCodeAt(c++));if(l===void 0||u===void 0)throw new le(`Invalid byte sequence ("${s[c-2]}${s[c-1]}" in "${s}").`);o[a]=l*16+u}return o}function Ty(t,e={}){const{size:r}=e,i=Oy.encode(t);return typeof r=="number"?(dy(i,r),Cy(i,r)):i}function Cy(t,e){return py(t,{dir:"right",size:e})}function Mc(t){return t.length}function By(t){try{return Dy(t),!0}catch{return!1}}class hs extends le{constructor(e){super(`Value \`${typeof e=="object"?Ca(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class Ry extends le{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class Ny extends le{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function ef(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,i=cg($y(t));return r==="Bytes"?i:js(i)}class Uy extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const ky={checksum:new Uy(8192)},Bn=ky.checksum;function tf(t,e={}){const{compressed:r}=e,{prefix:i,x:s,y:n}=t;if(r===!1||typeof s=="bigint"&&typeof n=="bigint"){if(i!==4)throw new Lc({prefix:i,cause:new Fy});return}if(r===!0||typeof s=="bigint"&&typeof n>"u"){if(i!==3&&i!==2)throw new Lc({prefix:i,cause:new zy});return}throw new qy({publicKey:t})}function jy(t){const e=(()=>{if(_y(t))return rf(t);if(By(t))return My(t);const{prefix:r,x:i,y:s}=t;return typeof i=="bigint"&&typeof s=="bigint"?{prefix:r??4,x:i,y:s}:{prefix:r,x:i}})();return tf(e),e}function My(t){return rf(js(t))}function rf(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new Vy({publicKey:t});if(t.length===130){const i=BigInt(Wt(t,0,32)),s=BigInt(Wt(t,32,64));return{prefix:4,x:i,y:s}}if(t.length===132){const i=Number(Wt(t,0,1)),s=BigInt(Wt(t,1,33)),n=BigInt(Wt(t,33,65));return{prefix:i,x:s,y:n}}const e=Number(Wt(t,0,1)),r=BigInt(Wt(t,1,33));return{prefix:e,x:r}}function Ly(t,e={}){tf(t);const{prefix:r,x:i,y:s}=t,{includePrefix:n=!0}=e;return vy(n?Cn(r,{size:1}):"0x",Cn(i,{size:32}),typeof s=="bigint"?Cn(s,{size:32}):"0x")}class qy extends le{constructor({publicKey:e}){super(`Value \`${Ca(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class Lc extends le{constructor({prefix:e,cause:r}){super(`Prefix "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class zy extends le{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class Fy extends le{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let Vy=class extends le{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${br(Ba(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const Ky=/^0x[a-fA-F0-9]{40}$/;function sf(t,e={}){const{strict:r=!0}=e;if(!Ky.test(t))throw new qc({address:t,cause:new Gy});if(r){if(t.toLowerCase()===t)return;if(nf(t)!==t)throw new qc({address:t,cause:new Yy})}}function nf(t){if(Bn.has(t))return Bn.get(t);sf(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=ef(Ty(e),{as:"Bytes"}),i=e.split("");for(let n=0;n<40;n+=2)r[n>>1]>>4>=8&&i[n]&&(i[n]=i[n].toUpperCase()),(r[n>>1]&15)>=8&&i[n+1]&&(i[n+1]=i[n+1].toUpperCase());const s=`0x${i.join("")}`;return Bn.set(t,s),s}function Hy(t,e={}){const{checksum:r=!1}=e;return sf(t),r?nf(t):t}function Wy(t,e={}){const r=ef(`0x${Ly(t).slice(4)}`).substring(26);return Hy(`0x${r}`,e)}class qc extends le{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class Gy extends le{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class Yy extends le{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}const Ze=BigInt(0),Me=BigInt(1),Cr=BigInt(2),Zy=BigInt(3),of=BigInt(4),af=BigInt(5),cf=BigInt(8);function We(t,e){const r=t%e;return r>=Ze?r:e+r}function ot(t,e,r){let i=t;for(;e-- >Ze;)i*=i,i%=r;return i}function No(t,e){if(t===Ze)throw new Error("invert: expected non-zero number");if(e<=Ze)throw new Error("invert: expected positive modulus, got "+e);let r=We(t,e),i=e,s=Ze,n=Me;for(;r!==Ze;){const a=i/r,c=i%r,l=s-n*a;i=r,r=c,s=n,n=l}if(i!==Me)throw new Error("invert: does not exist");return We(s,e)}function lf(t,e){const r=(t.ORDER+Me)/of,i=t.pow(e,r);if(!t.eql(t.sqr(i),e))throw new Error("Cannot find square root");return i}function Jy(t,e){const r=(t.ORDER-af)/cf,i=t.mul(e,Cr),s=t.pow(i,r),n=t.mul(e,s),o=t.mul(t.mul(n,Cr),s),a=t.mul(n,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function Xy(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Me,r=0;for(;e%Cr===Ze;)e/=Cr,r++;let i=Cr;const s=Ra(t);for(;zc(s,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return lf;let n=s.pow(i,e);const o=(e+Me)/Cr;return function(c,l){if(c.is0(l))return l;if(zc(c,l)!==1)throw new Error("Cannot find square root");let u=r,f=c.mul(c.ONE,n),h=c.pow(l,e),p=c.pow(l,o);for(;!c.eql(h,c.ONE);){if(c.is0(h))return c.ZERO;let d=1,g=c.sqr(h);for(;!c.eql(g,c.ONE);)if(d++,g=c.sqr(g),d===u)throw new Error("Cannot find square root");const m=Me<<BigInt(u-d-1),E=c.pow(f,m);u=d,f=c.sqr(E),h=c.mul(h,f),p=c.mul(p,E)}return p}}function Qy(t){return t%of===Zy?lf:t%cf===af?Jy:Xy(t)}const ew=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function tw(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=ew.reduce((i,s)=>(i[s]="function",i),e);return sn(t,r)}function rw(t,e,r){if(r<Ze)throw new Error("invalid exponent, negatives unsupported");if(r===Ze)return t.ONE;if(r===Me)return e;let i=t.ONE,s=e;for(;r>Ze;)r&Me&&(i=t.mul(i,s)),s=t.sqr(s),r>>=Me;return i}function uf(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),n=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),n),i}function zc(t,e){const r=(t.ORDER-Me)/Cr,i=t.pow(e,r),s=t.eql(i,t.ONE),n=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!s&&!n&&!o)throw new Error("invalid Legendre symbol result");return s?1:n?0:-1}function hf(t,e){e!==void 0&&lg(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function Ra(t,e,r=!1,i={}){if(t<=Ze)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:n}=hf(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:n,MASK:rn(s),ZERO:Ze,ONE:Me,create:c=>We(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ze<=c&&c<t},is0:c=>c===Ze,isOdd:c=>(c&Me)===Me,neg:c=>We(-c,t),eql:(c,l)=>c===l,sqr:c=>We(c*c,t),add:(c,l)=>We(c+l,t),sub:(c,l)=>We(c-l,t),mul:(c,l)=>We(c*l,t),pow:(c,l)=>rw(a,c,l),div:(c,l)=>We(c*No(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>No(c,t),sqrt:i.sqrt||(c=>(o||(o=Qy(t)),o(a,c))),toBytes:c=>r?Yh(c,n):Yi(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return r?Gh(c):kr(c)},invertBatch:c=>uf(a,c),cmov:(c,l,u)=>u?l:c});return Object.freeze(a)}function ff(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function df(t){const e=ff(t);return e+Math.ceil(e/2)}function iw(t,e,r=!1){const i=t.length,s=ff(e),n=df(e);if(i<16||i<n||i>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+i);const o=r?Gh(t):kr(t),a=We(o,e-Me)+Me;return r?Yh(a,s):Yi(a,s)}const Fc=BigInt(0),Uo=BigInt(1);function Rn(t,e){const r=e.negate();return t?r:e}function pf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Nn(t,e){pf(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),s=2**t,n=rn(t),o=BigInt(t);return{windows:r,windowSize:i,mask:n,maxNumber:s,shiftBy:o}}function Vc(t,e,r){const{windowSize:i,mask:s,maxNumber:n,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>i&&(a-=n,c+=Uo);const l=e*i,u=l+Math.abs(a)-1,f=a===0,h=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:f,isNeg:h,isNegF:p,offsetF:l}}function sw(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function nw(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const Un=new WeakMap,gf=new WeakMap;function kn(t){return gf.get(t)||1}function ow(t,e){return{constTimeNegate:Rn,hasPrecomputes(r){return kn(r)!==1},unsafeLadder(r,i,s=t.ZERO){let n=r;for(;i>Fc;)i&Uo&&(s=s.add(n)),n=n.double(),i>>=Uo;return s},precomputeWindow(r,i){const{windows:s,windowSize:n}=Nn(i,e),o=[];let a=r,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,s){let n=t.ZERO,o=t.BASE;const a=Nn(r,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:f,isNeg:h,isNegF:p,offsetF:d}=Vc(s,c,a);s=l,f?o=o.add(Rn(p,i[d])):n=n.add(Rn(h,i[u]))}return{p:n,f:o}},wNAFUnsafe(r,i,s,n=t.ZERO){const o=Nn(r,e);for(let a=0;a<o.windows&&s!==Fc;a++){const{nextN:c,offset:l,isZero:u,isNeg:f}=Vc(s,a,o);if(s=c,!u){const h=i[l];n=n.add(f?h.negate():h)}}return n},getPrecomputes(r,i,s){let n=Un.get(i);return n||(n=this.precomputeWindow(i,r),r!==1&&Un.set(i,s(n))),n},wNAFCached(r,i,s){const n=kn(r);return this.wNAF(n,this.getPrecomputes(n,r,s),i)},wNAFCachedUnsafe(r,i,s,n){const o=kn(r);return o===1?this.unsafeLadder(r,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),i,n)},setWindowSize(r,i){pf(i,e),gf.set(r,i),Un.delete(r)}}}function aw(t,e,r,i){sw(r,t),nw(i,e);const s=r.length,n=i.length;if(s!==n)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=uy(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=rn(c),u=new Array(Number(l)+1).fill(o),f=Math.floor((e.BITS-1)/c)*c;let h=o;for(let p=f;p>=0;p-=c){u.fill(o);for(let g=0;g<n;g++){const m=i[g],E=Number(m>>BigInt(p)&l);u[E]=u[E].add(r[g])}let d=o;for(let g=u.length-1,m=o;g>0;g--)m=m.add(u[g]),d=d.add(m);if(h=h.add(d),p!==0)for(let g=0;g<c;g++)h=h.double()}return h}function yf(t){return tw(t.Fp),sn(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...hf(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function Kc(t){t.lowS!==void 0&&qi("lowS",t.lowS),t.prehash!==void 0&&qi("prehash",t.prehash)}function cw(t){const e=yf(t);sn(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:i,a:s}=e;if(r){if(!i.eql(s,i.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class lw extends Error{constructor(e=""){super(e)}}const Gt={Err:lw,_tlv:{encode:(t,e)=>{const{Err:r}=Gt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,s=us(i);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const n=i>127?us(s.length/2|128):"";return us(t)+n+s+e},decode(t,e){const{Err:r}=Gt;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[i++],n=!!(s&128);let o=0;if(!n)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(i,i+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=Gt;if(t<Zt)throw new e("integer: negative integers are not allowed");let r=us(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Gt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return kr(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=Gt,s=ht("signature",t),{v:n,l:o}=i.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,n),{v:l,l:u}=i.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=Gt,i=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),n=i+s;return e.encode(48,n)}};function jn(t,e){return zi(Yi(t,e))}const Zt=BigInt(0),xe=BigInt(1);BigInt(2);const Mn=BigInt(3),uw=BigInt(4);function hw(t){const e=cw(t),{Fp:r}=e,i=Ra(e.n,e.nBitLength),s=e.toBytes||((b,x,A)=>{const v=x.toAffine();return ks(Uint8Array.from([4]),r.toBytes(v.x),r.toBytes(v.y))}),n=e.fromBytes||(b=>{const x=b.subarray(1),A=r.fromBytes(x.subarray(0,r.BYTES)),v=r.fromBytes(x.subarray(r.BYTES,2*r.BYTES));return{x:A,y:v}});function o(b){const{a:x,b:A}=e,v=r.sqr(b),C=r.mul(v,b);return r.add(r.add(C,r.mul(b,x)),A)}function a(b,x){const A=r.sqr(x),v=o(b);return r.eql(A,v)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,Mn),uw),l=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,l)))throw new Error("bad curve params: a or b");function u(b){return Ta(b,xe,e.n)}function f(b){const{allowedPrivateKeyLengths:x,nByteLength:A,wrapPrivateKey:v,n:C}=e;if(x&&typeof b!="bigint"){if(Gi(b)&&(b=zi(b)),typeof b!="string"||!x.includes(b.length))throw new Error("invalid private key");b=b.padStart(A*2,"0")}let R;try{R=typeof b=="bigint"?b:kr(ht("private key",b,A))}catch{throw new Error("invalid private key, expected hex or "+A+" bytes, got "+typeof b)}return v&&(R=We(R,C)),ni("private key",R,xe,C),R}function h(b){if(!(b instanceof g))throw new Error("ProjectivePoint expected")}const p=Nc((b,x)=>{const{px:A,py:v,pz:C}=b;if(r.eql(C,r.ONE))return{x:A,y:v};const R=b.is0();x==null&&(x=R?r.ONE:r.inv(C));const T=r.mul(A,x),k=r.mul(v,x),N=r.mul(C,x);if(R)return{x:r.ZERO,y:r.ZERO};if(!r.eql(N,r.ONE))throw new Error("invZ was invalid");return{x:T,y:k}}),d=Nc(b=>{if(b.is0()){if(e.allowInfinityPoint&&!r.is0(b.py))return;throw new Error("bad point: ZERO")}const{x,y:A}=b.toAffine();if(!r.isValid(x)||!r.isValid(A))throw new Error("bad point: x or y not FE");if(!a(x,A))throw new Error("bad point: equation left != right");if(!b.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(x,A,v){if(x==null||!r.isValid(x))throw new Error("x required");if(A==null||!r.isValid(A)||r.is0(A))throw new Error("y required");if(v==null||!r.isValid(v))throw new Error("z required");this.px=x,this.py=A,this.pz=v,Object.freeze(this)}static fromAffine(x){const{x:A,y:v}=x||{};if(!x||!r.isValid(A)||!r.isValid(v))throw new Error("invalid affine point");if(x instanceof g)throw new Error("projective point not allowed");const C=R=>r.eql(R,r.ZERO);return C(A)&&C(v)?g.ZERO:new g(A,v,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(x){const A=uf(r,x.map(v=>v.pz));return x.map((v,C)=>v.toAffine(A[C])).map(g.fromAffine)}static fromHex(x){const A=g.fromAffine(n(ht("pointHex",x)));return A.assertValidity(),A}static fromPrivateKey(x){return g.BASE.multiply(f(x))}static msm(x,A){return aw(g,i,x,A)}_setWindowSize(x){S.setWindowSize(this,x)}assertValidity(){d(this)}hasEvenY(){const{y:x}=this.toAffine();if(r.isOdd)return!r.isOdd(x);throw new Error("Field doesn't support isOdd")}equals(x){h(x);const{px:A,py:v,pz:C}=this,{px:R,py:T,pz:k}=x,N=r.eql(r.mul(A,k),r.mul(R,C)),B=r.eql(r.mul(v,k),r.mul(T,C));return N&&B}negate(){return new g(this.px,r.neg(this.py),this.pz)}double(){const{a:x,b:A}=e,v=r.mul(A,Mn),{px:C,py:R,pz:T}=this;let k=r.ZERO,N=r.ZERO,B=r.ZERO,$=r.mul(C,C),D=r.mul(R,R),y=r.mul(T,T),w=r.mul(C,R);return w=r.add(w,w),B=r.mul(C,T),B=r.add(B,B),k=r.mul(x,B),N=r.mul(v,y),N=r.add(k,N),k=r.sub(D,N),N=r.add(D,N),N=r.mul(k,N),k=r.mul(w,k),B=r.mul(v,B),y=r.mul(x,y),w=r.sub($,y),w=r.mul(x,w),w=r.add(w,B),B=r.add($,$),$=r.add(B,$),$=r.add($,y),$=r.mul($,w),N=r.add(N,$),y=r.mul(R,T),y=r.add(y,y),$=r.mul(y,w),k=r.sub(k,$),B=r.mul(y,D),B=r.add(B,B),B=r.add(B,B),new g(k,N,B)}add(x){h(x);const{px:A,py:v,pz:C}=this,{px:R,py:T,pz:k}=x;let N=r.ZERO,B=r.ZERO,$=r.ZERO;const D=e.a,y=r.mul(e.b,Mn);let w=r.mul(A,R),_=r.mul(v,T),P=r.mul(C,k),I=r.add(A,v),O=r.add(R,T);I=r.mul(I,O),O=r.add(w,_),I=r.sub(I,O),O=r.add(A,C);let U=r.add(R,k);return O=r.mul(O,U),U=r.add(w,P),O=r.sub(O,U),U=r.add(v,C),N=r.add(T,k),U=r.mul(U,N),N=r.add(_,P),U=r.sub(U,N),$=r.mul(D,O),N=r.mul(y,P),$=r.add(N,$),N=r.sub(_,$),$=r.add(_,$),B=r.mul(N,$),_=r.add(w,w),_=r.add(_,w),P=r.mul(D,P),O=r.mul(y,O),_=r.add(_,P),P=r.sub(w,P),P=r.mul(D,P),O=r.add(O,P),w=r.mul(_,O),B=r.add(B,w),w=r.mul(U,O),N=r.mul(I,N),N=r.sub(N,w),w=r.mul(I,_),$=r.mul(U,$),$=r.add($,w),new g(N,B,$)}subtract(x){return this.add(x.negate())}is0(){return this.equals(g.ZERO)}wNAF(x){return S.wNAFCached(this,x,g.normalizeZ)}multiplyUnsafe(x){const{endo:A,n:v}=e;ni("scalar",x,Zt,v);const C=g.ZERO;if(x===Zt)return C;if(this.is0()||x===xe)return this;if(!A||S.hasPrecomputes(this))return S.wNAFCachedUnsafe(this,x,g.normalizeZ);let{k1neg:R,k1:T,k2neg:k,k2:N}=A.splitScalar(x),B=C,$=C,D=this;for(;T>Zt||N>Zt;)T&xe&&(B=B.add(D)),N&xe&&($=$.add(D)),D=D.double(),T>>=xe,N>>=xe;return R&&(B=B.negate()),k&&($=$.negate()),$=new g(r.mul($.px,A.beta),$.py,$.pz),B.add($)}multiply(x){const{endo:A,n:v}=e;ni("scalar",x,xe,v);let C,R;if(A){const{k1neg:T,k1:k,k2neg:N,k2:B}=A.splitScalar(x);let{p:$,f:D}=this.wNAF(k),{p:y,f:w}=this.wNAF(B);$=S.constTimeNegate(T,$),y=S.constTimeNegate(N,y),y=new g(r.mul(y.px,A.beta),y.py,y.pz),C=$.add(y),R=D.add(w)}else{const{p:T,f:k}=this.wNAF(x);C=T,R=k}return g.normalizeZ([C,R])[0]}multiplyAndAddUnsafe(x,A,v){const C=g.BASE,R=(k,N)=>N===Zt||N===xe||!k.equals(C)?k.multiplyUnsafe(N):k.multiply(N),T=R(this,A).add(R(x,v));return T.is0()?void 0:T}toAffine(x){return p(this,x)}isTorsionFree(){const{h:x,isTorsionFree:A}=e;if(x===xe)return!0;if(A)return A(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:x,clearCofactor:A}=e;return x===xe?this:A?A(g,this):this.multiplyUnsafe(e.h)}toRawBytes(x=!0){return qi("isCompressed",x),this.assertValidity(),s(g,this,x)}toHex(x=!0){return qi("isCompressed",x),zi(this.toRawBytes(x))}}g.BASE=new g(e.Gx,e.Gy,r.ONE),g.ZERO=new g(r.ZERO,r.ONE,r.ZERO);const{endo:m,nBitLength:E}=e,S=ow(g,m?Math.ceil(E/2):E);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:f,weierstrassEquation:o,isWithinCurveOrder:u}}function fw(t){const e=yf(t);return sn(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function dw(t){const e=fw(t),{Fp:r,n:i,nByteLength:s,nBitLength:n}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(y){return We(y,i)}function l(y){return No(y,i)}const{ProjectivePoint:u,normPrivateKeyToScalar:f,weierstrassEquation:h,isWithinCurveOrder:p}=hw({...e,toBytes(y,w,_){const P=w.toAffine(),I=r.toBytes(P.x),O=ks;return qi("isCompressed",_),_?O(Uint8Array.from([w.hasEvenY()?2:3]),I):O(Uint8Array.from([4]),I,r.toBytes(P.y))},fromBytes(y){const w=y.length,_=y[0],P=y.subarray(1);if(w===o&&(_===2||_===3)){const I=kr(P);if(!Ta(I,xe,r.ORDER))throw new Error("Point is not on curve");const O=h(I);let U;try{U=r.sqrt(O)}catch(L){const q=L instanceof Error?": "+L.message:"";throw new Error("Point is not on curve"+q)}const j=(U&xe)===xe;return(_&1)===1!==j&&(U=r.neg(U)),{x:I,y:U}}else if(w===a&&_===4){const I=r.fromBytes(P.subarray(0,r.BYTES)),O=r.fromBytes(P.subarray(r.BYTES,2*r.BYTES));return{x:I,y:O}}else{const I=o,O=a;throw new Error("invalid Point, expected length of "+I+", or uncompressed "+O+", got "+w)}}});function d(y){const w=i>>xe;return y>w}function g(y){return d(y)?c(-y):y}const m=(y,w,_)=>kr(y.slice(w,_));class E{constructor(w,_,P){ni("r",w,xe,i),ni("s",_,xe,i),this.r=w,this.s=_,P!=null&&(this.recovery=P),Object.freeze(this)}static fromCompact(w){const _=s;return w=ht("compactSignature",w,_*2),new E(m(w,0,_),m(w,_,2*_))}static fromDER(w){const{r:_,s:P}=Gt.toSig(ht("DER",w));return new E(_,P)}assertValidity(){}addRecoveryBit(w){return new E(this.r,this.s,w)}recoverPublicKey(w){const{r:_,s:P,recovery:I}=this,O=C(ht("msgHash",w));if(I==null||![0,1,2,3].includes(I))throw new Error("recovery id invalid");const U=I===2||I===3?_+e.n:_;if(U>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const j=(I&1)===0?"02":"03",V=u.fromHex(j+jn(U,r.BYTES)),L=l(U),q=c(-O*L),H=c(P*L),G=u.BASE.multiplyAndAddUnsafe(V,q,H);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new E(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Us(this.toDERHex())}toDERHex(){return Gt.hexFromSig(this)}toCompactRawBytes(){return Us(this.toCompactHex())}toCompactHex(){const w=s;return jn(this.r,w)+jn(this.s,w)}}const S={isValidPrivateKey(y){try{return f(y),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const y=df(e.n);return iw(e.randomBytes(y),e.n)},precompute(y=8,w=u.BASE){return w._setWindowSize(y),w.multiply(BigInt(3)),w}};function b(y,w=!0){return u.fromPrivateKey(y).toRawBytes(w)}function x(y){if(typeof y=="bigint")return!1;if(y instanceof u)return!0;const _=ht("key",y).length,P=r.BYTES,I=P+1,O=2*P+1;if(!(e.allowedPrivateKeyLengths||s===I))return _===I||_===O}function A(y,w,_=!0){if(x(y)===!0)throw new Error("first arg must be private key");if(x(w)===!1)throw new Error("second arg must be public key");return u.fromHex(w).multiply(f(y)).toRawBytes(_)}const v=e.bits2int||function(y){if(y.length>8192)throw new Error("input is too large");const w=kr(y),_=y.length*8-n;return _>0?w>>BigInt(_):w},C=e.bits2int_modN||function(y){return c(v(y))},R=rn(n);function T(y){return ni("num < 2^"+n,y,Zt,R),Yi(y,s)}function k(y,w,_=N){if(["recovered","canonical"].some(W=>W in _))throw new Error("sign() legacy options not supported");const{hash:P,randomBytes:I}=e;let{lowS:O,prehash:U,extraEntropy:j}=_;O==null&&(O=!0),y=ht("msgHash",y),Kc(_),U&&(y=ht("prehashed msgHash",P(y)));const V=C(y),L=f(w),q=[T(L),T(V)];if(j!=null&&j!==!1){const W=j===!0?I(r.BYTES):j;q.push(ht("extraEntropy",W))}const H=ks(...q),G=V;function Z(W){const J=v(W);if(!p(J))return;const ue=l(J),ye=u.BASE.multiply(J).toAffine(),ve=c(ye.x);if(ve===Zt)return;const je=c(ue*c(G+ve*L));if(je===Zt)return;let St=(ye.x===ve?0:2)|Number(ye.y&xe),cs=je;return O&&d(je)&&(cs=g(je),St^=1),new E(ve,cs,St)}return{seed:H,k2sig:Z}}const N={lowS:e.lowS,prehash:!1},B={lowS:e.lowS,prehash:!1};function $(y,w,_=N){const{seed:P,k2sig:I}=k(y,w,_),O=e;return hy(O.hash.outputLen,O.nByteLength,O.hmac)(P,I)}u.BASE._setWindowSize(8);function D(y,w,_,P=B){const I=y;w=ht("msgHash",w),_=ht("publicKey",_);const{lowS:O,prehash:U,format:j}=P;if(Kc(P),"strict"in P)throw new Error("options.strict was renamed to lowS");if(j!==void 0&&j!=="compact"&&j!=="der")throw new Error("format must be compact or der");const V=typeof I=="string"||Gi(I),L=!V&&!j&&typeof I=="object"&&I!==null&&typeof I.r=="bigint"&&typeof I.s=="bigint";if(!V&&!L)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let q,H;try{if(L&&(q=new E(I.r,I.s)),V){try{j!=="compact"&&(q=E.fromDER(I))}catch(St){if(!(St instanceof Gt.Err))throw St}!q&&j!=="der"&&(q=E.fromCompact(I))}H=u.fromHex(_)}catch{return!1}if(!q||O&&q.hasHighS())return!1;U&&(w=e.hash(w));const{r:G,s:Z}=q,W=C(w),J=l(Z),ue=c(W*J),ye=c(G*J),ve=u.BASE.multiplyAndAddUnsafe(H,ue,ye)?.toAffine();return ve?c(ve.x)===G:!1}return{CURVE:e,getPublicKey:b,getSharedSecret:A,sign:$,verify:D,ProjectivePoint:u,Signature:E,utils:S}}function pw(t){return{hash:t,hmac:(e,...r)=>gg(t,e,hg(...r)),randomBytes:ug}}function gw(t,e){const r=i=>dw({...t,...pw(i)});return{...r(e),create:r}}const wf=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Hc=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),yw=BigInt(0),ww=BigInt(1),ko=BigInt(2),Wc=(t,e)=>(t+e/ko)/e;function mw(t){const e=wf,r=BigInt(3),i=BigInt(6),s=BigInt(11),n=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,u=l*l*t%e,f=ot(u,r,e)*u%e,h=ot(f,r,e)*u%e,p=ot(h,ko,e)*l%e,d=ot(p,s,e)*p%e,g=ot(d,n,e)*d%e,m=ot(g,a,e)*g%e,E=ot(m,c,e)*m%e,S=ot(E,a,e)*g%e,b=ot(S,r,e)*u%e,x=ot(b,o,e)*d%e,A=ot(x,i,e)*l%e,v=ot(A,ko,e);if(!jo.eql(jo.sqr(v),t))throw new Error("Cannot find square root");return v}const jo=Ra(wf,void 0,void 0,{sqrt:mw}),bw=gw({a:yw,b:BigInt(7),Fp:jo,n:Hc,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Hc,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-ww*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),n=r,o=BigInt("0x100000000000000000000000000000000"),a=Wc(n*t,e),c=Wc(-i*t,e);let l=We(t-a*r-c*s,e),u=We(-a*i-c*n,e);const f=l>o,h=u>o;if(f&&(l=e-l),h&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:f,k1:l,k2neg:h,k2:u}}}},fg);function vw(t){if(t.length!==130&&t.length!==132)throw new _w({signature:t});const e=BigInt(Wt(t,0,32)),r=BigInt(Wt(t,32,64)),i=(()=>{const s=+`0x${t.slice(130)}`;if(!Number.isNaN(s))try{return Ew(s)}catch{throw new xw({value:s})}})();return typeof i>"u"?{r:e,s:r}:{r:e,s:r,yParity:i}}function Ew(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new Iw({value:t})}class _w extends le{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${br(Ba(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class xw extends le{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class Iw extends le{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}function Sw(t){return Wy(Ow(t))}function Ow(t){const{payload:e,signature:r}=t,{r:i,s,yParity:n}=r,a=new bw.Signature(BigInt(i),BigInt(s)).addRecoveryBit(n).recoverPublicKey(Ba(e).substring(2));return jy(a)}function Dw(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){const u=t.charAt(l),f=u.charCodeAt(0);if(e[f]!==255)throw new TypeError(u+" is ambiguous");e[f]=l}const r=t.length,i=t.charAt(0),s=Math.log(r)/Math.log(256),n=Math.log(256)/Math.log(r);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,f=0,h=0;const p=l.length;for(;h!==p&&l[h]===0;)h++,u++;const d=(p-h)*n+1>>>0,g=new Uint8Array(d);for(;h!==p;){let S=l[h],b=0;for(let x=d-1;(S!==0||b<f)&&x!==-1;x--,b++)S+=256*g[x]>>>0,g[x]=S%r>>>0,S=S/r>>>0;if(S!==0)throw new Error("Non-zero carry");f=b,h++}let m=d-f;for(;m!==d&&g[m]===0;)m++;let E=i.repeat(u);for(;m<d;++m)E+=t.charAt(g[m]);return E}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,f=0,h=0;for(;l[u]===i;)f++,u++;const p=(l.length-u)*s+1>>>0,d=new Uint8Array(p);for(;u<l.length;){const S=l.charCodeAt(u);if(S>255)return;let b=e[S];if(b===255)return;let x=0;for(let A=p-1;(b!==0||x<h)&&A!==-1;A--,x++)b+=r*d[A]>>>0,d[A]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");h=x,u++}let g=p-h;for(;g!==p&&d[g]===0;)g++;const m=new Uint8Array(f+(p-g));let E=f;for(;g!==p;)m[E++]=d[g++];return m}function c(l){const u=a(l);if(u)return u;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var $w="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Zi=Dw($w);function Aw(t){const e=t.length;let r=0,i=0;for(;i<e;){let s=t.charCodeAt(i++);if((s&4294967168)===0){r++;continue}else if((s&4294965248)===0)r+=2;else{if(s>=55296&&s<=56319&&i<e){const n=t.charCodeAt(i);(n&64512)===56320&&(++i,s=((s&1023)<<10)+(n&1023)+65536)}(s&4294901760)===0?r+=3:r+=4}}return r}function Pw(t,e,r){const i=t.length;let s=r,n=0;for(;n<i;){let o=t.charCodeAt(n++);if((o&4294967168)===0){e[s++]=o;continue}else if((o&4294965248)===0)e[s++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&n<i){const a=t.charCodeAt(n);(a&64512)===56320&&(++n,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[s++]=o>>12&15|224,e[s++]=o>>6&63|128):(e[s++]=o>>18&7|240,e[s++]=o>>12&63|128,e[s++]=o>>6&63|128)}e[s++]=o&63|128}}const Tw=new TextEncoder,Cw=50;function Bw(t,e,r){Tw.encodeInto(t,e.subarray(r))}function Rw(t,e,r){t.length>Cw?Bw(t,e,r):Pw(t,e,r)}const Nw=4096;function mf(t,e,r){let i=e;const s=i+r,n=[];let o="";for(;i<s;){const a=t[i++];if((a&128)===0)n.push(a);else if((a&224)===192){const c=t[i++]&63;n.push((a&31)<<6|c)}else if((a&240)===224){const c=t[i++]&63,l=t[i++]&63;n.push((a&31)<<12|c<<6|l)}else if((a&248)===240){const c=t[i++]&63,l=t[i++]&63,u=t[i++]&63;let f=(a&7)<<18|c<<12|l<<6|u;f>65535&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|f&1023),n.push(f)}else n.push(a);n.length>=Nw&&(o+=String.fromCharCode(...n),n.length=0)}return n.length>0&&(o+=String.fromCharCode(...n)),o}const Uw=new TextDecoder,kw=200;function jw(t,e,r){const i=t.subarray(e,e+r);return Uw.decode(i)}function Mw(t,e,r){return r>kw?jw(t,e,r):mf(t,e,r)}class fs{constructor(e,r){this.type=e,this.data=r}}class it extends Error{constructor(e){super(e);const r=Object.create(it.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:it.name})}}const mi=4294967295;function Lw(t,e,r){const i=r/4294967296,s=r;t.setUint32(e,i),t.setUint32(e+4,s)}function bf(t,e,r){const i=Math.floor(r/4294967296),s=r;t.setUint32(e,i),t.setUint32(e+4,s)}function vf(t,e){const r=t.getInt32(e),i=t.getUint32(e+4);return r*4294967296+i}function qw(t,e){const r=t.getUint32(e),i=t.getUint32(e+4);return r*4294967296+i}const zw=-1,Fw=4294967296-1,Vw=17179869184-1;function Kw({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=Vw)if(e===0&&t<=Fw){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,i=t&4294967295,s=new Uint8Array(8),n=new DataView(s.buffer);return n.setUint32(0,e<<2|r&3),n.setUint32(4,i),s}else{const r=new Uint8Array(12),i=new DataView(r.buffer);return i.setUint32(0,e),bf(i,4,t),r}}function Hw(t){const e=t.getTime(),r=Math.floor(e/1e3),i=(e-r*1e3)*1e6,s=Math.floor(i/1e9);return{sec:r+s,nsec:i-s*1e9}}function Ww(t){if(t instanceof Date){const e=Hw(t);return Kw(e)}else return null}function Gw(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),i=e.getUint32(4),s=(r&3)*4294967296+i,n=r>>>2;return{sec:s,nsec:n}}case 12:{const r=vf(e,4),i=e.getUint32(0);return{sec:r,nsec:i}}default:throw new it(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function Yw(t){const e=Gw(t);return new Date(e.sec*1e3+e.nsec/1e6)}const Zw={type:zw,encode:Ww,decode:Yw};class Ms{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Zw)}register({type:e,encode:r,decode:i}){if(e>=0)this.encoders[e]=r,this.decoders[e]=i;else{const s=-1-e;this.builtInEncoders[s]=r,this.builtInDecoders[s]=i}}tryToEncode(e,r){for(let i=0;i<this.builtInEncoders.length;i++){const s=this.builtInEncoders[i];if(s!=null){const n=s(e,r);if(n!=null){const o=-1-i;return new fs(o,n)}}}for(let i=0;i<this.encoders.length;i++){const s=this.encoders[i];if(s!=null){const n=s(e,r);if(n!=null){const o=i;return new fs(o,n)}}}return e instanceof fs?e:null}decode(e,r,i){const s=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return s?s(e,r,i):new fs(r,e)}}Ms.defaultCodec=new Ms;function Jw(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function Mo(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Jw(t)?new Uint8Array(t):Uint8Array.from(t)}const Xw=100,Qw=2048;let em=class Ef{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??Ms.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??Xw,this.initialBufferSize=e?.initialBufferSize??Qw,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new Ef({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),i=new Uint8Array(r),s=new DataView(r);i.set(this.bytes),this.view=s,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const i=Aw(e);this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),Rw(e,this.bytes,this.pos),this.pos+=i}encodeObject(e,r){const i=this.extensionCodec.tryToEncode(e,this.context);if(i!=null)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const i=Mo(e);this.writeU8a(i)}encodeArray(e,r){const i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw new Error(`Too large array: ${i}`);for(const s of e)this.doEncode(s,r+1)}countWithoutUndefined(e,r){let i=0;for(const s of r)e[s]!==void 0&&i++;return i}encodeMap(e,r){const i=Object.keys(e);this.sortKeys&&i.sort();const s=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error(`Too large map object: ${s}`);for(const n of i){const o=e[n];this.ignoreUndefined&&o===void 0||(this.encodeString(n),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const i=e.data(this.pos+6),s=i.length;if(s>=4294967296)throw new Error(`Too large extension object: ${s}`);this.writeU8(201),this.writeU32(s),this.writeI8(e.type),this.writeU8a(i);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),Lw(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),bf(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function tm(t,e){return new em(e).encodeSharedRef(t)}function Ln(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const rm=16,im=16;class sm{constructor(e=rm,r=im){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,i){const s=this.caches[i-1];e:for(const n of s){const o=n.bytes;for(let a=0;a<i;a++)if(o[a]!==e[r+a])continue e;return n.str}return null}store(e,r){const i=this.caches[e.length-1],s={bytes:e,str:r};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=s:i.push(s)}decode(e,r,i){const s=this.find(e,r,i);if(s!=null)return this.hit++,s;this.miss++;const n=mf(e,r,i),o=Uint8Array.prototype.slice.call(e,r,r+i);return this.store(o,n),n}}const Lo="array",Ri="map_key",_f="map_value",nm=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new it("The type of key must be string or number but "+typeof t)};class om{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=Lo,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=Ri,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===Lo){const i=e;i.size=0,i.array=void 0,i.position=0,i.type=void 0}if(e.type===Ri||e.type===_f){const i=e;i.size=0,i.map=void 0,i.readCount=0,i.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const bi=-1,Na=new DataView(new ArrayBuffer(0)),am=new Uint8Array(Na.buffer);try{Na.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const Gc=new RangeError("Insufficient data"),cm=new sm;let lm=class xf{constructor(e){this.totalPos=0,this.pos=0,this.view=Na,this.bytes=am,this.headByte=bi,this.stack=new om,this.entered=!1,this.extensionCodec=e?.extensionCodec??Ms.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??mi,this.maxBinLength=e?.maxBinLength??mi,this.maxArrayLength=e?.maxArrayLength??mi,this.maxMapLength=e?.maxMapLength??mi,this.maxExtLength=e?.maxExtLength??mi,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:cm,this.mapKeyConverter=e?.mapKeyConverter??nm}clone(){return new xf({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=bi,this.stack.reset()}setBuffer(e){const r=Mo(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===bi&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),i=Mo(e),s=new Uint8Array(r.length+i.length);s.set(r),s.set(i,r.length),this.setBuffer(s)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:i}=this;return new RangeError(`Extra ${r.byteLength-i} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,i;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{i=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return i}const{headByte:s,pos:n,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${Ln(s)} at ${o} (${n} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let i=r,s=-1;for await(const n of e){if(r&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(n),i&&(s=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),--s!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const s=e-128;if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e<160){const s=e-144;if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else{const s=e-160;r=this.decodeString(s,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const s=this.lookU8();r=this.decodeString(s,1)}else if(e===218){const s=this.lookU16();r=this.decodeString(s,2)}else if(e===219){const s=this.lookU32();r=this.decodeString(s,4)}else if(e===220){const s=this.readU16();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===221){const s=this.readU32();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===222){const s=this.readU16();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===223){const s=this.readU32();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===196){const s=this.lookU8();r=this.decodeBinary(s,1)}else if(e===197){const s=this.lookU16();r=this.decodeBinary(s,2)}else if(e===198){const s=this.lookU32();r=this.decodeBinary(s,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const s=this.lookU8();r=this.decodeExtension(s,1)}else if(e===200){const s=this.lookU16();r=this.decodeExtension(s,2)}else if(e===201){const s=this.lookU32();r=this.decodeExtension(s,4)}else throw new it(`Unrecognized type byte: ${Ln(e)}`);this.complete();const i=this.stack;for(;i.length>0;){const s=i.top();if(s.type===Lo)if(s.array[s.position]=r,s.position++,s.position===s.size)r=s.array,i.release(s);else continue e;else if(s.type===Ri){if(r==="__proto__")throw new it("The key __proto__ is not allowed");s.key=this.mapKeyConverter(r),s.type=_f;continue e}else if(s.map[s.key]=r,s.readCount++,s.readCount===s.size)r=s.map,i.release(s);else{s.key=null,s.type=Ri;continue e}}return r}}readHeadByte(){return this.headByte===bi&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=bi}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new it(`Unrecognized array type byte: ${Ln(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new it(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new it(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){if(e>this.maxStrLength)throw new it(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw Gc;const i=this.pos+r;let s;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?s=this.keyDecoder.decode(this.bytes,i,e):s=Mw(this.bytes,i,e),this.pos+=r+e,s}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===Ri:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new it(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw Gc;const i=this.pos+r,s=this.bytes.subarray(i,i+e);return this.pos+=r+e,s}decodeExtension(e,r){if(e>this.maxExtLength)throw new it(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const i=this.view.getInt8(this.pos+r),s=this.decodeBinary(e,r+1);return this.extensionCodec.decode(s,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=qw(this.view,this.pos);return this.pos+=8,e}readI64(){const e=vf(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function um(t,e){return new lm(e).decode(t)}const hm=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),fm=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function jr(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return fm(t)}catch{return t}}function tr(t){return typeof t=="string"?t:hm(t)||""}function dm(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function If(t,...e){if(!dm(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Yc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function pm(t,e){If(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Wr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const qn=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function gm(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Sf(t){return typeof t=="string"&&(t=gm(t)),If(t),t}let ym=class{clone(){return this._cloneInto()}};function wm(t){const e=i=>t().update(Sf(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Of(t=32){if(Wr&&typeof Wr.getRandomValues=="function")return Wr.getRandomValues(new Uint8Array(t));if(Wr&&typeof Wr.randomBytes=="function")return Wr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function mm(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}let bm=class extends ym{constructor(e,r,i,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=qn(this.buffer)}update(e){Yc(this);const{view:r,buffer:i,blockLen:s}=this;e=Sf(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=qn(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Yc(this),pm(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let f=o;f<s;f++)r[f]=0;mm(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=qn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)a.setUint32(4*f,u[f],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=n,e.destroyed=o,s%r&&e.buffer.set(i),e}};const ds=BigInt(2**32-1),qo=BigInt(32);function Df(t,e=!1){return e?{h:Number(t&ds),l:Number(t>>qo&ds)}:{h:Number(t>>qo&ds)|0,l:Number(t&ds)|0}}function vm(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:n,l:o}=Df(t[s],e);[r[s],i[s]]=[n,o]}return[r,i]}const Em=(t,e)=>BigInt(t>>>0)<<qo|BigInt(e>>>0),_m=(t,e,r)=>t>>>r,xm=(t,e,r)=>t<<32-r|e>>>r,Im=(t,e,r)=>t>>>r|e<<32-r,Sm=(t,e,r)=>t<<32-r|e>>>r,Om=(t,e,r)=>t<<64-r|e>>>r-32,Dm=(t,e,r)=>t>>>r-32|e<<64-r,$m=(t,e)=>e,Am=(t,e)=>t,Pm=(t,e,r)=>t<<r|e>>>32-r,Tm=(t,e,r)=>e<<r|t>>>32-r,Cm=(t,e,r)=>e<<r-32|t>>>64-r,Bm=(t,e,r)=>t<<r-32|e>>>64-r;function Rm(t,e,r,i){const s=(e>>>0)+(i>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const Nm=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Um=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,km=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),jm=(t,e,r,i,s)=>e+r+i+s+(t/2**32|0)|0,Mm=(t,e,r,i,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(s>>>0),Lm=(t,e,r,i,s,n)=>e+r+i+s+n+(t/2**32|0)|0,Y={fromBig:Df,split:vm,toBig:Em,shrSH:_m,shrSL:xm,rotrSH:Im,rotrSL:Sm,rotrBH:Om,rotrBL:Dm,rotr32H:$m,rotr32L:Am,rotlSH:Pm,rotlSL:Tm,rotlBH:Cm,rotlBL:Bm,add:Rm,add3L:Nm,add3H:Um,add4L:km,add4H:jm,add5H:Lm,add5L:Mm},[qm,zm]=Y.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),ir=new Uint32Array(80),sr=new Uint32Array(80);let Fm=class extends bm{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:f,Fl:h,Gh:p,Gl:d,Hh:g,Hl:m}=this;return[e,r,i,s,n,o,a,c,l,u,f,h,p,d,g,m]}set(e,r,i,s,n,o,a,c,l,u,f,h,p,d,g,m){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=f|0,this.Fl=h|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)ir[b]=e.getUint32(r),sr[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const x=ir[b-15]|0,A=sr[b-15]|0,v=Y.rotrSH(x,A,1)^Y.rotrSH(x,A,8)^Y.shrSH(x,A,7),C=Y.rotrSL(x,A,1)^Y.rotrSL(x,A,8)^Y.shrSL(x,A,7),R=ir[b-2]|0,T=sr[b-2]|0,k=Y.rotrSH(R,T,19)^Y.rotrBH(R,T,61)^Y.shrSH(R,T,6),N=Y.rotrSL(R,T,19)^Y.rotrBL(R,T,61)^Y.shrSL(R,T,6),B=Y.add4L(C,N,sr[b-7],sr[b-16]),$=Y.add4H(B,v,k,ir[b-7],ir[b-16]);ir[b]=$|0,sr[b]=B|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:f,El:h,Fh:p,Fl:d,Gh:g,Gl:m,Hh:E,Hl:S}=this;for(let b=0;b<80;b++){const x=Y.rotrSH(f,h,14)^Y.rotrSH(f,h,18)^Y.rotrBH(f,h,41),A=Y.rotrSL(f,h,14)^Y.rotrSL(f,h,18)^Y.rotrBL(f,h,41),v=f&p^~f&g,C=h&d^~h&m,R=Y.add5L(S,A,C,zm[b],sr[b]),T=Y.add5H(R,E,x,v,qm[b],ir[b]),k=R|0,N=Y.rotrSH(i,s,28)^Y.rotrBH(i,s,34)^Y.rotrBH(i,s,39),B=Y.rotrSL(i,s,28)^Y.rotrBL(i,s,34)^Y.rotrBL(i,s,39),$=i&n^i&a^n&a,D=s&o^s&c^o&c;E=g|0,S=m|0,g=p|0,m=d|0,p=f|0,d=h|0,{h:f,l:h}=Y.add(l|0,u|0,T|0,k|0),l=a|0,u=c|0,a=n|0,c=o|0,n=i|0,o=s|0;const y=Y.add3L(k,B,D);i=Y.add3H(y,T,N,$),s=y|0}({h:i,l:s}=Y.add(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=Y.add(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=Y.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Y.add(this.Dh|0,this.Dl|0,l|0,u|0),{h:f,l:h}=Y.add(this.Eh|0,this.El|0,f|0,h|0),{h:p,l:d}=Y.add(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:m}=Y.add(this.Gh|0,this.Gl|0,g|0,m|0),{h:E,l:S}=Y.add(this.Hh|0,this.Hl|0,E|0,S|0),this.set(i,s,n,o,a,c,l,u,f,h,p,d,g,m,E,S)}roundClean(){ir.fill(0),sr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Vm=wm(()=>new Fm);const Ua=BigInt(0),$f=BigInt(1),Km=BigInt(2);function ka(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ja(t){if(!ka(t))throw new Error("Uint8Array expected")}function zn(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const Hm=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ma(t){ja(t);let e="";for(let r=0;r<t.length;r++)e+=Hm[t[r]];return e}function Af(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Ua:BigInt("0x"+t)}const Lt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Zc(t){if(t>=Lt._0&&t<=Lt._9)return t-Lt._0;if(t>=Lt.A&&t<=Lt.F)return t-(Lt.A-10);if(t>=Lt.a&&t<=Lt.f)return t-(Lt.a-10)}function Pf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=Zc(t.charCodeAt(n)),a=Zc(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function Wm(t){return Af(Ma(t))}function As(t){return ja(t),Af(Ma(Uint8Array.from(t).reverse()))}function Tf(t,e){return Pf(t.toString(16).padStart(e*2,"0"))}function zo(t,e){return Tf(t,e).reverse()}function qt(t,e,r){let i;if(typeof e=="string")try{i=Pf(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(ka(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}function Jc(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];ja(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}const Fn=t=>typeof t=="bigint"&&Ua<=t;function Gm(t,e,r){return Fn(t)&&Fn(e)&&Fn(r)&&e<=t&&t<r}function vi(t,e,r,i){if(!Gm(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function Ym(t){let e;for(e=0;t>Ua;t>>=$f,e+=1);return e}const Zm=t=>(Km<<BigInt(t-1))-$f,Jm={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||ka(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function La(t,e,r={}){const i=(s,n,o)=>{const a=Jm[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(r))i(s,n,!0);return t}function Xc(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}const Ie=BigInt(0),fe=BigInt(1),Ar=BigInt(2),Xm=BigInt(3),Fo=BigInt(4),Qc=BigInt(5),el=BigInt(8);function me(t,e){const r=t%e;return r>=Ie?r:e+r}function Qm(t,e,r){if(e<Ie)throw new Error("invalid exponent, negatives unsupported");if(r<=Ie)throw new Error("invalid modulus");if(r===fe)return Ie;let i=fe;for(;e>Ie;)e&fe&&(i=i*t%r),t=t*t%r,e>>=fe;return i}function Ot(t,e,r){let i=t;for(;e-- >Ie;)i*=i,i%=r;return i}function tl(t,e){if(t===Ie)throw new Error("invert: expected non-zero number");if(e<=Ie)throw new Error("invert: expected positive modulus, got "+e);let r=me(t,e),i=e,s=Ie,n=fe;for(;r!==Ie;){const o=i/r,a=i%r,c=s-n*o;i=r,r=a,s=n,n=c}if(i!==fe)throw new Error("invert: does not exist");return me(s,e)}function eb(t){const e=(t-fe)/Ar;let r,i,s;for(r=t-fe,i=0;r%Ar===Ie;r/=Ar,i++);for(s=Ar;s<t&&Qm(s,e,t)!==t-fe;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(t+fe)/Fo;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const n=(r+fe)/Ar;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,l=o.pow(o.mul(o.ONE,s),r),u=o.pow(a,n),f=o.pow(a,r);for(;!o.eql(f,o.ONE);){if(o.eql(f,o.ZERO))return o.ZERO;let h=1;for(let d=o.sqr(f);h<c&&!o.eql(d,o.ONE);h++)d=o.sqr(d);const p=o.pow(l,fe<<BigInt(c-h-1));l=o.sqr(p),u=o.mul(u,p),f=o.mul(f,l),c=h}return u}}function tb(t){if(t%Fo===Xm){const e=(t+fe)/Fo;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%el===Qc){const e=(t-Qc)/el;return function(r,i){const s=r.mul(i,Ar),n=r.pow(s,e),o=r.mul(i,n),a=r.mul(r.mul(o,Ar),n),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return eb(t)}const rb=(t,e)=>(me(t,e)&fe)===fe,ib=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function sb(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=ib.reduce((i,s)=>(i[s]="function",i),e);return La(t,r)}function nb(t,e,r){if(r<Ie)throw new Error("invalid exponent, negatives unsupported");if(r===Ie)return t.ONE;if(r===fe)return e;let i=t.ONE,s=e;for(;r>Ie;)r&fe&&(i=t.mul(i,s)),s=t.sqr(s),r>>=fe;return i}function ob(t,e){const r=new Array(e.length),i=e.reduce((n,o,a)=>t.is0(o)?n:(r[a]=n,t.mul(n,o)),t.ONE),s=t.inv(i);return e.reduceRight((n,o,a)=>t.is0(o)?n:(r[a]=t.mul(n,r[a]),t.mul(n,o)),s),r}function Cf(t,e){const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function Bf(t,e,r=!1,i={}){if(t<=Ie)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:n}=Cf(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:n,MASK:Zm(s),ZERO:Ie,ONE:fe,create:c=>me(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ie<=c&&c<t},is0:c=>c===Ie,isOdd:c=>(c&fe)===fe,neg:c=>me(-c,t),eql:(c,l)=>c===l,sqr:c=>me(c*c,t),add:(c,l)=>me(c+l,t),sub:(c,l)=>me(c-l,t),mul:(c,l)=>me(c*l,t),pow:(c,l)=>nb(a,c,l),div:(c,l)=>me(c*tl(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>tl(c,t),sqrt:i.sqrt||(c=>(o||(o=tb(t)),o(a,c))),invertBatch:c=>ob(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>r?zo(c,n):Tf(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return r?As(c):Wm(c)}});return Object.freeze(a)}const rl=BigInt(0),ps=BigInt(1);function Vn(t,e){const r=e.negate();return t?r:e}function Rf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Kn(t,e){Rf(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1);return{windows:r,windowSize:i}}function ab(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function cb(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const Hn=new WeakMap,Nf=new WeakMap;function Wn(t){return Nf.get(t)||1}function lb(t,e){return{constTimeNegate:Vn,hasPrecomputes(r){return Wn(r)!==1},unsafeLadder(r,i,s=t.ZERO){let n=r;for(;i>rl;)i&ps&&(s=s.add(n)),n=n.double(),i>>=ps;return s},precomputeWindow(r,i){const{windows:s,windowSize:n}=Kn(i,e),o=[];let a=r,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,s){const{windows:n,windowSize:o}=Kn(r,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**r-1),u=2**r,f=BigInt(r);for(let h=0;h<n;h++){const p=h*o;let d=Number(s&l);s>>=f,d>o&&(d-=u,s+=ps);const g=p,m=p+Math.abs(d)-1,E=h%2!==0,S=d<0;d===0?c=c.add(Vn(E,i[g])):a=a.add(Vn(S,i[m]))}return{p:a,f:c}},wNAFUnsafe(r,i,s,n=t.ZERO){const{windows:o,windowSize:a}=Kn(r,e),c=BigInt(2**r-1),l=2**r,u=BigInt(r);for(let f=0;f<o;f++){const h=f*a;if(s===rl)break;let p=Number(s&c);if(s>>=u,p>a&&(p-=l,s+=ps),p===0)continue;let d=i[h+Math.abs(p)-1];p<0&&(d=d.negate()),n=n.add(d)}return n},getPrecomputes(r,i,s){let n=Hn.get(i);return n||(n=this.precomputeWindow(i,r),r!==1&&Hn.set(i,s(n))),n},wNAFCached(r,i,s){const n=Wn(r);return this.wNAF(n,this.getPrecomputes(n,r,s),i)},wNAFCachedUnsafe(r,i,s,n){const o=Wn(r);return o===1?this.unsafeLadder(r,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),i,n)},setWindowSize(r,i){Rf(i,e),Nf.set(r,i),Hn.delete(r)}}}function ub(t,e,r,i){if(ab(r,t),cb(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=t.ZERO,n=Ym(BigInt(r.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),l=Math.floor((e.BITS-1)/o)*o;let u=s;for(let f=l;f>=0;f-=o){c.fill(s);for(let p=0;p<i.length;p++){const d=i[p],g=Number(d>>BigInt(f)&BigInt(a));c[g]=c[g].add(r[p])}let h=s;for(let p=c.length-1,d=s;p>0;p--)d=d.add(c[p]),h=h.add(d);if(u=u.add(h),f!==0)for(let p=0;p<o;p++)u=u.double()}return u}function hb(t){return sb(t.Fp),La(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Cf(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const mt=BigInt(0),Fe=BigInt(1),gs=BigInt(2),fb=BigInt(8),db={zip215:!0};function pb(t){const e=hb(t);return La(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function gb(t){const e=pb(t),{Fp:r,n:i,prehash:s,hash:n,randomBytes:o,nByteLength:a,h:c}=e,l=gs<<BigInt(a*8)-Fe,u=r.create,f=Bf(e.n,e.nBitLength),h=e.uvRatio||((y,w)=>{try{return{isValid:!0,value:r.sqrt(y*r.inv(w))}}catch{return{isValid:!1,value:mt}}}),p=e.adjustScalarBytes||(y=>y),d=e.domain||((y,w,_)=>{if(zn("phflag",_),w.length||_)throw new Error("Contexts/pre-hash are not supported");return y});function g(y,w){vi("coordinate "+y,w,mt,l)}function m(y){if(!(y instanceof b))throw new Error("ExtendedPoint expected")}const E=Xc((y,w)=>{const{ex:_,ey:P,ez:I}=y,O=y.is0();w==null&&(w=O?fb:r.inv(I));const U=u(_*w),j=u(P*w),V=u(I*w);if(O)return{x:mt,y:Fe};if(V!==Fe)throw new Error("invZ was invalid");return{x:U,y:j}}),S=Xc(y=>{const{a:w,d:_}=e;if(y.is0())throw new Error("bad point: ZERO");const{ex:P,ey:I,ez:O,et:U}=y,j=u(P*P),V=u(I*I),L=u(O*O),q=u(L*L),H=u(j*w),G=u(L*u(H+V)),Z=u(q+u(_*u(j*V)));if(G!==Z)throw new Error("bad point: equation left != right (1)");const W=u(P*I),J=u(O*U);if(W!==J)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(w,_,P,I){this.ex=w,this.ey=_,this.ez=P,this.et=I,g("x",w),g("y",_),g("z",P),g("t",I),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(w){if(w instanceof b)throw new Error("extended point not allowed");const{x:_,y:P}=w||{};return g("x",_),g("y",P),new b(_,P,Fe,u(_*P))}static normalizeZ(w){const _=r.invertBatch(w.map(P=>P.ez));return w.map((P,I)=>P.toAffine(_[I])).map(b.fromAffine)}static msm(w,_){return ub(b,f,w,_)}_setWindowSize(w){v.setWindowSize(this,w)}assertValidity(){S(this)}equals(w){m(w);const{ex:_,ey:P,ez:I}=this,{ex:O,ey:U,ez:j}=w,V=u(_*j),L=u(O*I),q=u(P*j),H=u(U*I);return V===L&&q===H}is0(){return this.equals(b.ZERO)}negate(){return new b(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:w}=e,{ex:_,ey:P,ez:I}=this,O=u(_*_),U=u(P*P),j=u(gs*u(I*I)),V=u(w*O),L=_+P,q=u(u(L*L)-O-U),H=V+U,G=H-j,Z=V-U,W=u(q*G),J=u(H*Z),ue=u(q*Z),ye=u(G*H);return new b(W,J,ye,ue)}add(w){m(w);const{a:_,d:P}=e,{ex:I,ey:O,ez:U,et:j}=this,{ex:V,ey:L,ez:q,et:H}=w;if(_===BigInt(-1)){const hc=u((O-I)*(L+V)),fc=u((O+I)*(L-V)),In=u(fc-hc);if(In===mt)return this.double();const dc=u(U*gs*H),pc=u(j*gs*q),gc=pc+dc,yc=fc+hc,wc=pc-dc,sg=u(gc*In),ng=u(yc*wc),og=u(gc*wc),ag=u(In*yc);return new b(sg,ng,ag,og)}const G=u(I*V),Z=u(O*L),W=u(j*P*H),J=u(U*q),ue=u((I+O)*(V+L)-G-Z),ye=J-W,ve=J+W,je=u(Z-_*G),St=u(ue*ye),cs=u(ve*je),rg=u(ue*je),ig=u(ye*ve);return new b(St,cs,ig,rg)}subtract(w){return this.add(w.negate())}wNAF(w){return v.wNAFCached(this,w,b.normalizeZ)}multiply(w){const _=w;vi("scalar",_,Fe,i);const{p:P,f:I}=this.wNAF(_);return b.normalizeZ([P,I])[0]}multiplyUnsafe(w,_=b.ZERO){const P=w;return vi("scalar",P,mt,i),P===mt?A:this.is0()||P===Fe?this:v.wNAFCachedUnsafe(this,P,b.normalizeZ,_)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return v.unsafeLadder(this,i).is0()}toAffine(w){return E(this,w)}clearCofactor(){const{h:w}=e;return w===Fe?this:this.multiplyUnsafe(w)}static fromHex(w,_=!1){const{d:P,a:I}=e,O=r.BYTES;w=qt("pointHex",w,O),zn("zip215",_);const U=w.slice(),j=w[O-1];U[O-1]=j&-129;const V=As(U),L=_?l:r.ORDER;vi("pointHex.y",V,mt,L);const q=u(V*V),H=u(q-Fe),G=u(P*q-I);let{isValid:Z,value:W}=h(H,G);if(!Z)throw new Error("Point.fromHex: invalid y coordinate");const J=(W&Fe)===Fe,ue=(j&128)!==0;if(!_&&W===mt&&ue)throw new Error("Point.fromHex: x=0 and x_0=1");return ue!==J&&(W=u(-W)),b.fromAffine({x:W,y:V})}static fromPrivateKey(w){return T(w).point}toRawBytes(){const{x:w,y:_}=this.toAffine(),P=zo(_,r.BYTES);return P[P.length-1]|=w&Fe?128:0,P}toHex(){return Ma(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,Fe,u(e.Gx*e.Gy)),b.ZERO=new b(mt,Fe,Fe,mt);const{BASE:x,ZERO:A}=b,v=lb(b,a*8);function C(y){return me(y,i)}function R(y){return C(As(y))}function T(y){const w=r.BYTES;y=qt("private key",y,w);const _=qt("hashed private key",n(y),2*w),P=p(_.slice(0,w)),I=_.slice(w,2*w),O=R(P),U=x.multiply(O),j=U.toRawBytes();return{head:P,prefix:I,scalar:O,point:U,pointBytes:j}}function k(y){return T(y).pointBytes}function N(y=new Uint8Array,...w){const _=Jc(...w);return R(n(d(_,qt("context",y),!!s)))}function B(y,w,_={}){y=qt("message",y),s&&(y=s(y));const{prefix:P,scalar:I,pointBytes:O}=T(w),U=N(_.context,P,y),j=x.multiply(U).toRawBytes(),V=N(_.context,j,O,y),L=C(U+V*I);vi("signature.s",L,mt,i);const q=Jc(j,zo(L,r.BYTES));return qt("result",q,r.BYTES*2)}const $=db;function D(y,w,_,P=$){const{context:I,zip215:O}=P,U=r.BYTES;y=qt("signature",y,2*U),w=qt("message",w),_=qt("publicKey",_,U),O!==void 0&&zn("zip215",O),s&&(w=s(w));const j=As(y.slice(U,2*U));let V,L,q;try{V=b.fromHex(_,O),L=b.fromHex(y.slice(0,U),O),q=x.multiplyUnsafe(j)}catch{return!1}if(!O&&V.isSmallOrder())return!1;const H=N(I,L.toRawBytes(),V.toRawBytes(),w);return L.add(V.multiplyUnsafe(H)).subtract(q).clearCofactor().equals(b.ZERO)}return x._setWindowSize(8),{CURVE:e,getPublicKey:k,sign:B,verify:D,ExtendedPoint:b,utils:{getExtendedPublicKey:T,randomPrivateKey:()=>o(r.BYTES),precompute(y=8,w=b.BASE){return w._setWindowSize(y),w.multiply(BigInt(3)),w}}}}BigInt(0),BigInt(1);const qa=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),il=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const yb=BigInt(1),sl=BigInt(2);BigInt(3);const wb=BigInt(5),mb=BigInt(8);function bb(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=qa,o=t*t%n*t%n,a=Ot(o,sl,n)*o%n,c=Ot(a,yb,n)*t%n,l=Ot(c,wb,n)*c%n,u=Ot(l,e,n)*l%n,f=Ot(u,r,n)*u%n,h=Ot(f,i,n)*f%n,p=Ot(h,s,n)*h%n,d=Ot(p,s,n)*h%n,g=Ot(d,e,n)*l%n;return{pow_p_5_8:Ot(g,sl,n)*t%n,b2:o}}function vb(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function Eb(t,e){const r=qa,i=me(e*e*e,r),s=me(i*i*e,r),n=bb(t*s).pow_p_5_8;let o=me(t*i*n,r);const a=me(e*o*o,r),c=o,l=me(o*il,r),u=a===t,f=a===me(-t,r),h=a===me(-t*il,r);return u&&(o=c),(f||h)&&(o=l),rb(o,r)&&(o=me(-o,r)),{isValid:u||f,value:o}}const _b=Bf(qa,void 0,!0),xb={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:_b,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:mb,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Vm,randomBytes:Of,adjustScalarBytes:vb,uvRatio:Eb},Uf=gb(xb),Ib="EdDSA",Sb="JWT",Ls=".",nn="base64url",kf="utf8",jf="utf8",Ob=":",Db="did",$b="key",nl="base58btc",Ab="z",Pb="K36",Tb=32;function za(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Mf(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?za(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Lf(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const r=Mf(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return za(r)}function Cb(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,m=0,E=0,S=d.length;E!==S&&d[E]===0;)E++,g++;for(var b=(S-E)*u+1>>>0,x=new Uint8Array(b);E!==S;){for(var A=d[E],v=0,C=b-1;(A!==0||v<m)&&C!==-1;C--,v++)A+=256*x[C]>>>0,x[C]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");m=v,E++}for(var R=b-m;R!==b&&x[R]===0;)R++;for(var T=c.repeat(g);R<b;++R)T+=t.charAt(x[R]);return T}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var m=0,E=0;d[g]===c;)m++,g++;for(var S=(d.length-g)*l+1>>>0,b=new Uint8Array(S);d[g];){var x=r[d.charCodeAt(g)];if(x===255)return;for(var A=0,v=S-1;(x!==0||A<E)&&v!==-1;v--,A++)x+=a*b[v]>>>0,b[v]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");E=A,g++}if(d[g]!==" "){for(var C=S-E;C!==S&&b[C]===0;)C++;for(var R=new Uint8Array(m+(S-C)),T=m;C!==S;)R[T++]=b[C++];return R}}}function p(d){var g=h(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var Bb=Cb,Rb=Bb;const qf=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Nb=t=>new TextEncoder().encode(t),Ub=t=>new TextDecoder().decode(t);let kb=class{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},jb=class{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return zf(this,e)}},Mb=class{constructor(e){this.decoders=e}or(e){return zf(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const zf=(t,e)=>new Mb({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let Lb=class{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new kb(e,r,i),this.decoder=new jb(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const on=({name:t,prefix:e,encode:r,decode:i})=>new Lb(t,e,r,i),Ji=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=Rb(r,e);return on({prefix:t,name:e,encode:i,decode:n=>qf(s(n))})},qb=(t,e,r,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const f=s[t[u]];if(f===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|f,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},zb=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Ae=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>on({prefix:e,name:t,encode(s){return zb(s,i,r)},decode(s){return qb(s,i,r,t)}}),Fb=on({prefix:"\0",name:"identity",encode:t=>Ub(t),decode:t=>Nb(t)});var Vb=Object.freeze({__proto__:null,identity:Fb});const Kb=Ae({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Hb=Object.freeze({__proto__:null,base2:Kb});const Wb=Ae({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Gb=Object.freeze({__proto__:null,base8:Wb});const Yb=Ji({prefix:"9",name:"base10",alphabet:"0123456789"});var Zb=Object.freeze({__proto__:null,base10:Yb});const Jb=Ae({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Xb=Ae({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Qb=Object.freeze({__proto__:null,base16:Jb,base16upper:Xb});const e0=Ae({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),t0=Ae({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),r0=Ae({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),i0=Ae({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),s0=Ae({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),n0=Ae({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),o0=Ae({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),a0=Ae({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),c0=Ae({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var l0=Object.freeze({__proto__:null,base32:e0,base32upper:t0,base32pad:r0,base32padupper:i0,base32hex:s0,base32hexupper:n0,base32hexpad:o0,base32hexpadupper:a0,base32z:c0});const u0=Ji({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),h0=Ji({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var f0=Object.freeze({__proto__:null,base36:u0,base36upper:h0});const d0=Ji({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),p0=Ji({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var g0=Object.freeze({__proto__:null,base58btc:d0,base58flickr:p0});const y0=Ae({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),w0=Ae({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),m0=Ae({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),b0=Ae({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var v0=Object.freeze({__proto__:null,base64:y0,base64pad:w0,base64url:m0,base64urlpad:b0});const Ff=Array.from(""),E0=Ff.reduce((t,e,r)=>(t[r]=e,t),[]),_0=Ff.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function x0(t){return t.reduce((e,r)=>(e+=E0[r],e),"")}function I0(t){const e=[];for(const r of t){const i=_0[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const S0=on({prefix:"",name:"base256emoji",encode:x0,decode:I0});var O0=Object.freeze({__proto__:null,base256emoji:S0}),D0=Vf,ol=128,$0=-128,A0=Math.pow(2,31);function Vf(t,e,r){e=e||[],r=r||0;for(var i=r;t>=A0;)e[r++]=t&255|ol,t/=128;for(;t&$0;)e[r++]=t&255|ol,t>>>=7;return e[r]=t|0,Vf.bytes=r-i+1,e}var P0=Vo,T0=128,al=127;function Vo(t,i){var r=0,i=i||0,s=0,n=i,o,a=t.length;do{if(n>=a)throw Vo.bytes=0,new RangeError("Could not decode varint");o=t[n++],r+=s<28?(o&al)<<s:(o&al)*Math.pow(2,s),s+=7}while(o>=T0);return Vo.bytes=n-i,r}var C0=Math.pow(2,7),B0=Math.pow(2,14),R0=Math.pow(2,21),N0=Math.pow(2,28),U0=Math.pow(2,35),k0=Math.pow(2,42),j0=Math.pow(2,49),M0=Math.pow(2,56),L0=Math.pow(2,63),q0=function(t){return t<C0?1:t<B0?2:t<R0?3:t<N0?4:t<U0?5:t<k0?6:t<j0?7:t<M0?8:t<L0?9:10},z0={encode:D0,decode:P0,encodingLength:q0},Kf=z0;const cl=(t,e,r=0)=>(Kf.encode(t,e,r),e),ll=t=>Kf.encodingLength(t),Ko=(t,e)=>{const r=e.byteLength,i=ll(t),s=i+ll(r),n=new Uint8Array(s+r);return cl(t,n,0),cl(r,n,i),n.set(e,s),new F0(t,r,e,n)};let F0=class{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}};const Hf=({name:t,code:e,encode:r})=>new V0(t,e,r);let V0=class{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Ko(this.code,r):r.then(i=>Ko(this.code,i))}else throw Error("Unknown type, must be binary type")}};const Wf=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),K0=Hf({name:"sha2-256",code:18,encode:Wf("SHA-256")}),H0=Hf({name:"sha2-512",code:19,encode:Wf("SHA-512")});var W0=Object.freeze({__proto__:null,sha256:K0,sha512:H0});const Gf=0,G0="identity",Yf=qf,Y0=t=>Ko(Gf,Yf(t)),Z0={code:Gf,name:G0,encode:Yf,digest:Y0};var J0=Object.freeze({__proto__:null,identity:Z0});new TextEncoder,new TextDecoder;const ul={...Vb,...Hb,...Gb,...Zb,...Qb,...l0,...f0,...g0,...v0,...O0};({...W0,...J0});function Zf(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const hl=Zf("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Gn=Zf("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Mf(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Jf={utf8:hl,"utf-8":hl,hex:ul.base16,latin1:Gn,ascii:Gn,binary:Gn,...ul};function an(t,e="utf8"){const r=Jf[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function fi(t,e="utf8"){const r=Jf[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?za(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function fl(t){return jr(an(fi(t,nn),kf))}function qs(t){return an(fi(tr(t),kf),nn)}function Xf(t){const e=fi(Pb,nl),r=Ab+an(Lf([e,t]),nl);return[Db,$b,r].join(Ob)}function X0(t){return an(t,nn)}function Q0(t){return fi(t,nn)}function e1(t){return fi([qs(t.header),qs(t.payload)].join(Ls),jf)}function t1(t){return[qs(t.header),qs(t.payload),X0(t.signature)].join(Ls)}function Ho(t){const e=t.split(Ls),r=fl(e[0]),i=fl(e[1]),s=Q0(e[2]),n=fi(e.slice(0,2).join(Ls),jf);return{header:r,payload:i,signature:s,data:n}}function dl(t=Of(Tb)){const e=Uf.getPublicKey(t);return{secretKey:Lf([t,e]),publicKey:e}}async function r1(t,e,r,i,s=F.fromMiliseconds(Date.now())){const n={alg:Ib,typ:Sb},o=Xf(i.publicKey),a=s+r,c={iss:o,sub:t,aud:e,iat:s,exp:a},l=e1({header:n,payload:c}),u=Uf.sign(l,i.secretKey.slice(0,32));return t1({header:n,payload:c,signature:u})}function Fa(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Qf(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Fa(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Ni(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const r=Qf(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return Fa(r)}function i1(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,m=0,E=0,S=d.length;E!==S&&d[E]===0;)E++,g++;for(var b=(S-E)*u+1>>>0,x=new Uint8Array(b);E!==S;){for(var A=d[E],v=0,C=b-1;(A!==0||v<m)&&C!==-1;C--,v++)A+=256*x[C]>>>0,x[C]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");m=v,E++}for(var R=b-m;R!==b&&x[R]===0;)R++;for(var T=c.repeat(g);R<b;++R)T+=t.charAt(x[R]);return T}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var m=0,E=0;d[g]===c;)m++,g++;for(var S=(d.length-g)*l+1>>>0,b=new Uint8Array(S);d[g];){var x=r[d.charCodeAt(g)];if(x===255)return;for(var A=0,v=S-1;(x!==0||A<E)&&v!==-1;v--,A++)x+=a*b[v]>>>0,b[v]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");E=A,g++}if(d[g]!==" "){for(var C=S-E;C!==S&&b[C]===0;)C++;for(var R=new Uint8Array(m+(S-C)),T=m;C!==S;)R[T++]=b[C++];return R}}}function p(d){var g=h(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var s1=i1,n1=s1;const o1=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},a1=t=>new TextEncoder().encode(t),c1=t=>new TextDecoder().decode(t);class l1{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class u1{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ed(this,e)}}class h1{constructor(e){this.decoders=e}or(e){return ed(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ed=(t,e)=>new h1({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class f1{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new l1(e,r,i),this.decoder=new u1(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const cn=({name:t,prefix:e,encode:r,decode:i})=>new f1(t,e,r,i),Xi=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=n1(r,e);return cn({prefix:t,name:e,encode:i,decode:n=>o1(s(n))})},d1=(t,e,r,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const f=s[t[u]];if(f===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|f,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},p1=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Pe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>cn({prefix:e,name:t,encode(s){return p1(s,i,r)},decode(s){return d1(s,i,r,t)}}),g1=cn({prefix:"\0",name:"identity",encode:t=>c1(t),decode:t=>a1(t)}),y1=Object.freeze(Object.defineProperty({__proto__:null,identity:g1},Symbol.toStringTag,{value:"Module"})),w1=Pe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),m1=Object.freeze(Object.defineProperty({__proto__:null,base2:w1},Symbol.toStringTag,{value:"Module"})),b1=Pe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),v1=Object.freeze(Object.defineProperty({__proto__:null,base8:b1},Symbol.toStringTag,{value:"Module"})),E1=Xi({prefix:"9",name:"base10",alphabet:"0123456789"}),_1=Object.freeze(Object.defineProperty({__proto__:null,base10:E1},Symbol.toStringTag,{value:"Module"})),x1=Pe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),I1=Pe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),S1=Object.freeze(Object.defineProperty({__proto__:null,base16:x1,base16upper:I1},Symbol.toStringTag,{value:"Module"})),O1=Pe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),D1=Pe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),$1=Pe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),A1=Pe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),P1=Pe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),T1=Pe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),C1=Pe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),B1=Pe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),R1=Pe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),N1=Object.freeze(Object.defineProperty({__proto__:null,base32:O1,base32hex:P1,base32hexpad:C1,base32hexpadupper:B1,base32hexupper:T1,base32pad:$1,base32padupper:A1,base32upper:D1,base32z:R1},Symbol.toStringTag,{value:"Module"})),U1=Xi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),k1=Xi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),j1=Object.freeze(Object.defineProperty({__proto__:null,base36:U1,base36upper:k1},Symbol.toStringTag,{value:"Module"})),M1=Xi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),L1=Xi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),q1=Object.freeze(Object.defineProperty({__proto__:null,base58btc:M1,base58flickr:L1},Symbol.toStringTag,{value:"Module"})),z1=Pe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),F1=Pe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),V1=Pe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),K1=Pe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),H1=Object.freeze(Object.defineProperty({__proto__:null,base64:z1,base64pad:F1,base64url:V1,base64urlpad:K1},Symbol.toStringTag,{value:"Module"})),td=Array.from(""),W1=td.reduce((t,e,r)=>(t[r]=e,t),[]),G1=td.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Y1(t){return t.reduce((e,r)=>(e+=W1[r],e),"")}function Z1(t){const e=[];for(const r of t){const i=G1[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const J1=cn({prefix:"",name:"base256emoji",encode:Y1,decode:Z1}),X1=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:J1},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const pl={...y1,...m1,...v1,..._1,...S1,...N1,...j1,...q1,...H1,...X1};function rd(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const gl=rd("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Yn=rd("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Qf(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),id={utf8:gl,"utf-8":gl,hex:pl.base16,latin1:Yn,ascii:Yn,binary:Yn,...pl};function pt(t,e="utf8"){const r=id[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Fa(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Xe(t,e="utf8"){const r=id[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const Q1={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var Zn,yl;function sd(){if(yl)return Zn;yl=1;const t="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(t);return a}function r(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function i(o){return(4294967296+o).toString(16).substring(1)}function s(o,a,c){let l=`
`+o+" = ";for(let u=0;u<a.length;u+=2){if(c===32)l+=i(a[u]).toUpperCase(),l+=" ",l+=i(a[u+1]).toUpperCase();else if(c===64)l+=i(a[u+1]).toUpperCase(),l+=i(a[u]).toUpperCase();else throw new Error("Invalid size "+c);u%6===4?l+=`
`+new Array(o.length+4).join(" "):u<a.length-2&&(l+=" ")}console.log(l)}function n(o,a,c){let l=new Date().getTime();const u=new Uint8Array(a);for(let h=0;h<a;h++)u[h]=h%256;const f=new Date().getTime();console.log("Generated random input in "+(f-l)+"ms"),l=f;for(let h=0;h<c;h++){const p=o(u),d=new Date().getTime(),g=d-l;l=d,console.log("Hashed in "+g+"ms: "+p.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(g/1e3)*100)/100+" MB PER SECOND")}}return Zn={normalizeInput:e,toHex:r,debugPrint:s,testSpeed:n},Zn}var Jn,wl;function ev(){if(wl)return Jn;wl=1;const t=sd();function e(E,S,b){const x=E[S]+E[b];let A=E[S+1]+E[b+1];x>=4294967296&&A++,E[S]=x,E[S+1]=A}function r(E,S,b,x){let A=E[S]+b;b<0&&(A+=4294967296);let v=E[S+1]+x;A>=4294967296&&v++,E[S]=A,E[S+1]=v}function i(E,S){return E[S]^E[S+1]<<8^E[S+2]<<16^E[S+3]<<24}function s(E,S,b,x,A,v){const C=l[A],R=l[A+1],T=l[v],k=l[v+1];e(c,E,S),r(c,E,C,R);let N=c[x]^c[E],B=c[x+1]^c[E+1];c[x]=B,c[x+1]=N,e(c,b,x),N=c[S]^c[b],B=c[S+1]^c[b+1],c[S]=N>>>24^B<<8,c[S+1]=B>>>24^N<<8,e(c,E,S),r(c,E,T,k),N=c[x]^c[E],B=c[x+1]^c[E+1],c[x]=N>>>16^B<<16,c[x+1]=B>>>16^N<<16,e(c,b,x),N=c[S]^c[b],B=c[S+1]^c[b+1],c[S]=B>>>31^N<<1,c[S+1]=N>>>31^B<<1}const n=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function(E){return E*2})),c=new Uint32Array(32),l=new Uint32Array(32);function u(E,S){let b=0;for(b=0;b<16;b++)c[b]=E.h[b],c[b+16]=n[b];for(c[24]=c[24]^E.t,c[25]=c[25]^E.t/4294967296,S&&(c[28]=~c[28],c[29]=~c[29]),b=0;b<32;b++)l[b]=i(E.b,4*b);for(b=0;b<12;b++)s(0,8,16,24,a[b*16+0],a[b*16+1]),s(2,10,18,26,a[b*16+2],a[b*16+3]),s(4,12,20,28,a[b*16+4],a[b*16+5]),s(6,14,22,30,a[b*16+6],a[b*16+7]),s(0,10,20,30,a[b*16+8],a[b*16+9]),s(2,12,22,24,a[b*16+10],a[b*16+11]),s(4,14,16,26,a[b*16+12],a[b*16+13]),s(6,8,18,28,a[b*16+14],a[b*16+15]);for(b=0;b<16;b++)E.h[b]=E.h[b]^c[b]^c[b+16]}const f=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function h(E,S,b,x){if(E===0||E>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(S&&S.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(b&&b.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(x&&x.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const A={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:E};f.fill(0),f[0]=E,S&&(f[1]=S.length),f[2]=1,f[3]=1,b&&f.set(b,32),x&&f.set(x,48);for(let v=0;v<16;v++)A.h[v]=n[v]^i(f,v*4);return S&&(p(A,S),A.c=128),A}function p(E,S){for(let b=0;b<S.length;b++)E.c===128&&(E.t+=E.c,u(E,!1),E.c=0),E.b[E.c++]=S[b]}function d(E){for(E.t+=E.c;E.c<128;)E.b[E.c++]=0;u(E,!0);const S=new Uint8Array(E.outlen);for(let b=0;b<E.outlen;b++)S[b]=E.h[b>>2]>>8*(b&3);return S}function g(E,S,b,x,A){b=b||64,E=t.normalizeInput(E),x&&(x=t.normalizeInput(x)),A&&(A=t.normalizeInput(A));const v=h(b,S,x,A);return p(v,E),d(v)}function m(E,S,b,x,A){const v=g(E,S,b,x,A);return t.toHex(v)}return Jn={blake2b:g,blake2bHex:m,blake2bInit:h,blake2bUpdate:p,blake2bFinal:d},Jn}var Xn,ml;function tv(){if(ml)return Xn;ml=1;const t=sd();function e(d,g){return d[g]^d[g+1]<<8^d[g+2]<<16^d[g+3]<<24}function r(d,g,m,E,S,b){o[d]=o[d]+o[g]+S,o[E]=i(o[E]^o[d],16),o[m]=o[m]+o[E],o[g]=i(o[g]^o[m],12),o[d]=o[d]+o[g]+b,o[E]=i(o[E]^o[d],8),o[m]=o[m]+o[E],o[g]=i(o[g]^o[m],7)}function i(d,g){return d>>>g^d<<32-g}const s=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),n=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(d,g){let m=0;for(m=0;m<8;m++)o[m]=d.h[m],o[m+8]=s[m];for(o[12]^=d.t,o[13]^=d.t/4294967296,g&&(o[14]=~o[14]),m=0;m<16;m++)a[m]=e(d.b,4*m);for(m=0;m<10;m++)r(0,4,8,12,a[n[m*16+0]],a[n[m*16+1]]),r(1,5,9,13,a[n[m*16+2]],a[n[m*16+3]]),r(2,6,10,14,a[n[m*16+4]],a[n[m*16+5]]),r(3,7,11,15,a[n[m*16+6]],a[n[m*16+7]]),r(0,5,10,15,a[n[m*16+8]],a[n[m*16+9]]),r(1,6,11,12,a[n[m*16+10]],a[n[m*16+11]]),r(2,7,8,13,a[n[m*16+12]],a[n[m*16+13]]),r(3,4,9,14,a[n[m*16+14]],a[n[m*16+15]]);for(m=0;m<8;m++)d.h[m]^=o[m]^o[m+8]}function l(d,g){if(!(d>0&&d<=32))throw new Error("Incorrect output length, should be in [1, 32]");const m=g?g.length:0;if(g&&!(m>0&&m<=32))throw new Error("Incorrect key length, should be in [1, 32]");const E={h:new Uint32Array(s),b:new Uint8Array(64),c:0,t:0,outlen:d};return E.h[0]^=16842752^m<<8^d,m>0&&(u(E,g),E.c=64),E}function u(d,g){for(let m=0;m<g.length;m++)d.c===64&&(d.t+=d.c,c(d,!1),d.c=0),d.b[d.c++]=g[m]}function f(d){for(d.t+=d.c;d.c<64;)d.b[d.c++]=0;c(d,!0);const g=new Uint8Array(d.outlen);for(let m=0;m<d.outlen;m++)g[m]=d.h[m>>2]>>8*(m&3)&255;return g}function h(d,g,m){m=m||32,d=t.normalizeInput(d);const E=l(m,g);return u(E,d),f(E)}function p(d,g,m){const E=h(d,g,m);return t.toHex(E)}return Xn={blake2s:h,blake2sHex:p,blake2sInit:l,blake2sUpdate:u,blake2sFinal:f},Xn}var Qn,bl;function rv(){if(bl)return Qn;bl=1;const t=ev(),e=tv();return Qn={blake2b:t.blake2b,blake2bHex:t.blake2bHex,blake2bInit:t.blake2bInit,blake2bUpdate:t.blake2bUpdate,blake2bFinal:t.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},Qn}var iv=rv(),sv={};const nv=":";function Xt(t){const[e,r]=t.split(nv);return{namespace:e,reference:r}}function vl(t,e=[]){const r=[];return Object.keys(t).forEach(i=>{if(e.length&&!e.includes(i))return;const s=t[i];r.push(...s.accounts)}),r}function nd(t,e){return t.includes(":")?[t]:e.chains||[]}var ov=Object.defineProperty,av=Object.defineProperties,cv=Object.getOwnPropertyDescriptors,El=Object.getOwnPropertySymbols,lv=Object.prototype.hasOwnProperty,uv=Object.prototype.propertyIsEnumerable,Wo=(t,e,r)=>e in t?ov(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_l=(t,e)=>{for(var r in e||(e={}))lv.call(e,r)&&Wo(t,r,e[r]);if(El)for(var r of El(e))uv.call(e,r)&&Wo(t,r,e[r]);return t},hv=(t,e)=>av(t,cv(e)),xl=(t,e,r)=>Wo(t,typeof e!="symbol"?e+"":e,r);const fv="ReactNative",nt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},dv="js";function zs(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Er(){return!er.getDocument()&&!!er.getNavigator()&&navigator.product===fv}function pv(){return Er()&&typeof globalThis<"u"&&typeof globalThis?.Platform<"u"&&globalThis?.Platform.OS==="android"}function gv(){return Er()&&typeof globalThis<"u"&&typeof globalThis?.Platform<"u"&&globalThis?.Platform.OS==="ios"}function di(){return!zs()&&!!er.getNavigator()&&!!er.getDocument()}function Qi(){return Er()?nt.reactNative:zs()?nt.node:di()?nt.browser:nt.unknown}function Il(){var t;try{return Er()&&typeof globalThis<"u"&&typeof globalThis?.Application<"u"?(t=globalThis.Application)==null?void 0:t.applicationId:void 0}catch{return}}function yv(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([i],[s])=>i.localeCompare(s)).forEach(([i,s])=>{s!=null&&r.set(i,String(s))}),r.toString()}function wv(t){var e,r;const i=od();try{return t!=null&&t.url&&i.url&&new URL(t.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),t.url=i.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(s=>s!=="")),hv(_l(_l({},i),t),{url:t?.url||i.url,name:t?.name||i.name,description:t?.description||i.description,icons:(r=t?.icons)!=null&&r.length&&t.icons.length>0?t.icons:i.icons})}catch(s){return console.warn("Error populating app metadata",s),t||i}}function od(){return oy.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function mv(){if(Qi()===nt.reactNative&&typeof globalThis<"u"&&typeof globalThis?.Platform<"u"){const{OS:r,Version:i}=globalThis.Platform;return[r,i].join("-")}const t=Ig();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function bv(){var t;const e=Qi();return e===nt.browser?[e,((t=er.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function ad(t,e,r){const i=mv(),s=bv();return[[t,e].join("-"),[dv,r].join("-"),i,s].join("/")}function vv({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:s,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=r.split("?"),u=ad(t,e,i),f={auth:s,ua:u,projectId:n,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},h=yv(l[1]||"",f);return l[0]+"?"+h}function Br(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Go(t){return Object.fromEntries(t.entries())}function Yo(t){return new Map(Object.entries(t))}function Dr(t=F.FIVE_MINUTES,e){const r=F.toMiliseconds(t||F.FIVE_MINUTES);let i,s,n,o;return{resolve:a=>{n&&i&&(clearTimeout(n),i(a),o=Promise.resolve(a))},reject:a=>{n&&s&&(clearTimeout(n),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},r),i=a,s=c})}}function Rt(t,e,r){return new Promise(async(i,s)=>{const n=setTimeout(()=>s(new Error(r)),e);try{const o=await t;i(o)}catch(o){s(o)}clearTimeout(n)})}function cd(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Ev(t){return cd("topic",t)}function _v(t){return cd("id",t)}function ld(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function pe(t,e){return F.fromMiliseconds(Date.now()+F.toMiliseconds(t))}function Bt(t){return Date.now()>=F.toMiliseconds(t)}function re(t,e){return`${t}${e?`:${e}`:""}`}function Nt(t=[],e=[]){return[...new Set([...t,...e])]}async function xv({id:t,topic:e,wcDeepLink:r}){var i;try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r,n=s?.href;if(typeof n!="string")return;const o=Iv(n,t,e),a=Qi();if(a===nt.browser){if(!((i=er.getDocument())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Sv(o)}else a===nt.reactNative&&typeof globalThis?.Linking<"u"&&await globalThis.Linking.openURL(o)}catch(s){console.error(s)}}function Iv(t,e,r){const i=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let s=`${t}`;if(t.startsWith("https://t.me")){const n=t.includes("?")?"&startapp=":"?startapp=";s=`${s}${n}${Av(i,!0)}`}else s=`${s}/wc?${i}`;return s}function Sv(t){let e="_self";$v()?e="_top":(Dv()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function Ov(t,e){let r="";try{if(di()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(i){console.error(i)}return r}function Sl(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),i=r.indexOf(e);return r[i+2]}function Ol(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Va(){return typeof process<"u"&&sv.IS_VITEST==="true"}function Dv(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function $v(){try{return window.self!==window.top}catch{return!1}}function Av(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function ud(t){return Buffer.from(t,"base64").toString("utf-8")}function Pv(t){return new Promise(e=>setTimeout(e,t))}let Tv=class{constructor({limit:e}){xl(this,"limit"),xl(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}};const ys=BigInt(2**32-1),Dl=BigInt(32);function hd(t,e=!1){return e?{h:Number(t&ys),l:Number(t>>Dl&ys)}:{h:Number(t>>Dl&ys)|0,l:Number(t&ys)|0}}function fd(t,e=!1){const r=t.length;let i=new Uint32Array(r),s=new Uint32Array(r);for(let n=0;n<r;n++){const{h:o,l:a}=hd(t[n],e);[i[n],s[n]]=[o,a]}return[i,s]}const $l=(t,e,r)=>t>>>r,Al=(t,e,r)=>t<<32-r|e>>>r,fr=(t,e,r)=>t>>>r|e<<32-r,dr=(t,e,r)=>t<<32-r|e>>>r,Ti=(t,e,r)=>t<<64-r|e>>>r-32,Ci=(t,e,r)=>t>>>r-32|e<<64-r,Cv=(t,e)=>e,Bv=(t,e)=>t,Rv=(t,e,r)=>t<<r|e>>>32-r,Nv=(t,e,r)=>e<<r|t>>>32-r,Uv=(t,e,r)=>e<<r-32|t>>>64-r,kv=(t,e,r)=>t<<r-32|e>>>64-r;function Et(t,e,r,i){const s=(e>>>0)+(i>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const Ka=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Ha=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,jv=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),Mv=(t,e,r,i,s)=>e+r+i+s+(t/2**32|0)|0,Lv=(t,e,r,i,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(s>>>0),qv=(t,e,r,i,s,n)=>e+r+i+s+n+(t/2**32|0)|0,Gr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function ln(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function rr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function It(t,...e){if(!ln(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function un(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");rr(t.outputLen),rr(t.blockLen)}function vr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Wa(t,e){It(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Fi(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function yt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function eo(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Dt(t,e){return t<<32-e|t>>>e}const dd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function pd(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Kt=dd?t=>t:t=>pd(t);function zv(t){for(let e=0;e<t.length;e++)t[e]=pd(t[e]);return t}const pr=dd?t=>t:zv,gd=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Fv=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function oi(t){if(It(t),gd)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Fv[t[r]];return e}const zt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Pl(t){if(t>=zt._0&&t<=zt._9)return t-zt._0;if(t>=zt.A&&t<=zt.F)return t-(zt.A-10);if(t>=zt.a&&t<=zt.f)return t-(zt.a-10)}function Fs(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(gd)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=Pl(t.charCodeAt(n)),a=Pl(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function yd(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function xt(t){return typeof t=="string"&&(t=yd(t)),It(t),t}function gr(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];It(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}class hn{}function es(t){const e=i=>t().update(xt(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Vv(t){const e=(i,s)=>t(s).update(xt(i)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}function qr(t=32){if(Gr&&typeof Gr.getRandomValues=="function")return Gr.getRandomValues(new Uint8Array(t));if(Gr&&typeof Gr.randomBytes=="function")return Uint8Array.from(Gr.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const Kv=BigInt(0),Ei=BigInt(1),Hv=BigInt(2),Wv=BigInt(7),Gv=BigInt(256),Yv=BigInt(113),wd=[],md=[],bd=[];for(let t=0,e=Ei,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],wd.push(2*(5*i+r)),md.push((t+1)*(t+2)/2%64);let s=Kv;for(let n=0;n<7;n++)e=(e<<Ei^(e>>Wv)*Yv)%Gv,e&Hv&&(s^=Ei<<(Ei<<BigInt(n))-Ei);bd.push(s)}const vd=fd(bd,!0),Zv=vd[0],Jv=vd[1],Tl=(t,e,r)=>r>32?Uv(t,e,r):Rv(t,e,r),Cl=(t,e,r)=>r>32?kv(t,e,r):Nv(t,e,r);function Xv(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],f=Tl(l,u,1)^r[a],h=Cl(l,u,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=f,t[o+p+1]^=h}let s=t[2],n=t[3];for(let o=0;o<24;o++){const a=md[o],c=Tl(s,n,a),l=Cl(s,n,a),u=wd[o];s=t[u],n=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=Zv[i],t[1]^=Jv[i]}yt(r)}let Qv=class Ed extends hn{constructor(e,r,i,s=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=s,this.rounds=n,rr(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Fi(this.state)}clone(){return this._cloneInto()}keccak(){pr(this.state32),Xv(this.state32,this.rounds),pr(this.state32),this.posOut=0,this.pos=0}update(e){vr(this),e=xt(e),It(e);const{blockLen:r,state:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(r-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:s}=this;e[i]^=r,(r&128)!==0&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){vr(this,!1),It(e),this.finish();const r=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return rr(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Wa(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,yt(this.state)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new Ed(r,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const eE=(t,e,r)=>es(()=>new Qv(e,t,r)),tE=eE(1,136,256/8);function rE(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}function iE(t,e,r){return t&e^~t&r}function sE(t,e,r){return t&e^t&r^e&r}let _d=class extends hn{constructor(e,r,i,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.buffer=new Uint8Array(e),this.view=eo(this.buffer)}update(e){vr(this),e=xt(e),It(e);const{view:r,buffer:i,blockLen:s}=this,n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=eo(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){vr(this),Wa(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,yt(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(i,0),o=0);for(let f=o;f<s;f++)r[f]=0;rE(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=eo(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)a.setUint32(4*f,u[f],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=n,e.length=s,e.pos=a,s%r&&e.buffer.set(i),e}clone(){return this._cloneInto()}};const nr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ce=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Be=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),nE=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),or=new Uint32Array(64);class oE extends _d{constructor(e=32){super(64,e,8,!1),this.A=nr[0]|0,this.B=nr[1]|0,this.C=nr[2]|0,this.D=nr[3]|0,this.E=nr[4]|0,this.F=nr[5]|0,this.G=nr[6]|0,this.H=nr[7]|0}get(){const{A:e,B:r,C:i,D:s,E:n,F:o,G:a,H:c}=this;return[e,r,i,s,n,o,a,c]}set(e,r,i,s,n,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=s|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let f=0;f<16;f++,r+=4)or[f]=e.getUint32(r,!1);for(let f=16;f<64;f++){const h=or[f-15],p=or[f-2],d=Dt(h,7)^Dt(h,18)^h>>>3,g=Dt(p,17)^Dt(p,19)^p>>>10;or[f]=g+or[f-7]+d+or[f-16]|0}let{A:i,B:s,C:n,D:o,E:a,F:c,G:l,H:u}=this;for(let f=0;f<64;f++){const h=Dt(a,6)^Dt(a,11)^Dt(a,25),p=u+h+iE(a,c,l)+nE[f]+or[f]|0,d=(Dt(i,2)^Dt(i,13)^Dt(i,22))+sE(i,s,n)|0;u=l,l=c,c=a,a=o+p|0,o=n,n=s,s=i,i=p+d|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(i,s,n,o,a,c,l,u)}roundClean(){yt(or)}destroy(){this.set(0,0,0,0,0,0,0,0),yt(this.buffer)}}const xd=fd(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),aE=xd[0],cE=xd[1],ar=new Uint32Array(80),cr=new Uint32Array(80);let Ga=class extends _d{constructor(e=64){super(128,e,16,!1),this.Ah=Be[0]|0,this.Al=Be[1]|0,this.Bh=Be[2]|0,this.Bl=Be[3]|0,this.Ch=Be[4]|0,this.Cl=Be[5]|0,this.Dh=Be[6]|0,this.Dl=Be[7]|0,this.Eh=Be[8]|0,this.El=Be[9]|0,this.Fh=Be[10]|0,this.Fl=Be[11]|0,this.Gh=Be[12]|0,this.Gl=Be[13]|0,this.Hh=Be[14]|0,this.Hl=Be[15]|0}get(){const{Ah:e,Al:r,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:f,Fl:h,Gh:p,Gl:d,Hh:g,Hl:m}=this;return[e,r,i,s,n,o,a,c,l,u,f,h,p,d,g,m]}set(e,r,i,s,n,o,a,c,l,u,f,h,p,d,g,m){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=f|0,this.Fl=h|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=m|0}process(e,r){for(let b=0;b<16;b++,r+=4)ar[b]=e.getUint32(r),cr[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){const x=ar[b-15]|0,A=cr[b-15]|0,v=fr(x,A,1)^fr(x,A,8)^$l(x,A,7),C=dr(x,A,1)^dr(x,A,8)^Al(x,A,7),R=ar[b-2]|0,T=cr[b-2]|0,k=fr(R,T,19)^Ti(R,T,61)^$l(R,T,6),N=dr(R,T,19)^Ci(R,T,61)^Al(R,T,6),B=jv(C,N,cr[b-7],cr[b-16]),$=Mv(B,v,k,ar[b-7],ar[b-16]);ar[b]=$|0,cr[b]=B|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:f,El:h,Fh:p,Fl:d,Gh:g,Gl:m,Hh:E,Hl:S}=this;for(let b=0;b<80;b++){const x=fr(f,h,14)^fr(f,h,18)^Ti(f,h,41),A=dr(f,h,14)^dr(f,h,18)^Ci(f,h,41),v=f&p^~f&g,C=h&d^~h&m,R=Lv(S,A,C,cE[b],cr[b]),T=qv(R,E,x,v,aE[b],ar[b]),k=R|0,N=fr(i,s,28)^Ti(i,s,34)^Ti(i,s,39),B=dr(i,s,28)^Ci(i,s,34)^Ci(i,s,39),$=i&n^i&a^n&a,D=s&o^s&c^o&c;E=g|0,S=m|0,g=p|0,m=d|0,p=f|0,d=h|0,{h:f,l:h}=Et(l|0,u|0,T|0,k|0),l=a|0,u=c|0,a=n|0,c=o|0,n=i|0,o=s|0;const y=Ka(k,B,D);i=Ha(y,T,N,$),s=y|0}({h:i,l:s}=Et(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=Et(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=Et(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Et(this.Dh|0,this.Dl|0,l|0,u|0),{h:f,l:h}=Et(this.Eh|0,this.El|0,f|0,h|0),{h:p,l:d}=Et(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:m}=Et(this.Gh|0,this.Gl|0,g|0,m|0),{h:E,l:S}=Et(this.Hh|0,this.Hl|0,E|0,S|0),this.set(i,s,n,o,a,c,l,u,f,h,p,d,g,m,E,S)}roundClean(){yt(ar,cr)}destroy(){yt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class lE extends Ga{constructor(){super(48),this.Ah=Ce[0]|0,this.Al=Ce[1]|0,this.Bh=Ce[2]|0,this.Bl=Ce[3]|0,this.Ch=Ce[4]|0,this.Cl=Ce[5]|0,this.Dh=Ce[6]|0,this.Dl=Ce[7]|0,this.Eh=Ce[8]|0,this.El=Ce[9]|0,this.Fh=Ce[10]|0,this.Fl=Ce[11]|0,this.Gh=Ce[12]|0,this.Gl=Ce[13]|0,this.Hh=Ce[14]|0,this.Hl=Ce[15]|0}}const Re=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class uE extends Ga{constructor(){super(32),this.Ah=Re[0]|0,this.Al=Re[1]|0,this.Bh=Re[2]|0,this.Bl=Re[3]|0,this.Ch=Re[4]|0,this.Cl=Re[5]|0,this.Dh=Re[6]|0,this.Dl=Re[7]|0,this.Eh=Re[8]|0,this.El=Re[9]|0,this.Fh=Re[10]|0,this.Fl=Re[11]|0,this.Gh=Re[12]|0,this.Gl=Re[13]|0,this.Hh=Re[14]|0,this.Hl=Re[15]|0}}const fn=es(()=>new oE),hE=es(()=>new Ga),fE=es(()=>new lE),dE=es(()=>new uE),pE=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),we=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),K=new Uint32Array(32);function lr(t,e,r,i,s,n){const o=s[n],a=s[n+1];let c=K[2*t],l=K[2*t+1],u=K[2*e],f=K[2*e+1],h=K[2*r],p=K[2*r+1],d=K[2*i],g=K[2*i+1],m=Ka(c,u,o);l=Ha(m,l,f,a),c=m|0,{Dh:g,Dl:d}={Dh:g^l,Dl:d^c},{Dh:g,Dl:d}={Dh:Cv(g,d),Dl:Bv(g)},{h:p,l:h}=Et(p,h,g,d),{Bh:f,Bl:u}={Bh:f^p,Bl:u^h},{Bh:f,Bl:u}={Bh:fr(f,u,24),Bl:dr(f,u,24)},K[2*t]=c,K[2*t+1]=l,K[2*e]=u,K[2*e+1]=f,K[2*r]=h,K[2*r+1]=p,K[2*i]=d,K[2*i+1]=g}function ur(t,e,r,i,s,n){const o=s[n],a=s[n+1];let c=K[2*t],l=K[2*t+1],u=K[2*e],f=K[2*e+1],h=K[2*r],p=K[2*r+1],d=K[2*i],g=K[2*i+1],m=Ka(c,u,o);l=Ha(m,l,f,a),c=m|0,{Dh:g,Dl:d}={Dh:g^l,Dl:d^c},{Dh:g,Dl:d}={Dh:fr(g,d,16),Dl:dr(g,d,16)},{h:p,l:h}=Et(p,h,g,d),{Bh:f,Bl:u}={Bh:f^p,Bl:u^h},{Bh:f,Bl:u}={Bh:Ti(f,u,63),Bl:Ci(f,u,63)},K[2*t]=c,K[2*t+1]=l,K[2*e]=u,K[2*e+1]=f,K[2*r]=h,K[2*r+1]=p,K[2*i]=d,K[2*i+1]=g}function gE(t,e={},r,i,s){if(rr(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:n,salt:o,personalization:a}=e;if(n!==void 0&&(n.length<1||n.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==i)throw new Error("salt must be undefined or "+i);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}class yE extends hn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,rr(e),rr(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Fi(this.buffer)}update(e){vr(this),e=xt(e),It(e);const{blockLen:r,buffer:i,buffer32:s}=this,n=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<n;){this.pos===r&&(pr(s),this.compress(s,0,!1),pr(s),this.pos=0);const l=Math.min(r-this.pos,n-c),u=o+c;if(l===r&&!(u%4)&&c+l<n){const f=new Uint32Array(a,u,Math.floor((n-c)/4));pr(f);for(let h=0;c+r<n;h+=s.length,c+=r)this.length+=r,this.compress(f,h,!1);pr(f);continue}i.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){vr(this),Wa(e,this);const{pos:r,buffer32:i}=this;this.finished=!0,yt(this.buffer.subarray(r)),pr(i),this.compress(i,0,!0),pr(i);const s=Fi(e);this.get().forEach((n,o)=>s[o]=Kt(n))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){const{buffer:r,length:i,finished:s,destroyed:n,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=n,e.finished=s,e.length=i,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class wE extends yE{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=we[0]|0,this.v0h=we[1]|0,this.v1l=we[2]|0,this.v1h=we[3]|0,this.v2l=we[4]|0,this.v2h=we[5]|0,this.v3l=we[6]|0,this.v3h=we[7]|0,this.v4l=we[8]|0,this.v4h=we[9]|0,this.v5l=we[10]|0,this.v5h=we[11]|0,this.v6l=we[12]|0,this.v6h=we[13]|0,this.v7l=we[14]|0,this.v7h=we[15]|0,gE(r,e,64,16,16);let{key:i,personalization:s,salt:n}=e,o=0;if(i!==void 0&&(i=xt(i),o=i.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,n!==void 0){n=xt(n);const a=Fi(n);this.v4l^=Kt(a[0]),this.v4h^=Kt(a[1]),this.v5l^=Kt(a[2]),this.v5h^=Kt(a[3])}if(s!==void 0){s=xt(s);const a=Fi(s);this.v6l^=Kt(a[0]),this.v6h^=Kt(a[1]),this.v7l^=Kt(a[2]),this.v7h^=Kt(a[3])}if(i!==void 0){const a=new Uint8Array(this.blockLen);a.set(i),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:i,v1h:s,v2l:n,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:f,v5h:h,v6l:p,v6h:d,v7l:g,v7h:m}=this;return[e,r,i,s,n,o,a,c,l,u,f,h,p,d,g,m]}set(e,r,i,s,n,o,a,c,l,u,f,h,p,d,g,m){this.v0l=e|0,this.v0h=r|0,this.v1l=i|0,this.v1h=s|0,this.v2l=n|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=f|0,this.v5h=h|0,this.v6l=p|0,this.v6h=d|0,this.v7l=g|0,this.v7h=m|0}compress(e,r,i){this.get().forEach((c,l)=>K[l]=c),K.set(we,16);let{h:s,l:n}=hd(BigInt(this.length));K[24]=we[8]^n,K[25]=we[9]^s,i&&(K[28]=~K[28],K[29]=~K[29]);let o=0;const a=pE;for(let c=0;c<12;c++)lr(0,4,8,12,e,r+2*a[o++]),ur(0,4,8,12,e,r+2*a[o++]),lr(1,5,9,13,e,r+2*a[o++]),ur(1,5,9,13,e,r+2*a[o++]),lr(2,6,10,14,e,r+2*a[o++]),ur(2,6,10,14,e,r+2*a[o++]),lr(3,7,11,15,e,r+2*a[o++]),ur(3,7,11,15,e,r+2*a[o++]),lr(0,5,10,15,e,r+2*a[o++]),ur(0,5,10,15,e,r+2*a[o++]),lr(1,6,11,12,e,r+2*a[o++]),ur(1,6,11,12,e,r+2*a[o++]),lr(2,7,8,13,e,r+2*a[o++]),ur(2,7,8,13,e,r+2*a[o++]),lr(3,4,9,14,e,r+2*a[o++]),ur(3,4,9,14,e,r+2*a[o++]);this.v0l^=K[0]^K[16],this.v0h^=K[1]^K[17],this.v1l^=K[2]^K[18],this.v1h^=K[3]^K[19],this.v2l^=K[4]^K[20],this.v2h^=K[5]^K[21],this.v3l^=K[6]^K[22],this.v3h^=K[7]^K[23],this.v4l^=K[8]^K[24],this.v4h^=K[9]^K[25],this.v5l^=K[10]^K[26],this.v5h^=K[11]^K[27],this.v6l^=K[12]^K[28],this.v6h^=K[13]^K[29],this.v7l^=K[14]^K[30],this.v7h^=K[15]^K[31],yt(K)}destroy(){this.destroyed=!0,yt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const mE=Vv(t=>new wE(t)),bE="https://rpc.walletconnect.org/v1";function Id(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(tE(r)).toString("hex")}async function vE(t,e,r,i,s,n){switch(r.t){case"eip191":return await EE(t,e,r.s);case"eip1271":return await _E(t,e,r.s,i,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function EE(t,e,r){const i=vw(r);return Sw({payload:Id(e),signature:i}).toLowerCase()===t.toLowerCase()}async function _E(t,e,r,i,s,n){const o=Xt(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=r.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),f=(e.startsWith("0x")?e:Id(e)).substring(2),h=a+f+c+u+l,p=await fetch(`${n||bE}/?chainId=${i}&projectId=${s}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:xE(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:h},"latest"]})}),{result:d}=await p.json();return d?d.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function xE(){return Date.now()+Math.floor(Math.random()*1e3)}function IE(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const i=r[0];if(i===0)throw new Error("No signatures found");const s=1+i*64;if(r.length<s)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const n=Buffer.from(t,"base64").slice(1,65);return Zi.encode(n)}function SE(t){const e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(n=>n.charCodeAt(0)),i=new Uint8Array(r.length+e.length);i.set(r),i.set(e,r.length);const s=mE(i,{dkLen:32});return Zi.encode(s)}function Bl(t){const e=new Uint8Array(fn(OE(t)));return Zi.encode(e)}function OE(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function Rl(t){const e=Buffer.from(t,"base64"),r=um(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const i=tm(r),s=Buffer.from("TX"),n=Buffer.concat([s,Buffer.from(i)]),o=dE(n);return pg.encode(o).replace(/=+$/,"")}function to(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function DE(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),i=Buffer.from(t.signature.signature,"base64"),s=[];s.push(Buffer.from([10])),s.push(to(e.length)),s.push(e),s.push(Buffer.from([18])),s.push(to(r.length)),s.push(r),s.push(Buffer.from([26])),s.push(to(i.length)),s.push(i);const n=Buffer.concat(s),o=fn(n);return Buffer.from(o).toString("hex").toUpperCase()}function $E(t){var e,r;const i=[];try{if(typeof t=="string")return i.push(t),i;if(typeof t!="object")return i;t!=null&&t.id&&i.push(t.id);const s=(r=(e=t?.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;s&&i.push(...s)}catch(s){console.warn("getWalletSendCallsHashes failed: ",s)}return i}var AE=Object.defineProperty,PE=Object.defineProperties,TE=Object.getOwnPropertyDescriptors,Nl=Object.getOwnPropertySymbols,CE=Object.prototype.hasOwnProperty,BE=Object.prototype.propertyIsEnumerable,Ul=(t,e,r)=>e in t?AE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,RE=(t,e)=>{for(var r in e||(e={}))CE.call(e,r)&&Ul(t,r,e[r]);if(Nl)for(var r of Nl(e))BE.call(e,r)&&Ul(t,r,e[r]);return t},NE=(t,e)=>PE(t,TE(e));const UE="did:pkh:",Ya=t=>t?.split(":"),kE=t=>{const e=t&&Ya(t);if(e)return t.includes(UE)?e[3]:e[1]},Zo=t=>{const e=t&&Ya(t);if(e)return e[2]+":"+e[3]},Vs=t=>{const e=t&&Ya(t);if(e)return e.pop()};async function kl(t){const{cacao:e,projectId:r}=t,{s:i,p:s}=e,n=Sd(s,s.iss),o=Vs(s.iss);return await vE(o,n,i,Zo(s.iss),r)}const Sd=(t,e)=>{const r=`${t.domain} wants you to sign in with your Ethereum account:`,i=Vs(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0;const n=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${kE(e)}`,c=`Nonce: ${t.nonce}`,l=`Issued At: ${t.iat}`,u=t.exp?`Expiration Time: ${t.exp}`:void 0,f=t.nbf?`Not Before: ${t.nbf}`:void 0,h=t.requestId?`Request ID: ${t.requestId}`:void 0,p=t.resources?`Resources:${t.resources.map(g=>`
- ${g}`).join("")}`:void 0,d=Ps(t.resources);if(d){const g=Vi(d);s=HE(s,g)}return[r,i,"",s,"",n,o,a,c,l,u,f,h,p].filter(g=>g!=null).join(`
`)};function jE(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function ME(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function Mr(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const i=t.att[r];if(Array.isArray(i))throw new Error(`Resource must be an object: ${r}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(i).forEach(s=>{const n=i[s];if(!Array.isArray(n))throw new Error(`Ability limits ${s} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function LE(t,e,r,i={}){return r?.sort((s,n)=>s.localeCompare(n)),{att:{[t]:qE(e,r,i)}}}function qE(t,e,r={}){e=e?.sort((s,n)=>s.localeCompare(n));const i=e.map(s=>({[`${t}/${s}`]:[r]}));return Object.assign({},...i)}function Od(t){return Mr(t),`urn:recap:${jE(t).replace(/=/g,"")}`}function Vi(t){const e=ME(t.replace("urn:recap:",""));return Mr(e),e}function zE(t,e,r){const i=LE(t,e,r);return Od(i)}function FE(t){return t&&t.includes("urn:recap:")}function VE(t,e){const r=Vi(t),i=Vi(e),s=KE(r,i);return Od(s)}function KE(t,e){Mr(t),Mr(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((s,n)=>s.localeCompare(n)),i={att:{}};return r.forEach(s=>{var n,o;Object.keys(((n=t.att)==null?void 0:n[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;i.att[s]=NE(RE({},i.att[s]),{[a]:((c=t.att[s])==null?void 0:c[a])||((l=e.att[s])==null?void 0:l[a])})})}),i}function HE(t="",e){Mr(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const i=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(f=>({ability:f.split("/")[0],action:f.split("/")[1]}));c.sort((f,h)=>f.action.localeCompare(h.action));const l={};c.forEach(f=>{l[f.ability]||(l[f.ability]=[]),l[f.ability].push(f.action)});const u=Object.keys(l).map(f=>(s++,`(${s}) '${f}': '${l[f].join("', '")}' for '${a}'.`));i.push(u.join(", ").replace(".,","."))});const n=i.join(" "),o=`${r}${n}`;return`${t?t+" ":""}${o}`}function jl(t){var e;const r=Vi(t);Mr(r);const i=(e=r.att)==null?void 0:e.eip155;return i?Object.keys(i).map(s=>s.split("/")[1]):[]}function Ml(t){const e=Vi(t);Mr(e);const r=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(s=>{var n;(n=s?.[0])!=null&&n.chains&&r.push(s[0].chains)})}),[...new Set(r.flat())]}function Ps(t){if(!t)return;const e=t?.[t.length-1];return FE(e)?e:void 0}function Dd(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Jo(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function ro(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Ge(t,...e){if(!Dd(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Ll(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function WE(t,e){Ge(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function mr(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ui(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function GE(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const YE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ZE(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Xo(t){if(typeof t=="string")t=ZE(t);else if(Dd(t))t=Qo(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function JE(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function XE(t,e){if(t.length!==e.length)return!1;let r=0;for(let i=0;i<t.length;i++)r|=t[i]^e[i];return r===0}const QE=(t,e)=>{function r(i,...s){if(Ge(i),!YE)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const l=s[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?Ge(l):Ge(l,t.nonceLength)}const n=t.tagLength;n&&s[1]!==void 0&&Ge(s[1]);const o=e(i,...s),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");Ge(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Ge(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(Ge(l),n&&l.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(r,t),r};function ql(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!t2(e))throw new Error("invalid output, must be aligned");return e}function zl(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n);t.setUint32(e+4,o,i),t.setUint32(e+0,a,i)}function e2(t,e,r){Jo(r);const i=new Uint8Array(16),s=GE(i);return zl(s,0,BigInt(e),r),zl(s,8,BigInt(t),r),i}function t2(t){return t.byteOffset%4===0}function Qo(t){return Uint8Array.from(t)}const $d=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),r2=$d("expand 16-byte k"),i2=$d("expand 32-byte k"),s2=mr(r2),n2=mr(i2);function ee(t,e){return t<<e|t>>>32-e}function ea(t){return t.byteOffset%4===0}const ws=64,o2=16,Ad=2**32-1,Fl=new Uint32Array;function a2(t,e,r,i,s,n,o,a){const c=s.length,l=new Uint8Array(ws),u=mr(l),f=ea(s)&&ea(n),h=f?mr(s):Fl,p=f?mr(n):Fl;for(let d=0;d<c;o++){if(t(e,r,i,u,o,a),o>=Ad)throw new Error("arx: counter overflow");const g=Math.min(ws,c-d);if(f&&g===ws){const m=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let E=0,S;E<o2;E++)S=m+E,p[S]=h[S]^u[E];d+=ws;continue}for(let m=0,E;m<g;m++)E=d+m,n[E]=s[E]^l[m];d+=g}}function c2(t,e){const{allowShortKeys:r,extendNonceFn:i,counterLength:s,counterRight:n,rounds:o}=JE({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return ro(s),ro(o),Jo(n),Jo(r),(a,c,l,u,f=0)=>{Ge(a),Ge(c),Ge(l);const h=l.length;if(u===void 0&&(u=new Uint8Array(h)),Ge(u),ro(f),f<0||f>=Ad)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);const p=[];let d=a.length,g,m;if(d===32)p.push(g=Qo(a)),m=n2;else if(d===16&&r)g=new Uint8Array(32),g.set(a),g.set(a,16),m=s2,p.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);ea(c)||p.push(c=Qo(c));const E=mr(g);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(m,E,mr(c.subarray(0,16)),E),c=c.subarray(16)}const S=16-s;if(S!==c.length)throw new Error(`arx: nonce must be ${S} or 16 bytes`);if(S!==12){const x=new Uint8Array(12);x.set(c,n?0:12-c.length),c=x,p.push(c)}const b=mr(c);return a2(t,m,E,b,l,u,f,o),ui(...p),u}}const Se=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class l2{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Xo(e),Ge(e,32);const r=Se(e,0),i=Se(e,2),s=Se(e,4),n=Se(e,6),o=Se(e,8),a=Se(e,10),c=Se(e,12),l=Se(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|i<<3)&8191,this.r[2]=(i>>>10|s<<6)&7939,this.r[3]=(s>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Se(e,16+2*u)}process(e,r,i=!1){const s=i?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],f=o[4],h=o[5],p=o[6],d=o[7],g=o[8],m=o[9],E=Se(e,r+0),S=Se(e,r+2),b=Se(e,r+4),x=Se(e,r+6),A=Se(e,r+8),v=Se(e,r+10),C=Se(e,r+12),R=Se(e,r+14);let T=n[0]+(E&8191),k=n[1]+((E>>>13|S<<3)&8191),N=n[2]+((S>>>10|b<<6)&8191),B=n[3]+((b>>>7|x<<9)&8191),$=n[4]+((x>>>4|A<<12)&8191),D=n[5]+(A>>>1&8191),y=n[6]+((A>>>14|v<<2)&8191),w=n[7]+((v>>>11|C<<5)&8191),_=n[8]+((C>>>8|R<<8)&8191),P=n[9]+(R>>>5|s),I=0,O=I+T*a+k*(5*m)+N*(5*g)+B*(5*d)+$*(5*p);I=O>>>13,O&=8191,O+=D*(5*h)+y*(5*f)+w*(5*u)+_*(5*l)+P*(5*c),I+=O>>>13,O&=8191;let U=I+T*c+k*a+N*(5*m)+B*(5*g)+$*(5*d);I=U>>>13,U&=8191,U+=D*(5*p)+y*(5*h)+w*(5*f)+_*(5*u)+P*(5*l),I+=U>>>13,U&=8191;let j=I+T*l+k*c+N*a+B*(5*m)+$*(5*g);I=j>>>13,j&=8191,j+=D*(5*d)+y*(5*p)+w*(5*h)+_*(5*f)+P*(5*u),I+=j>>>13,j&=8191;let V=I+T*u+k*l+N*c+B*a+$*(5*m);I=V>>>13,V&=8191,V+=D*(5*g)+y*(5*d)+w*(5*p)+_*(5*h)+P*(5*f),I+=V>>>13,V&=8191;let L=I+T*f+k*u+N*l+B*c+$*a;I=L>>>13,L&=8191,L+=D*(5*m)+y*(5*g)+w*(5*d)+_*(5*p)+P*(5*h),I+=L>>>13,L&=8191;let q=I+T*h+k*f+N*u+B*l+$*c;I=q>>>13,q&=8191,q+=D*a+y*(5*m)+w*(5*g)+_*(5*d)+P*(5*p),I+=q>>>13,q&=8191;let H=I+T*p+k*h+N*f+B*u+$*l;I=H>>>13,H&=8191,H+=D*c+y*a+w*(5*m)+_*(5*g)+P*(5*d),I+=H>>>13,H&=8191;let G=I+T*d+k*p+N*h+B*f+$*u;I=G>>>13,G&=8191,G+=D*l+y*c+w*a+_*(5*m)+P*(5*g),I+=G>>>13,G&=8191;let Z=I+T*g+k*d+N*p+B*h+$*f;I=Z>>>13,Z&=8191,Z+=D*u+y*l+w*c+_*a+P*(5*m),I+=Z>>>13,Z&=8191;let W=I+T*m+k*g+N*d+B*p+$*h;I=W>>>13,W&=8191,W+=D*f+y*u+w*l+_*c+P*a,I+=W>>>13,W&=8191,I=(I<<2)+I|0,I=I+O|0,O=I&8191,I=I>>>13,U+=I,n[0]=O,n[1]=U,n[2]=j,n[3]=V,n[4]=L,n[5]=q,n[6]=H,n[7]=G,n[8]=Z,n[9]=W}finalize(){const{h:e,pad:r}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+s,s=i[a]>>>13,i[a]&=8191;i[9]-=8192;let n=(s^1)-1;for(let a=0;a<10;a++)i[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;ui(i)}update(e){Ll(this),e=Xo(e),Ge(e);const{buffer:r,blockLen:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(i-this.pos,s-n);if(o===i){for(;i<=s-n;n+=i)this.process(e,n);continue}r.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===i&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){ui(this.h,this.r,this.buffer,this.pad)}digestInto(e){Ll(this),WE(e,this),this.finished=!0;const{buffer:r,h:i}=this;let{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=i[o]>>>0,e[n++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}}function u2(t){const e=(i,s)=>t(s).update(Xo(i)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}const h2=u2(t=>new l2(t));function f2(t,e,r,i,s,n=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],f=e[1],h=e[2],p=e[3],d=e[4],g=e[5],m=e[6],E=e[7],S=s,b=r[0],x=r[1],A=r[2],v=o,C=a,R=c,T=l,k=u,N=f,B=h,$=p,D=d,y=g,w=m,_=E,P=S,I=b,O=x,U=A;for(let V=0;V<n;V+=2)v=v+k|0,P=ee(P^v,16),D=D+P|0,k=ee(k^D,12),v=v+k|0,P=ee(P^v,8),D=D+P|0,k=ee(k^D,7),C=C+N|0,I=ee(I^C,16),y=y+I|0,N=ee(N^y,12),C=C+N|0,I=ee(I^C,8),y=y+I|0,N=ee(N^y,7),R=R+B|0,O=ee(O^R,16),w=w+O|0,B=ee(B^w,12),R=R+B|0,O=ee(O^R,8),w=w+O|0,B=ee(B^w,7),T=T+$|0,U=ee(U^T,16),_=_+U|0,$=ee($^_,12),T=T+$|0,U=ee(U^T,8),_=_+U|0,$=ee($^_,7),v=v+N|0,U=ee(U^v,16),w=w+U|0,N=ee(N^w,12),v=v+N|0,U=ee(U^v,8),w=w+U|0,N=ee(N^w,7),C=C+B|0,P=ee(P^C,16),_=_+P|0,B=ee(B^_,12),C=C+B|0,P=ee(P^C,8),_=_+P|0,B=ee(B^_,7),R=R+$|0,I=ee(I^R,16),D=D+I|0,$=ee($^D,12),R=R+$|0,I=ee(I^R,8),D=D+I|0,$=ee($^D,7),T=T+k|0,O=ee(O^T,16),y=y+O|0,k=ee(k^y,12),T=T+k|0,O=ee(O^T,8),y=y+O|0,k=ee(k^y,7);let j=0;i[j++]=o+v|0,i[j++]=a+C|0,i[j++]=c+R|0,i[j++]=l+T|0,i[j++]=u+k|0,i[j++]=f+N|0,i[j++]=h+B|0,i[j++]=p+$|0,i[j++]=d+D|0,i[j++]=g+y|0,i[j++]=m+w|0,i[j++]=E+_|0,i[j++]=S+P|0,i[j++]=b+I|0,i[j++]=x+O|0,i[j++]=A+U|0}const d2=c2(f2,{counterRight:!1,counterLength:4,allowShortKeys:!1}),p2=new Uint8Array(16),Vl=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(p2.subarray(r))},g2=new Uint8Array(32);function Kl(t,e,r,i,s){const n=t(e,r,g2),o=h2.create(n);s&&Vl(o,s),Vl(o,i);const a=e2(i.length,s?s.length:0,!0);o.update(a);const c=o.digest();return ui(n,a),c}const y2=t=>(e,r,i)=>({encrypt(s,n){const o=s.length;n=ql(o+16,n,!1),n.set(s);const a=n.subarray(0,-16);t(e,r,a,a,1);const c=Kl(t,e,r,a,i);return n.set(c,o),ui(c),n},decrypt(s,n){n=ql(s.length-16,n,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=Kl(t,e,r,o,i);if(!XE(a,c))throw new Error("invalid tag");return n.set(s.subarray(0,-16)),t(e,r,n,n,1),ui(c),n}}),Pd=QE({blockSize:64,nonceLength:12,tagLength:16},y2(d2));let Td=class extends hn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,un(e);const i=xt(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),yt(n)}update(e){return vr(this),this.iHash.update(e),this}digestInto(e){vr(this),It(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:s,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const dn=(t,e,r)=>new Td(t,e).update(r).digest();dn.create=(t,e)=>new Td(t,e);function w2(t,e,r){return un(t),r===void 0&&(r=new Uint8Array(t.outputLen)),dn(t,xt(r),xt(e))}const io=Uint8Array.from([0]),Hl=Uint8Array.of();function m2(t,e,r,i=32){un(t),rr(i);const s=t.outputLen;if(i>255*s)throw new Error("Length should be <= 255*HashLen");const n=Math.ceil(i/s);r===void 0&&(r=Hl);const o=new Uint8Array(n*s),a=dn.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<n;u++)io[0]=u+1,c.update(u===0?Hl:l).update(r).update(io).digestInto(l),o.set(l,s*u),a._cloneInto(c);return a.destroy(),c.destroy(),yt(l,io),o.slice(0,i)}const b2=(t,e,r,i,s)=>m2(t,w2(t,e,r),i,s),pn=fn,Za=BigInt(0),ta=BigInt(1);function Ks(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function Rr(t,e,r=""){const i=ln(t),s=t?.length,n=e!==void 0;if(!i||n&&s!==e){const o=r&&`"${r}" `,a=n?` of length ${e}`:"",c=i?`length=${s}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function ms(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Cd(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Za:BigInt("0x"+t)}function gn(t){return Cd(oi(t))}function Hs(t){return It(t),Cd(oi(Uint8Array.from(t).reverse()))}function Ja(t,e){return Fs(t.toString(16).padStart(e*2,"0"))}function Xa(t,e){return Ja(t,e).reverse()}function ke(t,e,r){let i;if(typeof e=="string")try{i=Fs(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(ln(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}const so=t=>typeof t=="bigint"&&Za<=t;function v2(t,e,r){return so(t)&&so(e)&&so(r)&&e<=t&&t<r}function ra(t,e,r,i){if(!v2(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function Bd(t){let e;for(e=0;t>Za;t>>=ta,e+=1);return e}const ts=t=>(ta<<BigInt(t))-ta;function E2(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const i=h=>new Uint8Array(h),s=h=>Uint8Array.of(h);let n=i(t),o=i(t),a=0;const c=()=>{n.fill(1),o.fill(0),a=0},l=(...h)=>r(o,n,...h),u=(h=i(0))=>{o=l(s(0),h),n=l(),h.length!==0&&(o=l(s(1),h),n=l())},f=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const p=[];for(;h<e;){n=l();const d=n.slice();p.push(d),h+=n.length}return gr(...p)};return(h,p)=>{c(),u(h);let d;for(;!(d=p(f()));)u();return c(),d}}function yn(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function i(s,n,o){const a=t[s];if(o&&a===void 0)return;const c=typeof a;if(c!==n||a===null)throw new Error(`param "${s}" is invalid: expected ${n}, got ${c}`)}Object.entries(e).forEach(([s,n])=>i(s,n,!1)),Object.entries(r).forEach(([s,n])=>i(s,n,!0))}function Wl(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}const Je=BigInt(0),Le=BigInt(1),Nr=BigInt(2),Rd=BigInt(3),Nd=BigInt(4),Ud=BigInt(5),_2=BigInt(7),kd=BigInt(8),x2=BigInt(9),jd=BigInt(16);function st(t,e){const r=t%e;return r>=Je?r:e+r}function vt(t,e,r){let i=t;for(;e-- >Je;)i*=i,i%=r;return i}function Gl(t,e){if(t===Je)throw new Error("invert: expected non-zero number");if(e<=Je)throw new Error("invert: expected positive modulus, got "+e);let r=st(t,e),i=e,s=Je,n=Le;for(;r!==Je;){const o=i/r,a=i%r,c=s-n*o;i=r,r=a,s=n,n=c}if(i!==Le)throw new Error("invert: does not exist");return st(s,e)}function Qa(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function Md(t,e){const r=(t.ORDER+Le)/Nd,i=t.pow(e,r);return Qa(t,i,e),i}function I2(t,e){const r=(t.ORDER-Ud)/kd,i=t.mul(e,Nr),s=t.pow(i,r),n=t.mul(e,s),o=t.mul(t.mul(n,Nr),s),a=t.mul(n,t.sub(o,t.ONE));return Qa(t,a,e),a}function S2(t){const e=_r(t),r=Ld(t),i=r(e,e.neg(e.ONE)),s=r(e,i),n=r(e,e.neg(i)),o=(t+_2)/jd;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,i);const f=a.mul(l,s),h=a.mul(l,n),p=a.eql(a.sqr(u),c),d=a.eql(a.sqr(f),c);l=a.cmov(l,u,p),u=a.cmov(h,f,d);const g=a.eql(a.sqr(u),c),m=a.cmov(l,u,g);return Qa(a,m,c),m}}function Ld(t){if(t<Rd)throw new Error("sqrt is not defined for small field");let e=t-Le,r=0;for(;e%Nr===Je;)e/=Nr,r++;let i=Nr;const s=_r(t);for(;Yl(s,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Md;let n=s.pow(i,e);const o=(e+Le)/Nr;return function(a,c){if(a.is0(c))return c;if(Yl(a,c)!==1)throw new Error("Cannot find square root");let l=r,u=a.mul(a.ONE,n),f=a.pow(c,e),h=a.pow(c,o);for(;!a.eql(f,a.ONE);){if(a.is0(f))return a.ZERO;let p=1,d=a.sqr(f);for(;!a.eql(d,a.ONE);)if(p++,d=a.sqr(d),p===l)throw new Error("Cannot find square root");const g=Le<<BigInt(l-p-1),m=a.pow(u,g);l=p,u=a.sqr(m),f=a.mul(f,u),h=a.mul(h,m)}return h}}function O2(t){return t%Nd===Rd?Md:t%kd===Ud?I2:t%jd===x2?S2(t):Ld(t)}const D2=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function $2(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=D2.reduce((i,s)=>(i[s]="function",i),e);return yn(t,r),t}function A2(t,e,r){if(r<Je)throw new Error("invalid exponent, negatives unsupported");if(r===Je)return t.ONE;if(r===Le)return e;let i=t.ONE,s=e;for(;r>Je;)r&Le&&(i=t.mul(i,s)),s=t.sqr(s),r>>=Le;return i}function qd(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),n=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),n),i}function Yl(t,e){const r=(t.ORDER-Le)/Nr,i=t.pow(e,r),s=t.eql(i,t.ONE),n=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!s&&!n&&!o)throw new Error("invalid Legendre symbol result");return s?1:n?0:-1}function zd(t,e){e!==void 0&&rr(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function _r(t,e,r=!1,i={}){if(t<=Je)throw new Error("invalid field: expected ORDER > 0, got "+t);let s,n,o=!1,a;if(typeof e=="object"&&e!=null){if(i.sqrt||r)throw new Error("cannot specify opts in two arguments");const h=e;h.BITS&&(s=h.BITS),h.sqrt&&(n=h.sqrt),typeof h.isLE=="boolean"&&(r=h.isLE),typeof h.modFromBytes=="boolean"&&(o=h.modFromBytes),a=h.allowedLengths}else typeof e=="number"&&(s=e),i.sqrt&&(n=i.sqrt);const{nBitLength:c,nByteLength:l}=zd(t,s);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const f=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:l,MASK:ts(c),ZERO:Je,ONE:Le,allowedLengths:a,create:h=>st(h,t),isValid:h=>{if(typeof h!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof h);return Je<=h&&h<t},is0:h=>h===Je,isValidNot0:h=>!f.is0(h)&&f.isValid(h),isOdd:h=>(h&Le)===Le,neg:h=>st(-h,t),eql:(h,p)=>h===p,sqr:h=>st(h*h,t),add:(h,p)=>st(h+p,t),sub:(h,p)=>st(h-p,t),mul:(h,p)=>st(h*p,t),pow:(h,p)=>A2(f,h,p),div:(h,p)=>st(h*Gl(p,t),t),sqrN:h=>h*h,addN:(h,p)=>h+p,subN:(h,p)=>h-p,mulN:(h,p)=>h*p,inv:h=>Gl(h,t),sqrt:n||(h=>(u||(u=O2(t)),u(f,h))),toBytes:h=>r?Xa(h,l):Ja(h,l),fromBytes:(h,p=!0)=>{if(a){if(!a.includes(h.length)||h.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+h.length);const g=new Uint8Array(l);g.set(h,r?0:g.length-h.length),h=g}if(h.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+h.length);let d=r?Hs(h):gn(h);if(o&&(d=st(d,t)),!p&&!f.isValid(d))throw new Error("invalid field element: outside of range 0..ORDER");return d},invertBatch:h=>qd(f,h),cmov:(h,p,d)=>d?p:h});return Object.freeze(f)}function Fd(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Vd(t){const e=Fd(t);return e+Math.ceil(e/2)}function P2(t,e,r=!1){const i=t.length,s=Fd(e),n=Vd(e);if(i<16||i<n||i>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+i);const o=r?Hs(t):gn(t),a=st(o,e-Le)+Le;return r?Xa(a,s):Ja(a,s)}const hi=BigInt(0),Ur=BigInt(1);function Ws(t,e){const r=e.negate();return t?r:e}function no(t,e){const r=qd(t.Fp,e.map(i=>i.Z));return e.map((i,s)=>t.fromAffine(i.toAffine(r[s])))}function Kd(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function oo(t,e){Kd(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),s=2**t,n=ts(t),o=BigInt(t);return{windows:r,windowSize:i,mask:n,maxNumber:s,shiftBy:o}}function Zl(t,e,r){const{windowSize:i,mask:s,maxNumber:n,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>i&&(a-=n,c+=Ur);const l=e*i,u=l+Math.abs(a)-1,f=a===0,h=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:f,isNeg:h,isNegF:p,offsetF:l}}function T2(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function C2(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const ao=new WeakMap,Hd=new WeakMap;function co(t){return Hd.get(t)||1}function Jl(t){if(t!==hi)throw new Error("invalid wNAF")}class B2{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,i=this.ZERO){let s=e;for(;r>hi;)r&Ur&&(i=i.add(s)),s=s.double(),r>>=Ur;return i}precomputeWindow(e,r){const{windows:i,windowSize:s}=oo(r,this.bits),n=[];let o=e,a=o;for(let c=0;c<i;c++){a=o,n.push(a);for(let l=1;l<s;l++)a=a.add(o),n.push(a);o=a.double()}return n}wNAF(e,r,i){if(!this.Fn.isValid(i))throw new Error("invalid scalar");let s=this.ZERO,n=this.BASE;const o=oo(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:l,isZero:u,isNeg:f,isNegF:h,offsetF:p}=Zl(i,a,o);i=c,u?n=n.add(Ws(h,r[p])):s=s.add(Ws(f,r[l]))}return Jl(i),{p:s,f:n}}wNAFUnsafe(e,r,i,s=this.ZERO){const n=oo(e,this.bits);for(let o=0;o<n.windows&&i!==hi;o++){const{nextN:a,offset:c,isZero:l,isNeg:u}=Zl(i,o,n);if(i=a,!l){const f=r[c];s=s.add(u?f.negate():f)}}return Jl(i),s}getPrecomputes(e,r,i){let s=ao.get(r);return s||(s=this.precomputeWindow(r,e),e!==1&&(typeof i=="function"&&(s=i(s)),ao.set(r,s))),s}cached(e,r,i){const s=co(e);return this.wNAF(s,this.getPrecomputes(s,e,i),r)}unsafe(e,r,i,s){const n=co(e);return n===1?this._unsafeLadder(e,r,s):this.wNAFUnsafe(n,this.getPrecomputes(n,e,i),r,s)}createCache(e,r){Kd(r,this.bits),Hd.set(e,r),ao.delete(e)}hasCache(e){return co(e)!==1}}function R2(t,e,r,i){let s=e,n=t.ZERO,o=t.ZERO;for(;r>hi||i>hi;)r&Ur&&(n=n.add(s)),i&Ur&&(o=o.add(s)),s=s.double(),r>>=Ur,i>>=Ur;return{p1:n,p2:o}}function N2(t,e,r,i){T2(r,t),C2(i,e);const s=r.length,n=i.length;if(s!==n)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Bd(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=ts(c),u=new Array(Number(l)+1).fill(o),f=Math.floor((e.BITS-1)/c)*c;let h=o;for(let p=f;p>=0;p-=c){u.fill(o);for(let g=0;g<n;g++){const m=i[g],E=Number(m>>BigInt(p)&l);u[E]=u[E].add(r[g])}let d=o;for(let g=u.length-1,m=o;g>0;g--)m=m.add(u[g]),d=d.add(m);if(h=h.add(d),p!==0)for(let g=0;g<c;g++)h=h.double()}return h}function Xl(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return $2(e),e}else return _r(t,{isLE:r})}function U2(t,e,r={},i){if(i===void 0&&(i=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>hi))throw new Error(`CURVE.${a} must be positive bigint`)}const s=Xl(e.p,r.Fp,i),n=Xl(e.n,r.Fn,i),o=["Gx","Gy","a","b"];for(const a of o)if(!s.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:n}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),yd("HashToScalar-");const _i=BigInt(0),Yr=BigInt(1),bs=BigInt(2);function k2(t){return yn(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function j2(t){const e=k2(t),{P:r,type:i,adjustScalarBytes:s,powPminus2:n,randomBytes:o}=e,a=i==="x25519";if(!a&&i!=="x448")throw new Error("invalid type");const c=o||qr,l=a?255:448,u=a?32:56,f=BigInt(a?9:5),h=BigInt(a?121665:39081),p=a?bs**BigInt(254):bs**BigInt(447),d=a?BigInt(8)*bs**BigInt(251)-Yr:BigInt(4)*bs**BigInt(445)-Yr,g=p+d+Yr,m=B=>st(B,r),E=S(f);function S(B){return Xa(m(B),u)}function b(B){const $=ke("u coordinate",B,u);return a&&($[31]&=127),m(Hs($))}function x(B){return Hs(s(ke("scalar",B,u)))}function A(B,$){const D=R(b($),x(B));if(D===_i)throw new Error("invalid private or public key received");return S(D)}function v(B){return A(B,E)}function C(B,$,D){const y=m(B*($-D));return $=m($-y),D=m(D+y),{x_2:$,x_3:D}}function R(B,$){ra("u",B,_i,r),ra("scalar",$,p,g);const D=$,y=B;let w=Yr,_=_i,P=B,I=Yr,O=_i;for(let j=BigInt(l-1);j>=_i;j--){const V=D>>j&Yr;O^=V,{x_2:w,x_3:P}=C(O,w,P),{x_2:_,x_3:I}=C(O,_,I),O=V;const L=w+_,q=m(L*L),H=w-_,G=m(H*H),Z=q-G,W=P+I,J=P-I,ue=m(J*L),ye=m(W*H),ve=ue+ye,je=ue-ye;P=m(ve*ve),I=m(y*m(je*je)),w=m(q*G),_=m(Z*(q+m(h*Z)))}({x_2:w,x_3:P}=C(O,w,P)),{x_2:_,x_3:I}=C(O,_,I);const U=n(_);return m(w*U)}const T={secretKey:u,publicKey:u,seed:u},k=(B=c(u))=>(It(B,T.seed),B);function N(B){const $=k(B);return{secretKey:$,publicKey:v($)}}return{keygen:N,getSharedSecret:(B,$)=>A(B,$),getPublicKey:B=>v(B),scalarMult:A,scalarMultBase:v,utils:{randomSecretKey:k,randomPrivateKey:k},GuBytes:E.slice(),lengths:T}}const M2=BigInt(1),Ql=BigInt(2),L2=BigInt(3),q2=BigInt(5);BigInt(8);const Wd=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),z2={p:Wd,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function F2(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=Wd,o=t*t%n*t%n,a=vt(o,Ql,n)*o%n,c=vt(a,M2,n)*t%n,l=vt(c,q2,n)*c%n,u=vt(l,e,n)*l%n,f=vt(u,r,n)*u%n,h=vt(f,i,n)*f%n,p=vt(h,s,n)*h%n,d=vt(p,s,n)*h%n,g=vt(d,e,n)*l%n;return{pow_p_5_8:vt(g,Ql,n)*t%n,b2:o}}function V2(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const K2=_r(z2.p,{isLE:!0}),ia=(()=>{const t=K2.ORDER;return j2({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:i}=F2(e);return st(vt(r,L2,t)*i,t)},adjustScalarBytes:V2})})(),eu=(t,e)=>(t+(t>=0?e:-e)/Gd)/e;function H2(t,e,r){const[[i,s],[n,o]]=e,a=eu(o*t,r),c=eu(-s*t,r);let l=t-a*i-c*n,u=-a*s-c*o;const f=l<Jt,h=u<Jt;f&&(l=-l),h&&(u=-u);const p=ts(Math.ceil(Bd(r)/2))+ai;if(l<Jt||l>=p||u<Jt||u>=p)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:f,k1:l,k2neg:h,k2:u}}function sa(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function lo(t,e){const r={};for(let i of Object.keys(e))r[i]=t[i]===void 0?e[i]:t[i];return Ks(r.lowS,"lowS"),Ks(r.prehash,"prehash"),r.format!==void 0&&sa(r.format),r}class W2 extends Error{constructor(e=""){super(e)}}const Yt={Err:W2,_tlv:{encode:(t,e)=>{const{Err:r}=Yt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,s=ms(i);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const n=i>127?ms(s.length/2|128):"";return ms(t)+n+s+e},decode(t,e){const{Err:r}=Yt;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[i++],n=!!(s&128);let o=0;if(!n)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(i,i+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=Yt;if(t<Jt)throw new e("integer: negative integers are not allowed");let r=ms(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Yt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return gn(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=Yt,s=ke("signature",t),{v:n,l:o}=i.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,n),{v:l,l:u}=i.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=Yt,i=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),n=i+s;return e.encode(48,n)}},Jt=BigInt(0),ai=BigInt(1),Gd=BigInt(2),vs=BigInt(3),G2=BigInt(4);function ti(t,e){const{BYTES:r}=t;let i;if(typeof e=="bigint")i=e;else{let s=ke("private key",e);try{i=t.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}function Y2(t,e={}){const r=U2("weierstrass",t,e),{Fp:i,Fn:s}=r;let n=r.CURVE;const{h:o,n:a}=n;yn(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!i.is0(n.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=Zd(i,s);function u(){if(!i.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function f(B,$,D){const{x:y,y:w}=$.toAffine(),_=i.toBytes(y);if(Ks(D,"isCompressed"),D){u();const P=!i.isOdd(w);return gr(Yd(P),_)}else return gr(Uint8Array.of(4),_,i.toBytes(w))}function h(B){Rr(B,void 0,"Point");const{publicKey:$,publicKeyUncompressed:D}=l,y=B.length,w=B[0],_=B.subarray(1);if(y===$&&(w===2||w===3)){const P=i.fromBytes(_);if(!i.isValid(P))throw new Error("bad point: is not on curve, wrong x");const I=g(P);let O;try{O=i.sqrt(I)}catch(j){const V=j instanceof Error?": "+j.message:"";throw new Error("bad point: is not on curve, sqrt error"+V)}u();const U=i.isOdd(O);return(w&1)===1!==U&&(O=i.neg(O)),{x:P,y:O}}else if(y===D&&w===4){const P=i.BYTES,I=i.fromBytes(_.subarray(0,P)),O=i.fromBytes(_.subarray(P,P*2));if(!m(I,O))throw new Error("bad point: is not on curve");return{x:I,y:O}}else throw new Error(`bad point: got length ${y}, expected compressed=${$} or uncompressed=${D}`)}const p=e.toBytes||f,d=e.fromBytes||h;function g(B){const $=i.sqr(B),D=i.mul($,B);return i.add(i.add(D,i.mul(B,n.a)),n.b)}function m(B,$){const D=i.sqr($),y=g(B);return i.eql(D,y)}if(!m(n.Gx,n.Gy))throw new Error("bad curve params: generator point");const E=i.mul(i.pow(n.a,vs),G2),S=i.mul(i.sqr(n.b),BigInt(27));if(i.is0(i.add(E,S)))throw new Error("bad curve params: a or b");function b(B,$,D=!1){if(!i.isValid($)||D&&i.is0($))throw new Error(`bad point coordinate ${B}`);return $}function x(B){if(!(B instanceof T))throw new Error("ProjectivePoint expected")}function A(B){if(!c||!c.basises)throw new Error("no endo");return H2(B,c.basises,s.ORDER)}const v=Wl((B,$)=>{const{X:D,Y:y,Z:w}=B;if(i.eql(w,i.ONE))return{x:D,y};const _=B.is0();$==null&&($=_?i.ONE:i.inv(w));const P=i.mul(D,$),I=i.mul(y,$),O=i.mul(w,$);if(_)return{x:i.ZERO,y:i.ZERO};if(!i.eql(O,i.ONE))throw new Error("invZ was invalid");return{x:P,y:I}}),C=Wl(B=>{if(B.is0()){if(e.allowInfinityPoint&&!i.is0(B.Y))return;throw new Error("bad point: ZERO")}const{x:$,y:D}=B.toAffine();if(!i.isValid($)||!i.isValid(D))throw new Error("bad point: x or y not field elements");if(!m($,D))throw new Error("bad point: equation left != right");if(!B.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function R(B,$,D,y,w){return D=new T(i.mul(D.X,B),D.Y,D.Z),$=Ws(y,$),D=Ws(w,D),$.add(D)}class T{constructor($,D,y){this.X=b("x",$),this.Y=b("y",D,!0),this.Z=b("z",y),Object.freeze(this)}static CURVE(){return n}static fromAffine($){const{x:D,y}=$||{};if(!$||!i.isValid(D)||!i.isValid(y))throw new Error("invalid affine point");if($ instanceof T)throw new Error("projective point not allowed");return i.is0(D)&&i.is0(y)?T.ZERO:new T(D,y,i.ONE)}static fromBytes($){const D=T.fromAffine(d(Rr($,void 0,"point")));return D.assertValidity(),D}static fromHex($){return T.fromBytes(ke("pointHex",$))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute($=8,D=!0){return N.createCache(this,$),D||this.multiply(vs),this}assertValidity(){C(this)}hasEvenY(){const{y:$}=this.toAffine();if(!i.isOdd)throw new Error("Field doesn't support isOdd");return!i.isOdd($)}equals($){x($);const{X:D,Y:y,Z:w}=this,{X:_,Y:P,Z:I}=$,O=i.eql(i.mul(D,I),i.mul(_,w)),U=i.eql(i.mul(y,I),i.mul(P,w));return O&&U}negate(){return new T(this.X,i.neg(this.Y),this.Z)}double(){const{a:$,b:D}=n,y=i.mul(D,vs),{X:w,Y:_,Z:P}=this;let I=i.ZERO,O=i.ZERO,U=i.ZERO,j=i.mul(w,w),V=i.mul(_,_),L=i.mul(P,P),q=i.mul(w,_);return q=i.add(q,q),U=i.mul(w,P),U=i.add(U,U),I=i.mul($,U),O=i.mul(y,L),O=i.add(I,O),I=i.sub(V,O),O=i.add(V,O),O=i.mul(I,O),I=i.mul(q,I),U=i.mul(y,U),L=i.mul($,L),q=i.sub(j,L),q=i.mul($,q),q=i.add(q,U),U=i.add(j,j),j=i.add(U,j),j=i.add(j,L),j=i.mul(j,q),O=i.add(O,j),L=i.mul(_,P),L=i.add(L,L),j=i.mul(L,q),I=i.sub(I,j),U=i.mul(L,V),U=i.add(U,U),U=i.add(U,U),new T(I,O,U)}add($){x($);const{X:D,Y:y,Z:w}=this,{X:_,Y:P,Z:I}=$;let O=i.ZERO,U=i.ZERO,j=i.ZERO;const V=n.a,L=i.mul(n.b,vs);let q=i.mul(D,_),H=i.mul(y,P),G=i.mul(w,I),Z=i.add(D,y),W=i.add(_,P);Z=i.mul(Z,W),W=i.add(q,H),Z=i.sub(Z,W),W=i.add(D,w);let J=i.add(_,I);return W=i.mul(W,J),J=i.add(q,G),W=i.sub(W,J),J=i.add(y,w),O=i.add(P,I),J=i.mul(J,O),O=i.add(H,G),J=i.sub(J,O),j=i.mul(V,W),O=i.mul(L,G),j=i.add(O,j),O=i.sub(H,j),j=i.add(H,j),U=i.mul(O,j),H=i.add(q,q),H=i.add(H,q),G=i.mul(V,G),W=i.mul(L,W),H=i.add(H,G),G=i.sub(q,G),G=i.mul(V,G),W=i.add(W,G),q=i.mul(H,W),U=i.add(U,q),q=i.mul(J,W),O=i.mul(Z,O),O=i.sub(O,q),q=i.mul(Z,H),j=i.mul(J,j),j=i.add(j,q),new T(O,U,j)}subtract($){return this.add($.negate())}is0(){return this.equals(T.ZERO)}multiply($){const{endo:D}=e;if(!s.isValidNot0($))throw new Error("invalid scalar: out of range");let y,w;const _=P=>N.cached(this,P,I=>no(T,I));if(D){const{k1neg:P,k1:I,k2neg:O,k2:U}=A($),{p:j,f:V}=_(I),{p:L,f:q}=_(U);w=V.add(q),y=R(D.beta,j,L,P,O)}else{const{p:P,f:I}=_($);y=P,w=I}return no(T,[y,w])[0]}multiplyUnsafe($){const{endo:D}=e,y=this;if(!s.isValid($))throw new Error("invalid scalar: out of range");if($===Jt||y.is0())return T.ZERO;if($===ai)return y;if(N.hasCache(this))return this.multiply($);if(D){const{k1neg:w,k1:_,k2neg:P,k2:I}=A($),{p1:O,p2:U}=R2(T,y,_,I);return R(D.beta,O,U,w,P)}else return N.unsafe(y,$)}multiplyAndAddUnsafe($,D,y){const w=this.multiplyUnsafe(D).add($.multiplyUnsafe(y));return w.is0()?void 0:w}toAffine($){return v(this,$)}isTorsionFree(){const{isTorsionFree:$}=e;return o===ai?!0:$?$(T,this):N.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:$}=e;return o===ai?this:$?$(T,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes($=!0){return Ks($,"isCompressed"),this.assertValidity(),p(T,this,$)}toHex($=!0){return oi(this.toBytes($))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes($=!0){return this.toBytes($)}_setWindowSize($){this.precompute($)}static normalizeZ($){return no(T,$)}static msm($,D){return N2(T,s,$,D)}static fromPrivateKey($){return T.BASE.multiply(ti(s,$))}}T.BASE=new T(n.Gx,n.Gy,i.ONE),T.ZERO=new T(i.ZERO,i.ONE,i.ZERO),T.Fp=i,T.Fn=s;const k=s.BITS,N=new B2(T,e.endo?Math.ceil(k/2):k);return T.BASE.precompute(8),T}function Yd(t){return Uint8Array.of(t?2:3)}function Zd(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function Z2(t,e={}){const{Fn:r}=t,i=e.randomBytes||qr,s=Object.assign(Zd(t.Fp,r),{seed:Vd(r.ORDER)});function n(h){try{return!!ti(r,h)}catch{return!1}}function o(h,p){const{publicKey:d,publicKeyUncompressed:g}=s;try{const m=h.length;return p===!0&&m!==d||p===!1&&m!==g?!1:!!t.fromBytes(h)}catch{return!1}}function a(h=i(s.seed)){return P2(Rr(h,s.seed,"seed"),r.ORDER)}function c(h,p=!0){return t.BASE.multiply(ti(r,h)).toBytes(p)}function l(h){const p=a(h);return{secretKey:p,publicKey:c(p)}}function u(h){if(typeof h=="bigint")return!1;if(h instanceof t)return!0;const{secretKey:p,publicKey:d,publicKeyUncompressed:g}=s;if(r.allowedLengths||p===d)return;const m=ke("key",h).length;return m===d||m===g}function f(h,p,d=!0){if(u(h)===!0)throw new Error("first arg must be private key");if(u(p)===!1)throw new Error("second arg must be public key");const g=ti(r,h);return t.fromHex(p).multiply(g).toBytes(d)}return Object.freeze({getPublicKey:c,getSharedSecret:f,keygen:l,Point:t,utils:{isValidSecretKey:n,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:n,randomPrivateKey:a,normPrivateKeyToScalar:h=>ti(r,h),precompute(h=8,p=t.BASE){return p.precompute(h,!1)}},lengths:s})}function J2(t,e,r={}){un(e),yn(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const i=r.randomBytes||qr,s=r.hmac||((D,...y)=>dn(e,D,gr(...y))),{Fp:n,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:f,utils:h,lengths:p}=Z2(t,r),d={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},g="compact";function m(D){const y=a>>ai;return D>y}function E(D,y){if(!o.isValidNot0(y))throw new Error(`invalid signature ${D}: out of range 1..Point.Fn.ORDER`);return y}function S(D,y){sa(y);const w=p.signature,_=y==="compact"?w:y==="recovered"?w+1:void 0;return Rr(D,_,`${y} signature`)}class b{constructor(y,w,_){this.r=E("r",y),this.s=E("s",w),_!=null&&(this.recovery=_),Object.freeze(this)}static fromBytes(y,w=g){S(y,w);let _;if(w==="der"){const{r:U,s:j}=Yt.toSig(Rr(y));return new b(U,j)}w==="recovered"&&(_=y[0],w="compact",y=y.subarray(1));const P=o.BYTES,I=y.subarray(0,P),O=y.subarray(P,P*2);return new b(o.fromBytes(I),o.fromBytes(O),_)}static fromHex(y,w){return this.fromBytes(Fs(y),w)}addRecoveryBit(y){return new b(this.r,this.s,y)}recoverPublicKey(y){const w=n.ORDER,{r:_,s:P,recovery:I}=this;if(I==null||![0,1,2,3].includes(I))throw new Error("recovery id invalid");if(a*Gd<w&&I>1)throw new Error("recovery id is ambiguous for h>1 curve");const O=I===2||I===3?_+a:_;if(!n.isValid(O))throw new Error("recovery id 2 or 3 invalid");const U=n.toBytes(O),j=t.fromBytes(gr(Yd((I&1)===0),U)),V=o.inv(O),L=A(ke("msgHash",y)),q=o.create(-L*V),H=o.create(P*V),G=t.BASE.multiplyUnsafe(q).add(j.multiplyUnsafe(H));if(G.is0())throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return m(this.s)}toBytes(y=g){if(sa(y),y==="der")return Fs(Yt.hexFromSig(this));const w=o.toBytes(this.r),_=o.toBytes(this.s);if(y==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return gr(Uint8Array.of(this.recovery),w,_)}return gr(w,_)}toHex(y){return oi(this.toBytes(y))}assertValidity(){}static fromCompact(y){return b.fromBytes(ke("sig",y),"compact")}static fromDER(y){return b.fromBytes(ke("sig",y),"der")}normalizeS(){return this.hasHighS()?new b(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return oi(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return oi(this.toBytes("compact"))}}const x=r.bits2int||function(D){if(D.length>8192)throw new Error("input is too large");const y=gn(D),w=D.length*8-c;return w>0?y>>BigInt(w):y},A=r.bits2int_modN||function(D){return o.create(x(D))},v=ts(c);function C(D){return ra("num < 2^"+c,D,Jt,v),o.toBytes(D)}function R(D,y){return Rr(D,void 0,"message"),y?Rr(e(D),void 0,"prehashed message"):D}function T(D,y,w){if(["recovered","canonical"].some(H=>H in w))throw new Error("sign() legacy options not supported");const{lowS:_,prehash:P,extraEntropy:I}=lo(w,d);D=R(D,P);const O=A(D),U=ti(o,y),j=[C(U),C(O)];if(I!=null&&I!==!1){const H=I===!0?i(p.secretKey):I;j.push(ke("extraEntropy",H))}const V=gr(...j),L=O;function q(H){const G=x(H);if(!o.isValidNot0(G))return;const Z=o.inv(G),W=t.BASE.multiply(G).toAffine(),J=o.create(W.x);if(J===Jt)return;const ue=o.create(Z*o.create(L+J*U));if(ue===Jt)return;let ye=(W.x===J?0:2)|Number(W.y&ai),ve=ue;return _&&m(ue)&&(ve=o.neg(ue),ye^=1),new b(J,ve,ye)}return{seed:V,k2sig:q}}function k(D,y,w={}){D=ke("message",D);const{seed:_,k2sig:P}=T(D,y,w);return E2(e.outputLen,o.BYTES,s)(_,P)}function N(D){let y;const w=typeof D=="string"||ln(D),_=!w&&D!==null&&typeof D=="object"&&typeof D.r=="bigint"&&typeof D.s=="bigint";if(!w&&!_)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(_)y=new b(D.r,D.s);else if(w){try{y=b.fromBytes(ke("sig",D),"der")}catch(P){if(!(P instanceof Yt.Err))throw P}if(!y)try{y=b.fromBytes(ke("sig",D),"compact")}catch{return!1}}return y||!1}function B(D,y,w,_={}){const{lowS:P,prehash:I,format:O}=lo(_,d);if(w=ke("publicKey",w),y=R(ke("message",y),I),"strict"in _)throw new Error("options.strict was renamed to lowS");const U=O===void 0?N(D):b.fromBytes(ke("sig",D),O);if(U===!1)return!1;try{const j=t.fromBytes(w);if(P&&U.hasHighS())return!1;const{r:V,s:L}=U,q=A(y),H=o.inv(L),G=o.create(q*H),Z=o.create(V*H),W=t.BASE.multiplyUnsafe(G).add(j.multiplyUnsafe(Z));return W.is0()?!1:o.create(W.x)===V}catch{return!1}}function $(D,y,w={}){const{prehash:_}=lo(w,d);return y=R(y,_),b.fromBytes(D,"recovered").recoverPublicKey(y).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:f,utils:h,lengths:p,Point:t,sign:k,verify:B,recoverPublicKey:$,Signature:b,hash:e})}function X2(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let i=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const s=_r(e.n,{BITS:t.nBitLength,allowedLengths:i,modFromBytes:t.wrapPrivateKey}),n={Fp:r,Fn:s,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:n}}function Q2(t){const{CURVE:e,curveOpts:r}=X2(t),i={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:i}}function e_(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,zd(r.Fn.ORDER,r.Fn.BITS))})}function t_(t){const{CURVE:e,curveOpts:r,hash:i,ecdsaOpts:s}=Q2(t),n=Y2(e,r),o=J2(n,i,s);return e_(t,o)}function na(t,e){const r=i=>t_({...t,hash:i});return{...r(e),create:r}}const Jd={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Xd={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Qd={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},r_=_r(Jd.p),i_=_r(Xd.p),s_=_r(Qd.p),n_=na({...Jd,Fp:r_,lowS:!1},fn);na({...Xd,Fp:i_,lowS:!1},fE),na({...Qd,Fp:s_,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},hE);const o_=n_,ep="base10",qe="base16",Ye="base64pad",yr="base64url",rs="utf8",tp=0,Qt=1,is=2,a_=0,tu=1,Ui=12,ec=32;function c_(){const t=ia.utils.randomPrivateKey(),e=ia.getPublicKey(t);return{privateKey:Xe(t,qe),publicKey:Xe(e,qe)}}function oa(){const t=qr(ec);return Xe(t,qe)}function l_(t,e){const r=ia.getSharedSecret(pt(t,qe),pt(e,qe)),i=b2(pn,r,void 0,void 0,ec);return Xe(i,qe)}function Ts(t){const e=pn(pt(t,qe));return Xe(e,qe)}function ft(t){const e=pn(pt(t,rs));return Xe(e,qe)}function rp(t){return pt(`${t}`,ep)}function Lr(t){return Number(Xe(t,ep))}function ip(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function sp(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function u_(t){const e=rp(typeof t.type<"u"?t.type:tp);if(Lr(e)===Qt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?pt(t.senderPublicKey,qe):void 0,i=typeof t.iv<"u"?pt(t.iv,qe):qr(Ui),s=pt(t.symKey,qe),n=Pd(s,i).encrypt(pt(t.message,rs)),o=np({type:e,sealed:n,iv:i,senderPublicKey:r});return t.encoding===yr?ip(o):o}function h_(t){const e=pt(t.symKey,qe),{sealed:r,iv:i}=Ki({encoded:t.encoded,encoding:t.encoding}),s=Pd(e,i).decrypt(r);if(s===null)throw new Error("Failed to decrypt");return Xe(s,rs)}function f_(t,e){const r=rp(is),i=qr(Ui),s=pt(t,rs),n=np({type:r,sealed:s,iv:i});return e===yr?ip(n):n}function d_(t,e){const{sealed:r}=Ki({encoded:t,encoding:e});return Xe(r,rs)}function np(t){if(Lr(t.type)===is)return Xe(Ni([t.type,t.sealed]),Ye);if(Lr(t.type)===Qt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Xe(Ni([t.type,t.senderPublicKey,t.iv,t.sealed]),Ye)}return Xe(Ni([t.type,t.iv,t.sealed]),Ye)}function Ki(t){const e=(t.encoding||Ye)===yr?sp(t.encoded):t.encoded,r=pt(e,Ye),i=r.slice(a_,tu),s=tu;if(Lr(i)===Qt){const c=s+ec,l=c+Ui,u=r.slice(s,c),f=r.slice(c,l),h=r.slice(l);return{type:i,sealed:h,iv:f,senderPublicKey:u}}if(Lr(i)===is){const c=r.slice(s),l=qr(Ui);return{type:i,sealed:c,iv:l}}const n=s+Ui,o=r.slice(s,n),a=r.slice(n);return{type:i,sealed:a,iv:o}}function p_(t,e){const r=Ki({encoded:t,encoding:e?.encoding});return op({type:Lr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Xe(r.senderPublicKey,qe):void 0,receiverPublicKey:e?.receiverPublicKey})}function op(t){const e=t?.type||tp;if(e===Qt){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function ru(t){return t.type===Qt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function iu(t){return t.type===is}function g_(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return Ni([new Uint8Array([4]),e,r])}function y_(t,e){const[r,i,s]=t.split("."),n=Buffer.from(sp(s),"base64");if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=`${r}.${i}`,l=pn(c),u=g_(e);if(!o_.verify(Ni([o,a]),l,u))throw new Error("Invalid signature");return Ho(t).payload}const w_="irn";function Gs(t){return t?.relay||{protocol:w_}}function ri(t){const e=Q1[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var m_=Object.defineProperty,b_=Object.defineProperties,v_=Object.getOwnPropertyDescriptors,su=Object.getOwnPropertySymbols,E_=Object.prototype.hasOwnProperty,__=Object.prototype.propertyIsEnumerable,nu=(t,e,r)=>e in t?m_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,uo=(t,e)=>{for(var r in e||(e={}))E_.call(e,r)&&nu(t,r,e[r]);if(su)for(var r of su(e))__.call(e,r)&&nu(t,r,e[r]);return t},x_=(t,e)=>b_(t,v_(e));function I_(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(i)){const n=s.replace(i,""),o=t[s];r[n]=o}}),r}function ou(t){if(!t.includes("wc:")){const l=ud(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),s=t.substring(e+1,r).split("@"),n=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(n),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:S_(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:I_(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function S_(t){return t.startsWith("//")?t.substring(2):t}function O_(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(s=>{const n=s,o=r+e+n;t[n]&&(i[o]=t[n])}),i}function au(t){const e=new URLSearchParams,r=uo(uo(x_(uo({},O_(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([i],[s])=>i.localeCompare(s)).forEach(([i,s])=>{s!==void 0&&e.append(i,String(s))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function Es(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var D_=Object.defineProperty,$_=Object.defineProperties,A_=Object.getOwnPropertyDescriptors,cu=Object.getOwnPropertySymbols,P_=Object.prototype.hasOwnProperty,T_=Object.prototype.propertyIsEnumerable,lu=(t,e,r)=>e in t?D_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,C_=(t,e)=>{for(var r in e||(e={}))P_.call(e,r)&&lu(t,r,e[r]);if(cu)for(var r of cu(e))T_.call(e,r)&&lu(t,r,e[r]);return t},B_=(t,e)=>$_(t,A_(e));function pi(t){const e=[];return t.forEach(r=>{const[i,s]=r.split(":");e.push(`${i}:${s}`)}),e}function R_(t){const e=[];return Object.values(t).forEach(r=>{e.push(...pi(r.accounts))}),e}function N_(t,e){const r=[];return Object.values(t).forEach(i=>{pi(i.accounts).includes(e)&&r.push(...i.methods)}),r}function U_(t,e){const r=[];return Object.values(t).forEach(i=>{pi(i.accounts).includes(e)&&r.push(...i.events)}),r}function wn(t){return t.includes(":")}function ii(t){return wn(t)?t.split(":")[0]:t}function uu(t){var e,r,i;const s={};if(!Ut(t))return s;for(const[n,o]of Object.entries(t)){const a=wn(n)?[n]:o.chains,c=o.methods||[],l=o.events||[],u=ii(n);s[u]=B_(C_({},s[u]),{chains:Nt(a,(e=s[u])==null?void 0:e.chains),methods:Nt(c,(r=s[u])==null?void 0:r.methods),events:Nt(l,(i=s[u])==null?void 0:i.events)})}return s}function k_(t){const e={};return t?.forEach(r=>{var i;const[s,n]=r.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(r),(i=e[s].chains)==null||i.push(`${s}:${n}`)}),e}function hu(t,e){e=e.map(i=>i.replace("did:pkh:",""));const r=k_(e);for(const[i,s]of Object.entries(r))s.methods?s.methods=Nt(s.methods,t):s.methods=t,s.events=["chainChanged","accountsChanged"];return r}function j_(t,e){var r,i,s,n,o,a;const c=uu(t),l=uu(e),u={},f=Object.keys(c).concat(Object.keys(l));for(const h of f)u[h]={chains:Nt((r=c[h])==null?void 0:r.chains,(i=l[h])==null?void 0:i.chains),methods:Nt((s=c[h])==null?void 0:s.methods,(n=l[h])==null?void 0:n.methods),events:Nt((o=c[h])==null?void 0:o.events,(a=l[h])==null?void 0:a.events)};return u}const M_={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},L_={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function z(t,e){const{message:r,code:i}=L_[t];return{message:e?`${r} ${e}`:r,code:i}}function ce(t,e){const{message:r,code:i}=M_[t];return{message:e?`${r} ${e}`:r,code:i}}function gt(t,e){return!!Array.isArray(t)}function Ut(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function be(t){return typeof t>"u"}function ge(t,e){return e&&be(t)?!0:typeof t=="string"&&!!t.trim().length}function tc(t,e){return e&&be(t)?!0:typeof t=="number"&&!isNaN(t)}function q_(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),s=Object.keys(r);let n=!0;return Br(s,i)?(i.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],u=pi(a),f=r[o];(!Br(nd(o,f),u)||!Br(f.methods,c)||!Br(f.events,l))&&(n=!1)}),n):!1}function Ys(t){return ge(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function z_(t){if(ge(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&Ys(r)}}return!1}function F_(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(ge(t,!1)){if(e(t))return!0;const r=ud(t);return e(r)}}catch{}return!1}function V_(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function K_(t){return t?.topic}function H_(t,e){let r=null;return ge(t?.publicKey,!1)||(r=z("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function fu(t){let e=!0;return gt(t)?t.length&&(e=t.every(r=>ge(r,!1))):e=!1,e}function W_(t,e,r){let i=null;return gt(e)&&e.length?e.forEach(s=>{i||Ys(s)||(i=ce("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):Ys(t)||(i=ce("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function G_(t,e,r){let i=null;return Object.entries(t).forEach(([s,n])=>{if(i)return;const o=W_(s,nd(s,n),`${e} ${r}`);o&&(i=o)}),i}function Y_(t,e){let r=null;return gt(t)?t.forEach(i=>{r||z_(i)||(r=ce("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=ce("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function Z_(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=Y_(i?.accounts,`${e} namespace`);s&&(r=s)}),r}function J_(t,e){let r=null;return fu(t?.methods)?fu(t?.events)||(r=ce("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=ce("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function ap(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=J_(i,`${e}, namespace`);s&&(r=s)}),r}function X_(t,e,r){let i=null;if(t&&Ut(t)){const s=ap(t,e);s&&(i=s);const n=G_(t,e,r);n&&(i=n)}else i=z("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function ho(t,e){let r=null;if(t&&Ut(t)){const i=ap(t,e);i&&(r=i);const s=Z_(t,e);s&&(r=s)}else r=z("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function cp(t){return ge(t.protocol,!0)}function Q_(t,e){let r=!1;return t?t&&gt(t)&&t.length&&t.forEach(i=>{r=cp(i)}):r=!0,r}function ex(t){return typeof t=="number"}function He(t){return typeof t<"u"&&typeof t!==null}function tx(t){return!(!t||typeof t!="object"||!t.code||!tc(t.code,!1)||!t.message||!ge(t.message,!1))}function rx(t){return!(be(t)||!ge(t.method,!1))}function ix(t){return!(be(t)||be(t.result)&&be(t.error)||!tc(t.id,!1)||!ge(t.jsonrpc,!1))}function sx(t){return!(be(t)||!ge(t.name,!1))}function du(t,e){return!(!Ys(e)||!R_(t).includes(e))}function nx(t,e,r){return ge(r,!1)?N_(t,e).includes(r):!1}function ox(t,e,r){return ge(r,!1)?U_(t,e).includes(r):!1}function pu(t,e,r){let i=null;const s=ax(t),n=cx(e),o=Object.keys(s),a=Object.keys(n),c=gu(Object.keys(t)),l=gu(Object.keys(e)),u=c.filter(f=>!l.includes(f));return u.length&&(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),Br(o,a)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(f=>{if(!f.includes(":")||i)return;const h=pi(e[f].accounts);h.includes(f)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${f}
        Required: ${f}
        Approved: ${h.toString()}`))}),o.forEach(f=>{i||(Br(s[f].methods,n[f].methods)?Br(s[f].events,n[f].events)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${f}`)):i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${f}`))}),i}function ax(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(s=>{e[s]={methods:t[r].methods,events:t[r].events}})}),e}function gu(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function cx(t){const e={};return Object.keys(t).forEach(r=>{r.includes(":")?e[r]=t[r]:pi(t[r].accounts)?.forEach(s=>{e[s]={accounts:t[r].accounts.filter(n=>n.includes(`${s}:`)),methods:t[r].methods,events:t[r].events}})}),e}function lx(t,e){return tc(t,!1)&&t<=e.max&&t>=e.min}function yu(){const t=Qi();return new Promise(e=>{switch(t){case nt.browser:e(ux());break;case nt.reactNative:e(hx());break;case nt.node:e(fx());break;default:e(!0)}})}function ux(){return di()&&navigator?.onLine}async function hx(){return Er()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo?(await globalThis?.NetInfo.fetch())?.isConnected:!0}function fx(){return!0}function dx(t){switch(Qi()){case nt.browser:px(t);break;case nt.reactNative:gx(t);break}}function px(t){!Er()&&di()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function gx(t){Er()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo&&globalThis?.NetInfo.addEventListener(e=>t(e?.isConnected))}function yx(){var t;return di()&&er.getDocument()?((t=er.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const fo={};class xi{static get(e){return fo[e]}static set(e,r){fo[e]=r}static delete(e){delete fo[e]}}function wx(t){const e=Zi.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function mx({publicKey:t,signature:e,payload:r}){var i;const s=aa(r.method),n=128|parseInt(((i=r.version)==null?void 0:i.toString())||"4"),o=Ex(r.address),a=r.era==="00"?new Uint8Array([0]):aa(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${vx(r.tip)}`),f=xx(u),h=new Uint8Array([0,...t,o,...e,...a,...l,...f,...s]),p=_x(h.length+1);return new Uint8Array([...p,n,...h])}function bx(t){const e=aa(t),r=iv.blake2b(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function aa(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function vx(t){return t.startsWith("0x")?t.slice(2):t}function Ex(t){const e=Zi.decode(t)[0];return e===42?0:e===60?2:1}function _x(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function xx(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function Ix(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=wx(t.transaction.address),i=mx({publicKey:r,signature:e,payload:t.transaction}),s=Buffer.from(i).toString("hex");return bx(s)}class zr{}let Sx=class extends zr{constructor(e){super()}};const wu=F.FIVE_SECONDS,Fr={pulse:"heartbeat_pulse"};let Ox=class lp extends Sx{constructor(e){super(e),this.events=new wt.EventEmitter,this.interval=wu,this.interval=e?.interval||wu}static async init(e){const r=new lp(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),F.toMiliseconds(this.interval))}pulse(){this.events.emit(Fr.pulse)}};function Dx(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function _e(t,...e){try{return Dx(t(...e))}catch(r){return Promise.reject(r)}}function $x(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function Ax(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Cs(t){if($x(t))return String(t);if(Ax(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Cs(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const ca="base64:";function Px(t){return typeof t=="string"?t:ca+Bx(t)}function Tx(t){return typeof t!="string"||!t.startsWith(ca)?t:Cx(t.slice(ca.length))}function Cx(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function Bx(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Ke(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function Rx(...t){return Ke(t.join(":"))}function _s(t){return t=Ke(t),t?t+":":""}function Nx(t,e){if(e===void 0)return!0;let r=0,i=t.indexOf(":");for(;i>-1;)r++,i=t.indexOf(":",i+1);return r<=e}function Ux(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const kx="memory",jx=()=>{const t=new Map;return{name:kx,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Mx(t={}){const e={mounts:{"":t.driver||jx()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},i=(l,u)=>e.mountpoints.filter(f=>f.startsWith(l)||u&&l.startsWith(f)).map(f=>({relativeBase:l.length>f.length?l.slice(f.length):void 0,mountpoint:f,driver:e.mounts[f]})),s=(l,u)=>{if(e.watching){u=Ke(u);for(const f of e.watchListeners)f(l,u)}},n=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await mu(e.mounts[l],s,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,f)=>{const h=new Map,p=d=>{let g=h.get(d.base);return g||(g={driver:d.driver,base:d.base,items:[]},h.set(d.base,g)),g};for(const d of l){const g=typeof d=="string",m=Ke(g?d:d.key),E=g?void 0:d.value,S=g||!d.options?u:{...u,...d.options},b=r(m);p(b).items.push({key:m,value:E,relativeKey:b.relativeKey,options:S})}return Promise.all([...h.values()].map(d=>f(d))).then(d=>d.flat())},c={hasItem(l,u={}){l=Ke(l);const{relativeKey:f,driver:h}=r(l);return _e(h.hasItem,f,u)},getItem(l,u={}){l=Ke(l);const{relativeKey:f,driver:h}=r(l);return _e(h.getItem,f,u).then(p=>ls(p))},getItems(l,u={}){return a(l,u,f=>f.driver.getItems?_e(f.driver.getItems,f.items.map(h=>({key:h.relativeKey,options:h.options})),u).then(h=>h.map(p=>({key:Rx(f.base,p.key),value:ls(p.value)}))):Promise.all(f.items.map(h=>_e(f.driver.getItem,h.relativeKey,h.options).then(p=>({key:h.key,value:ls(p)})))))},getItemRaw(l,u={}){l=Ke(l);const{relativeKey:f,driver:h}=r(l);return h.getItemRaw?_e(h.getItemRaw,f,u):_e(h.getItem,f,u).then(p=>Tx(p))},async setItem(l,u,f={}){if(u===void 0)return c.removeItem(l);l=Ke(l);const{relativeKey:h,driver:p}=r(l);p.setItem&&(await _e(p.setItem,h,Cs(u),f),p.watch||s("update",l))},async setItems(l,u){await a(l,u,async f=>{if(f.driver.setItems)return _e(f.driver.setItems,f.items.map(h=>({key:h.relativeKey,value:Cs(h.value),options:h.options})),u);f.driver.setItem&&await Promise.all(f.items.map(h=>_e(f.driver.setItem,h.relativeKey,Cs(h.value),h.options)))})},async setItemRaw(l,u,f={}){if(u===void 0)return c.removeItem(l,f);l=Ke(l);const{relativeKey:h,driver:p}=r(l);if(p.setItemRaw)await _e(p.setItemRaw,h,u,f);else if(p.setItem)await _e(p.setItem,h,Px(u),f);else return;p.watch||s("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=Ke(l);const{relativeKey:f,driver:h}=r(l);h.removeItem&&(await _e(h.removeItem,f,u),(u.removeMeta||u.removeMata)&&await _e(h.removeItem,f+"$",u),h.watch||s("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=Ke(l);const{relativeKey:f,driver:h}=r(l),p=Object.create(null);if(h.getMeta&&Object.assign(p,await _e(h.getMeta,f,u)),!u.nativeOnly){const d=await _e(h.getItem,f+"$",u).then(g=>ls(g));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(p,d))}return p},setMeta(l,u,f={}){return this.setItem(l+"$",u,f)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){l=_s(l);const f=i(l,!0);let h=[];const p=[];let d=!0;for(const m of f){m.driver.flags?.maxDepth||(d=!1);const E=await _e(m.driver.getKeys,m.relativeBase,u);for(const S of E){const b=m.mountpoint+Ke(S);h.some(x=>b.startsWith(x))||p.push(b)}h=[m.mountpoint,...h.filter(S=>!S.startsWith(m.mountpoint))]}const g=u.maxDepth!==void 0&&!d;return p.filter(m=>(!g||Nx(m,u.maxDepth))&&Ux(m,l))},async clear(l,u={}){l=_s(l),await Promise.all(i(l,!1).map(async f=>{if(f.driver.clear)return _e(f.driver.clear,f.relativeBase,u);if(f.driver.removeItem){const h=await f.driver.getKeys(f.relativeBase||"",u);return Promise.all(h.map(p=>f.driver.removeItem(p,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>bu(l)))},async watch(l){return await n(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=_s(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((f,h)=>h.length-f.length)),e.mounts[l]=u,e.watching&&Promise.resolve(mu(u,s,l)).then(f=>{e.unwatch[l]=f}).catch(console.error),c},async unmount(l,u=!0){l=_s(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&(e.unwatch[l]?.(),delete e.unwatch[l]),u&&await bu(e.mounts[l]),e.mountpoints=e.mountpoints.filter(f=>f!==l),delete e.mounts[l])},getMount(l=""){l=Ke(l)+":";const u=r(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=Ke(l),i(l,u.parents).map(h=>({driver:h.driver,base:h.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,f={})=>c.setItem(l,u,f),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function mu(t,e,r){return t.watch?t.watch((i,s)=>e(i,r+s)):()=>{}}async function bu(t){typeof t.dispose=="function"&&await _e(t.dispose)}function Vr(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function up(t,e){let r;const i=()=>{if(r)return r;const s=indexedDB.open(t);return s.onupgradeneeded=()=>s.result.createObjectStore(e),r=Vr(s),r.then(n=>{n.onclose=()=>r=void 0},()=>{}),r};return(s,n)=>i().then(o=>n(o.transaction(e,s).objectStore(e)))}let po;function ss(){return po||(po=up("keyval-store","keyval")),po}function vu(t,e=ss()){return e("readonly",r=>Vr(r.get(t)))}function Lx(t,e,r=ss()){return r("readwrite",i=>(i.put(e,t),Vr(i.transaction)))}function qx(t,e=ss()){return e("readwrite",r=>(r.delete(t),Vr(r.transaction)))}function zx(t=ss()){return t("readwrite",e=>(e.clear(),Vr(e.transaction)))}function Fx(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Vr(t.transaction)}function Vx(t=ss()){return t("readonly",e=>{if(e.getAllKeys)return Vr(e.getAllKeys());const r=[];return Fx(e,i=>r.push(i.key)).then(()=>r)})}const Kx="idb-keyval";var Hx=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=s=>e+s;let i;return t.dbName&&t.storeName&&(i=up(t.dbName,t.storeName)),{name:Kx,options:t,async hasItem(s){return!(typeof await vu(r(s),i)>"u")},async getItem(s){return await vu(r(s),i)??null},setItem(s,n){return Lx(r(s),n,i)},removeItem(s){return qx(r(s),i)},getKeys(){return Vx(i)},clear(){return zx(i)}}};const Wx="WALLET_CONNECT_V2_INDEXED_DB",Gx="keyvaluestorage";let Yx=class{constructor(){this.indexedDb=Mx({driver:Hx({dbName:Wx,storeName:Gx})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,tr(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var go=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},Bs={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof go<"u"&&go.localStorage?Bs.exports=go.localStorage:typeof window<"u"&&window.localStorage?Bs.exports=window.localStorage:Bs.exports=new e})();function Zx(t){var e;return[t[0],jr((e=t[1])!=null?e:"")]}let Jx=class{constructor(){this.localStorage=Bs.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Zx)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return jr(r)}async setItem(e,r){this.localStorage.setItem(e,tr(r))}async removeItem(e){this.localStorage.removeItem(e)}};const Xx="wc_storage_version",Eu=1,Qx=async(t,e,r)=>{const i=Xx,s=await e.getItem(i);if(s&&s>=Eu){r(e);return}const n=await t.getKeys();if(!n.length){r(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await t.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(i,Eu),r(e),eI(t,o)},eI=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let tI=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new Jx;this.storage=e;try{const r=new Yx;Qx(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var yo,_u;function rI(){if(_u)return yo;_u=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}yo=e;function e(r,i,s){var n=s&&s.stringify||t,o=1;if(typeof r=="object"&&r!==null){var a=i.length+o;if(a===1)return r;var c=new Array(a);c[0]=n(r);for(var l=1;l<a;l++)c[l]=n(i[l]);return c.join(" ")}if(typeof r!="string")return r;var u=i.length;if(u===0)return r;for(var f="",h=1-o,p=-1,d=r&&r.length||0,g=0;g<d;){if(r.charCodeAt(g)===37&&g+1<d){switch(p=p>-1?p:0,r.charCodeAt(g+1)){case 100:case 102:if(h>=u||i[h]==null)break;p<g&&(f+=r.slice(p,g)),f+=Number(i[h]),p=g+2,g++;break;case 105:if(h>=u||i[h]==null)break;p<g&&(f+=r.slice(p,g)),f+=Math.floor(Number(i[h])),p=g+2,g++;break;case 79:case 111:case 106:if(h>=u||i[h]===void 0)break;p<g&&(f+=r.slice(p,g));var m=typeof i[h];if(m==="string"){f+="'"+i[h]+"'",p=g+2,g++;break}if(m==="function"){f+=i[h].name||"<anonymous>",p=g+2,g++;break}f+=n(i[h]),p=g+2,g++;break;case 115:if(h>=u)break;p<g&&(f+=r.slice(p,g)),f+=String(i[h]),p=g+2,g++;break;case 37:p<g&&(f+=r.slice(p,g)),f+="%",p=g+2,g++,h--;break}++h}++g}return p===-1?r:(p<d&&(f+=r.slice(p)),f)}return yo}var wo,xu;function iI(){if(xu)return wo;xu=1;const t=rI();wo=s;const e=A().console||{},r={mapHttpRequest:d,mapHttpResponse:d,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:d,res:d,err:h};function i(v,C){return Array.isArray(v)?v.filter(function(T){return T!=="!stdSerializers.err"}):v===!0?Object.keys(C):!1}function s(v){v=v||{},v.browser=v.browser||{};const C=v.browser.transmit;if(C&&typeof C.send!="function")throw Error("pino: transmit option must have a send function");const R=v.browser.write||e;v.browser.write&&(v.browser.asObject=!0);const T=v.serializers||{},k=i(v.browser.serialize,T);let N=v.browser.serialize;Array.isArray(v.browser.serialize)&&v.browser.serialize.indexOf("!stdSerializers.err")>-1&&(N=!1);const B=["error","fatal","warn","info","debug","trace"];typeof R=="function"&&(R.error=R.fatal=R.warn=R.info=R.debug=R.trace=R),v.enabled===!1&&(v.level="silent");const $=v.level||"info",D=Object.create(R);D.log||(D.log=m),Object.defineProperty(D,"levelVal",{get:w}),Object.defineProperty(D,"level",{get:_,set:P});const y={transmit:C,serialize:k,asObject:v.browser.asObject,levels:B,timestamp:p(v)};D.levels=s.levels,D.level=$,D.setMaxListeners=D.getMaxListeners=D.emit=D.addListener=D.on=D.prependListener=D.once=D.prependOnceListener=D.removeListener=D.removeAllListeners=D.listeners=D.listenerCount=D.eventNames=D.write=D.flush=m,D.serializers=T,D._serialize=k,D._stdErrSerialize=N,D.child=I,C&&(D._logEvent=f());function w(){return this.level==="silent"?1/0:this.levels.values[this.level]}function _(){return this._level}function P(O){if(O!=="silent"&&!this.levels.values[O])throw Error("unknown level "+O);this._level=O,n(y,D,"error","log"),n(y,D,"fatal","error"),n(y,D,"warn","error"),n(y,D,"info","log"),n(y,D,"debug","log"),n(y,D,"trace","log")}function I(O,U){if(!O)throw new Error("missing bindings for child Pino");U=U||{},k&&O.serializers&&(U.serializers=O.serializers);const j=U.serializers;if(k&&j){var V=Object.assign({},T,j),L=v.browser.serialize===!0?Object.keys(V):k;delete O.serializers,c([O],L,V,this._stdErrSerialize)}function q(H){this._childLevel=(H._childLevel|0)+1,this.error=l(H,O,"error"),this.fatal=l(H,O,"fatal"),this.warn=l(H,O,"warn"),this.info=l(H,O,"info"),this.debug=l(H,O,"debug"),this.trace=l(H,O,"trace"),V&&(this.serializers=V,this._serialize=L),C&&(this._logEvent=f([].concat(H._logEvent.bindings,O)))}return q.prototype=this,new q(this)}return D}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=r,s.stdTimeFunctions=Object.assign({},{nullTime:E,epochTime:S,unixTime:b,isoTime:x});function n(v,C,R,T){const k=Object.getPrototypeOf(C);C[R]=C.levelVal>C.levels.values[R]?m:k[R]?k[R]:e[R]||e[T]||m,o(v,C,R)}function o(v,C,R){!v.transmit&&C[R]===m||(C[R]=(function(T){return function(){const N=v.timestamp(),B=new Array(arguments.length),$=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var D=0;D<B.length;D++)B[D]=arguments[D];if(v.serialize&&!v.asObject&&c(B,this._serialize,this.serializers,this._stdErrSerialize),v.asObject?T.call($,a(this,R,B,N)):T.apply($,B),v.transmit){const y=v.transmit.level||C.level,w=s.levels.values[y],_=s.levels.values[R];if(_<w)return;u(this,{ts:N,methodLevel:R,methodValue:_,transmitValue:s.levels.values[v.transmit.level||C.level],send:v.transmit.send,val:C.levelVal},B)}}})(C[R]))}function a(v,C,R,T){v._serialize&&c(R,v._serialize,v.serializers,v._stdErrSerialize);const k=R.slice();let N=k[0];const B={};T&&(B.time=T),B.level=s.levels.values[C];let $=(v._childLevel|0)+1;if($<1&&($=1),N!==null&&typeof N=="object"){for(;$--&&typeof k[0]=="object";)Object.assign(B,k.shift());N=k.length?t(k.shift(),k):void 0}else typeof N=="string"&&(N=t(k.shift(),k));return N!==void 0&&(B.msg=N),B}function c(v,C,R,T){for(const k in v)if(T&&v[k]instanceof Error)v[k]=s.stdSerializers.err(v[k]);else if(typeof v[k]=="object"&&!Array.isArray(v[k]))for(const N in v[k])C&&C.indexOf(N)>-1&&N in R&&(v[k][N]=R[N](v[k][N]))}function l(v,C,R){return function(){const T=new Array(1+arguments.length);T[0]=C;for(var k=1;k<T.length;k++)T[k]=arguments[k-1];return v[R].apply(this,T)}}function u(v,C,R){const T=C.send,k=C.ts,N=C.methodLevel,B=C.methodValue,$=C.val,D=v._logEvent.bindings;c(R,v._serialize||Object.keys(v.serializers),v.serializers,v._stdErrSerialize===void 0?!0:v._stdErrSerialize),v._logEvent.ts=k,v._logEvent.messages=R.filter(function(y){return D.indexOf(y)===-1}),v._logEvent.level.label=N,v._logEvent.level.value=B,T(N,v._logEvent,$),v._logEvent=f(D)}function f(v){return{ts:0,messages:[],bindings:v||[],level:{label:"",value:0}}}function h(v){const C={type:v.constructor.name,msg:v.message,stack:v.stack};for(const R in v)C[R]===void 0&&(C[R]=v[R]);return C}function p(v){return typeof v.timestamp=="function"?v.timestamp:v.timestamp===!1?E:S}function d(){return{}}function g(v){return v}function m(){}function E(){return!1}function S(){return Date.now()}function b(){return Math.round(Date.now()/1e3)}function x(){return new Date(Date.now()).toISOString()}function A(){function v(C){return typeof C<"u"&&C}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return v(self)||v(window)||v(this)||{}}}return wo}var ei=iI();const ns=qh(ei),sI={level:"info"},os="custom_context",rc=1e3*1024;let nI=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Iu=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new nI(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}},hp=class{constructor(e,r=rc){this.level=e??"error",this.levelValue=ei.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new Iu(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===ei.levels.values.error?console.error(e):r===ei.levels.values.warn?console.warn(e):r===ei.levels.values.debug?console.debug(e):r===ei.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(tr({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new Iu(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(tr({extraMetadata:e})),new Blob(r,{type:"application/json"})}},oI=class{constructor(e,r=rc){this.baseChunkLogger=new hp(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=r,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}},aI=class{constructor(e,r=rc){this.baseChunkLogger=new hp(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var cI=Object.defineProperty,lI=Object.defineProperties,uI=Object.getOwnPropertyDescriptors,Su=Object.getOwnPropertySymbols,hI=Object.prototype.hasOwnProperty,fI=Object.prototype.propertyIsEnumerable,Ou=(t,e,r)=>e in t?cI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zs=(t,e)=>{for(var r in e||(e={}))hI.call(e,r)&&Ou(t,r,e[r]);if(Su)for(var r of Su(e))fI.call(e,r)&&Ou(t,r,e[r]);return t},Js=(t,e)=>lI(t,uI(e));function mn(t){return Js(Zs({},t),{level:t?.level||sI.level})}function dI(t,e=os){return t[e]||""}function pI(t,e,r=os){return t[r]=e,t}function Qe(t,e=os){let r="";return typeof t.bindings>"u"?r=dI(t,e):r=t.bindings().context||"",r}function gI(t,e,r=os){const i=Qe(t,r);return i.trim()?`${i}/${e}`:e}function ze(t,e,r=os){const i=gI(t,e,r),s=t.child({context:i});return pI(s,i,r)}function yI(t){var e,r;const i=new oI((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:ns(Js(Zs({},t.opts),{level:"trace",browser:Js(Zs({},(r=t.opts)==null?void 0:r.browser),{write:s=>i.write(s)})})),chunkLoggerController:i}}function wI(t){var e;const r=new aI((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:ns(Js(Zs({},t.opts),{level:"trace"}),r),chunkLoggerController:r}}function mI(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?yI(t):wI(t)}var bI=Object.defineProperty,vI=(t,e,r)=>e in t?bI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Du=(t,e,r)=>vI(t,typeof e!="symbol"?e+"":e,r);let EI=class extends zr{constructor(e){super(),this.opts=e,Du(this,"protocol","wc"),Du(this,"version",2)}};var _I=Object.defineProperty,xI=(t,e,r)=>e in t?_I(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,II=(t,e,r)=>xI(t,e+"",r);let SI=class extends zr{constructor(e,r){super(),this.core=e,this.logger=r,II(this,"records",new Map)}},OI=class{constructor(e,r){this.logger=e,this.core=r}},DI=class extends zr{constructor(e,r){super(),this.relayer=e,this.logger=r}},$I=class extends zr{constructor(e){super()}},AI=class{constructor(e,r,i,s){this.core=e,this.logger=r,this.name=i}},PI=class extends zr{constructor(e,r){super(),this.relayer=e,this.logger=r}},TI=class extends zr{constructor(e,r){super(),this.core=e,this.logger=r}},CI=class{constructor(e,r,i){this.core=e,this.logger=r,this.store=i}},BI=class{constructor(e,r){this.projectId=e,this.logger=r}},RI=class{constructor(e,r,i){this.core=e,this.logger=r,this.telemetryEnabled=i}};var NI=Object.defineProperty,UI=(t,e,r)=>e in t?NI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$u=(t,e,r)=>UI(t,typeof e!="symbol"?e+"":e,r);let kI=class{constructor(e){this.opts=e,$u(this,"protocol","wc"),$u(this,"version",2)}},jI=class{constructor(e){this.client=e}};const MI="PARSE_ERROR",LI="INVALID_REQUEST",qI="METHOD_NOT_FOUND",zI="INVALID_PARAMS",fp="INTERNAL_ERROR",ic="SERVER_ERROR",FI=[-32700,-32600,-32601,-32602,-32603],ki={[MI]:{code:-32700,message:"Parse error"},[LI]:{code:-32600,message:"Invalid Request"},[qI]:{code:-32601,message:"Method not found"},[zI]:{code:-32602,message:"Invalid params"},[fp]:{code:-32603,message:"Internal error"},[ic]:{code:-32e3,message:"Server error"}},dp=ic;function VI(t){return FI.includes(t)}function Au(t){return Object.keys(ki).includes(t)?ki[t]:ki[dp]}function KI(t){const e=Object.values(ki).find(r=>r.code===t);return e||ki[dp]}function pp(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var mo={};var la=function(t,e){return la=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},la(t,e)};function HI(t,e){la(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var ua=function(){return ua=Object.assign||function(e){for(var r,i=1,s=arguments.length;i<s;i++){r=arguments[i];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ua.apply(this,arguments)};function WI(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r}function GI(t,e,r,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(n=(s<3?o(n):s>3?o(e,r,n):o(e,r))||n);return s>3&&n&&Object.defineProperty(e,r,n),n}function YI(t,e){return function(r,i){e(r,i,t)}}function ZI(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function JI(t,e,r,i){function s(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function a(u){try{l(i.next(u))}catch(f){o(f)}}function c(u){try{l(i.throw(u))}catch(f){o(f)}}function l(u){u.done?n(u.value):s(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function XI(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(n=l[0]&2?s.return:l[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,l[1])).done)return n;switch(s=0,n&&(l=[l[0]&2,n.value]),l[0]){case 0:case 1:n=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,s=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!n||l[1]>n[0]&&l[1]<n[3])){r.label=l[1];break}if(l[0]===6&&r.label<n[1]){r.label=n[1],n=l;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(l);break}n[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],s=0}finally{i=n=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function QI(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function e3(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function ha(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function gp(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),s,n=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return n}function t3(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(gp(arguments[e]));return t}function r3(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),s=0,e=0;e<r;e++)for(var n=arguments[e],o=0,a=n.length;o<a;o++,s++)i[s]=n[o];return i}function Hi(t){return this instanceof Hi?(this.v=t,this):new Hi(t)}function i3(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),s,n=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(h){i[h]&&(s[h]=function(p){return new Promise(function(d,g){n.push([h,p,d,g])>1||a(h,p)})})}function a(h,p){try{c(i[h](p))}catch(d){f(n[0][3],d)}}function c(h){h.value instanceof Hi?Promise.resolve(h.value.v).then(l,u):f(n[0][2],h)}function l(h){a("next",h)}function u(h){a("throw",h)}function f(h,p){h(p),n.shift(),n.length&&a(n[0][0],n[0][1])}}function s3(t){var e,r;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=t[s]?function(o){return(r=!r)?{value:Hi(t[s](o)),done:s==="return"}:n?n(o):o}:n}}function n3(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof ha=="function"?ha(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(n){r[n]=t[n]&&function(o){return new Promise(function(a,c){o=t[n](o),s(a,c,o.done,o.value)})}}function s(n,o,a,c){Promise.resolve(c).then(function(l){n({value:l,done:a})},o)}}function o3(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function a3(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function c3(t){return t&&t.__esModule?t:{default:t}}function l3(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function u3(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const h3=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return ua},__asyncDelegator:s3,__asyncGenerator:i3,__asyncValues:n3,__await:Hi,__awaiter:JI,__classPrivateFieldGet:l3,__classPrivateFieldSet:u3,__createBinding:QI,__decorate:GI,__exportStar:e3,__extends:HI,__generator:XI,__importDefault:c3,__importStar:a3,__makeTemplateObject:o3,__metadata:ZI,__param:YI,__read:gp,__rest:WI,__spread:t3,__spreadArrays:r3,__values:ha},Symbol.toStringTag,{value:"Module"})),f3=Lh(h3);var Ft={},Pu;function d3(){if(Pu)return Ft;Pu=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.isBrowserCryptoAvailable=Ft.getSubtleCrypto=Ft.getBrowerCrypto=void 0;function t(){return globalThis?.crypto||globalThis?.msCrypto||{}}Ft.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}Ft.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Ft.isBrowserCryptoAvailable=r,Ft}var Vt={},Tu;function p3(){if(Tu)return Vt;Tu=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.isBrowser=Vt.isNode=Vt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Vt.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Vt.isNode=e;function r(){return!t()&&!e()}return Vt.isBrowser=r,Vt}var Cu;function g3(){return Cu||(Cu=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=f3;e.__exportStar(d3(),t),e.__exportStar(p3(),t)})(mo)),mo}var y3=g3();function Tt(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function wr(t=6){return BigInt(Tt(t))}function _t(t,e,r){return{id:r||Tt(),jsonrpc:"2.0",method:t,params:e}}function Wi(t,e){return{id:t,jsonrpc:"2.0",result:e}}function bn(t,e,r){return{id:t,jsonrpc:"2.0",error:w3(e)}}function w3(t,e){return typeof t>"u"?Au(fp):(typeof t=="string"&&(t=Object.assign(Object.assign({},Au(ic)),{message:t})),VI(t.code)&&(t=KI(t.code)),t)}class m3{}class b3 extends m3{constructor(){super()}}class v3 extends b3{constructor(e){super()}}const E3="^https?:",_3="^wss?:";function x3(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function yp(t,e){const r=x3(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function Bu(t){return yp(t,E3)}function Ru(t){return yp(t,_3)}function I3(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function wp(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function sc(t){return wp(t)&&"method"in t}function vn(t){return wp(t)&&(Ct(t)||dt(t))}function Ct(t){return"result"in t}function dt(t){return"error"in t}let nc=class extends v3{constructor(e){super(e),this.events=new wt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(_t(e.method,e.params||[],e.id||wr().toString()),r)}async requestStrict(e,r){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{dt(n)?s(n.error):i(n.result)});try{await this.connection.send(e,r)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),vn(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const S3=()=>typeof WebSocket<"u"?WebSocket:typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"?globalThis.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),O3=()=>typeof WebSocket<"u"||typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Nu=t=>t.split("?")[0],Uu=10,D3=S3();let $3=class{constructor(e){if(this.url=e,this.events=new wt.EventEmitter,this.registering=!1,!Ru(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(tr(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!Ru(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const s=y3.isReactNative()?void 0:{rejectUnauthorized:!I3(e)},n=new D3(e,[],s);O3()?n.onerror=o=>{const a=o;i(this.emitError(a.error))}:n.on("error",o=>{i(this.emitError(o))}),n.onopen=()=>{this.onOpen(n),r(n)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?jr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),n=bn(e,s);this.events.emit("payload",n)}parseError(e,r=this.url){return pp(e,Nu(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Uu&&this.events.setMaxListeners(Uu)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${Nu(this.url)}`));return this.events.emit("register_error",r),r}};var A3={};const mp="wc",bp=2,fa="core",kt=`${mp}@2:${fa}:`,P3={logger:"error"},T3={database:":memory:"},C3="crypto",ku="client_ed25519_seed",B3=F.ONE_DAY,R3="keychain",N3="0.3",U3="messages",k3="0.3",j3=F.SIX_HOURS,M3="publisher",vp="irn",L3="error",Ep="wss://relay.walletconnect.org",q3="relayer",he={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},z3="_subscription",at={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},F3=.1,da="2.21.10",ae={link_mode:"link_mode",relay:"relay"},Rs={inbound:"inbound",outbound:"outbound"},V3="0.3",K3="WALLETCONNECT_CLIENT_ID",ju="WALLETCONNECT_LINK_MODE_APPS",rt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},H3="subscription",W3="0.3",G3="pairing",Y3="0.3",Ii={wc_pairingDelete:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:F.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:F.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:F.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:F.ONE_DAY,prompt:!1,tag:0},res:{ttl:F.ONE_DAY,prompt:!1,tag:0}}},Pr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},bt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Z3="history",J3="0.3",X3="expirer",ut={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Q3="0.3",eS="verify-api",tS="https://verify.walletconnect.com",_p="https://verify.walletconnect.org",ji=_p,rS=`${ji}/v3`,iS=[tS,_p],sS="echo",nS="https://echo.walletconnect.com",Pt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Ht={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},hr={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Si={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Sr={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Oi={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},oS=.1,aS="event-client",cS=86400,lS="https://pulse.walletconnect.org/batch";function uS(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,m=0,E=0,S=d.length;E!==S&&d[E]===0;)E++,g++;for(var b=(S-E)*u+1>>>0,x=new Uint8Array(b);E!==S;){for(var A=d[E],v=0,C=b-1;(A!==0||v<m)&&C!==-1;C--,v++)A+=256*x[C]>>>0,x[C]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");m=v,E++}for(var R=b-m;R!==b&&x[R]===0;)R++;for(var T=c.repeat(g);R<b;++R)T+=t.charAt(x[R]);return T}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var m=0,E=0;d[g]===c;)m++,g++;for(var S=(d.length-g)*l+1>>>0,b=new Uint8Array(S);d[g];){var x=r[d.charCodeAt(g)];if(x===255)return;for(var A=0,v=S-1;(x!==0||A<E)&&v!==-1;v--,A++)x+=a*b[v]>>>0,b[v]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");E=A,g++}if(d[g]!==" "){for(var C=S-E;C!==S&&b[C]===0;)C++;for(var R=new Uint8Array(m+(S-C)),T=m;C!==S;)R[T++]=b[C++];return R}}}function p(d){var g=h(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var hS=uS,fS=hS;const xp=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},dS=t=>new TextEncoder().encode(t),pS=t=>new TextDecoder().decode(t);class gS{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class yS{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ip(this,e)}}class wS{constructor(e){this.decoders=e}or(e){return Ip(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ip=(t,e)=>new wS({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class mS{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new gS(e,r,i),this.decoder=new yS(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const En=({name:t,prefix:e,encode:r,decode:i})=>new mS(t,e,r,i),as=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=fS(r,e);return En({prefix:t,name:e,encode:i,decode:n=>xp(s(n))})},bS=(t,e,r,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const f=s[t[u]];if(f===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|f,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},vS=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Te=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>En({prefix:e,name:t,encode(s){return vS(s,i,r)},decode(s){return bS(s,i,r,t)}}),ES=En({prefix:"\0",name:"identity",encode:t=>pS(t),decode:t=>dS(t)});var _S=Object.freeze({__proto__:null,identity:ES});const xS=Te({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var IS=Object.freeze({__proto__:null,base2:xS});const SS=Te({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var OS=Object.freeze({__proto__:null,base8:SS});const DS=as({prefix:"9",name:"base10",alphabet:"0123456789"});var $S=Object.freeze({__proto__:null,base10:DS});const AS=Te({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),PS=Te({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var TS=Object.freeze({__proto__:null,base16:AS,base16upper:PS});const CS=Te({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),BS=Te({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),RS=Te({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),NS=Te({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),US=Te({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),kS=Te({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),jS=Te({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),MS=Te({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),LS=Te({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var qS=Object.freeze({__proto__:null,base32:CS,base32upper:BS,base32pad:RS,base32padupper:NS,base32hex:US,base32hexupper:kS,base32hexpad:jS,base32hexpadupper:MS,base32z:LS});const zS=as({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),FS=as({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var VS=Object.freeze({__proto__:null,base36:zS,base36upper:FS});const KS=as({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),HS=as({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var WS=Object.freeze({__proto__:null,base58btc:KS,base58flickr:HS});const GS=Te({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),YS=Te({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ZS=Te({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),JS=Te({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var XS=Object.freeze({__proto__:null,base64:GS,base64pad:YS,base64url:ZS,base64urlpad:JS});const Sp=Array.from(""),QS=Sp.reduce((t,e,r)=>(t[r]=e,t),[]),e8=Sp.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function t8(t){return t.reduce((e,r)=>(e+=QS[r],e),"")}function r8(t){const e=[];for(const r of t){const i=e8[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const i8=En({prefix:"",name:"base256emoji",encode:t8,decode:r8});var s8=Object.freeze({__proto__:null,base256emoji:i8}),n8=Op,Mu=128,o8=-128,a8=Math.pow(2,31);function Op(t,e,r){e=e||[],r=r||0;for(var i=r;t>=a8;)e[r++]=t&255|Mu,t/=128;for(;t&o8;)e[r++]=t&255|Mu,t>>>=7;return e[r]=t|0,Op.bytes=r-i+1,e}var c8=pa,l8=128,Lu=127;function pa(t,i){var r=0,i=i||0,s=0,n=i,o,a=t.length;do{if(n>=a)throw pa.bytes=0,new RangeError("Could not decode varint");o=t[n++],r+=s<28?(o&Lu)<<s:(o&Lu)*Math.pow(2,s),s+=7}while(o>=l8);return pa.bytes=n-i,r}var u8=Math.pow(2,7),h8=Math.pow(2,14),f8=Math.pow(2,21),d8=Math.pow(2,28),p8=Math.pow(2,35),g8=Math.pow(2,42),y8=Math.pow(2,49),w8=Math.pow(2,56),m8=Math.pow(2,63),b8=function(t){return t<u8?1:t<h8?2:t<f8?3:t<d8?4:t<p8?5:t<g8?6:t<y8?7:t<w8?8:t<m8?9:10},v8={encode:n8,decode:c8,encodingLength:b8},Dp=v8;const qu=(t,e,r=0)=>(Dp.encode(t,e,r),e),zu=t=>Dp.encodingLength(t),ga=(t,e)=>{const r=e.byteLength,i=zu(t),s=i+zu(r),n=new Uint8Array(s+r);return qu(t,n,0),qu(r,n,i),n.set(e,s),new E8(t,r,e,n)};class E8{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}}const $p=({name:t,code:e,encode:r})=>new _8(t,e,r);class _8{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?ga(this.code,r):r.then(i=>ga(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Ap=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),x8=$p({name:"sha2-256",code:18,encode:Ap("SHA-256")}),I8=$p({name:"sha2-512",code:19,encode:Ap("SHA-512")});var S8=Object.freeze({__proto__:null,sha256:x8,sha512:I8});const Pp=0,O8="identity",Tp=xp,D8=t=>ga(Pp,Tp(t)),$8={code:Pp,name:O8,encode:Tp,digest:D8};var A8=Object.freeze({__proto__:null,identity:$8});new TextEncoder,new TextDecoder;const Fu={..._S,...IS,...OS,...$S,...TS,...qS,...VS,...WS,...XS,...s8};({...S8,...A8});function Cp(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function P8(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Cp(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Bp(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Vu=Bp("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),bo=Bp("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=P8(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),T8={utf8:Vu,"utf-8":Vu,hex:Fu.base16,latin1:bo,ascii:bo,binary:bo,...Fu};function C8(t,e="utf8"){const r=T8[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Cp(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var B8=Object.defineProperty,R8=(t,e,r)=>e in t?B8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$t=(t,e,r)=>R8(t,typeof e!="symbol"?e+"":e,r);class N8{constructor(e,r){this.core=e,this.logger=r,$t(this,"keychain",new Map),$t(this,"name",R3),$t(this,"version",N3),$t(this,"initialized",!1),$t(this,"storagePrefix",kt),$t(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),$t(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),$t(this,"set",async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()}),$t(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:n}=z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return s}),$t(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=ze(r,this.name)}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Go(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Yo(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var U8=Object.defineProperty,k8=(t,e,r)=>e in t?U8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Oe=(t,e,r)=>k8(t,typeof e!="symbol"?e+"":e,r);class j8{constructor(e,r,i){this.core=e,this.logger=r,Oe(this,"name",C3),Oe(this,"keychain"),Oe(this,"randomSessionIdentifier",oa()),Oe(this,"initialized",!1),Oe(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Oe(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),Oe(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),n=dl(s);return Xf(n.publicKey)}),Oe(this,"generateKeyPair",()=>{this.isInitialized();const s=c_();return this.setPrivateKey(s.publicKey,s.privateKey)}),Oe(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),o=dl(n),a=this.randomSessionIdentifier;return await r1(a,s,B3,o)}),Oe(this,"generateSharedKey",(s,n,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=l_(a,n);return this.setSymKey(c,o)}),Oe(this,"setSymKey",async(s,n)=>{this.isInitialized();const o=n||Ts(s);return await this.keychain.set(o,s),o}),Oe(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),Oe(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),Oe(this,"encode",async(s,n,o)=>{this.isInitialized();const a=op(o),c=tr(n);if(iu(a))return f_(c,o?.encoding);if(ru(a)){const h=a.senderPublicKey,p=a.receiverPublicKey;s=await this.generateSharedKey(h,p)}const l=this.getSymKey(s),{type:u,senderPublicKey:f}=a;return u_({type:u,symKey:l,message:c,senderPublicKey:f,encoding:o?.encoding})}),Oe(this,"decode",async(s,n,o)=>{this.isInitialized();const a=p_(n,o);if(iu(a)){const c=d_(n,o?.encoding);return jr(c)}if(ru(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;s=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(s),l=h_({symKey:c,encoded:n,encoding:o?.encoding});return jr(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Oe(this,"getPayloadType",(s,n=Ye)=>{const o=Ki({encoded:s,encoding:n});return Lr(o.type)}),Oe(this,"getPayloadSenderPublicKey",(s,n=Ye)=>{const o=Ki({encoded:s,encoding:n});return o.senderPublicKey?Xe(o.senderPublicKey,qe):void 0}),this.core=e,this.logger=ze(r,this.name),this.keychain=i||new N8(this.core,this.logger)}get context(){return Qe(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(ku)}catch{e=oa(),await this.keychain.set(ku,e)}return C8(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var M8=Object.defineProperty,L8=Object.defineProperties,q8=Object.getOwnPropertyDescriptors,Ku=Object.getOwnPropertySymbols,z8=Object.prototype.hasOwnProperty,F8=Object.prototype.propertyIsEnumerable,ya=(t,e,r)=>e in t?M8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,V8=(t,e)=>{for(var r in e||(e={}))z8.call(e,r)&&ya(t,r,e[r]);if(Ku)for(var r of Ku(e))F8.call(e,r)&&ya(t,r,e[r]);return t},K8=(t,e)=>L8(t,q8(e)),et=(t,e,r)=>ya(t,typeof e!="symbol"?e+"":e,r);class H8 extends OI{constructor(e,r){super(e,r),this.logger=e,this.core=r,et(this,"messages",new Map),et(this,"messagesWithoutClientAck",new Map),et(this,"name",U3),et(this,"version",k3),et(this,"initialized",!1),et(this,"storagePrefix",kt),et(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),et(this,"set",async(i,s,n)=>{this.isInitialized();const o=ft(s);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(i,a),n===Rs.inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,K8(V8({},c),{[o]:s}))}return await this.persist(),o}),et(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),et(this,"getWithoutAck",i=>{this.isInitialized();const s={};for(const n of i){const o=this.messagesWithoutClientAck.get(n)||{};s[n]=Object.values(o)}return s}),et(this,"has",(i,s)=>{this.isInitialized();const n=this.get(i),o=ft(s);return typeof n[o]<"u"}),et(this,"ack",async(i,s)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(i);if(typeof n>"u")return;const o=ft(s);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,n),await this.persist()}),et(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=ze(e,this.name),this.core=r}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Go(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Go(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Yo(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Yo(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var W8=Object.defineProperty,G8=Object.defineProperties,Y8=Object.getOwnPropertyDescriptors,Hu=Object.getOwnPropertySymbols,Z8=Object.prototype.hasOwnProperty,J8=Object.prototype.propertyIsEnumerable,wa=(t,e,r)=>e in t?W8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zr=(t,e)=>{for(var r in e||(e={}))Z8.call(e,r)&&wa(t,r,e[r]);if(Hu)for(var r of Hu(e))J8.call(e,r)&&wa(t,r,e[r]);return t},Wu=(t,e)=>G8(t,Y8(e)),ct=(t,e,r)=>wa(t,typeof e!="symbol"?e+"":e,r);class X8 extends DI{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,ct(this,"events",new wt.EventEmitter),ct(this,"name",M3),ct(this,"queue",new Map),ct(this,"publishTimeout",F.toMiliseconds(F.ONE_MINUTE)),ct(this,"initialPublishTimeout",F.toMiliseconds(F.ONE_SECOND*15)),ct(this,"needsTransportRestart",!1),ct(this,"publish",async(i,s,n)=>{var o,a,c,l,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}});const f=n?.ttl||j3,h=n?.prompt||!1,p=n?.tag||0,d=n?.id||wr().toString(),g=ri(Gs().protocol),m={id:d,method:n?.publishMethod||g.publish,params:Zr({topic:i,message:s,ttl:f,prompt:h,tag:p,attestation:n?.attestation},n?.tvf)},E=`Failed to publish payload, please try again. id:${d} tag:${p}`;try{be((o=m.params)==null?void 0:o.prompt)&&((a=m.params)==null||delete a.prompt),be((c=m.params)==null?void 0:c.tag)&&((l=m.params)==null||delete l.tag);const S=new Promise(async b=>{const x=({id:v})=>{var C;((C=m.id)==null?void 0:C.toString())===v.toString()&&(this.removeRequestFromQueue(v),this.relayer.events.removeListener(he.publish,x),b())};this.relayer.events.on(he.publish,x);const A=Rt(new Promise((v,C)=>{this.rpcPublish(m,n).then(v).catch(R=>{this.logger.warn(R,R?.message),C(R)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${d} tag:${p}`);try{await A,this.events.removeListener(he.publish,x)}catch(v){this.queue.set(d,{request:m,opts:n,attempt:1}),this.logger.warn(v,v?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:d,topic:i,message:s,opts:n}}),await Rt(S,this.publishTimeout,E)}catch(S){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(S),(u=n?.internal)!=null&&u.throwOnFailedPublish)throw S}finally{this.queue.delete(d)}}),ct(this,"publishCustom",async i=>{var s,n,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:i});const{payload:l,opts:u={}}=i,{attestation:f,tvf:h,publishMethod:p,prompt:d,tag:g,ttl:m=F.FIVE_MINUTES}=u,E=u.id||wr().toString(),S=ri(Gs().protocol),b=p||S.publish,x={id:E,method:b,params:Zr(Wu(Zr({},l),{ttl:m,prompt:d,tag:g,attestation:f}),h)},A=`Failed to publish custom payload, please try again. id:${E} tag:${g}`;try{be((s=x.params)==null?void 0:s.prompt)&&((n=x.params)==null||delete n.prompt),be((o=x.params)==null?void 0:o.tag)&&((a=x.params)==null||delete a.tag);const v=new Promise(async C=>{const R=({id:k})=>{var N;((N=x.id)==null?void 0:N.toString())===k.toString()&&(this.removeRequestFromQueue(k),this.relayer.events.removeListener(he.publish,R),C())};this.relayer.events.on(he.publish,R);const T=Rt(new Promise((k,N)=>{this.rpcPublish(x,u).then(k).catch(B=>{this.logger.warn(B,B?.message),N(B)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${b} id:${E} tag:${g}`);try{await T,this.events.removeListener(he.publish,R)}catch(k){this.queue.set(E,{request:x,opts:u,attempt:1}),this.logger.warn(k,k?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:E,payload:l,opts:u}}),await Rt(v,this.publishTimeout,A)}catch(v){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(v),(c=u?.internal)!=null&&c.throwOnFailedPublish)throw v}finally{this.queue.delete(E)}}),ct(this,"on",(i,s)=>{this.events.on(i,s)}),ct(this,"once",(i,s)=>{this.events.once(i,s)}),ct(this,"off",(i,s)=>{this.events.off(i,s)}),ct(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=e,this.logger=ze(r,this.name),this.registerEventListeners()}get context(){return Qe(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const i=await this.relayer.request(e);return this.relayer.events.emit(he.publish,Zr(Zr({},e),r)),this.logger.debug("Successfully Published Payload"),i}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var i;const s=e.attempt+1;this.queue.set(r,Wu(Zr({},e),{attempt:s})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(i=e.request.params)==null?void 0:i.tag}, attempt: ${s}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Fr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(he.connection_stalled);return}this.checkQueue()}),this.relayer.on(he.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var Q8=Object.defineProperty,eO=(t,e,r)=>e in t?Q8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Jr=(t,e,r)=>eO(t,typeof e!="symbol"?e+"":e,r);class tO{constructor(){Jr(this,"map",new Map),Jr(this,"set",(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])}),Jr(this,"get",e=>this.map.get(e)||[]),Jr(this,"exists",(e,r)=>this.get(e).includes(r)),Jr(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const s=i.filter(n=>n!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),Jr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var rO=Object.defineProperty,iO=Object.defineProperties,sO=Object.getOwnPropertyDescriptors,Gu=Object.getOwnPropertySymbols,nO=Object.prototype.hasOwnProperty,oO=Object.prototype.propertyIsEnumerable,ma=(t,e,r)=>e in t?rO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Di=(t,e)=>{for(var r in e||(e={}))nO.call(e,r)&&ma(t,r,e[r]);if(Gu)for(var r of Gu(e))oO.call(e,r)&&ma(t,r,e[r]);return t},vo=(t,e)=>iO(t,sO(e)),ne=(t,e,r)=>ma(t,typeof e!="symbol"?e+"":e,r);class aO extends PI{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,ne(this,"subscriptions",new Map),ne(this,"topicMap",new tO),ne(this,"events",new wt.EventEmitter),ne(this,"name",H3),ne(this,"version",W3),ne(this,"pending",new Map),ne(this,"cached",[]),ne(this,"initialized",!1),ne(this,"storagePrefix",kt),ne(this,"subscribeTimeout",F.toMiliseconds(F.ONE_MINUTE)),ne(this,"initialSubscribeTimeout",F.toMiliseconds(F.ONE_SECOND*15)),ne(this,"clientId"),ne(this,"batchSubscribeTopicsLimit",500),ne(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ne(this,"subscribe",async(i,s)=>{var n;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const o=Gs(s),a={topic:i,relay:o,transportType:s?.transportType};(n=s?.internal)!=null&&n.skipSubscribe||this.pending.set(i,a);const c=await this.rpcSubscribe(i,o,s);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),ne(this,"unsubscribe",async(i,s)=>{this.isInitialized(),typeof s?.id<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)}),ne(this,"isSubscribed",i=>new Promise(s=>{s(this.topicMap.topics.includes(i))})),ne(this,"isKnownTopic",i=>new Promise(s=>{s(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(n=>n.topic===i))})),ne(this,"on",(i,s)=>{this.events.on(i,s)}),ne(this,"once",(i,s)=>{this.events.once(i,s)}),ne(this,"off",(i,s)=>{this.events.off(i,s)}),ne(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),ne(this,"start",async()=>{await this.onConnect()}),ne(this,"stop",async()=>{await this.onDisconnect()}),ne(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ne(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(s=>{i.push(s)}),await this.batchSubscribe(i)}),ne(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Fr.pulse,async()=>{await this.checkPending()}),this.events.on(rt.created,async i=>{const s=rt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()}),this.events.on(rt.deleted,async i=>{const s=rt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()})}),this.relayer=e,this.logger=ze(r,this.name),this.clientId=""}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const s=Gs(i);await this.restartToComplete({topic:e,id:r,relay:s}),await this.rpcUnsubscribe(e,r,s);const n=ce("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r,i){var s,n;const o=await this.getSubscriptionId(e);if((s=i?.internal)!=null&&s.skipSubscribe)return o;(!i||i?.transportType===ae.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:ri(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(n=i?.internal)==null?void 0:n.throwOnFailedPublish;try{if(i?.transportType===ae.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(f=>this.logger.warn(f))},F.toMiliseconds(F.ONE_SECOND)),o;const l=new Promise(async f=>{const h=p=>{p.topic===e&&(this.events.removeListener(rt.created,h),f(p.id))};this.events.on(rt.created,h);try{const p=await Rt(new Promise((d,g)=>{this.relayer.request(a).catch(m=>{this.logger.warn(m,m?.message),g(m)}).then(d)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(rt.created,h),f(p)}catch{}}),u=await Rt(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(he.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:ri(r.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Rt(new Promise(s=>{this.relayer.request(i).catch(n=>this.logger.warn(n)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(he.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,i={method:ri(r.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await Rt(new Promise((n,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(he.connection_stalled)}return s}rpcUnsubscribe(e,r,i){const s={method:ri(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,r){this.setSubscription(e,vo(Di({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Di({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Di({},r)),this.topicMap.set(r.topic,e),this.events.emit(rt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(rt.deleted,vo(Di({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(rt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(rt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var i;return r.topic===((i=this.subscriptions.get(r.id))==null?void 0:i.topic)})){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>vo(Di({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await Pv(F.toMiliseconds(F.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return ft(e+await this.getClientId())}}var cO=Object.defineProperty,Yu=Object.getOwnPropertySymbols,lO=Object.prototype.hasOwnProperty,uO=Object.prototype.propertyIsEnumerable,ba=(t,e,r)=>e in t?cO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zu=(t,e)=>{for(var r in e||(e={}))lO.call(e,r)&&ba(t,r,e[r]);if(Yu)for(var r of Yu(e))uO.call(e,r)&&ba(t,r,e[r]);return t},te=(t,e,r)=>ba(t,typeof e!="symbol"?e+"":e,r);class hO extends $I{constructor(e){super(e),te(this,"protocol","wc"),te(this,"version",2),te(this,"core"),te(this,"logger"),te(this,"events",new wt.EventEmitter),te(this,"provider"),te(this,"messages"),te(this,"subscriber"),te(this,"publisher"),te(this,"name",q3),te(this,"transportExplicitlyClosed",!1),te(this,"initialized",!1),te(this,"connectionAttemptInProgress",!1),te(this,"relayUrl"),te(this,"projectId"),te(this,"packageName"),te(this,"bundleId"),te(this,"hasExperiencedNetworkDisruption",!1),te(this,"pingTimeout"),te(this,"heartBeatTimeout",F.toMiliseconds(F.THIRTY_SECONDS+F.FIVE_SECONDS)),te(this,"reconnectTimeout"),te(this,"connectPromise"),te(this,"reconnectInProgress",!1),te(this,"requestsInFlight",[]),te(this,"connectTimeout",F.toMiliseconds(F.ONE_SECOND*15)),te(this,"request",async r=>{var i,s;this.logger.debug("Publishing Request Payload");const n=r.id||wr().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:r.method,topic:(i=r.params)==null?void 0:i.topic},"relayer.request - publishing...");const o=`${n}:${((s=r.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),te(this,"resetPingTimeout",()=>{zs()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,i,s,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null?void 0:s.terminate)==null||n.call(s)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),te(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),te(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(he.connect)}),te(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),te(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(he.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),te(this,"registerProviderListeners",()=>{this.provider.on(at.payload,this.onPayloadHandler),this.provider.on(at.connect,this.onConnectHandler),this.provider.on(at.disconnect,this.onDisconnectHandler),this.provider.on(at.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?ze(e.logger,this.name):ns(mn({level:e.logger||L3})),this.messages=new H8(this.logger,e.core),this.subscriber=new aO(this,this.logger),this.publisher=new X8(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Ep,pv()?this.packageName=Il():gv()&&(this.bundleId=Il()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return Qe(this.logger)}get connected(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:ae.relay},Rs.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var i,s,n;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((i=r?.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(s=r?.internal)==null?void 0:s.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(rt.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(rt.created,l)}),new Promise(async(u,f)=>{a=await this.subscriber.subscribe(e,Zu({internal:{throwOnFailedPublish:o}},r)).catch(h=>{o&&f(h)})||a,u()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Rt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,i)=>{await this.connect(e).then(r).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await yu())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((i,s)=>i.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const i of r)try{await this.onMessageEvent(i)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+s?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:i}=e;if(!r.sessionExists){const s=pe(F.FIVE_MINUTES),n={topic:i,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,n)}this.events.emit(he.message,e),await this.recordMessageEvent(e,Rs.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(i,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to connect"))};this.provider.once(at.disconnect,n),await Rt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(at.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(at.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(at.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const s=i;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(i=>setTimeout(i,F.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,i,s,n;if(zs())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((n=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new nc(new $3(vv({sdkVersion:da,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:i,message:s}=e;await this.messages.set(i,s,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const s=this.messages.has(r,i);return s&&this.logger.warn(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),sc(e)){if(!e.method.endsWith(z3))return;const r=e.params,{topic:i,message:s,publishedAt:n,attestation:o}=r.data,a={topic:i,message:s,publishedAt:n,transportType:ae.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Zu({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else vn(e)&&this.events.emit(he.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Rs.inbound),this.events.emit(he.message,e))}async acknowledgePayload(e){const r=Wi(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(at.payload,this.onPayloadHandler),this.provider.off(at.connect,this.onConnectHandler),this.provider.off(at.disconnect,this.onDisconnectHandler),this.provider.off(at.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await yu();dx(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(i=>this.logger.error(i,i?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Fr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&yx())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(he.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},F.toMiliseconds(F3)))))}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function fO(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function Ju(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Xu(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const dO="[object RegExp]",pO="[object String]",gO="[object Number]",yO="[object Boolean]",Qu="[object Arguments]",wO="[object Symbol]",mO="[object Date]",bO="[object Map]",vO="[object Set]",EO="[object Array]",_O="[object Function]",xO="[object ArrayBuffer]",Eo="[object Object]",IO="[object Error]",SO="[object DataView]",OO="[object Uint8Array]",DO="[object Uint8ClampedArray]",$O="[object Uint16Array]",AO="[object Uint32Array]",PO="[object BigUint64Array]",TO="[object Int8Array]",CO="[object Int16Array]",BO="[object Int32Array]",RO="[object BigInt64Array]",NO="[object Float32Array]",UO="[object Float64Array]";function kO(){}function eh(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function jO(t,e,r){return Bi(t,e,void 0,void 0,void 0,void 0,r)}function Bi(t,e,r,i,s,n,o){const a=o(t,e,r,i,s,n);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Mi(t,e,n,o)}return Mi(t,e,n,o)}function Mi(t,e,r,i){if(Object.is(t,e))return!0;let s=Xu(t),n=Xu(e);if(s===Qu&&(s=Eo),n===Qu&&(n=Eo),s!==n)return!1;switch(s){case pO:return t.toString()===e.toString();case gO:{const c=t.valueOf(),l=e.valueOf();return fO(c,l)}case yO:case mO:case wO:return Object.is(t.valueOf(),e.valueOf());case dO:return t.source===e.source&&t.flags===e.flags;case _O:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(s){case bO:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!Bi(l,e.get(c),c,t,e,r,i))return!1;return!0}case vO:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const f=c[u],h=l.findIndex(p=>Bi(f,p,void 0,t,e,r,i));if(h===-1)return!1;l.splice(h,1)}return!0}case EO:case OO:case DO:case $O:case AO:case PO:case TO:case CO:case BO:case RO:case NO:case UO:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Bi(t[c],e[c],c,t,e,r,i))return!1;return!0}case xO:return t.byteLength!==e.byteLength?!1:Mi(new Uint8Array(t),new Uint8Array(e),r,i);case SO:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Mi(new Uint8Array(t),new Uint8Array(e),r,i);case IO:return t.name===e.name&&t.message===e.message;case Eo:{if(!(Mi(t.constructor,e.constructor,r,i)||eh(t)&&eh(e)))return!1;const c=[...Object.keys(t),...Ju(t)],l=[...Object.keys(e),...Ju(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const f=c[u],h=t[f];if(!Object.hasOwn(e,f))return!1;const p=e[f];if(!Bi(h,p,f,t,e,r,i))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function MO(t,e){return jO(t,e,kO)}var LO=Object.defineProperty,th=Object.getOwnPropertySymbols,qO=Object.prototype.hasOwnProperty,zO=Object.prototype.propertyIsEnumerable,va=(t,e,r)=>e in t?LO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rh=(t,e)=>{for(var r in e||(e={}))qO.call(e,r)&&va(t,r,e[r]);if(th)for(var r of th(e))zO.call(e,r)&&va(t,r,e[r]);return t},Ve=(t,e,r)=>va(t,typeof e!="symbol"?e+"":e,r);class Kr extends AI{constructor(e,r,i,s=kt,n=void 0){super(e,r,i,s),this.core=e,this.logger=r,this.name=i,Ve(this,"map",new Map),Ve(this,"version",V3),Ve(this,"cached",[]),Ve(this,"initialized",!1),Ve(this,"getKey"),Ve(this,"storagePrefix",kt),Ve(this,"recentlyDeleted",[]),Ve(this,"recentlyDeletedLimit",200),Ve(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!be(o)?this.map.set(this.getKey(o),o):V_(o)?this.map.set(o.id,o):K_(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Ve(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Ve(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Ve(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>MO(a[c],o[c]))):this.values)),Ve(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=rh(rh({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Ve(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=ze(r,this.name),this.storagePrefix=s,this.getKey=n}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:s}=z("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var FO=Object.defineProperty,VO=(t,e,r)=>e in t?FO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,X=(t,e,r)=>VO(t,typeof e!="symbol"?e+"":e,r);class KO{constructor(e,r){this.core=e,this.logger=r,X(this,"name",G3),X(this,"version",Y3),X(this,"events",new $a),X(this,"pairings"),X(this,"initialized",!1),X(this,"storagePrefix",kt),X(this,"ignoredPayloadTypes",[Qt]),X(this,"registeredMethods",[]),X(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),X(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),X(this,"create",async i=>{this.isInitialized();const s=oa(),n=await this.core.crypto.setSymKey(s),o=pe(F.FIVE_MINUTES),a={protocol:vp},c={topic:n,expiry:o,relay:a,active:!1,methods:i?.methods},l=au({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:a,expiryTimestamp:o,methods:i?.methods});return this.events.emit(Pr.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:i?.transportType,internal:i?.internal}),{topic:n,uri:l}}),X(this,"pair",async i=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:i?.uri,trace:[Pt.pairing_started]}});this.isValidPair(i,s);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:l}=ou(i.uri);s.props.properties.topic=n,s.addTrace(Pt.pairing_uri_validation_success),s.addTrace(Pt.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(n)){if(u=this.pairings.get(n),s.addTrace(Pt.existing_pairing),u.active)throw s.setError(Ht.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(Pt.pairing_not_expired)}const f=c||pe(F.FIVE_MINUTES),h={topic:n,relay:a,expiry:f,active:!1,methods:l};this.core.expirer.set(n,f),await this.pairings.set(n,h),s.addTrace(Pt.store_new_pairing),i.activatePairing&&await this.activate({topic:n}),this.events.emit(Pr.create,h),s.addTrace(Pt.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),s.addTrace(Pt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(Ht.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(p){throw s.setError(Ht.subscribe_pairing_topic_failure),p}return s.addTrace(Pt.subscribe_pairing_topic_success),h}),X(this,"activate",async({topic:i})=>{this.isInitialized();const s=pe(F.FIVE_MINUTES);this.core.expirer.set(i,s),await this.pairings.update(i,{active:!0,expiry:s})}),X(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Dr();this.events.once(re("pairing_ping",n),({error:l})=>{l?c(l):a()}),await o()}}),X(this,"updateExpiry",async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})}),X(this,"updateMetadata",async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})}),X(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),X(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",ce("USER_DISCONNECTED")),await this.deletePairing(s))}),X(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:n,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(s);return au({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),X(this,"sendRequest",async(i,s,n)=>{const o=_t(s,n),a=await this.core.crypto.encode(i,o),c=Ii[s].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),X(this,"sendResult",async(i,s,n)=>{const o=Wi(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,l=Ii[c].res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),X(this,"sendError",async(i,s,n)=>{const o=bn(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,l=Ii[c]?Ii[c].res:Ii.unregistered_method.res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),X(this,"deletePairing",async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,ce("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])}),X(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(s=>Bt(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))}),X(this,"onRelayEventRequest",async i=>{const{topic:s,payload:n}=i;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,n);default:return await this.onUnknownRpcMethodRequest(s,n)}}),X(this,"onRelayEventResponse",async i=>{const{topic:s,payload:n}=i,o=(await this.core.history.get(s,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(o)}}),X(this,"onPairingPingRequest",async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(Pr.ping,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),X(this,"onPairingPingResponse",(i,s)=>{const{id:n}=s;setTimeout(()=>{Ct(s)?this.events.emit(re("pairing_ping",n),{}):dt(s)&&this.events.emit(re("pairing_ping",n),{error:s.error})},500)}),X(this,"onPairingDeleteRequest",async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(Pr.delete,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),X(this,"onUnknownRpcMethodRequest",async(i,s)=>{const{id:n,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=ce("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,i,a),this.logger.error(a)}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),X(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(ce("WC_METHOD_UNSUPPORTED",i))}),X(this,"isValidPair",(i,s)=>{var n;if(!He(i)){const{message:a}=z("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError(Ht.malformed_pairing_uri),new Error(a)}if(!F_(i.uri)){const{message:a}=z("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError(Ht.malformed_pairing_uri),new Error(a)}const o=ou(i?.uri);if(!((n=o?.relay)!=null&&n.protocol)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(Ht.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(Ht.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&F.toMiliseconds(o?.expiryTimestamp)<Date.now()){s.setError(Ht.pairing_expired);const{message:a}=z("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),X(this,"isValidPing",async i=>{if(!He(i)){const{message:n}=z("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),X(this,"isValidDisconnect",async i=>{if(!He(i)){const{message:n}=z("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),X(this,"isValidPairingTopic",async i=>{if(!ge(i,!1)){const{message:s}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(Bt(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=z("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}}),this.core=e,this.logger=ze(r,this.name),this.pairings=new Kr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Qe(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(he.message,async e=>{const{topic:r,message:i,transportType:s}=e;if(this.pairings.keys.includes(r)&&s!==ae.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const n=await this.core.crypto.decode(r,i);sc(n)?(this.core.history.set(r,n),await this.onRelayEventRequest({topic:r,payload:n})):vn(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.core.history.delete(r,n.id)),await this.core.relayer.messages.ack(r,i)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(ut.expired,async e=>{const{topic:r}=ld(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Pr.expire,{topic:r}))})}}var HO=Object.defineProperty,WO=(t,e,r)=>e in t?HO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,De=(t,e,r)=>WO(t,typeof e!="symbol"?e+"":e,r);class GO extends SI{constructor(e,r){super(e,r),this.core=e,this.logger=r,De(this,"records",new Map),De(this,"events",new wt.EventEmitter),De(this,"name",Z3),De(this,"version",J3),De(this,"cached",[]),De(this,"initialized",!1),De(this,"storagePrefix",kt),De(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),De(this,"set",(i,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const o={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n,expiry:pe(F.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(bt.created,o)}),De(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=dt(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.persist(),this.events.emit(bt.updated,s))}),De(this,"get",async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s))),De(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(bt.deleted,n)}}),this.persist()}),De(this,"exists",async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1)),De(this,"on",(i,s)=>{this.events.on(i,s)}),De(this,"once",(i,s)=>{this.events.once(i,s)}),De(this,"off",(i,s)=>{this.events.off(i,s)}),De(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=ze(r,this.name)}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:_t(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(bt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(bt.created,e=>{const r=bt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(bt.updated,e=>{const r=bt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(bt.deleted,e=>{const r=bt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Fr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{F.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(bt.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var YO=Object.defineProperty,ZO=(t,e,r)=>e in t?YO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ne=(t,e,r)=>ZO(t,typeof e!="symbol"?e+"":e,r);class JO extends TI{constructor(e,r){super(e,r),this.core=e,this.logger=r,Ne(this,"expirations",new Map),Ne(this,"events",new wt.EventEmitter),Ne(this,"name",X3),Ne(this,"version",Q3),Ne(this,"cached",[]),Ne(this,"initialized",!1),Ne(this,"storagePrefix",kt),Ne(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ne(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),Ne(this,"set",(i,s)=>{this.isInitialized();const n=this.formatTarget(i),o={target:n,expiry:s};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(ut.created,{target:n,expiration:o})}),Ne(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),Ne(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(ut.deleted,{target:s,expiration:n})}}),Ne(this,"on",(i,s)=>{this.events.on(i,s)}),Ne(this,"once",(i,s)=>{this.events.once(i,s)}),Ne(this,"off",(i,s)=>{this.events.off(i,s)}),Ne(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=ze(r,this.name)}get context(){return Qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Ev(e);if(typeof e=="number")return _v(e);const{message:r}=z("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ut.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;F.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(ut.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Fr.pulse,()=>this.checkExpirations()),this.events.on(ut.created,e=>{const r=ut.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ut.expired,e=>{const r=ut.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ut.deleted,e=>{const r=ut.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var XO=Object.defineProperty,QO=(t,e,r)=>e in t?XO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,de=(t,e,r)=>QO(t,typeof e!="symbol"?e+"":e,r);class eD extends CI{constructor(e,r,i){super(e,r,i),this.core=e,this.logger=r,this.store=i,de(this,"name",eS),de(this,"abortController"),de(this,"isDevEnv"),de(this,"verifyUrlV3",rS),de(this,"storagePrefix",kt),de(this,"version",bp),de(this,"publicKey"),de(this,"fetchPromise"),de(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&F.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),de(this,"register",async s=>{if(!di()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const l=er.getDocument(),u=this.startAbortTimer(F.ONE_SECOND*5),f=await new Promise((h,p)=>{const d=()=>{window.removeEventListener("message",m),l.body.removeChild(g),p("attestation aborted")};this.abortController.signal.addEventListener("abort",d);const g=l.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",d,{signal:this.abortController.signal});const m=E=>{if(E.data&&typeof E.data=="string")try{const S=JSON.parse(E.data);if(S.type==="verify_attestation"){if(Ho(S.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(g),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",m),h(S.attestation===null?"":S.attestation)}}catch(S){this.logger.warn(S)}};l.body.appendChild(g),window.addEventListener("message",m,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",f),f}catch(l){this.logger.warn(l)}return""}),de(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=s;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(Ho(n).payload.id!==a)return;const l=await this.isValidJwtAttestation(n);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(s?.verifyUrl);return this.fetchAttestation(o,c)}),de(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const o=this.startAbortTimer(F.ONE_SECOND*5),a=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),de(this,"getVerifyUrl",s=>{let n=s||ji;return iS.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${ji}`),n=ji),n}),de(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(F.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),de(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),de(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),de(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),de(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),de(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),de(this,"validateAttestation",(s,n)=>{const o=y_(s,n.publicKey),a={hasExpired:F.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=ze(r,this.name),this.abortController=new AbortController,this.isDevEnv=Va(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Qe(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),F.toMiliseconds(e))}}var tD=Object.defineProperty,rD=(t,e,r)=>e in t?tD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ih=(t,e,r)=>rD(t,typeof e!="symbol"?e+"":e,r);class iD extends BI{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,ih(this,"context",sS),ih(this,"registerDeviceToken",async i=>{const{clientId:s,token:n,notificationType:o,enableEncrypted:a=!1}=i,c=`${nS}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:n,always_raw:a})})}),this.logger=ze(r,this.context)}}var sD=Object.defineProperty,sh=Object.getOwnPropertySymbols,nD=Object.prototype.hasOwnProperty,oD=Object.prototype.propertyIsEnumerable,Ea=(t,e,r)=>e in t?sD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$i=(t,e)=>{for(var r in e||(e={}))nD.call(e,r)&&Ea(t,r,e[r]);if(sh)for(var r of sh(e))oD.call(e,r)&&Ea(t,r,e[r]);return t},Ee=(t,e,r)=>Ea(t,typeof e!="symbol"?e+"":e,r);class aD extends RI{constructor(e,r,i=!0){super(e,r,i),this.core=e,this.logger=r,Ee(this,"context",aS),Ee(this,"storagePrefix",kt),Ee(this,"storageVersion",oS),Ee(this,"events",new Map),Ee(this,"shouldPersist",!1),Ee(this,"init",async()=>{if(!Va())try{const s={eventId:Ol(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:ad(this.core.relayer.protocol,this.core.relayer.version,da)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),Ee(this,"createEvent",s=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=s,l=Ol(),u=this.core.projectId||"",f=Date.now(),h=$i({eventId:l,timestamp:f,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,h),this.shouldPersist=!0),h}),Ee(this,"getEvent",s=>{const{eventId:n,topic:o}=s;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return $i($i({},a),this.setMethods(a.eventId))}),Ee(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),Ee(this,"setEventListeners",()=>{this.core.heartbeat.on(Fr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{F.fromMiliseconds(Date.now())-F.fromMiliseconds(s.timestamp)>cS&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),Ee(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),Ee(this,"addTrace",(s,n)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(n),this.events.set(s,o),this.shouldPersist=!0)}),Ee(this,"setError",(s,n)=>{const o=this.events.get(s);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),Ee(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ee(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,$i($i({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),Ee(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[n,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),Ee(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${lS}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${da}${n}`,{method:"POST",body:JSON.stringify(s)})}),Ee(this,"getAppDomain",()=>od().url),this.logger=ze(r,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var cD=Object.defineProperty,nh=Object.getOwnPropertySymbols,lD=Object.prototype.hasOwnProperty,uD=Object.prototype.propertyIsEnumerable,_a=(t,e,r)=>e in t?cD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oh=(t,e)=>{for(var r in e||(e={}))lD.call(e,r)&&_a(t,r,e[r]);if(nh)for(var r of nh(e))uD.call(e,r)&&_a(t,r,e[r]);return t},oe=(t,e,r)=>_a(t,typeof e!="symbol"?e+"":e,r);let hD=class Rp extends EI{constructor(e){var r;super(e),oe(this,"protocol",mp),oe(this,"version",bp),oe(this,"name",fa),oe(this,"relayUrl"),oe(this,"projectId"),oe(this,"customStoragePrefix"),oe(this,"events",new wt.EventEmitter),oe(this,"logger"),oe(this,"heartbeat"),oe(this,"relayer"),oe(this,"crypto"),oe(this,"storage"),oe(this,"history"),oe(this,"expirer"),oe(this,"pairing"),oe(this,"verify"),oe(this,"echoClient"),oe(this,"linkModeSupportedApps"),oe(this,"eventClient"),oe(this,"initialized",!1),oe(this,"logChunkController"),oe(this,"on",(a,c)=>this.events.on(a,c)),oe(this,"once",(a,c)=>this.events.once(a,c)),oe(this,"off",(a,c)=>this.events.off(a,c)),oe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),oe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:ae.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const i=this.getGlobalCore(e?.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Ep,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=mn({level:typeof e?.logger=="string"&&e.logger?e.logger:P3.logger,name:fa}),{logger:n,chunkLoggerController:o}=mI({opts:s,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=ze(n,this.name),this.heartbeat=new Ox,this.crypto=new j8(this,this.logger,e?.keychain),this.history=new GO(this,this.logger),this.expirer=new JO(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new tI(oh(oh({},T3),e?.storageOptions)),this.relayer=new hO({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new KO(this,this.logger),this.verify=new eD(this,this.logger,this.storage),this.echoClient=new iD(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new aD(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new Rp(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(K3,i),r}get context(){return Qe(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(ju,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(ju)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,i=`${r}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&A3.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const fD=hD,Np="wc",Up=2,kp="client",oc=`${Np}@${Up}:${kp}:`,_o={name:kp,logger:"error"},ah="WALLETCONNECT_DEEPLINK_CHOICE",dD="proposal",ch="Proposal expired",pD="session",Xr=F.SEVEN_DAYS,gD="engine",$e={wc_sessionPropose:{req:{ttl:F.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1104},res:{ttl:F.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1106},res:{ttl:F.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:F.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:F.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1112},res:{ttl:F.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1114},res:{ttl:F.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:F.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:F.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1119}}},xo={min:F.FIVE_MINUTES,max:F.SEVEN_DAYS},At={idle:"IDLE",active:"ACTIVE"},yD={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},wD="request",mD=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],bD="wc",vD="auth",ED="authKeys",_D="pairingTopics",xD="requests",_n=`${bD}@${1.5}:${vD}:`,Ns=`${_n}:PUB_KEY`;var ID=Object.defineProperty,SD=Object.defineProperties,OD=Object.getOwnPropertyDescriptors,lh=Object.getOwnPropertySymbols,DD=Object.prototype.hasOwnProperty,$D=Object.prototype.propertyIsEnumerable,xa=(t,e,r)=>e in t?ID(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ie=(t,e)=>{for(var r in e||(e={}))DD.call(e,r)&&xa(t,r,e[r]);if(lh)for(var r of lh(e))$D.call(e,r)&&xa(t,r,e[r]);return t},Ue=(t,e)=>SD(t,OD(e)),M=(t,e,r)=>xa(t,typeof e!="symbol"?e+"":e,r);class AD extends jI{constructor(e){super(e),M(this,"name",gD),M(this,"events",new $a),M(this,"initialized",!1),M(this,"requestQueue",{state:At.idle,queue:[]}),M(this,"sessionRequestQueue",{state:At.idle,queue:[]}),M(this,"emittedSessionRequests",new Tv({limit:500})),M(this,"requestQueueDelay",F.ONE_SECOND),M(this,"expectedPairingMethodMap",new Map),M(this,"recentlyDeletedMap",new Map),M(this,"recentlyDeletedLimit",200),M(this,"relayMessageCache",[]),M(this,"pendingSessions",new Map),M(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys($e)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},F.toMiliseconds(this.requestQueueDelay)))}),M(this,"connect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Ue(ie({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=j_(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:l}=i;let u=s,f,h=!1;try{if(u){const v=this.client.core.pairing.pairings.get(u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),h=v.active}}catch(v){throw this.client.logger.error(`connect() -> pairing.get(${u}) failed`),v}if(!u||!h){const{topic:v,uri:C}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});u=v,f=C}if(!u){const{message:v}=z("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(v)}const p=await this.client.core.crypto.generateKeyPair(),d=$e.wc_sessionPropose.req.ttl||F.FIVE_MINUTES,g=pe(d),m=Ue(ie(ie({requiredNamespaces:n,optionalNamespaces:o,relays:l??[{protocol:vp}],proposer:{publicKey:p,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:u},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:Tt()}),E=re("session_connect",m.id),{reject:S,resolve:b,done:x}=Dr(d,ch),A=({id:v})=>{v===m.id&&(this.client.events.off("proposal_expire",A),this.pendingSessions.delete(m.id),this.events.emit(E,{error:{message:ch,code:0}}))};return this.client.events.on("proposal_expire",A),this.events.once(E,({error:v,session:C})=>{this.client.events.off("proposal_expire",A),v?S(v):C&&b(C)}),await this.sendProposeSession({proposal:m,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:m.id}}}),await this.setProposal(m.id,m),{uri:f,approval:x}}),M(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(i){throw this.client.logger.error("pair() failed"),i}}),M(this,"approve",async r=>{var i,s,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(i=r?.id)==null?void 0:i.toString(),trace:[hr.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(T){throw o.setError(Si.no_internet_connection),T}try{await this.isValidProposalId(r?.id)}catch(T){throw this.client.logger.error(`approve() -> proposal.get(${r?.id}) failed`),o.setError(Si.proposal_not_found),T}try{await this.isValidApprove(r)}catch(T){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Si.session_approve_namespace_validation_failure),T}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:f,sessionConfig:h}=r,p=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:d,proposer:g,requiredNamespaces:m,optionalNamespaces:E}=p;let S=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:d});S||(S=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:hr.session_approve_started,properties:{topic:d,trace:[hr.session_approve_started,hr.session_namespaces_validation_success]}}));const b=await this.client.core.crypto.generateKeyPair(),x=g.publicKey,A=await this.client.core.crypto.generateSharedKey(b,x),v=ie(ie(ie({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:b,metadata:this.client.metadata},expiry:pe(Xr)},u&&{sessionProperties:u}),f&&{scopedProperties:f}),h&&{sessionConfig:h}),C=ae.relay;S.addTrace(hr.subscribing_session_topic);try{await this.client.core.relayer.subscribe(A,{transportType:C,internal:{skipSubscribe:!0}})}catch(T){throw S.setError(Si.subscribe_session_topic_failure),T}S.addTrace(hr.subscribe_session_topic_success);const R=Ue(ie({},v),{topic:A,requiredNamespaces:m,optionalNamespaces:E,pairingTopic:d,acknowledged:!1,self:v.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:b,transportType:ae.relay});await this.client.session.set(A,R),S.addTrace(hr.store_session);try{await this.sendApproveSession({sessionTopic:A,proposal:p,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:b},sessionSettleRequest:v,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),S.addTrace(hr.session_approve_publish_success)}catch(T){throw this.client.logger.error(T),this.client.session.delete(A,ce("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(A),T}return this.client.core.eventClient.deleteEvent({eventId:S.eventId}),await this.client.core.pairing.updateMetadata({topic:d,metadata:g.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:d}),await this.setExpiry(A,pe(Xr)),{topic:A,acknowledged:()=>Promise.resolve(this.client.session.get(A))}}),M(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:i,reason:s}=r;let n;try{n=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}n&&await this.sendError({id:i,topic:n,error:s,rpcOpts:$e.wc_sessionPropose.reject}),await this.deleteProposal(i)}),M(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(f){throw this.client.logger.error("update() -> isValidUpdate() failed"),f}const{topic:i,namespaces:s}=r,{done:n,resolve:o,reject:a}=Dr(),c=Tt(),l=wr().toString(),u=this.client.session.get(i).namespaces;return this.events.once(re("session_update",c),({error:f})=>{f?a(f):o()}),await this.client.session.update(i,{namespaces:s}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(f=>{this.client.logger.error(f),this.client.session.update(i,{namespaces:u}),a(f)}),{acknowledged:n}}),M(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=r,s=Tt(),{done:n,resolve:o,reject:a}=Dr();return this.events.once(re("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,pe(Xr)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),M(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}const{chainId:i,request:s,topic:n,expiry:o=$e.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(n);a?.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const c=Tt(),l=wr().toString(),{done:u,resolve:f,reject:h}=Dr(o,"Request expired. Please try again.");this.events.once(re("session_request",c),({error:m,result:E})=>{m?h(m):f(E)});const p="wc_sessionRequest",d=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(d)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:n,method:p,params:{request:Ue(ie({},s),{expiryTimestamp:pe(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:d}).catch(m=>h(m)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),await u();const g={request:Ue(ie({},s),{expiryTimestamp:pe(o)}),chainId:i};return await Promise.all([new Promise(async m=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:n,method:p,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(E=>h(E)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),m()}),new Promise(async m=>{var E;if(!((E=a.sessionConfig)!=null&&E.disableDeepLink)){const S=await Ov(this.client.core.storage,ah);await xv({id:c,topic:n,wcDeepLink:S})}m()}),u()]).then(m=>m[2])}),M(this,"respond",async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:s}=r,{id:n}=s,o=this.client.session.get(i);o.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);Ct(s)?await this.sendResult({id:n,topic:i,result:s.result,throwOnFailedPublish:!0,appLink:a}):dt(s)&&await this.sendError({id:n,topic:i,error:s.error,appLink:a}),this.cleanupAfterResponse(r)}),M(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:i}=r;if(this.client.session.keys.includes(i)){const s=Tt(),n=wr().toString(),{done:o,resolve:a,reject:c}=Dr();this.events.once(re("session_ping",s),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),M(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:i,event:s,chainId:n}=r,o=wr().toString(),a=Tt();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:s,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),M(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:ce("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:s}=z("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(s)}}),M(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(i=>q_(i,r)))),M(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),M(this,"authenticate",async(r,i)=>{var s;this.isInitialized(),this.isValidAuthenticate(r);const n=i&&this.client.core.linkModeSupportedApps.includes(i)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=n?ae.link_mode:ae.relay;o===ae.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:f,type:h,exp:p,nbf:d,methods:g=[],expiry:m}=r,E=[...r.resources||[]],{topic:S,uri:b}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:S,uri:b}});const x=await this.client.core.crypto.generateKeyPair(),A=Ts(x);if(await Promise.all([this.client.auth.authKeys.set(Ns,{responseTopic:A,publicKey:x}),this.client.auth.pairingTopics.set(A,{topic:A,pairingTopic:S})]),await this.client.core.relayer.subscribe(A,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${S}`),g.length>0){const{namespace:I}=Xt(a[0]);let O=zE(I,"request",g);Ps(E)&&(O=VE(O,E.pop())),E.push(O)}const v=m&&m>$e.wc_sessionAuthenticate.req.ttl?m:$e.wc_sessionAuthenticate.req.ttl,C={authPayload:{type:h??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:f,iat:new Date().toISOString(),exp:p,nbf:d,resources:E},requester:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:pe(v)},R={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},T={requiredNamespaces:{},optionalNamespaces:R,relays:[{protocol:"irn"}],pairingTopic:S,proposer:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:pe($e.wc_sessionPropose.req.ttl),id:Tt()},{done:k,resolve:N,reject:B}=Dr(v,"Request expired"),$=Tt(),D=re("session_connect",T.id),y=re("session_request",$),w=async({error:I,session:O})=>{this.events.off(y,_),I?B(I):O&&N({session:O})},_=async I=>{var O,U,j;if(await this.deletePendingAuthRequest($,{message:"fulfilled",code:0}),I.error){const W=ce("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return I.error.code===W.code?void 0:(this.events.off(D,w),B(I.error.message))}await this.deleteProposal(T.id),this.events.off(D,w);const{cacaos:V,responder:L}=I.result,q=[],H=[];for(const W of V){await kl({cacao:W,projectId:this.client.core.projectId})||(this.client.logger.error(W,"Signature verification failed"),B(ce("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:J}=W,ue=Ps(J.resources),ye=[Zo(J.iss)],ve=Vs(J.iss);if(ue){const je=jl(ue),St=Ml(ue);q.push(...je),ye.push(...St)}for(const je of ye)H.push(`${je}:${ve}`)}const G=await this.client.core.crypto.generateSharedKey(x,L.publicKey);let Z;q.length>0&&(Z={topic:G,acknowledged:!0,self:{publicKey:x,metadata:this.client.metadata},peer:L,controller:L.publicKey,expiry:pe(Xr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:S,namespaces:hu([...new Set(q)],[...new Set(H)]),transportType:o},await this.client.core.relayer.subscribe(G,{transportType:o}),await this.client.session.set(G,Z),S&&await this.client.core.pairing.updateMetadata({topic:S,metadata:L.metadata}),Z=this.client.session.get(G)),(O=this.client.metadata.redirect)!=null&&O.linkMode&&(U=L.metadata.redirect)!=null&&U.linkMode&&(j=L.metadata.redirect)!=null&&j.universal&&i&&(this.client.core.addLinkModeSupportedApp(L.metadata.redirect.universal),this.client.session.update(G,{transportType:ae.link_mode})),N({auths:V,session:Z})};this.events.once(D,w),this.events.once(y,_);let P;try{if(n){const I=_t("wc_sessionAuthenticate",C,$);this.client.core.history.set(S,I);const O=await this.client.core.crypto.encode("",I,{type:is,encoding:yr});P=Es(i,S,O)}else await Promise.all([this.sendRequest({topic:S,method:"wc_sessionAuthenticate",params:C,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:$}),this.sendRequest({topic:S,method:"wc_sessionPropose",params:T,expiry:$e.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:T.id})])}catch(I){throw this.events.off(D,w),this.events.off(y,_),I}return await this.setProposal(T.id,T),await this.setAuthRequest($,{request:Ue(ie({},C),{verifyContext:{}}),pairingTopic:S,transportType:o}),{uri:P??b,response:k}}),M(this,"approveSessionAuthenticate",async r=>{const{id:i,auths:s}=r,n=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[Sr.authenticated_session_approve_started]}});try{this.isInitialized()}catch(m){throw n.setError(Oi.no_internet_connection),m}const o=this.getPendingAuthRequest(i);if(!o)throw n.setError(Oi.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const a=o.transportType||ae.relay;a===ae.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=Ts(c),f={type:Qt,receiverPublicKey:c,senderPublicKey:l},h=[],p=[];for(const m of s){if(!await kl({cacao:m,projectId:this.client.core.projectId})){n.setError(Oi.invalid_cacao);const A=ce("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:u,error:A,encodeOpts:f}),new Error(A.message)}n.addTrace(Sr.cacaos_verified);const{p:E}=m,S=Ps(E.resources),b=[Zo(E.iss)],x=Vs(E.iss);if(S){const A=jl(S),v=Ml(S);h.push(...A),b.push(...v)}for(const A of b)p.push(`${A}:${x}`)}const d=await this.client.core.crypto.generateSharedKey(l,c);n.addTrace(Sr.create_authenticated_session_topic);let g;if(h?.length>0){g={topic:d,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:pe(Xr),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:hu([...new Set(h)],[...new Set(p)]),transportType:a},n.addTrace(Sr.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(d,{transportType:a})}catch(m){throw n.setError(Oi.subscribe_authenticated_session_topic_failure),m}n.addTrace(Sr.subscribe_authenticated_session_topic_success),await this.client.session.set(d,g),n.addTrace(Sr.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(Sr.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:i,result:{cacaos:s,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:f,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(m){throw n.setError(Oi.authenticated_session_approve_publish_failure),m}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:g}}),M(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:i,reason:s}=r,n=this.getPendingAuthRequest(i);if(!n)throw new Error(`Could not find pending auth request with id ${i}`);n.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Ts(o),l={type:Qt,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:s,encodeOpts:l,rpcOpts:$e.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.deleteProposal(i)}),M(this,"formatAuthMessage",r=>{this.isInitialized();const{request:i,iss:s}=r;return Sd(i,s)}),M(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),M(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&n.topic&&n.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),M(this,"deleteSession",async r=>{var i;const{topic:s,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,ce("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),n||this.client.core.expirer.del(s),this.client.core.storage.removeItem(ah).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===s&&this.deletePendingSessionRequest(l.id,ce("USER_DISCONNECTED"))}),s===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=At.idle),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),M(this,"deleteProposal",async(r,i)=>{if(i)try{const s=this.client.proposal.get(r);this.client.core.eventClient.getEvent({topic:s.pairingTopic})?.setError(Si.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,ce("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),M(this,"deletePendingSessionRequest",async(r,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==r),s&&(this.sessionRequestQueue.state=At.idle,this.client.events.emit("session_request_expire",{id:r}))}),M(this,"deletePendingAuthRequest",async(r,i,s=!1)=>{await Promise.all([this.client.auth.requests.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)])}),M(this,"setExpiry",async(r,i)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,i),await this.client.session.update(r,{expiry:i}))}),M(this,"setProposal",async(r,i)=>{this.client.core.expirer.set(r,pe($e.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,i)}),M(this,"setAuthRequest",async(r,i)=>{const{request:s,pairingTopic:n,transportType:o=ae.relay}=i;this.client.core.expirer.set(r,s.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:r,pairingTopic:n,verifyContext:s.verifyContext,transportType:o})}),M(this,"setPendingSessionRequest",async r=>{const{id:i,topic:s,params:n,verifyContext:o}=r,a=n.request.expiryTimestamp||pe($e.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:s,params:n,verifyContext:o})}),M(this,"sendRequest",async r=>{const{topic:i,method:s,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:f,publishOpts:h={}}=r,p=_t(s,n,c);let d;const g=!!u;try{const S=g?yr:Ye;d=await this.client.core.crypto.encode(i,p,{encoding:S})}catch(S){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),S}let m;if(mD.includes(s)){const S=ft(JSON.stringify(p)),b=ft(d);m=await this.client.core.verify.register({id:b,decryptedId:S})}const E=ie(ie({},$e[s].req),h);if(E.attestation=m,o&&(E.ttl=o),a&&(E.id=a),this.client.core.history.set(i,p),g){const S=Es(u,i,d);await globalThis.Linking.openURL(S,this.client.name)}else E.tvf=Ue(ie({},f),{correlationId:p.id}),l?(E.internal=Ue(ie({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,d,E)):this.client.core.relayer.publish(i,d,E).catch(S=>this.client.logger.error(S));return p.id}),M(this,"sendProposeSession",async r=>{const{proposal:i,publishOpts:s}=r,n=_t("wc_sessionPropose",i,i.id);this.client.core.history.set(i.pairingTopic,n);const o=await this.client.core.crypto.encode(i.pairingTopic,n,{encoding:Ye}),a=ft(JSON.stringify(n)),c=ft(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:i.pairingTopic,sessionProposal:o},opts:Ue(ie({},s),{publishMethod:"wc_proposeSession",attestation:l})})}),M(this,"sendApproveSession",async r=>{const{sessionTopic:i,pairingProposalResponse:s,proposal:n,sessionSettleRequest:o,publishOpts:a}=r,c=Wi(n.id,s),l=await this.client.core.crypto.encode(n.pairingTopic,c,{encoding:Ye}),u=_t("wc_sessionSettle",o,a?.id),f=await this.client.core.crypto.encode(i,u,{encoding:Ye});this.client.core.history.set(i,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:i,pairingTopic:n.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:f},opts:Ue(ie({},a),{publishMethod:"wc_approveSession"})})}),M(this,"sendResult",async r=>{const{id:i,topic:s,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,l=Wi(i,n);let u;const f=c&&typeof globalThis?.Linking<"u";try{const d=f?yr:Ye;u=await this.client.core.crypto.encode(s,l,Ue(ie({},a||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),d}let h,p;try{h=await this.client.core.history.get(s,i);const d=h.request;try{p=this.getTVFParams(i,d.params,n)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g?.message}`)}}catch(d){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${i}) failed`),d}if(f){const d=Es(c,s,u);await globalThis.Linking.openURL(d,this.client.name)}else{const d=h.request.method,g=$e[d].res;g.tvf=Ue(ie({},p),{correlationId:i}),o?(g.internal=Ue(ie({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,u,g)):this.client.core.relayer.publish(s,u,g).catch(m=>this.client.logger.error(m))}await this.client.core.history.resolve(l)}),M(this,"sendError",async r=>{const{id:i,topic:s,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=r,l=bn(i,n);let u;const f=c&&typeof globalThis?.Linking<"u";try{const p=f?yr:Ye;u=await this.client.core.crypto.encode(s,l,Ue(ie({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),p}let h;try{h=await this.client.core.history.get(s,i)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${s}, ${i}) failed`),p}if(f){const p=Es(c,s,u);await globalThis.Linking.openURL(p,this.client.name)}else{const p=h.request.method,d=a||$e[p].res;this.client.core.relayer.publish(s,u,d)}await this.client.core.history.resolve(l)}),M(this,"cleanup",async()=>{const r=[],i=[];this.client.session.getAll().forEach(s=>{let n=!1;Bt(s.expiry)&&(n=!0),this.client.core.crypto.keychain.has(s.topic)||(n=!0),n&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Bt(s.expiryTimestamp)&&i.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession({topic:s})),...i.map(s=>this.deleteProposal(s))])}),M(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),M(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),M(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===At.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=At.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=At.idle}),M(this,"processRequest",async r=>{const{topic:i,payload:s,attestation:n,transportType:o,encryptedId:a}=r,c=s.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:s,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,s);case"wc_sessionPing":return await this.onSessionPingRequest(i,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),M(this,"onRelayEventResponse",async r=>{const{topic:i,payload:s,transportType:n}=r,o=(await this.client.core.history.get(i,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),M(this,"onRelayEventUnknownPayload",r=>{const{topic:i}=r,{message:s}=z("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),M(this,"shouldIgnorePairingRequest",r=>{const{topic:i,requestMethod:s}=r,n=this.expectedPairingMethodMap.get(i);return!n||n.includes(s)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),M(this,"onSessionProposeRequest",async r=>{const{topic:i,payload:s,attestation:n,encryptedId:o}=r,{params:a,id:c}=s;try{const l=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l?.setError(Ht.proposal_listener_not_found)),this.isValidConnect(ie({},s.params));const u=a.expiryTimestamp||pe($e.wc_sessionPropose.req.ttl),f=ie({id:c,pairingTopic:i,expiryTimestamp:u,attestation:n,encryptedId:o},a);await this.setProposal(c,f);const h=await this.getVerifyContext({attestationId:n,hash:ft(JSON.stringify(s)),encryptedId:o,metadata:f.proposer.metadata});l?.addTrace(Pt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:f,verifyContext:h})}catch(l){await this.sendError({id:c,topic:i,error:l,rpcOpts:$e.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),M(this,"onSessionProposeResponse",async(r,i,s)=>{const{id:n}=i;if(Ct(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(n,{sessionTopic:u,pairingTopic:r,proposalId:n,publicKey:c});const f=await this.client.core.relayer.subscribe(u,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:f}),await this.client.core.pairing.activate({topic:r})}else if(dt(i)){await this.deleteProposal(n);const o=re("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),M(this,"onSessionSettleRequest",async(r,i)=>{const{id:s,params:n}=i;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:f,sessionConfig:h}=i.params,p=[...this.pendingSessions.values()].find(m=>m.sessionTopic===r);if(!p)return this.client.logger.error(`Pending session not found for topic ${r}`);const d=this.client.proposal.get(p.proposalId),g=Ue(ie(ie(ie({topic:r,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:p.pairingTopic,requiredNamespaces:d.requiredNamespaces,optionalNamespaces:d.optionalNamespaces,controller:a.publicKey,self:{publicKey:p.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),f&&{scopedProperties:f}),h&&{sessionConfig:h}),{transportType:ae.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:p.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(re("session_connect",p.proposalId),{session:g}),this.pendingSessions.delete(p.proposalId),this.deleteProposal(p.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:i.id,topic:r,result:!0})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),M(this,"onSessionSettleResponse",async(r,i)=>{const{id:s}=i;Ct(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(re("session_approve",s),{})):dt(i)&&(await this.client.session.delete(r,ce("USER_DISCONNECTED")),this.events.emit(re("session_approve",s),{error:i.error}))}),M(this,"onSessionUpdateRequest",async(r,i)=>{const{params:s,id:n}=i;try{const o=`${r}_session_update`,a=xi.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:r,error:ce("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ie({topic:r},s));try{xi.set(o,n),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:r,result:!0})}catch(c){throw xi.delete(o),c}this.client.events.emit("session_update",{id:n,topic:r,params:s})}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),M(this,"isRequestOutOfSync",(r,i)=>i.toString().slice(0,-3)<r.toString().slice(0,-3)),M(this,"onSessionUpdateResponse",(r,i)=>{const{id:s}=i,n=re("session_update",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Ct(i)?this.events.emit(re("session_update",s),{}):dt(i)&&this.events.emit(re("session_update",s),{error:i.error})}),M(this,"onSessionExtendRequest",async(r,i)=>{const{id:s}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,pe(Xr)),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_extend",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}}),M(this,"onSessionExtendResponse",(r,i)=>{const{id:s}=i,n=re("session_extend",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Ct(i)?this.events.emit(re("session_extend",s),{}):dt(i)&&this.events.emit(re("session_extend",s),{error:i.error})}),M(this,"onSessionPingRequest",async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}}),M(this,"onSessionPingResponse",(r,i)=>{const{id:s}=i,n=re("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);Ct(i)?this.events.emit(re("session_ping",s),{}):dt(i)&&this.events.emit(re("session_ping",s),{error:i.error})},500)}),M(this,"onSessionDeleteRequest",async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await Promise.all([new Promise(n=>{this.client.core.relayer.once(he.publish,async()=>{n(await this.deleteSession({topic:r,id:s}))})}),this.sendResult({id:s,topic:r,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:ce("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),M(this,"onSessionRequest",async r=>{var i,s,n;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=r,{id:f,params:h}=a;try{await this.isValidRequest(ie({topic:o},h));const p=this.client.session.get(o),d=await this.getVerifyContext({attestationId:c,hash:ft(JSON.stringify(_t("wc_sessionRequest",h,f))),encryptedId:l,metadata:p.peer.metadata,transportType:u}),g={id:f,topic:o,params:h,verifyContext:d};await this.setPendingSessionRequest(g),u===ae.link_mode&&(i=p.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((s=p.peer.metadata.redirect)==null?void 0:s.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(p){await this.sendError({id:f,topic:o,error:p}),this.client.logger.error(p)}}),M(this,"onSessionRequestResponse",(r,i)=>{const{id:s}=i,n=re("session_request",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Ct(i)?this.events.emit(re("session_request",s),{result:i.result}):dt(i)&&this.events.emit(re("session_request",s),{error:i.error})}),M(this,"onSessionEventRequest",async(r,i)=>{const{id:s,params:n}=i;try{const o=`${r}_session_event_${n.event.name}`,a=xi.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(ie({topic:r},n)),this.client.events.emit("session_event",{id:s,topic:r,params:n}),xi.set(o,s)}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),M(this,"onSessionAuthenticateResponse",(r,i)=>{const{id:s}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:i}),Ct(i)?this.events.emit(re("session_request",s),{result:i.result}):dt(i)&&this.events.emit(re("session_request",s),{error:i.error})}),M(this,"onSessionAuthenticateRequest",async r=>{var i;const{topic:s,payload:n,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:l,authPayload:u,expiryTimestamp:f}=n.params,h=await this.getVerifyContext({attestationId:o,hash:ft(JSON.stringify(n)),encryptedId:a,metadata:l.metadata,transportType:c}),p={requester:l,pairingTopic:s,id:n.id,authPayload:u,verifyContext:h,expiryTimestamp:f};await this.setAuthRequest(n.id,{request:p,pairingTopic:s,transportType:c}),c===ae.link_mode&&(i=l.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:n.params,id:n.id,verifyContext:h})}catch(l){this.client.logger.error(l);const u=n.params.requester.publicKey,f=await this.client.core.crypto.generateKeyPair(),h=this.getAppLinkIfEnabled(n.params.requester.metadata,c),p={type:Qt,receiverPublicKey:u,senderPublicKey:f};await this.sendError({id:n.id,topic:s,error:l,encodeOpts:p,rpcOpts:$e.wc_sessionAuthenticate.autoReject,appLink:h})}}),M(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),M(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=At.idle,this.processSessionRequestQueue()},F.toMiliseconds(this.requestQueueDelay))}),M(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:i})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(n=>n.topic===r&&n.request.method==="wc_sessionRequest").forEach(n=>{const o=n.request.id,a=re("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(re("session_request",n.request.id),{error:i})})}),M(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===At.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(i){this.client.logger.error(i)}}),M(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=At.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),M(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const i=this.client.proposal.getAll().find(s=>s.pairingTopic===r.topic);i&&this.onSessionProposeRequest({topic:r.topic,payload:_t("wc_sessionPropose",Ue(ie({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id),attestation:i.attestation,encryptedId:i.encryptedId})}),M(this,"isValidConnect",async r=>{if(!He(r)){const{message:l}=z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(l)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=r;if(be(i)||await this.isValidPairingTopic(i),!Q_(c)){const{message:l}=z("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(!be(s)&&Ut(s)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(s,"requiredNamespaces")}if(!be(n)&&Ut(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),be(o)||this.validateSessionProps(o,"sessionProperties"),!be(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(s||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),M(this,"validateNamespaces",(r,i)=>{const s=X_(r,"connect()",i);if(s)throw new Error(s.message)}),M(this,"isValidApprove",async r=>{if(!He(r))throw new Error(z("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:s,relayProtocol:n,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),l=ho(s,"approve()");if(l)throw new Error(l.message);const u=pu(c.requiredNamespaces,s,"approve()");if(u)throw new Error(u.message);if(!ge(n,!0)){const{message:f}=z("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(f)}if(be(o)||this.validateSessionProps(o,"sessionProperties"),!be(a)){this.validateSessionProps(a,"scopedProperties");const f=new Set(Object.keys(s));if(!Object.keys(a).every(h=>f.has(h.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(f).join(", ")}`)}}),M(this,"isValidReject",async r=>{if(!He(r)){const{message:n}=z("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(n)}const{id:i,reason:s}=r;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!tx(s)){const{message:n}=z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}}),M(this,"isValidSessionSettleRequest",r=>{if(!He(r)){const{message:l}=z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:i,controller:s,namespaces:n,expiry:o}=r;if(!cp(i)){const{message:l}=z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=H_(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=ho(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Bt(o)){const{message:l}=z("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),M(this,"isValidUpdate",async r=>{if(!He(r)){const{message:c}=z("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:i,namespaces:s}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const n=this.client.session.get(i),o=ho(s,"update()");if(o)throw new Error(o.message);const a=pu(n.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),M(this,"isValidExtend",async r=>{if(!He(r)){const{message:s}=z("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:i}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),M(this,"isValidRequest",async r=>{if(!He(r)){const{message:c}=z("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:i,request:s,chainId:n,expiry:o}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!du(a,n)){const{message:c}=z("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!rx(s)){const{message:c}=z("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!nx(a,n,s.method)){const{message:c}=z("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(o&&!lx(o,xo)){const{message:c}=z("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${xo.min} and ${xo.max}`);throw new Error(c)}}),M(this,"isValidRespond",async r=>{var i;if(!He(r)){const{message:o}=z("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(o)}const{topic:s,response:n}=r;try{await this.isValidSessionTopic(s)}catch(o){throw(i=r?.response)!=null&&i.id&&this.cleanupAfterResponse(r),o}if(!ix(n)){const{message:o}=z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}}),M(this,"isValidPing",async r=>{if(!He(r)){const{message:s}=z("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),M(this,"isValidEmit",async r=>{if(!He(r)){const{message:a}=z("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:i,event:s,chainId:n}=r;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!du(o,n)){const{message:a}=z("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!sx(s)){const{message:a}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!ox(o,n,s.name)){const{message:a}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),M(this,"isValidDisconnect",async r=>{if(!He(r)){const{message:s}=z("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),M(this,"isValidAuthenticate",r=>{const{chains:i,uri:s,domain:n,nonce:o}=r;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!ge(s,!1))throw new Error("uri is required parameter");if(!ge(n,!1))throw new Error("domain is required parameter");if(!ge(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>Xt(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Xt(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),M(this,"getVerifyContext",async r=>{const{attestationId:i,hash:s,encryptedId:n,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||ji,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ae.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:i,hash:s,encryptedId:n,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),M(this,"validateSessionProps",(r,i)=>{Object.values(r).forEach((s,n)=>{if(s==null){const{message:o}=z("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${s} for key ${Object.keys(r)[n]}`);throw new Error(o)}})}),M(this,"getPendingAuthRequest",r=>{const i=this.client.auth.requests.get(r);return typeof i=="object"?i:void 0}),M(this,"addToRecentlyDeleted",(r,i)=>{if(this.recentlyDeletedMap.set(r,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=n)break;this.recentlyDeletedMap.delete(o)}}}),M(this,"checkRecentlyDeleted",r=>{const i=this.recentlyDeletedMap.get(r);if(i){const{message:s}=z("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${r}`);throw new Error(s)}}),M(this,"isLinkModeEnabled",(r,i)=>{var s,n,o,a,c,l,u,f,h;return!r||i!==ae.link_mode?!1:((n=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=r?.redirect)==null?void 0:u.universal)!==void 0&&((f=r?.redirect)==null?void 0:f.universal)!==""&&((h=r?.redirect)==null?void 0:h.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof globalThis?.Linking<"u"}),M(this,"getAppLinkIfEnabled",(r,i)=>{var s;return this.isLinkModeEnabled(r,i)?(s=r?.redirect)==null?void 0:s.universal:void 0}),M(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const i=Sl(r,"topic")||"",s=decodeURIComponent(Sl(r,"wc_ev")||""),n=this.client.session.keys.includes(i);n&&this.client.session.update(i,{transportType:ae.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:n})}),M(this,"registerLinkModeListeners",async()=>{var r;if(Va()||Er()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const i=globalThis?.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await i.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),M(this,"getTVFParams",(r,i,s)=>{var n,o,a;if(!((n=i.request)!=null&&n.method))return{};const c={correlationId:r,rpcMethods:[i.request.method],chainId:i.chainId};try{const l=this.extractTxHashesFromResult(i.request,s);c.txHashes=l,c.contractAddresses=this.isValidContractData(i.request.params)?[(a=(o=i.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn("Error getting TVF params",l)}return c}),M(this,"isValidContractData",r=>{var i;if(!r)return!1;try{const s=r?.data||((i=r?.[0])==null?void 0:i.data);if(!s.startsWith("0x"))return!1;const n=s.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),M(this,"extractTxHashesFromResult",(r,i)=>{var s;try{if(!i)return[];const n=r.method,o=yD[n];if(n==="sui_signTransaction")return[SE(i.transactionBytes)];if(n==="near_signTransaction")return[Bl(i)];if(n==="near_signTransactions")return i.map(c=>Bl(c));if(n==="xrpl_signTransactionFor"||n==="xrpl_signTransaction")return[(s=i.tx_json)==null?void 0:s.hash];if(n==="polkadot_signTransaction")return[Ix({transaction:r.params.transactionPayload,signature:i.signature})];if(n==="algo_signTxn")return gt(i)?i.map(c=>Rl(c)):[Rl(i)];if(n==="cosmos_signDirect")return[DE(i)];if(n==="wallet_sendCalls")return $E(i);if(typeof i=="string")return[i];const a=i[o.key];if(gt(a))return n==="solana_signAllTransactions"?a.map(c=>IE(c)):a;if(typeof a=="string")return[a]}catch(n){this.client.logger.warn("Error extracting tx hashes from result",n)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,s]of Object.entries(r))for(const n of s)try{await this.onProviderMessageEvent({topic:i,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(he.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:i,attestation:s,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Ns)?this.client.auth.authKeys.get(Ns):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,i,{receiverPublicKey:o,encoding:n===ae.link_mode?yr:Ye});sc(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:s,transportType:n,encryptedId:ft(i)})):vn(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:n}),this.client.core.history.delete(r,a.id)):await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(r,i)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(ut.expired,async e=>{const{topic:r,id:i}=ld(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,z("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,z("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(Pr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Pr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ge(e,!1)){const{message:r}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Bt(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=z("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!ge(e,!1)){const{message:r}=z("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Bt(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=z("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=z("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ge(e,!1)){const{message:r}=z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!ex(e)){const{message:r}=z("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Bt(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=z("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class PD extends Kr{constructor(e,r){super(e,r,dD,oc),this.core=e,this.logger=r}}let TD=class extends Kr{constructor(e,r){super(e,r,pD,oc),this.core=e,this.logger=r}};class CD extends Kr{constructor(e,r){super(e,r,wD,oc,i=>i.id),this.core=e,this.logger=r}}class BD extends Kr{constructor(e,r){super(e,r,ED,_n,()=>Ns),this.core=e,this.logger=r}}class RD extends Kr{constructor(e,r){super(e,r,_D,_n),this.core=e,this.logger=r}}class ND extends Kr{constructor(e,r){super(e,r,xD,_n,i=>i.id),this.core=e,this.logger=r}}var UD=Object.defineProperty,kD=(t,e,r)=>e in t?UD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Io=(t,e,r)=>kD(t,typeof e!="symbol"?e+"":e,r);class jD{constructor(e,r){this.core=e,this.logger=r,Io(this,"authKeys"),Io(this,"pairingTopics"),Io(this,"requests"),this.authKeys=new BD(this.core,this.logger),this.pairingTopics=new RD(this.core,this.logger),this.requests=new ND(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var MD=Object.defineProperty,LD=(t,e,r)=>e in t?MD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Q=(t,e,r)=>LD(t,typeof e!="symbol"?e+"":e,r);let qD=class jp extends kI{constructor(e){super(e),Q(this,"protocol",Np),Q(this,"version",Up),Q(this,"name",_o.name),Q(this,"metadata"),Q(this,"core"),Q(this,"logger"),Q(this,"events",new wt.EventEmitter),Q(this,"engine"),Q(this,"session"),Q(this,"proposal"),Q(this,"pendingRequest"),Q(this,"auth"),Q(this,"signConfig"),Q(this,"on",(i,s)=>this.events.on(i,s)),Q(this,"once",(i,s)=>this.events.once(i,s)),Q(this,"off",(i,s)=>this.events.off(i,s)),Q(this,"removeListener",(i,s)=>this.events.removeListener(i,s)),Q(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),Q(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"update",async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"request",async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"find",i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),Q(this,"authenticate",async(i,s)=>{try{return await this.engine.authenticate(i,s)}catch(n){throw this.logger.error(n.message),n}}),Q(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),this.name=e?.name||_o.name,this.metadata=wv(e?.metadata),this.signConfig=e?.signConfig;const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:ns(mn({level:e?.logger||_o.logger}));this.core=e?.core||new fD(e),this.logger=ze(r,this.name),this.session=new TD(this.core,this.logger),this.proposal=new PD(this.core,this.logger),this.pendingRequest=new CD(this.core,this.logger),this.engine=new AD(this),this.auth=new jD(this.core,this.logger)}static async init(e){const r=new jp(e);return await r.initialize(),r}get context(){return Qe(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var xs={exports:{}},uh;function zD(){return uh||(uh=1,(function(t,e){var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof globalThis<"u"&&globalThis,i=(function(){function n(){this.fetch=!1,this.DOMException=r.DOMException}return n.prototype=r,new n})();(function(n){(function(o){var a=typeof n<"u"&&n||typeof self<"u"&&self||typeof n<"u"&&n||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function l(y){return y&&DataView.prototype.isPrototypeOf(y)}if(c.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],f=ArrayBuffer.isView||function(y){return y&&u.indexOf(Object.prototype.toString.call(y))>-1};function h(y){if(typeof y!="string"&&(y=String(y)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(y)||y==="")throw new TypeError('Invalid character in header field name: "'+y+'"');return y.toLowerCase()}function p(y){return typeof y!="string"&&(y=String(y)),y}function d(y){var w={next:function(){var _=y.shift();return{done:_===void 0,value:_}}};return c.iterable&&(w[Symbol.iterator]=function(){return w}),w}function g(y){this.map={},y instanceof g?y.forEach(function(w,_){this.append(_,w)},this):Array.isArray(y)?y.forEach(function(w){if(w.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+w.length);this.append(w[0],w[1])},this):y&&Object.getOwnPropertyNames(y).forEach(function(w){this.append(w,y[w])},this)}g.prototype.append=function(y,w){y=h(y),w=p(w);var _=this.map[y];this.map[y]=_?_+", "+w:w},g.prototype.delete=function(y){delete this.map[h(y)]},g.prototype.get=function(y){return y=h(y),this.has(y)?this.map[y]:null},g.prototype.has=function(y){return this.map.hasOwnProperty(h(y))},g.prototype.set=function(y,w){this.map[h(y)]=p(w)},g.prototype.forEach=function(y,w){for(var _ in this.map)this.map.hasOwnProperty(_)&&y.call(w,this.map[_],_,this)},g.prototype.keys=function(){var y=[];return this.forEach(function(w,_){y.push(_)}),d(y)},g.prototype.values=function(){var y=[];return this.forEach(function(w){y.push(w)}),d(y)},g.prototype.entries=function(){var y=[];return this.forEach(function(w,_){y.push([_,w])}),d(y)},c.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function m(y){if(!y._noBody){if(y.bodyUsed)return Promise.reject(new TypeError("Already read"));y.bodyUsed=!0}}function E(y){return new Promise(function(w,_){y.onload=function(){w(y.result)},y.onerror=function(){_(y.error)}})}function S(y){var w=new FileReader,_=E(w);return w.readAsArrayBuffer(y),_}function b(y){var w=new FileReader,_=E(w),P=/charset=([A-Za-z0-9_-]+)/.exec(y.type),I=P?P[1]:"utf-8";return w.readAsText(y,I),_}function x(y){for(var w=new Uint8Array(y),_=new Array(w.length),P=0;P<w.length;P++)_[P]=String.fromCharCode(w[P]);return _.join("")}function A(y){if(y.slice)return y.slice(0);var w=new Uint8Array(y.byteLength);return w.set(new Uint8Array(y)),w.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(y){this.bodyUsed=this.bodyUsed,this._bodyInit=y,y?typeof y=="string"?this._bodyText=y:c.blob&&Blob.prototype.isPrototypeOf(y)?this._bodyBlob=y:c.formData&&FormData.prototype.isPrototypeOf(y)?this._bodyFormData=y:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)?this._bodyText=y.toString():c.arrayBuffer&&c.blob&&l(y)?(this._bodyArrayBuffer=A(y.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(y)||f(y))?this._bodyArrayBuffer=A(y):this._bodyText=y=Object.prototype.toString.call(y):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof y=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var y=m(this);if(y)return y;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var y=m(this);return y||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(S);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var y=m(this);if(y)return y;if(this._bodyBlob)return b(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(x(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(k)}),this.json=function(){return this.text().then(JSON.parse)},this}var C=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function R(y){var w=y.toUpperCase();return C.indexOf(w)>-1?w:y}function T(y,w){if(!(this instanceof T))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');w=w||{};var _=w.body;if(y instanceof T){if(y.bodyUsed)throw new TypeError("Already read");this.url=y.url,this.credentials=y.credentials,w.headers||(this.headers=new g(y.headers)),this.method=y.method,this.mode=y.mode,this.signal=y.signal,!_&&y._bodyInit!=null&&(_=y._bodyInit,y.bodyUsed=!0)}else this.url=String(y);if(this.credentials=w.credentials||this.credentials||"same-origin",(w.headers||!this.headers)&&(this.headers=new g(w.headers)),this.method=R(w.method||this.method||"GET"),this.mode=w.mode||this.mode||null,this.signal=w.signal||this.signal||(function(){if("AbortController"in a){var O=new AbortController;return O.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&_)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(_),(this.method==="GET"||this.method==="HEAD")&&(w.cache==="no-store"||w.cache==="no-cache")){var P=/([?&])_=[^&]*/;if(P.test(this.url))this.url=this.url.replace(P,"$1_="+new Date().getTime());else{var I=/\?/;this.url+=(I.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}T.prototype.clone=function(){return new T(this,{body:this._bodyInit})};function k(y){var w=new FormData;return y.trim().split("&").forEach(function(_){if(_){var P=_.split("="),I=P.shift().replace(/\+/g," "),O=P.join("=").replace(/\+/g," ");w.append(decodeURIComponent(I),decodeURIComponent(O))}}),w}function N(y){var w=new g,_=y.replace(/\r?\n[\t ]+/g," ");return _.split("\r").map(function(P){return P.indexOf(`
`)===0?P.substr(1,P.length):P}).forEach(function(P){var I=P.split(":"),O=I.shift().trim();if(O){var U=I.join(":").trim();try{w.append(O,U)}catch(j){console.warn("Response "+j.message)}}}),w}v.call(T.prototype);function B(y,w){if(!(this instanceof B))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(w||(w={}),this.type="default",this.status=w.status===void 0?200:w.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=w.statusText===void 0?"":""+w.statusText,this.headers=new g(w.headers),this.url=w.url||"",this._initBody(y)}v.call(B.prototype),B.prototype.clone=function(){return new B(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},B.error=function(){var y=new B(null,{status:200,statusText:""});return y.ok=!1,y.status=0,y.type="error",y};var $=[301,302,303,307,308];B.redirect=function(y,w){if($.indexOf(w)===-1)throw new RangeError("Invalid status code");return new B(null,{status:w,headers:{location:y}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(w,_){this.message=w,this.name=_;var P=Error(w);this.stack=P.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function D(y,w){return new Promise(function(_,P){var I=new T(y,w);if(I.signal&&I.signal.aborted)return P(new o.DOMException("Aborted","AbortError"));var O=new XMLHttpRequest;function U(){O.abort()}O.onload=function(){var L={statusText:O.statusText,headers:N(O.getAllResponseHeaders()||"")};I.url.indexOf("file://")===0&&(O.status<200||O.status>599)?L.status=200:L.status=O.status,L.url="responseURL"in O?O.responseURL:L.headers.get("X-Request-URL");var q="response"in O?O.response:O.responseText;setTimeout(function(){_(new B(q,L))},0)},O.onerror=function(){setTimeout(function(){P(new TypeError("Network request failed"))},0)},O.ontimeout=function(){setTimeout(function(){P(new TypeError("Network request timed out"))},0)},O.onabort=function(){setTimeout(function(){P(new o.DOMException("Aborted","AbortError"))},0)};function j(L){try{return L===""&&a.location.href?a.location.href:L}catch{return L}}if(O.open(I.method,j(I.url),!0),I.credentials==="include"?O.withCredentials=!0:I.credentials==="omit"&&(O.withCredentials=!1),"responseType"in O&&(c.blob?O.responseType="blob":c.arrayBuffer&&(O.responseType="arraybuffer")),w&&typeof w.headers=="object"&&!(w.headers instanceof g||a.Headers&&w.headers instanceof a.Headers)){var V=[];Object.getOwnPropertyNames(w.headers).forEach(function(L){V.push(h(L)),O.setRequestHeader(L,p(w.headers[L]))}),I.headers.forEach(function(L,q){V.indexOf(q)===-1&&O.setRequestHeader(q,L)})}else I.headers.forEach(function(L,q){O.setRequestHeader(q,L)});I.signal&&(I.signal.addEventListener("abort",U),O.onreadystatechange=function(){O.readyState===4&&I.signal.removeEventListener("abort",U)}),O.send(typeof I._bodyInit>"u"?null:I._bodyInit)})}return D.polyfill=!0,a.fetch||(a.fetch=D,a.Headers=g,a.Request=T,a.Response=B),o.Headers=g,o.Request=T,o.Response=B,o.fetch=D,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var s=r.fetch?r:i;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,t.exports=e})(xs,xs.exports)),xs.exports}var FD=zD();const hh=qh(FD);var VD=Object.defineProperty,KD=Object.defineProperties,HD=Object.getOwnPropertyDescriptors,fh=Object.getOwnPropertySymbols,WD=Object.prototype.hasOwnProperty,GD=Object.prototype.propertyIsEnumerable,dh=(t,e,r)=>e in t?VD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ph=(t,e)=>{for(var r in e||(e={}))WD.call(e,r)&&dh(t,r,e[r]);if(fh)for(var r of fh(e))GD.call(e,r)&&dh(t,r,e[r]);return t},gh=(t,e)=>KD(t,HD(e));const YD={Accept:"application/json","Content-Type":"application/json"},ZD="POST",yh={headers:YD,method:ZD},wh=10;let Mp=class{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new wt.EventEmitter,this.isAvailable=!1,this.registering=!1,!Bu(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const r=tr(e),i=await(await hh(this.url,gh(ph({},yh),{body:r}))).json();this.onPayload({data:i})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!Bu(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const r=tr({id:1,jsonrpc:"2.0",method:"test",params:[]});await hh(e,gh(ph({},yh),{body:r}))}this.onOpen()}catch(r){const i=this.parseError(r);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?jr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),n=bn(e,s);this.events.emit("payload",n)}parseError(e,r=this.url){return pp(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>wh&&this.events.setMaxListeners(wh)}};const mh="error",JD="wss://relay.walletconnect.org",XD="wc",QD="universal_provider",Is=`${XD}@2:${QD}:`,Lp="https://rpc.walletconnect.org/v1/",qp="generic",e$=`${Lp}bundler`,ci="call_status",t$=86400,ac={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function cc(t){return t==null||typeof t!="object"&&typeof t!="function"}function zp(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Fp(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const r$="[object RegExp]",Vp="[object String]",Kp="[object Number]",Hp="[object Boolean]",Wp="[object Arguments]",i$="[object Symbol]",s$="[object Date]",n$="[object Map]",o$="[object Set]",a$="[object Array]",c$="[object ArrayBuffer]",l$="[object Object]",u$="[object DataView]",h$="[object Uint8Array]",f$="[object Uint8ClampedArray]",d$="[object Uint16Array]",p$="[object Uint32Array]",g$="[object Int8Array]",y$="[object Int16Array]",w$="[object Int32Array]",m$="[object Float32Array]",b$="[object Float64Array]";function lc(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function v$(t,e){return si(t,void 0,t,new Map,e)}function si(t,e,r,i=new Map,s=void 0){const n=s?.(t,e,r,i);if(n!=null)return n;if(cc(t))return t;if(i.has(t))return i.get(t);if(Array.isArray(t)){const o=new Array(t.length);i.set(t,o);for(let a=0;a<t.length;a++)o[a]=si(t[a],a,r,i,s);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;i.set(t,o);for(const[a,c]of t)o.set(a,si(c,a,r,i,s));return o}if(t instanceof Set){const o=new Set;i.set(t,o);for(const a of t)o.add(si(a,void 0,r,i,s));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(lc(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);i.set(t,o);for(let a=0;a<t.length;a++)o[a]=si(t[a],a,r,i,s);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return i.set(t,o),Tr(o,t,r,i,s),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return i.set(t,o),Tr(o,t,r,i,s),o}if(t instanceof Blob){const o=new Blob([t],{type:t.type});return i.set(t,o),Tr(o,t,r,i,s),o}if(t instanceof Error){const o=new t.constructor;return i.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,Tr(o,t,r,i,s),o}if(typeof t=="object"&&E$(t)){const o=Object.create(Object.getPrototypeOf(t));return i.set(t,o),Tr(o,t,r,i,s),o}return t}function Tr(t,e,r=t,i,s){const n=[...Object.keys(e),...zp(e)];for(let o=0;o<n.length;o++){const a=n[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=si(e[a],a,r,i,s))}}function E$(t){switch(Fp(t)){case Wp:case a$:case c$:case u$:case Hp:case s$:case m$:case b$:case g$:case y$:case w$:case n$:case Kp:case l$:case r$:case o$:case Vp:case i$:case h$:case f$:case d$:case p$:return!0;default:return!1}}function _$(t,e){return v$(t,(r,i,s,n)=>{if(typeof t=="object")switch(Object.prototype.toString.call(t)){case Kp:case Vp:case Hp:{const o=new t.constructor(t?.valueOf());return Tr(o,t),o}case Wp:{const o={};return Tr(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}})}function bh(t){return _$(t)}function vh(t){return t!==null&&typeof t=="object"&&Fp(t)==="[object Arguments]"}function Eh(t){return typeof t=="object"&&t!==null}function x$(){}function I$(t){return lc(t)}function S$(t){if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const r=t[Symbol.toStringTag];return r==null||!Object.getOwnPropertyDescriptor(t,Symbol.toStringTag)?.writable?!1:t.toString()===`[object ${r}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function O$(t){if(cc(t))return t;if(Array.isArray(t)||lc(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t),r=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new r(t);if(t instanceof RegExp){const i=new r(t);return i.lastIndex=t.lastIndex,i}if(t instanceof DataView)return new r(t.buffer.slice(0));if(t instanceof Error){const i=new r(t.message);return i.stack=t.stack,i.name=t.name,i.cause=t.cause,i}if(typeof File<"u"&&t instanceof File)return new r([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const i=Object.create(e);return Object.assign(i,t)}return t}function D$(t,...e){const r=e.slice(0,-1),i=e[e.length-1];let s=t;for(let n=0;n<r.length;n++){const o=r[n];s=Ia(s,o,i,new Map)}return s}function Ia(t,e,r,i){if(cc(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(i.has(e))return O$(i.get(e));if(i.set(e,t),Array.isArray(e)){e=e.slice();for(let n=0;n<e.length;n++)e[n]=e[n]??void 0}const s=[...Object.keys(e),...zp(e)];for(let n=0;n<s.length;n++){const o=s[n];let a=e[o],c=t[o];if(vh(a)&&(a={...a}),vh(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=bh(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const u=[],f=Reflect.ownKeys(c);for(let h=0;h<f.length;h++){const p=f[h];u[p]=c[p]}c=u}else c=[];const l=r(c,a,o,t,e,i);l!=null?t[o]=l:Array.isArray(a)||Eh(c)&&Eh(a)?t[o]=Ia(c,a,r,i):c==null&&S$(a)?t[o]=Ia({},a,r,i):c==null&&I$(a)?t[o]=bh(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function $$(t,...e){return D$(t,...e,x$)}var A$=Object.defineProperty,P$=Object.defineProperties,T$=Object.getOwnPropertyDescriptors,_h=Object.getOwnPropertySymbols,C$=Object.prototype.hasOwnProperty,B$=Object.prototype.propertyIsEnumerable,xh=(t,e,r)=>e in t?A$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ss=(t,e)=>{for(var r in e||(e={}))C$.call(e,r)&&xh(t,r,e[r]);if(_h)for(var r of _h(e))B$.call(e,r)&&xh(t,r,e[r]);return t},R$=(t,e)=>P$(t,T$(e));function Gp(t,e,r){var i;const s=Xt(t);return((i=e.rpcMap)==null?void 0:i[s.reference])||`${Lp}?chainId=${s.namespace}:${s.reference}&projectId=${r}`}function N$(t){return t.includes(":")?t.split(":")[1]:t}function Yp(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function U$(t,e){const r=Object.keys(e.namespaces).filter(s=>s.includes(t));if(!r.length)return[];const i=[];return r.forEach(s=>{const n=e.namespaces[s].accounts;i.push(...n)}),i}function Ih(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>{var i,s;return((i=r?.chains)==null?void 0:i.length)&&((s=r?.chains)==null?void 0:s.length)>0}))}function Os(t={},e={}){const r=Ih(Sh(t)),i=Ih(Sh(e));return $$(r,i)}function Sh(t){var e,r,i,s,n;const o={};if(!Ut(t))return o;for(const[a,c]of Object.entries(t)){const l=wn(a)?[a]:c.chains,u=c.methods||[],f=c.events||[],h=c.rpcMap||{},p=ii(a);o[p]=R$(Ss(Ss({},o[p]),c),{chains:Nt(l,(e=o[p])==null?void 0:e.chains),methods:Nt(u,(r=o[p])==null?void 0:r.methods),events:Nt(f,(i=o[p])==null?void 0:i.events)}),(Ut(h)||Ut(((s=o[p])==null?void 0:s.rpcMap)||{}))&&(o[p].rpcMap=Ss(Ss({},h),(n=o[p])==null?void 0:n.rpcMap))}return o}function Oh(t){return t.includes(":")?t.split(":")[2]:t}function Dh(t){const e={};for(const[r,i]of Object.entries(t)){const s=i.methods||[],n=i.events||[],o=i.accounts||[],a=wn(r)?[r]:i.chains?i.chains:Yp(i.accounts);e[r]={chains:a,methods:s,events:n,accounts:o}}return e}function So(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function k$(t){try{const e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}const Zp={},li=t=>Zp[t],Oo=(t,e)=>{Zp[t]=e};var j$=Object.defineProperty,$h=Object.getOwnPropertySymbols,M$=Object.prototype.hasOwnProperty,L$=Object.prototype.propertyIsEnumerable,Ah=(t,e,r)=>e in t?j$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ph=(t,e)=>{for(var r in e||(e={}))M$.call(e,r)&&Ah(t,r,e[r]);if($h)for(var r of $h(e))L$.call(e,r)&&Ah(t,r,e[r]);return t};const Th="eip155",q$=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],z$=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,Do=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,Ch=t=>Object.keys(t).filter(e=>q$.includes(e)).reduce((e,r)=>(e[r]=F$(t[r]),e),{}),F$=t=>typeof t=="string"&&k$(t)?JSON.parse(t):t,V$=(t,e,r)=>{const{sessionProperties:i={},scopedProperties:s={}}=t,n={};if(!Ut(s)&&!Ut(i))return;const o=Ch(i);for(const a of r){const c=z$(a);if(!c)continue;n[Do(c)]=o;const l=s?.[`${Th}:${c}`];if(l){const u=l?.[`${Th}:${c}:${e}`];n[Do(c)]=Ph(Ph({},n[Do(c)]),Ch(u||l))}}for(const[a,c]of Object.entries(n))Object.keys(c).length===0&&delete n[a];return Object.keys(n).length>0?n:void 0};var K$=Object.defineProperty,H$=(t,e,r)=>e in t?K$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,W$=(t,e,r)=>H$(t,e+"",r);let $o,G$=class Jp{constructor(e){W$(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,r){return await this.storage.setItem(e,r)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return $o||($o=new Jp(e)),$o}};var Y$=Object.defineProperty,Z$=Object.defineProperties,J$=Object.getOwnPropertyDescriptors,Bh=Object.getOwnPropertySymbols,X$=Object.prototype.hasOwnProperty,Q$=Object.prototype.propertyIsEnumerable,Rh=(t,e,r)=>e in t?Y$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,eA=(t,e)=>{for(var r in e||(e={}))X$.call(e,r)&&Rh(t,r,e[r]);if(Bh)for(var r of Bh(e))Q$.call(e,r)&&Rh(t,r,e[r]);return t},tA=(t,e)=>Z$(t,J$(e));async function rA(t,e){const r=Xt(t.result.capabilities.caip345.caip2),i=t.result.capabilities.caip345.transactionHashes,s=await Promise.allSettled(i.map(f=>iA(r.reference,f,e))),n=s.filter(f=>f.status==="fulfilled").map(f=>f.value).filter(f=>f);s.filter(f=>f.status==="rejected").forEach(f=>console.warn("Failed to fetch transaction receipt:",f.reason));const o=!n.length||n.some(f=>!f),a=n.every(f=>f?.status==="0x1"),c=n.every(f=>f?.status==="0x0"),l=n.some(f=>f?.status==="0x0");let u;return o?u=100:a?u=200:c?u=500:l&&(u=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:n,status:u}}async function iA(t,e,r){return await r(parseInt(t)).request(_t("eth_getTransactionReceipt",[e]))}async function sA({sendCalls:t,storage:e}){const r=await e.getItem(ci);await e.setItem(ci,tA(eA({},r),{[t.result.id]:{request:t.request,result:t.result,expiry:pe(t$)}}))}async function nA({resultId:t,storage:e}){const r=await e.getItem(ci);if(r){delete r[t],await e.setItem(ci,r);for(const i in r)Bt(r[i].expiry)&&delete r[i];await e.setItem(ci,r)}}async function oA({resultId:t,storage:e}){const r=await e.getItem(ci),i=r?.[t];if(i&&!Bt(i.expiry))return i;await nA({resultId:t,storage:e})}var aA=Object.defineProperty,cA=Object.defineProperties,lA=Object.getOwnPropertyDescriptors,Nh=Object.getOwnPropertySymbols,uA=Object.prototype.hasOwnProperty,hA=Object.prototype.propertyIsEnumerable,Sa=(t,e,r)=>e in t?aA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ao=(t,e)=>{for(var r in e||(e={}))uA.call(e,r)&&Sa(t,r,e[r]);if(Nh)for(var r of Nh(e))hA.call(e,r)&&Sa(t,r,e[r]);return t},Po=(t,e)=>cA(t,lA(e)),Or=(t,e,r)=>Sa(t,typeof e!="symbol"?e+"":e,r);class fA{constructor(e){Or(this,"name","eip155"),Or(this,"client"),Or(this,"chainId"),Or(this,"namespace"),Or(this,"httpProviders"),Or(this,"events"),Or(this,"storage"),this.namespace=e.namespace,this.events=li("events"),this.client=li("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=G$.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r);const i=this.chainId;this.chainId=parseInt(e),this.events.emit(ac.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${i}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const i=r||Gp(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new nc(new Mp(i,li("disableProviderPing")))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const s=parseInt(N$(r));e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(e){const r=e||this.chainId;return this.httpProviders[r]||(this.httpProviders=Po(Ao({},this.httpProviders),{[r]:this.createHttpProvider(r)}),this.httpProviders[r])}async handleSwitchChain(e){var r,i;let s=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const n=parseInt(s,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var r,i,s,n,o;const a=(i=(r=e.request)==null?void 0:r.params)==null?void 0:i[0],c=((n=(s=e.request)==null?void 0:s.params)==null?void 0:n[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const l=this.client.session.get(e.topic),u=((o=l?.sessionProperties)==null?void 0:o.capabilities)||{},f=`${a}${c.join(",")}`,h=u?.[f];if(h)return h;let p;try{p=V$(l,a,c)}catch(g){console.warn("Failed to extract capabilities from session",g)}if(p)return p;const d=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Po(Ao({},l.sessionProperties||{}),{capabilities:Po(Ao({},u||{}),{[f]:d})})})}catch(g){console.warn("Failed to update session with capabilities",g)}return d}async getCallStatus(e){var r,i,s;const n=this.client.session.get(e.topic),o=(r=n.sessionProperties)==null?void 0:r.bundler_name;if(o){const l=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(l,e)}catch(u){console.warn("Failed to fetch call status from bundler",u,l)}}const a=(i=n.sessionProperties)==null?void 0:i.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from custom bundler",l,a)}const c=await oA({resultId:(s=e.request.params)==null?void 0:s[0],storage:this.storage});if(c)try{return await rA(c,this.getHttpProvider.bind(this))}catch(l){console.warn("Failed to fetch call status from stored send calls",l,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,r){var i;const s=new URL(e),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_t("eth_getUserOperationReceipt",[(i=r.request.params)==null?void 0:i[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,r){return`${e$}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${r}`}async sendCalls(e){var r,i,s;const n=await this.client.request(e),o=(r=e.request.params)==null?void 0:r[0],a=n?.id,c=n?.capabilities||{},l=(i=c?.caip345)==null?void 0:i.caip2,u=(s=c?.caip345)==null?void 0:s.transactionHashes;return!a||!l||!(u!=null&&u.length)||await sA({sendCalls:{request:o,result:n},storage:this.storage}),n}}var dA=Object.defineProperty,pA=(t,e,r)=>e in t?dA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Qr=(t,e,r)=>pA(t,typeof e!="symbol"?e+"":e,r);class gA{constructor(e){Qr(this,"name",qp),Qr(this,"client"),Qr(this,"httpProviders"),Qr(this,"events"),Qr(this,"namespace"),Qr(this,"chainId"),this.namespace=e.namespace,this.events=li("events"),this.client=li("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r);const i=this.chainId;this.chainId=e,this.events.emit(ac.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${i}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return Xt(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){var e,r;const i={};return(r=(e=this.namespace)==null?void 0:e.accounts)==null||r.forEach(s=>{var n,o;const a=Xt(s),c=(o=(n=this.namespace)==null?void 0:n.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];i[a.reference]=this.createHttpProvider(s,c)}),i}getHttpProvider(e){const r=Xt(e).reference,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Gp(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new nc(new Mp(i,li("disableProviderPing")))}}var yA=Object.defineProperty,wA=Object.defineProperties,mA=Object.getOwnPropertyDescriptors,Uh=Object.getOwnPropertySymbols,bA=Object.prototype.hasOwnProperty,vA=Object.prototype.propertyIsEnumerable,Oa=(t,e,r)=>e in t?yA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ai=(t,e)=>{for(var r in e||(e={}))bA.call(e,r)&&Oa(t,r,e[r]);if(Uh)for(var r of Uh(e))vA.call(e,r)&&Oa(t,r,e[r]);return t},Ds=(t,e)=>wA(t,mA(e)),lt=(t,e,r)=>Oa(t,typeof e!="symbol"?e+"":e,r);class uc{constructor(e){lt(this,"client"),lt(this,"namespaces"),lt(this,"optionalNamespaces"),lt(this,"sessionProperties"),lt(this,"scopedProperties"),lt(this,"events",new $a),lt(this,"rpcProviders",{}),lt(this,"session"),lt(this,"providerOpts"),lt(this,"logger"),lt(this,"uri"),lt(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:ns(mn({level:e?.logger||mh})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const r=new uc(e);return await r.initialize(),r}async request(e,r,i){const[s,n]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Ai({},e),chainId:`${s}:${n}`,topic:this.session.topic,expiry:i})}sendAsync(e,r,i,s){const n=new Date().getTime();this.request(e,i,s).then(o=>r(null,Wi(n,o))).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ce("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:s}=await this.client.authenticate(e,r);i&&(this.uri=i,this.events.emit("display_uri",i));const n=await s();if(this.session=n.session,this.session){const o=Dh(this.session.namespaces);this.namespaces=Os(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});r&&(this.uri=r,this.events.emit("display_uri",r));const s=await i();this.session=s;const n=Dh(s.namespaces);return this.namespaces=Os(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[i,s]=this.validateChain(e);this.getProvider(i).setDefaultChain(s,r)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(!gt(r))return;for(const i of r)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}catch(r){this.logger.warn("Failed to cleanup pending pairings",r)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,r;if(this.client=this.providerOpts.client||await qD.init({core:this.providerOpts.core,logger:this.providerOpts.logger||mh,relayUrl:this.providerOpts.relayUrl||JD,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error("Failed to get session",i),new Error(`The provided session: ${(r=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:r.topic} doesn't exist in the Sign client`)}else{const i=this.client.session.getAll();this.session=i[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>ii(r)))];Oo("client",this.client),Oo("events",this.events),Oo("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const i=U$(r,this.session);if(i?.length===0)return;const s=Yp(i),n=Os(this.namespaces,this.optionalNamespaces),o=Ds(Ai({},n[r]),{accounts:i,chains:s});switch(r){case"eip155":this.rpcProviders[r]=new fA({namespace:o});break;default:this.rpcProviders[r]=new gA({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var r;const{topic:i}=e;i===((r=this.session)==null?void 0:r.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var r;const{params:i,topic:s}=e;if(s!==((r=this.session)==null?void 0:r.topic))return;const{event:n}=i;if(n.name==="accountsChanged"){const o=n.data;o&&gt(o)&&this.events.emit("accountsChanged",o.map(Oh))}else if(n.name==="chainChanged"){const o=i.chainId,a=i.event.data,c=ii(o),l=So(o)!==So(a)?`${c}:${So(a)}`:o;this.onChainChanged({currentCaipChainId:l})}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i,s;if(e!==((i=this.session)==null?void 0:i.topic))return;const{namespaces:n}=r,o=(s=this.client)==null?void 0:s.session.get(e);this.session=Ds(Ai({},o),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{var r;e.topic===((r=this.session)==null?void 0:r.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Ds(Ai({},ce("USER_DISCONNECTED")),{data:e.topic})))}),this.on(ac.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(Ds(Ai({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[qp]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r={},optionalNamespaces:i={},sessionProperties:s,scopedProperties:n}=e;this.optionalNamespaces=Os(r,i),this.sessionProperties=s,this.scopedProperties=n}validateChain(e){const[r,i]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,i];if(r&&!Object.keys(this.namespaces||{}).map(o=>ii(o)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&i)return[r,i];const s=ii(Object.keys(this.namespaces)[0]),n=this.rpcProviders[s].getDefaultChain();return[s,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:r,internal:i=!1}){if(!this.namespaces)return;const[s,n]=this.validateChain(e);n&&(this.updateNamespaceChain(s,n),i?(this.events.emit("chainChanged",n),this.emitAccountsChangedOnChainChange({namespace:s,currentCaipChainId:e,previousCaipChainId:r})):this.getProvider(s).setDefaultChain(n),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:r,previousCaipChainId:i}){var s,n;try{if(i===r)return;const o=(n=(s=this.session)==null?void 0:s.namespaces[e])==null?void 0:n.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${r}:`)).map(Oh);if(!gt(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,r){if(!this.namespaces)return;const i=this.namespaces[e]?e:`${e}:${r}`,s={chains:[],methods:[],events:[],defaultChain:r};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=r):this.namespaces[i]=s}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,r){var i;const s=((i=this.session)==null?void 0:i.topic)||"";await this.client.core.storage.setItem(`${Is}/${e}${s}`,r)}async getFromStore(e){var r;const i=((r=this.session)==null?void 0:r.topic)||"";return await this.client.core.storage.getItem(`${Is}/${e}${i}`)}async deleteFromStore(e){var r;const i=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.removeItem(`${Is}/${e}${i}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const r=await this.client.core.storage.getKeys();for(const i of r)i.startsWith(Is)&&await this.client.core.storage.removeItem(i)}catch(r){this.logger.warn("Failed to cleanup storage",r)}}}const EA=uc,_A="wc",xA="ethereum_provider",IA=`${_A}@2:${xA}:`,SA="https://rpc.walletconnect.org/v1/",Xs=["eth_sendTransaction","personal_sign"],Xp=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],Qs=["chainChanged","accountsChanged"],Qp=["chainChanged","accountsChanged","message","disconnect","connect"],OA=async()=>{const{createAppKit:t}=await dg(()=>import("./B2LnQrQp.js").then(e=>e.$),__vite__mapDeps([0,1,2,3]),import.meta.url);return t};var DA=Object.defineProperty,$A=Object.defineProperties,AA=Object.getOwnPropertyDescriptors,kh=Object.getOwnPropertySymbols,PA=Object.prototype.hasOwnProperty,TA=Object.prototype.propertyIsEnumerable,Da=(t,e,r)=>e in t?DA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$r=(t,e)=>{for(var r in e||(e={}))PA.call(e,r)&&Da(t,r,e[r]);if(kh)for(var r of kh(e))TA.call(e,r)&&Da(t,r,e[r]);return t},Pi=(t,e)=>$A(t,AA(e)),tt=(t,e,r)=>Da(t,typeof e!="symbol"?e+"":e,r);function en(t){return Number(t[0].split(":")[1])}function $s(t){return`0x${t.toString(16)}`}function CA(t){const{chains:e,optionalChains:r,methods:i,optionalMethods:s,events:n,optionalEvents:o,rpcMap:a}=t;if(!gt(e))throw new Error("Invalid chains");const c={chains:e,methods:i||Xs,events:n||Qs,rpcMap:$r({},e.length?{[en(e)]:a[en(e)]}:{})},l=n?.filter(p=>!Qs.includes(p)),u=i?.filter(p=>!Xs.includes(p));if(!r&&!o&&!s&&!(l!=null&&l.length)&&!(u!=null&&u.length))return{required:e.length?c:void 0};const f=l?.length&&u?.length||!r,h={chains:[...new Set(f?c.chains.concat(r||[]):r)],methods:[...new Set(c.methods.concat(s!=null&&s.length?s:Xp))],events:[...new Set(c.events.concat(o!=null&&o.length?o:Qp))],rpcMap:a};return{required:e.length?c:void 0,optional:r.length?h:void 0}}class xn{constructor(){tt(this,"events",new wt.EventEmitter),tt(this,"namespace","eip155"),tt(this,"accounts",[]),tt(this,"signer"),tt(this,"chainId",1),tt(this,"modal"),tt(this,"rpc"),tt(this,"STORAGE_KEY",IA),tt(this,"on",(e,r)=>(this.events.on(e,r),this)),tt(this,"once",(e,r)=>(this.events.once(e,r),this)),tt(this,"removeListener",(e,r)=>(this.events.removeListener(e,r),this)),tt(this,"off",(e,r)=>(this.events.off(e,r),this)),tt(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const r=new xn;return await r.initialize(e),r}async request(e,r){return await this.signer.request(e,this.formatChainId(this.chainId),r)}sendAsync(e,r,i){this.signer.sendAsync(e,r,this.formatChainId(this.chainId),i)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var r;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:i,optional:s}=CA(this.rpc);try{const n=await new Promise(async(a,c)=>{var l,u;this.rpc.showQrModal&&((l=this.modal)==null||l.open(),(u=this.modal)==null||u.subscribeState(h=>{!h.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const f=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(Pi($r({namespaces:$r({},i&&{[this.namespace]:i})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:e?.pairingTopic,scopedProperties:f})).then(h=>{a(h)}).catch(h=>{var p;(p=this.modal)==null||p.showErrorMessage("Unable to connect"),c(new Error(h.message))})});if(!n)return;const o=vl(n.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:$s(this.chainId)})}catch(n){throw this.signer.logger.error(n),n}finally{(r=this.modal)==null||r.close()}}async authenticate(e,r){var i;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e?.chains});try{const s=await new Promise(async(o,a)=>{var c,l;this.rpc.showQrModal&&((c=this.modal)==null||c.open(),(l=this.modal)==null||l.subscribeState(u=>{!u.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(Pi($r({},e),{chains:this.rpc.chains}),r).then(u=>{o(u)}).catch(u=>{var f;(f=this.modal)==null||f.showErrorMessage("Unable to connect"),a(new Error(u.message))})}),n=s.session;if(n){const o=vl(n.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:$s(this.chainId)})}return s}catch(s){throw this.signer.logger.error(s),s}finally{(i=this.modal)==null||i.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:r}=e,{event:i}=r;i.name==="accountsChanged"?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const r=parseInt(e);this.chainId=r,this.events.emit("chainChanged",$s(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",Pi($r({},ce("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const r=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",$s(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const r=this.parseChainId(e);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(e){const[r,i,s]=e.split(":");return{chainId:`${r}:${i}`,address:s}}setAccounts(e){this.accounts=e.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var r,i;const s=(r=e?.chains)!=null?r:[],n=(i=e?.optionalChains)!=null?i:[],o=s.concat(n);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const a=s.length?e?.methods||Xs:[],c=s.length?e?.events||Qs:[],l=e?.optionalMethods||[],u=e?.optionalEvents||[],f=e?.rpcMap||this.buildRpcMap(o,e.projectId),h=e?.qrModalOptions||void 0;return{chains:s?.map(p=>this.formatChainId(p)),optionalChains:n.map(p=>this.formatChainId(p)),methods:a,events:c,optionalMethods:l,optionalEvents:u,rpcMap:f,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:h,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,r){const i={};return e.forEach(s=>{i[s]=this.getRpcUrl(s,r)}),i}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?en(this.rpc.chains):en(this.rpc.optionalChains),this.signer=await EA.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const i=await OA(),{convertWCMToAppKitOptions:s}=await Promise.resolve().then(function(){return FA}),n=s(Pi($r({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!n.networks.length)throw new Error("No networks found for WalletConnect");r=i(Pi($r({},n),{universalProvider:this.signer,manualWCControl:!0}))}catch(i){throw console.warn(i),new Error("To use QR modal, please install @reown/appkit package")}if(r)try{this.modal=r}catch(i){throw this.signer.logger.error(i),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:r,optionalChains:i,rpcMap:s}=e;r&&gt(r)&&(this.rpc.chains=r.map(n=>this.formatChainId(n)),r.forEach(n=>{this.rpc.rpcMap[n]=s?.[n]||this.getRpcUrl(n)})),i&&gt(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i?.map(n=>this.formatChainId(n)),i.forEach(n=>{this.rpc.rpcMap[n]=s?.[n]||this.getRpcUrl(n)}))}getRpcUrl(e,r){var i;return((i=this.rpc.rpcMap)==null?void 0:i[e])||`${SA}?chainId=eip155:${e}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:r?.accounts),this.setAccounts(r?.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(r=>this.signer.logger.warn(r))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(r=>this.parseAccount(r))}}const BA=xn;var RA=Object.defineProperty,NA=Object.defineProperties,UA=Object.getOwnPropertyDescriptors,jh=Object.getOwnPropertySymbols,kA=Object.prototype.hasOwnProperty,jA=Object.prototype.propertyIsEnumerable,Mh=(t,e,r)=>e in t?RA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,eg=(t,e)=>{for(var r in e||(e={}))kA.call(e,r)&&Mh(t,r,e[r]);if(jh)for(var r of jh(e))jA.call(e,r)&&Mh(t,r,e[r]);return t},MA=(t,e)=>NA(t,UA(e));function LA(t){if(t)return{"--w3m-font-family":t["--wcm-font-family"],"--w3m-accent":t["--wcm-accent-color"],"--w3m-color-mix":t["--wcm-background-color"],"--w3m-z-index":t["--wcm-z-index"]?Number(t["--wcm-z-index"]):void 0,"--w3m-qr-color":t["--wcm-accent-color"],"--w3m-font-size-master":t["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":t["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const qA=t=>{const[e,r]=t.split(":");return tg({id:r,caipNetworkId:t,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function zA(t){var e,r,i,s,n,o,a;const c=(e=t.chains)==null?void 0:e.map(qA).filter(Boolean);if(c.length===0)throw new Error("At least one chain must be specified");const l=c.find(f=>{var h;return f.id===((h=t.defaultChain)==null?void 0:h.id)}),u={projectId:t.projectId,networks:c,themeMode:t.themeMode,themeVariables:LA(t.themeVariables),chainImages:t.chainImages,connectorImages:t.walletImages,defaultNetwork:l,metadata:MA(eg({},t.metadata),{name:((r=t.metadata)==null?void 0:r.name)||"WalletConnect",description:((i=t.metadata)==null?void 0:i.description)||"Connect to WalletConnect-compatible wallets",url:((s=t.metadata)==null?void 0:s.url)||"https://walletconnect.org",icons:((n=t.metadata)==null?void 0:n.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:t.explorerRecommendedWalletIds==="NONE"?[]:Array.isArray(t.explorerRecommendedWalletIds)?t.explorerRecommendedWalletIds:[],excludeWalletIds:t.explorerExcludedWalletIds==="ALL"?[]:Array.isArray(t.explorerExcludedWalletIds)?t.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((o=t.mobileWallets)!=null&&o.length||(a=t.desktopWallets)!=null&&a.length){const f=[...(t.mobileWallets||[]).map(d=>({id:d.id,name:d.name,links:d.links})),...(t.desktopWallets||[]).map(d=>({id:d.id,name:d.name,links:{native:d.links.native,universal:d.links.universal}}))],h=[...u.featuredWalletIds||[],...u.excludeWalletIds||[]],p=f.filter(d=>!h.includes(d.id));p.length&&(u.customWallets=p)}return u}function tg(t){return eg({formatters:void 0,fees:void 0,serializers:void 0},t)}var FA=Object.freeze({__proto__:null,convertWCMToAppKitOptions:zA,defineChain:tg});const NP=Object.freeze(Object.defineProperty({__proto__:null,EthereumProvider:BA,OPTIONAL_EVENTS:Qp,OPTIONAL_METHODS:Xp,REQUIRED_EVENTS:Qs,REQUIRED_METHODS:Xs,default:xn},Symbol.toStringTag,{value:"Module"}));export{mI as A,wr as B,Q1 as C,bn as D,ze as E,Ct as F,dt as G,Tt as H,zr as I,Mp as J,NP as K,dl as P,Xf as Q,F as a,er as b,oy as c,Ig as d,Ni as e,pt as f,um as g,tm as h,iv as i,Ox as j,mn as k,tI as l,_t as m,ns as n,nc as o,$3 as p,sc as q,Fr as r,Ho as s,Xe as t,vn as u,Wi as v,r1 as w,tr as x,Qe as y,jr as z};
