import{_ as ne}from"./BRD0zS0z.js";import{g as le,Q as ie,a as ce,U as re,b as ue,R as de,B as _e,s as V,e as r,V as me,o as fe,w as pe,l as f,m as u,n as l,p as d,W as K,q as o,X as be,c as i,Y as ke,N as C,M as v,Z as ye,$ as A,L as D,a0 as ve,a1 as ge,C as he,a2 as x,S as we,a3 as Se,a4 as Ce,y as xe,a5 as Ie,a6 as $e}from"./9S2XGRg9.js";import{_ as Ue}from"./drKZnbC8.js";import{_ as Re}from"./CGyKrs8V.js";import{_ as Te}from"./CLuOJMie.js";import{u as Be}from"./DOPoUBoe.js";import"./DVNOgE3D.js";import"./D89E3aNf.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s.SENTRY_RELEASE={id:"cd189bad150b481aa5ecb2e95de26ec677010e55"}}catch{}})();try{(function(){var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new s.Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="aaaff172-60bd-43ad-a5ce-dcbc767659a1",s._sentryDebugIdIdentifier="sentry-dbid-aaaff172-60bd-43ad-a5ce-dcbc767659a1")})()}catch{}const Le={class:"flex px-3 py-3.5 border-b border-gray-200"},Ne=["src","alt"],Ve=["textContent"],We=le({__name:"latest-books",setup(s){const{t}=ie(),{BOOK3_URL:g}=ce().public,E=re(),q=Be(),P=ue(),j=de(),M=_e(),{userLikerInfo:I}=V(E),{isAuthenticated:h,wallet:$}=V(P),W=i(()=>[{label:t("latest_books.latest_releases"),value:"latest"},{label:t("latest_books.best_sellers"),value:"bestselling"}]),_=r(""),p=r(!1),U=r([]),R=r([]),b=r("latest"),m=r(M.query.q||""),w=i(()=>I.value?.user?Ce(I.value?.user):""),S=i(()=>p.value&&w.value),O=i(()=>[{accessorKey:"image",header:t("table.cover")},{accessorKey:"className",header:t("latest_books.book_name")},{accessorKey:"author",header:t("common.author")},{accessorKey:"priceInUSD",header:t("common.price")},{accessorKey:"url",header:S.value?t("latest_books.affiliation_link"):t("common.link")}]),T=i(()=>b.value||"latest"),Y=i(()=>T.value==="latest"?U.value:R.value),B=i(()=>Y.value.map(e=>{const a=e.name||e.title,c=e.thumbnailUrl||e.imageUrl,k=typeof e.author=="object"?e.author.name:e.author;return{className:a,image:c?Ie($e(c)):void 0,author:k,priceInUSD:`US$${e.minPrice||e.prices?.[0]?.price||0}`,url:`${g}/store/${e.classId}?from=${w.value}&utm_source=bookpress&utm_medium=list_${T.value}`}})),z=i(()=>{if(!m.value)return B.value;const e=m.value.toLowerCase();return B.value.filter(a=>[a.className,a.author].some(c=>c&&c.toLowerCase().includes(e)))});me({title:()=>t("seo.latest_books_title"),ogTitle:()=>t("seo.latest_books_title")}),fe(async()=>{if(await Promise.all([F().catch(e=>{_.value=e}),H().catch(e=>{_.value=e})]),h.value)try{await L()}catch(e){console.error(e)}});async function F(){const e=await $fetch(`${g}/api/store/products?tag=latest`);U.value=e?.records||[]}async function H(){const e=await $fetch(`${g}/api/store/products?tag=bestselling`);R.value=e?.records||[]}async function L(){if(!$.value){p.value=!1;return}try{const e=await q.fetchStripeConnectStatusByWallet($.value);p.value=e?.isReady}catch(e){console.error(e),p.value=!1}}function Q(){x("latest_books_click_affiliation_setup"),we(j({name:"settings"}))}function X(e){x("latest_books_click_table_row"),window.open(e.original.url,"_blank")}function Z(e,a){e.stopPropagation(),x("latest_books_click_copy_button"),Se(a)}return pe(h,()=>{h.value&&xe(()=>{L()})}),(e,a)=>{const c=ne,k=be,G=ye,N=ke,J=ve,ee=ge,te=Ue,oe=Re,ae=Te;return u(),f(ae,null,{default:l(()=>[d(c,{title:o(t)("latest_books.title")},null,8,["title"]),o(_)?(u(),f(k,{key:0,icon:"i-heroicons-exclamation-triangle",color:"error",variant:"soft",title:`${o(_)}`,close:{icon:"i-heroicons-x-mark-20-solid",color:"error",variant:"link"},onClose:a[0]||(a[0]=y=>_.value="")},null,8,["title"])):K("",!0),o(S)?(u(),f(N,{key:2},{default:l(()=>[C(v(o(t)("latest_books_extended.append_text")),1),d(G,{class:"font-mono"},{default:l(()=>[C(" ?from="+v(o(w)),1)]),_:1}),C(v(o(t)("latest_books_extended.append_suffix")),1)]),_:1})):(u(),f(k,{key:1,icon:"i-heroicons-exclamation-circle",color:"warning",variant:"soft",title:o(t)("latest_books.join_affiliation"),description:o(t)("latest_books.affiliation_description"),actions:[{label:o(t)("common.setup"),color:"warning",variant:"outline",onClick:Q}]},null,8,["title","description","actions"])),d(oe,{modelValue:o(b),"onUpdate:modelValue":a[2]||(a[2]=y=>A(b)?b.value=y:null),class:"w-full",items:o(W)},{content:l(({item:y})=>[(u(),f(N,{key:y.value,ui:{header:"flex justify-between items-center",body:"p-0",footer:"text-center"}},{default:l(()=>[D("div",Le,[d(J,{modelValue:o(m),"onUpdate:modelValue":a[1]||(a[1]=n=>A(m)?m.value=n:null),placeholder:o(t)("latest_books.filter_placeholder")},null,8,["modelValue","placeholder"])]),d(te,{columns:o(O),data:o(z),onSelect:X},{"image-cell":l(({row:n})=>[n.original.image?(u(),he("img",{key:0,src:n.original.image,alt:n.original.className,class:"w-12 h-12 object-cover rounded-lg"},null,8,Ne)):K("",!0)]),"className-cell":l(({row:n})=>[D("div",{class:"max-w-[20vw] whitespace-normal",textContent:v(n.original.className)},null,8,Ve)]),"url-cell":l(({row:n})=>[d(ee,{label:o(t)("common.copy"),disabled:!o(S),onClick:se=>Z(se,n.original.url)},null,8,["label","disabled","onClick"])]),_:1},8,["columns","data"])]),_:1}))]),_:1},8,["modelValue","items"])]),_:1})}}});export{We as default};
