{"version":3,"file":"C1elK9vU.js","sources":["../../../pages/batch-short-links.vue"],"sourcesContent":["<template>\n  <PageContainer>\n    <PageHeader :title=\"$t('batch_short_links.page_title')\" />\n\n    <PageBody>\n      <UFormField\n        :label=\"$t('batch_short_links.provider_label')\"\n        :required=\"true\"\n      >\n        <USelect\n          v-model=\"shortLinkProvider\"\n          :items=\"shortLinkProviders\"\n        />\n      </UFormField>\n\n      <UFormField\n        :label=\"apiKeyLabel\"\n        :required=\"true\"\n      >\n        <UInput\n          v-model=\"apiKey\"\n          class=\"font-mono\"\n          autocomplete=\"off\"\n        />\n      </UFormField>\n\n      <UFormField\n        v-if=\"shouldShowShortLinkDomain\"\n        :label=\"$t('batch_short_links.shortio_domain')\"\n        :required=\"true\"\n      >\n        <UInput\n          v-model=\"shortLinkDomain\"\n          class=\"font-mono\"\n          placeholder=\"link.liker.land\"\n          autocomplete=\"off\"\n        />\n      </UFormField>\n\n      <UFormField :label=\"$t('batch_short_links.title_prefix')\">\n        <UInput\n          v-model=\"titlePrefix\"\n          :hint=\"$t('batch_short_links.optional')\"\n        />\n      </UFormField>\n\n      <UCard :ui=\"{ body: 'space-y-2' }\">\n        <UFormField :label=\"$t('batch_short_links.upload_csv')\">\n          <UInput type=\"file\" accept=\"csv\" @change=\"handleFileChange\" />\n        </UFormField>\n        <USeparator class=\"print:hidden\" :label=\"$t('batch_short_links.or_divider')\" />\n        <UFormField :label=\"$t('batch_short_links.input_csv')\">\n          <UTextarea\n            v-model=\"csvInput\"\n            class=\"font-mono\"\n            :placeholder=\"csvInputPlaceholder\"\n            :resize=\"true\"\n          />\n        </UFormField>\n      </UCard>\n\n      <div class=\"flex justify-center\">\n        <UButton\n          :label=\"$t('batch_short_links.start')\"\n          size=\"lg\"\n          :disabled=\"!csvInput || !apiKey || (shouldShowShortLinkDomain && !shortLinkDomain)\"\n          @click=\"startShorteningURLs\"\n        />\n      </div>\n\n      <template v-if=\"shortenedURLItems.length\">\n        <UCard\n          :ui=\"{\n            header: 'flex justify-between items-center gap-2',\n            body: 'p-0'\n          }\"\n        >\n          <template #header>\n            <h3 class=\"font-bold font-mono\">\n              {{ $t('batch_short_links.results') }}\n            </h3>\n\n            <div class=\"flex items-center gap-2\">\n              <UButton\n                :label=\"$t('batch_short_links.download_csv')\"\n                variant=\"outline\"\n                @click=\"downloadAllShortenedLinks\"\n              />\n              <UButton\n                :label=\"$t('batch_short_links.convert_to_qr')\"\n                variant=\"outline\"\n                @click=\"convertToQRCode\"\n              />\n            </div>\n          </template>\n\n          <UTable\n            :columns=\"[\n              { accessorKey: 'key', header: $t('batch_short_links.key_column') },\n              { accessorKey: 'url', header: $t('batch_short_links.url_column') },\n              { accessorKey: 'destination', header: $t('batch_short_links.destination_column') },\n            ]\"\n            :data=\"shortenedURLItems\"\n          >\n            <template #url-cell=\"{ row }\">\n              <UButton\n                class=\"font-mono\"\n                :to=\"row.original.url\"\n                target=\"_blank\"\n                rel=\"noopener\"\n                variant=\"link\"\n              >\n                {{ row.original.url }}\n              </UButton>\n            </template>\n            <template #destination-cell=\"{ row }\">\n              <UButton\n                class=\"font-mono\"\n                :to=\"row.original.destination\"\n                target=\"_blank\"\n                rel=\"noopener\"\n                variant=\"link\"\n              >\n                {{ row.original.destination }}\n              </UButton>\n            </template>\n          </UTable>\n        </UCard>\n      </template>\n    </PageBody>\n  </PageContainer>\n</template>\n\n<script setup lang=\"ts\">\nimport { parse as csvParse } from 'csv-parse/sync'\n\nimport { convertArrayOfObjectsToCSV } from '~/utils'\nconst { t: $t } = useI18n()\n\nconst toast = useToast()\nconst route = useRoute()\nconst localeRoute = useLocaleRoute()\n\nconst CSV_HEADER = 'key,url'\n\nenum ShortLinkProvider {\n  Bitly = 'bitly',\n  ShortIO = 'shortio'\n}\nconst shortLinkProviders = [\n  {\n    label: 'Bitly',\n    value: ShortLinkProvider.Bitly\n  },\n  {\n    label: 'Short.io',\n    value: ShortLinkProvider.ShortIO\n  }\n]\nconst shortLinkProvider = ref<ShortLinkProvider>(route.query.provider as ShortLinkProvider || ShortLinkProvider.Bitly)\nconst shouldShowShortLinkDomain = computed(() => shortLinkProvider.value === ShortLinkProvider.ShortIO)\nconst shortLinkDomain = ref('')\n\nconst titlePrefix = ref(route.query.title_prefix as string || $t('batch_short_links.default_title_prefix'))\nconst csvInput = ref('')\nconst csvInputPlaceholder = `${CSV_HEADER}\nexample01,https://example01.com,\nexample02,https://example02.com,`\nconst apiKey = ref('')\nconst apiKeyLabel = computed(() => {\n  switch (shortLinkProvider.value) {\n    case ShortLinkProvider.Bitly:\n      return $t('batch_short_links.bitly_token')\n    case ShortLinkProvider.ShortIO:\n      return $t('batch_short_links.shortio_api_key')\n    default:\n      return ''\n  }\n})\nconst shortenedURLItems = ref<{ key: string, url: string, destination: string }[]>([])\n\nuseSeoMeta({\n  title: 'Batch Create Book Short Links',\n  ogTitle: 'Batch Create Book Short Links'\n})\n\nonMounted(() => {\n  try {\n    const loadedInput = sessionStorage.getItem('nft_book_press_batch_shorten_url')\n    if (loadedInput) {\n      csvInput.value = loadedInput\n      sessionStorage.removeItem('nft_book_press_batch_shorten_url')\n    }\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(error)\n  }\n})\n\nasync function shortenURLWithBitly ({ url, key }: { url: string, key: string }) {\n  try {\n    const data = await $fetch<{ link: string }>('https://api-ssl.bitly.com/v4/bitlinks', {\n      method: 'POST',\n      headers: {\n        Authorization: `Bearer ${apiKey.value}`\n      },\n      body: {\n        long_url: url,\n        domain: 'bit.ly',\n        title: [titlePrefix.value, key].join(' - '),\n        tags: [\n          'nft-book-press'\n        ]\n      }\n    })\n    if (!data) {\n      throw new Error($t('batch_short_links.bitly_no_data'))\n    }\n    return data.link\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(error)\n    toast.add({\n      icon: 'i-heroicons-exclamation-circle',\n      title: (error as Error).toString(),\n      duration: 0,\n      color: 'error'\n    })\n    return 'error'\n  }\n}\n\nasync function shortenURLWithShortIO ({ url, key }: { url: string, key: string }) {\n  try {\n    const data = await $fetch<{ shortURL: string }>('https://api.short.io/links/public', {\n      method: 'POST',\n      headers: {\n        Authorization: apiKey.value\n      },\n      body: {\n        allowDuplicates: true,\n        domain: shortLinkDomain.value,\n        originalURL: url,\n        title: [titlePrefix.value, key].join(' - '),\n        tags: [\n          'nft-book-press'\n        ]\n      }\n    })\n    if (!data) {\n      throw new Error($t('batch_short_links.shortio_no_data'))\n    }\n    return data.shortURL\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(error)\n    toast.add({\n      icon: 'i-heroicons-exclamation-circle',\n      title: (error as Error).toString(),\n      duration: 0,\n      color: 'error'\n    })\n    return 'error'\n  }\n}\n\nasync function startShorteningURLs () {\n  let urlItems: { key: string, url: string }[] = []\n  try {\n    let input = csvInput.value\n    if (!input.includes(CSV_HEADER)) {\n      input = `${CSV_HEADER}\\n${input}`\n    }\n    urlItems = csvParse(input, {\n      columns: true,\n      skip_empty_lines: true\n    })\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(error)\n    toast.add({\n      icon: 'i-heroicons-exclamation-circle',\n      title: (error as Error).toString(),\n      duration: 0,\n      color: 'error'\n    })\n    return\n  }\n\n  try {\n    for (const { key, url } of urlItems) {\n      let shortenedURL = ''\n      switch (shortLinkProvider.value) {\n        case ShortLinkProvider.Bitly:\n          shortenedURL = await shortenURLWithBitly({ url, key })\n          break\n        case ShortLinkProvider.ShortIO:\n          shortenedURL = await shortenURLWithShortIO({ url, key })\n          break\n        default:\n          break\n      }\n      shortenedURLItems.value.push({\n        key,\n        url: shortenedURL,\n        destination: url\n      })\n    }\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(error)\n    toast.add({\n      icon: 'i-heroicons-exclamation-circle',\n      title: (error as Error).toString(),\n      duration: 0,\n      color: 'error'\n    })\n  }\n}\n\nfunction downloadAllShortenedLinks () {\n  downloadFile({\n    data: shortenedURLItems.value,\n    fileName: 'shortened_links.csv',\n    fileType: 'csv'\n  })\n}\n\nasync function convertToQRCode () {\n  sessionStorage.setItem('nft_book_press_batch_qrcode', convertArrayOfObjectsToCSV(shortenedURLItems.value))\n  await navigateTo(localeRoute({ name: 'batch-qrcode' }))\n}\n\nfunction handleFileChange (event: Event) {\n  const files = (event.target as HTMLInputElement)?.files\n  if (!files?.length) { return }\n  const file = files[0]\n  if (!file) { return }\n  const reader = new FileReader()\n  reader.onload = (e) => {\n    const text = e.target?.result\n    if (typeof text === 'string') {\n      csvInput.value = text\n    }\n  }\n  reader.readAsText(file)\n}\n\n</script>\n"],"names":["CSV_HEADER","$t","useI18n","toast","useToast","route","useRoute","localeRoute","useLocaleRoute","shortLinkProviders","shortLinkProvider","ref","shouldShowShortLinkDomain","computed","shortLinkDomain","titlePrefix","csvInput","csvInputPlaceholder","apiKey","apiKeyLabel","shortenedURLItems","useSeoMeta","onMounted","loadedInput","error","shortenURLWithBitly","url","key","data","shortenURLWithShortIO","startShorteningURLs","urlItems","input","csvParse","shortenedURL","downloadAllShortenedLinks","downloadFile","convertToQRCode","convertArrayOfObjectsToCSV","navigateTo","handleFileChange","event","files","file","reader","e","text","_createBlock","_component_PageContainer","_createVNode","_component_PageHeader","_unref","_component_PageBody","_component_UFormField","_component_USelect","$event","_component_UInput","_component_UCard","_component_USeparator","_component_UTextarea","_createElementVNode","_hoisted_1","_component_UButton","_hoisted_2","_toDisplayString","_hoisted_3","_component_UTable","_withCtx","row"],"mappings":"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"}