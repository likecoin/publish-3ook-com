import{g as W,o as Y,e as m,t as _e,q as t,B as fe,R as ge,Q as be,b as ye,s as R,a$ as ve,V as he,w as $,l as w,m as i,n as l,W as K,p as d,L as I,X as we,ao as Ie,N as q,Y as ke,c as u,$ as N,C as V,M as F,aa as Se,ad as Le,aq as xe,a0 as Te,aO as Ue,S as z}from"./9S2XGRg9.js";import{_ as $e}from"./DBITDbxI.js";import{u as O}from"./DJApvAF_.js";import{_ as Ce}from"./drKZnbC8.js";import{_ as Be}from"./CGyKrs8V.js";import{_ as Re}from"./CLuOJMie.js";import{u as Ne}from"./DOPoUBoe.js";import"./CSf5BCM0.js";import"./D89E3aNf.js";(function(){try{var o=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};o.SENTRY_RELEASE={id:"cd189bad150b481aa5ecb2e95de26ec677010e55"}}catch{}})();try{(function(){var o=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},p=new o.Error().stack;p&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[p]="eb3e5f82-b456-4f26-b8f7-107a7ded7a4d",o._sentryDebugIdIdentifier="sentry-dbid-eb3e5f82-b456-4f26-b8f7-107a7ded7a4d")})()}catch{}const Ve=W({__name:"NFTClassMetadataLoader",props:{classId:{type:String,required:!0}},setup(o){const p=O(),k=o,s=m(!1);return Y(async()=>{try{s.value=!0,await p.lazyFetchClassMetadataById(k.classId)}catch{}finally{s.value=!1}}),(S,C)=>_e(S.$slots,"default",{isLoading:t(s)})}}),Fe=Object.assign(Ve,{__name:"NFTClassMetadataLoader"}),Me={class:"flex justify-between items-center w-full"},Pe={class:"flex gap-2 items-center"},De={class:"text-sm leading-5"},Ae={class:"flex gap-1"},je={key:1,class:"max-w-xs truncate"},Ee={class:"mt-4 text-center text-sm text-gray-500 dark:text-gray-400"},Ge=W({__name:"index",setup(o){const p=fe(),k=ge(),{t:s}=be(),S=ye(),C=O(),{listingList:M,moderatedBookList:P,token:Q,wallet:_}=R(S),D=ve(),{getLikerInfoByWallet:X}=R(D),A=Ne(),{getStripeConnectStatusByWallet:J}=R(A),{lazyFetchClassMetadataById:G}=C,{fetchBookListing:H,fetchModeratedBookList:Z}=S,L=m(""),j=m(!1),ee=u(()=>{const e=X.value(_.value||""),a=J.value(_.value||""),n=e?.user||"",y=_.value||"",v=a?.email||"",h="https://docs.google.com/forms/d/e/1FAIpQLSdiV9jIUFcDjoFoLtz6KMmq1YRFjU7uXR7ka36JKhVespsP6w/viewform",B=new URLSearchParams({usp:"pp_url","entry.1466422015":n,"entry.1252262934":y,"entry.1672981182":v});return`${h}?${B.toString()}`});he({title:()=>s("seo_titles.book_listing_management"),ogTitle:()=>s("seo_titles.book_listing_management")});const ae=u(()=>[{label:s("bookstore.current_listing"),value:"current"},{label:s("bookstore.viewable_listing"),value:"viewable"}]),f=m(p.query.tab||"current");$(f,e=>{e&&z(k({query:{tab:e}}),{replace:!0})});const g=m(""),te=m({column:"pendingAction",direction:"desc"}),b=m(50),r=m(1),se=u(()=>(r.value-1)*b.value+1),oe=u(()=>Math.min(r.value*b.value,x.value.length)),x=u(()=>(f.value==="viewable"?P:M).value.map(e=>({classId:e.classId,className:C.getClassMetadataById(e.classId)?.name,priceInUSD:e.prices?.[0]?.price,prices:e.prices?.map(a=>a.price),pendingAction:e.pendingNFTCount,sold:e.sold})).filter(e=>{if(!g.value)return!0;const a=g.value.toLowerCase();return e.classId.toLowerCase().includes(a)||e.className?.toLowerCase().includes(a)})),ne=u(()=>{const{column:e,direction:a}=te.value;return[...x.value].sort((n,y)=>{const v=n[e]??"",h=y[e]??"";return v<h?a==="asc"?-1:1:v>h?a==="asc"?1:-1:0})}),le=u(()=>ne.value.slice((r.value-1)*b.value,r.value*b.value)),re=u(()=>[{accessorKey:"pendingAction",header:s("table.pending_action")},{accessorKey:"className",header:s("table.class_name")},{accessorKey:"priceInUSD",header:s("table.price_in_usd")},{accessorKey:"sold",header:s("table.sold")},{accessorKey:"classId",header:s("bookstore.class_id"),meta:{class:{td:"font-mono"}}}]);$(j,e=>{e&&(L.value="")}),$(f,()=>{g.value="",r.value=1}),$(b,()=>{r.value=1}),Y(async()=>{const e=[H()];Q.value&&e.push(Z()),_.value&&(e.push(D.lazyFetchLikerInfoByWallet(_.value)),e.push(A.fetchStripeConnectStatusByWallet(_.value))),await Promise.all(e),new Set(M.value.map(n=>n.classId).concat(P.value.map(n=>n.classId))).forEach(n=>G(n))});async function ce(e){await z(k({name:"my-books-status-classId",params:{classId:e.original.classId}}))}return(e,a)=>{const n=we,y=Ie,v=$e,h=Te,B=xe,ie=Fe,de=Ce,E=ke,ue=Be,me=Ue,pe=Re;return i(),w(pe,{ui:{constrained:""}},{default:l(()=>[t(L)?(i(),w(n,{key:0,class:"mt-4",icon:"i-heroicons-exclamation-triangle",color:"error",variant:"soft",title:`${t(L)}`,close:{icon:"i-heroicons-x-mark-20-solid",color:"error",variant:"link"},onClose:a[0]||(a[0]=T=>L.value="")},null,8,["title"])):K("",!0),t(j)?(i(),w(y,{key:1,animation:"carousel"},{indicator:l(()=>[...a[4]||(a[4]=[q(" Loading... ",-1)])]),_:1})):K("",!0),d(E,{ui:{header:"flex justify-between items-center gap-4"}},{default:l(()=>[d(ue,{modelValue:t(f),"onUpdate:modelValue":a[3]||(a[3]=T=>N(f)?f.value=T:null),class:"w-full",items:t(ae)},{content:l(({item:T})=>[(i(),w(E,{key:T.value,ui:{header:"flex justify-between items-center gap-4",body:"divide-y divide-gray-200 dark:divide-gray-700 p-0"}},{header:l(()=>[I("div",Me,[I("div",Pe,[d(v,{page:t(r),"onUpdate:page":a[1]||(a[1]=c=>N(r)?r.value=c:null),"items-per-page":t(b),total:t(x).length},null,8,["page","items-per-page","total"]),I("span",De,F(t(s)("table.showing_rows",{from:t(se),to:t(oe),total:t(x).length})),1)]),d(h,{modelValue:t(g),"onUpdate:modelValue":a[2]||(a[2]=c=>N(g)?g.value=c:null),icon:"i-heroicons-magnifying-glass-20-solid",placeholder:t(s)("table.search_placeholder")},null,8,["modelValue","placeholder"])])]),default:l(()=>[d(de,{columns:t(re),data:t(le),onSelect:ce},{"priceInUSD-cell":l(({row:c})=>[I("ul",Ae,[(i(!0),V(Se,null,Le(c.original.prices,U=>(i(),V("li",{key:U},[d(B,{label:`$${U}`,variant:"solid",size:"xs",color:"neutral",class:"rounded-full"},null,8,["label"])]))),128))])]),"className-cell":l(({row:c})=>[d(ie,{"class-id":c.original.classId},{default:l(({isLoading:U})=>[U||!c.original.className?(i(),w(y,{key:0})):(i(),V("div",je,F(c.original.className),1))]),_:2},1032,["class-id"])]),_:1},8,["columns","data"])]),_:1}))]),_:1},8,["modelValue","items"])]),_:1}),I("div",Ee,[d(me,{to:t(ee),target:"_blank",class:"underline"},{default:l(()=>[q(F(t(s)("my_books.author_promo_form")),1)]),_:1},8,["to"])])]),_:1})}}});export{Ge as default};
