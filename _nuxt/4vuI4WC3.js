import{g as et,Q as at,u as nt,s as ot,e as m,w as N,ap as st,C as T,m as d,l as S,W as x,p as k,q as a,X as it,Y as rt,n as E,L as y,ao as lt,ai as ct,a0 as ut,aq as mt,N as dt,M as $,a1 as ft,c as C,ar as _t,a as gt,as as pt,a6 as bt,at as vt}from"./9S2XGRg9.js";import{u as yt}from"./CSf5BCM0.js";import{b as Ct}from"./CFNaZjOu.js";import{u as ht}from"./Do2UJywV.js";(function(){try{var o=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};o.SENTRY_RELEASE={id:"cd189bad150b481aa5ecb2e95de26ec677010e55"}}catch{}})();try{(function(){var o=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},p=new o.Error().stack;p&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[p]="65b3994e-73dc-4ce4-82f6-2051e27365f0",o._sentryDebugIdIdentifier="sentry-dbid-65b3994e-73dc-4ce4-82f6-2051e27365f0")})()}catch{}const wt={class:"flex flex-col items-stretch grow space-y-4"},Nt=["textContent"],Tt={class:"flex justify-center"},xt=["src"],kt={key:1,class:"w-full"},Ut={class:"space-y-3"},Mt={class:"flex justify-between items-center"},Dt={class:"text-xs text-gray-500"},Ft={key:2,class:"flex justify-center"},It=et({__name:"LiteMintNFT",props:{iscnData:{type:Object,default:null},shouldShowSubmit:{type:Boolean,default:!0},iscnId:{type:String,default:""},isRestock:{type:Boolean,default:!1},restockCount:{type:Number,default:0}},emits:["submit","formValidChange"],setup(o,{expose:p,emit:W}){const{t:i}=at(),{getClassOwner:z,getClassMetadata:J,checkNFTClassIsBookNFT:Y}=yt(),{mintNFT:Q}=Ct(),O=nt(),{wallet:B}=ot(O),{validateWalletConsistency:X}=O,l=o,b=m(""),c=m(!1),f=m(null),L=m(""),U=m([]),M=m(null),_=m(l.iscnId||""),e=_t({mintCount:pt,imageUrl:"",externalUrl:""}),V=W,{showErrorToast:D}=ht(),j=C(()=>{const t={mintCount:e.mintCount!==void 0,imageUrl:!!e.imageUrl};return Object.entries(t).filter(([n,r])=>!r).map(([n])=>n.toUpperCase())}),A=C(()=>!j.value?.length),g=C(()=>f.value?.contentMetadata?.name||""),q=C(()=>bt(e.imageUrl)),G=C(()=>g.value?l.isRestock?g.value:i("nft.mint_by_filling_info",{bookName:g.value}):i("nft.minting_loading"));N(A,t=>{V("formValidChange",t)},{immediate:!0}),N(c,t=>{t&&(b.value="")},{immediate:!0}),st(async()=>{l.iscnData?(f.value=l.iscnData,L.value=l.iscnData["@id"],e.imageUrl=l.iscnData.contentMetadata?.thumbnailUrl||"",_.value=l.iscnData["@id"]):l.iscnId&&await tt(l.iscnId)}),N(c,t=>{t&&(b.value="")}),N(()=>l.isRestock,t=>{t&&(l.restockCount<0?e.mintCount=Math.abs(l.restockCount):e.mintCount=vt)},{immediate:!0});function H({nftMintCount:t,imgUrl:n}){const r=[];for(let s=0;s<t;s++)r.push({image:n,metadata:""});return r}async function K(){try{const t=f.value;if(!t){D(i("errors.no_mint_data"));return}const{contentMetadata:n}=t;if(!A.value){const s=j.value.join(", ");D(i("errors.required_field_missing",{fields:s}));return}c.value=!0;const r={metadata:{name:n.name,description:n.description,symbol:"BOOK",...n,image:e.imageUrl,external_url:e.externalUrl}};typeof e.mintCount!="number"&&(e.mintCount=Number(e.mintCount)),M.value=r,U.value=H({nftMintCount:e.mintCount,imgUrl:e.imageUrl}),e.mintCount=U.value.length,e.mintCount>0&&await Z(),_.value&&V("submit",{classId:_.value,nftMintCount:e.mintCount})}catch(t){console.error(t),D(`${i("nft.mint_error")}: ${t.toString()}`)}finally{c.value=!1}}async function Z(){try{if(c.value=!0,B.value||await X(),!B.value)return;if(!M.value)throw new Error(i("errors.no_mint_data"));const t=M.value.metadata,{BOOK3_URL:n}=gt().public,r=(s,v)=>{const{image:h,metadata:F,...I}=U?.value?.[s]||{},w=JSON.parse(F||"{}"),u={...t,...w};return h&&(u.image=h),Object.entries(I).forEach(([P,R])=>{if(R)try{u[P]=JSON.parse(R)}catch{u[P]=R}}),{image:u.image,external_url:`${n}/store/${_.value}/${Number(v)+s}`,description:`Copy #${Number(v)+s} of ${u.name}`,name:`${u.name} #${Number(v)+s}`,attributes:u.attributes}};await Q({classId:_.value,mintCount:e.mintCount,buildTokenMetadata:r})}catch(t){throw new Error("MINT_NFT_ERROR:"+t.toString())}finally{c.value=!1}}async function tt(t){c.value=!0;try{if(L.value=t,!await Y(t))throw new Error("Invalid NFT Class ID");const[r,s]=await Promise.all([J(t),z(t)]);if(!r)throw new Error("Invalid NFT Class ID");f.value={contentMetadata:r,owner:s,"@id":t},e.imageUrl=f.value.contentMetadata?.thumbnailUrl||"",e.externalUrl=f.value.contentMetadata?.url||"",_.value=t}catch(n){console.error(n)}finally{c.value=!1}}return p({startNFTMintFlow:K}),(t,n)=>{const r=it,s=lt,v=ut,h=mt,F=ft,I=rt;return d(),T("div",wt,[a(b)?(d(),S(r,{key:0,icon:"i-heroicons-exclamation-triangle",color:"error",variant:"soft",title:`${a(b)}`,close:{icon:"i-heroicons-x-mark-20-solid",color:"error",variant:"link"},onClose:n[0]||(n[0]=w=>b.value="")},null,8,["title"])):x("",!0),k(I,{class:"flex-1",ui:{body:"space-y-4"}},{header:E(()=>[y("h3",{class:"font-bold text-center",textContent:$(a(G))},null,8,Nt)]),default:E(()=>[y("div",Tt,[a(q)?(d(),T("img",{key:1,src:a(q),alt:"Cover preview",class:ct([o.isRestock?"max-w-[150px]":"max-w-[300px]","object-contain","rounded-lg","border","border-gray-200"])},null,10,xt)):(d(),S(s,{key:0,animation:"carousel",color:"primary",class:"w-full"}))]),o.isRestock&&a(g)?(d(),S(v,{key:0,modelValue:a(e).mintCount,"onUpdate:modelValue":n[1]||(n[1]=w=>a(e).mintCount=w),type:"number",class:"w-full max-w-[180px] mx-auto",placeholder:a(i)("nft.mint_count_placeholder")},null,8,["modelValue","placeholder"])):x("",!0),a(c)&&a(g)?(d(),T("div",kt,[y("div",Ut,[y("div",Mt,[k(h,{variant:"soft"},{default:E(()=>[dt($(o.isRestock?a(i)("nft.minting_restock"):a(i)("nft.minting")),1)]),_:1}),y("p",Dt,$(o.isRestock?a(i)("nft.minting_restock_in_progress",{count:a(e).mintCount}):a(i)("nft.minting_in_progress")),1)]),k(s,{animation:"carousel",color:"primary",class:"w-full"})])])):x("",!0),o.shouldShowSubmit?(d(),T("div",Ft,[k(F,{label:a(g)?a(i)("common.submit"):a(i)("loading.progress"),loading:a(c),size:"lg",disabled:a(c),onClick:K},null,8,["label","loading","disabled"])])):x("",!0)]),_:1})])}}}),Bt=Object.assign(It,{__name:"LiteMintNFT"});export{Bt as _};
