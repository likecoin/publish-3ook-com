import{c as D,r as R,a as m,u as L}from"./CSf5BCM0.js";import{cA as M,cr as P,c6 as b,cB as H,cC as O,cD as W,cE as q,cF as U,cG as J,ct as K,cu as j,cg as Q,Q as Y,A as z,cH as V,cI as X,cJ as G,u as Z,s as tt}from"./9S2XGRg9.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};a.SENTRY_RELEASE={id:"cd189bad150b481aa5ecb2e95de26ec677010e55"}}catch{}})();try{(function(){var a=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new a.Error().stack;n&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[n]="033facdb-b3da-4017-a4d7-57e0c236cde4",a._sentryDebugIdIdentifier="sentry-dbid-033facdb-b3da-4017-a4d7-57e0c236cde4")})()}catch{}async function nt(a,{address:n,blockNumber:e,blockTag:o=a.experimental_blockTag??"latest"}){const r=typeof e=="bigint"?M(e):void 0,s=await a.request({method:"eth_getBalance",params:[n,r||o]});return BigInt(s)}async function at(a,n){const{chainId:e,connector:o,...r}=n;let s;n.account?s=n.account:s=(await P(a,{account:n.account,assertChainId:!1,chainId:e,connector:o})).account;const l=a.getClient({chainId:e});return b(l,H,"estimateGas")({...r,account:s})}async function B(a,n){const{address:e,blockNumber:o,blockTag:r,chainId:s}=n,l=a.getClient({chainId:s}),g=await b(l,nt,"getBalance")(o?{address:e,blockNumber:o}:{address:e,blockTag:r}),d=a.chains.find(i=>i.id===s)??l.chain;return{decimals:d.nativeCurrency.decimals,symbol:d.nativeCurrency.symbol,value:g}}function et(a,n={}){const{chainId:e}=n,o=a.getClient({chainId:e});return b(o,O,"getGasPrice")({})}async function x(a,n){const{chainId:e,timeout:o=0,...r}=n,s=a.getClient({chainId:e}),w=await b(s,W,"waitForTransactionReceipt")({...r,timeout:o});if(w.status==="reverted"){const g=b(s,q,"getTransaction"),{from:d,...i}=await g({hash:w.transactionHash}),h=await b(s,D,"call")({...i,account:d,data:i.input,gasPrice:i.type!=="eip1559"?i.gasPrice:void 0,maxFeePerGas:i.type==="eip1559"?i.maxFeePerGas:void 0,maxPriorityFeePerGas:i.type==="eip1559"?i.maxPriorityFeePerGas:void 0}),t=h?.data?U(`0x${h.data.substring(138)}`):"unknown reason";throw new Error(t)}return{...w,chainId:s.chain.id}}async function ct(a,n){const{account:e,chainId:o,connector:r,...s}=n;let l;return typeof e=="object"&&e?.type==="local"?l=a.getClient({chainId:o}):l=await P(a,{account:e??void 0,assertChainId:!1,chainId:o,connector:r}),await b(l,J,"writeContract")({...s,...e?{account:e}:{},chain:o?{id:o}:null})}function st(a){return{mutationFn(n){return ct(a,n)},mutationKey:["writeContract"]}}function S(a={}){const{mutation:n}=a,e=K(a),o=st(e),{mutate:r,mutateAsync:s,...l}=j({...n,...o});return{...l,writeContract:r,writeContractAsync:s}}const ot=()=>{const{writeContractAsync:a}=S(),{$wagmiConfig:n}=Q(),{t:e}=Y(),o=z(),r=(t,c,u)=>{const f=G(c),y=G(u);o.add({icon:"i-heroicons-exclamation-circle",title:e("errors.insufficient_gas_fee"),description:e("errors.insufficient_gas_fee_description",{currentBalance:f,neededBalance:y}),duration:0,color:"warning",actions:[{label:e("errors.contact_support"),onClick:()=>{window.Intercom&&window.Intercom("showNewMessage",e("errors.insufficient_gas_fee_support_message",{walletAddress:t,currentBalance:f,neededBalance:y}))}}]})},s=async({classId:t,wallet:c},u)=>{const f=await R(n,{abi:m,address:t,functionName:u});if(!await R(n,{abi:m,address:t,functionName:"hasRole",args:[f,c]})){await d({wallet:c,address:t,abi:m,functionName:"ownerGrantRole",args:[f,c]});const C=await a({abi:m,address:t,functionName:"ownerGrantRole",args:[f,c]});await i({hash:C,confirmations:2}),console.log(`Granted ${u} to ${c} in class ${t}. Transaction hash: ${C}`)}},l=({classId:t,wallet:c})=>s({classId:t,wallet:c},"UPDATER_ROLE"),w=({classId:t,wallet:c})=>s({classId:t,wallet:c},"MINTER_ROLE"),g=async({wallet:t})=>{const c=await B(n,{address:t});if(c.value<=0n)throw new Error("WALLET_HAS_NO_BASE_ETH_BALANCE");return c},d=async t=>{const c=X({abi:t.abi,functionName:t.functionName,args:t.args});await h({wallet:t.wallet,tx:{to:t.address,data:c,value:t.value},value:t.value})},i=async t=>{let c;try{c=await x(n,t)}catch{await V(3e3),c=await x(n,t)}return c},T=async t=>{await h({wallet:t.wallet,tx:{to:t.to,value:t.value,data:t.data},value:t.value})},h=async t=>{const{wallet:c,tx:u,value:f}=t,y="to"in u,k="data"in u&&u.data!=null?1500000n:y?21000n:500000n,[p,F,A]=await Promise.allSettled([B(n,{address:c}),at(n,{...u,account:c}),et(n)]),_=p.status==="fulfilled"?p.value:{value:0n},E=F.status==="fulfilled"?F.value:k,$=A.status==="fulfilled"?A.value:1000000000n,v=E*$,I=v*120n/100n,N=I+(f??0n);if(_.value<N)throw r(c,_.value,N),new Error("INSUFFICIENT_GAS_FEE_BALANCE");return{balance:_,gasEstimate:E,estimatedGasCost:v,requiredBalance:I}};return{checkAndGrantUpdater:l,checkAndGrantMinter:w,assertPositiveWalletBalance:g,assertSufficientBalanceForTransaction:d,assertSufficientBalanceForTransfer:T,waitForTransactionReceipt:i}};function lt(){const a=Z(),{wallet:n}=tt(a),{checkAndGrantMinter:e,assertSufficientBalanceForTransaction:o,waitForTransactionReceipt:r}=ot(),{getClassCurrentTokenId:s}=L(),{writeContractAsync:l}=S();async function w(g){const{classId:d,mintCount:i,buildTokenMetadata:T}=g;await e({classId:d,wallet:n.value});const h=await s(d),t=[...Array(i).keys()].map(y=>T(y,h)),c={address:d,abi:m,functionName:"safeMintWithTokenId",args:[h,Array(i).fill(n.value),Array(i).fill(""),t.map(y=>JSON.stringify(y))]};await o({wallet:n.value,...c});const u=await l(c),f=await r({hash:u,confirmations:2});if(!f||f.status!=="success")throw new Error("NFT minting failed");return{txHash:u,fromTokenId:h}}return{mintNFT:w}}export{S as a,lt as b,ot as u};
