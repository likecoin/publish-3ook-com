import{Q as Z,c as x,e as D,r as G,al as oe,g as re,b as ie,w as ce,o as ue,l as P,m as T,n as u,L as g,W as de,p as _,M as C,q as a,a1 as fe,N as me,X as pe,Y as ge,an as _e,aq as be,C as he,aE as H,ad as F,a7 as ye,$ as J}from"./9S2XGRg9.js";import{_ as ve}from"./D3om2a5D.js";import{_ as ke}from"./drKZnbC8.js";import{_ as xe}from"./DBITDbxI.js";import{_ as Ce}from"./CLuOJMie.js";import{u as Se}from"./RNJfQWMs.js";(function(){try{var o=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};o.SENTRY_RELEASE={id:"cd189bad150b481aa5ecb2e95de26ec677010e55"}}catch{}})();try{(function(){var o=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},d=new o.Error().stack;d&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[d]="e701e5bd-eced-4d8e-b31d-ef49a8e52ae1",o._sentryDebugIdIdentifier="sentry-dbid-e701e5bd-eced-4d8e-b31d-ef49a8e52ae1")})()}catch{}function we(){const{t:o}=Z(),d=Se(),m=D({page:1,limit:100,total:0}),r=D({column:null,direction:null}),U=[{label:"25",value:25},{label:"50",value:50},{label:"100",value:100},{label:"200",value:200}],y=D([]),E=x(()=>y.value.length>0),h=x(()=>y.value.length),N=x(()=>[{key:"readerEmail",label:o("table.reader_email"),accessorKey:"readerEmail",header:o("table.reader_email")},{key:"readerWallet",label:o("table.reader_wallet"),accessorKey:"readerWallet",header:o("table.reader_wallet")},{key:"firstPurchaseTime",label:o("table.first_purchase"),accessorKey:"firstPurchaseTime",header:o("table.first_purchase")},{key:"lastPurchaseTime",label:o("table.last_purchase"),accessorKey:"lastPurchaseTime",header:o("table.last_purchase")},{key:"lifetimeValue",label:o("table.lifetime_value"),accessorKey:"lifetimeValue",header:o("table.lifetime_value")},{key:"hasMessage",label:o("table.has_message"),accessorKey:"hasMessage",header:o("table.has_message")}]),W=x(()=>{const e=N.value.map(l=>({key:l.key,label:l.label,accessorKey:l.accessorKey,header:l.header})),s=Object.values(d.booksInfo).map(l=>({key:`book_${l.classId}`,label:l.name?.slice(0,1)||l.classId.slice(0,1),accessorKey:`book_${l.classId}`,header:l.name?.slice(0,1)||l.classId.slice(0,1)}));return[...e,...s]}),M=x(()=>{const e=[...d.readers];return!r.value.column||!r.value.direction?e.sort((s,l)=>l.lifetimeValue-s.lifetimeValue):e.sort((s,l)=>{const n=s[r.value.column],c=l[r.value.column];let p=0;if(r.value.column.includes("Time")){const v=new Date(n).getTime(),i=new Date(c).getTime();p=v-i}else typeof n=="string"&&typeof c=="string"?p=n.localeCompare(c):typeof n=="number"&&typeof c=="number"?p=n-c:typeof n=="boolean"&&typeof c=="boolean"?p=(n?1:0)-(c?1:0):n==null&&c==null?p=0:n==null?p=-1:c==null?p=1:p=String(n).localeCompare(String(c));return r.value.direction==="desc"?-p:p})}),S=x(()=>{m.value.total=d.readers.length;const e=(m.value.page-1)*m.value.limit,s=e+m.value.limit;return M.value.slice(e,s)}),j=x(()=>Math.ceil(m.value.total/m.value.limit));function z(e){y.value=e}function B(){y.value=[]}function $(e,s="zh-TW"){if(!e)return"-";const l=new Date(e);return isNaN(l.getTime())?"-":l.toLocaleDateString(s,{year:"numeric",month:"2-digit",day:"2-digit"})}function I(e,s=2){return typeof e!="number"||isNaN(e)?"0.00":`${e.toFixed(s)}`}function L(e,s){r.value.column=e,r.value.direction=s}function O(e){const s=Math.ceil(m.value.total/m.value.limit);m.value.page=Math.max(1,Math.min(e,s))}function K(e){m.value.limit=e,m.value.page=1}function V(e,s=6,l=4){return e?e.length<=s+l?e:`${e.slice(0,s)}...${e.slice(-l)}`:""}function Y(e){return e?`https://opensea.io/${e}`:""}function A(e,s,l){return e===l?s==="asc"?"i-heroicons-bars-arrow-up-20-solid":"i-heroicons-bars-arrow-down-20-solid":"i-heroicons-arrows-up-down-20-solid"}function q(e,s){return s.split(".").reduce((l,n)=>{if(l&&typeof l=="object")return l[n]},e)}async function w(e,s,l){if(e.length===0)return;const n=e.map(v=>{const i={};return s.forEach(f=>{const b=q(v,f.key);i[f.label]=f.formatter?f.formatter(b):b}),i}),c=s.map(v=>({accessorKey:v.label,header:v.label})),p=l||`export_${new Date().toISOString().split("T")[0]}.csv`;await oe(n,c,p)}async function k(){const e=E.value?y.value:d.readers,s=[{key:"readerEmail",label:o("table.reader_email")},{key:"readerWallet",label:o("table.reader_wallet")},{key:"firstPurchaseTime",label:o("table.first_purchase"),formatter:n=>$(n)},{key:"lastPurchaseTime",label:o("table.last_purchase"),formatter:n=>$(n)},{key:"lifetimeValue",label:`${o("table.lifetime_value")} (USD)`,formatter:n=>I(n)},{key:"hasMessage",label:o("table.has_message"),formatter:n=>n?"Y":"N"},...Object.values(d.booksInfo).map(n=>({key:`purchasedBooks.${n.classId}`,label:n.name||n.classId,formatter:c=>c?"Y":"N"}))],l=`readers_export_${new Date().toISOString().split("T")[0]}.csv`;await w(e,s,l)}return{ordersStore:d,sortedReaders:M,paginatedReaders:S,columns:W,totalPages:j,pagination:G(m),sortState:G(r),selectedRows:y,hasSelection:E,selectionCount:h,baseColumnsConfig:N,setSortState:L,setPage:O,setPageSize:K,onSelect:z,clearSelection:B,formatDate:$,formatCurrency:I,shortenWallet:V,getWalletLink:Y,getSortIcon:A,pageSizeOptions:U,exportToCSV:w,exportReadersToCSV:k}}const Te={class:"flex justify-between items-center"},$e=["textContent"],Ie={class:"flex gap-2"},Ve={class:"flex justify-between items-center"},Pe=["textContent"],De={class:"flex items-center gap-2"},Ee=["textContent"],Ne={class:"w-full flex justify-start"},Me={key:1,class:"text-gray-400"},Re=["textContent"],Ue=["textContent"],We=["textContent"],je={class:"flex justify-center w-full"},ze={class:"flex justify-center w-full"},Be={class:"flex justify-end items-center"},Fe=re({__name:"index",setup(o){const{t:d}=Z(),m=ie(),{ordersStore:r,paginatedReaders:U,columns:y,pagination:E,sortState:h,selectedRows:N,hasSelection:W,selectionCount:M,setSortState:S,setPage:j,setPageSize:z,onSelect:B,clearSelection:$,formatDate:I,formatCurrency:L,shortenWallet:O,getWalletLink:K,getSortIcon:V,baseColumnsConfig:Y,pageSizeOptions:A,exportReadersToCSV:q}=we(),w=D(100),k=D(1);ce(k,i=>{j(i)}),ue(async()=>{m.isAuthenticated&&await e()});async function e(){await r.fetchReaders()}async function s(){await r.fetchReaders(!0),$()}function l(i){z(i),k.value=1}function n(i){const f=h.value;f.column===i?f.direction==="asc"?S(i,"desc"):f.direction==="desc"?S(null,null):S(i,"asc"):S(i,"asc")}function c(){q()}function p(i){window.open(`mailto:${i}`,"_self")}function v(i){window.open(K(i),"_blank")}return(i,f)=>{const b=fe,ee=pe,te=ve,Q=ye,X=be,ae=ke,le=xe,ne=ge,se=Ce;return T(),P(se,{class:"space-y-6"},{default:u(()=>[g("div",Te,[g("h1",{class:"text-lg font-bold font-mono",textContent:C(a(d)("menu.readers_list"))},null,8,$e),g("div",Ie,[_(b,{icon:"i-hugeicons-csv-02",color:"primary",variant:"outline",onClick:c},{default:u(()=>[me(C(a(d)("common.export_csv",{length:a(W)?a(M):a(r).readers.length})),1)]),_:1}),_(b,{icon:"i-heroicons-arrow-path",variant:"outline",color:"neutral",disabled:a(r).isLoading,loading:a(r).isLoading,onClick:s},null,8,["disabled","loading"])])]),a(r).error?(T(),P(ee,{key:0,icon:"i-heroicons-exclamation-triangle",color:"error",variant:"soft",title:a(r).error,close:{icon:"i-heroicons-x-mark-20-solid",color:"error",variant:"link"},onClose:f[0]||(f[0]=t=>a(r).clearError())},null,8,["title"])):de("",!0),_(ne,{ui:{body:"p-0!"}},{header:u(()=>[g("div",Ve,[g("h3",{class:"font-medium",textContent:C(a(d)("readers.total_readers",{count:a(r).isLoading?"...":a(r).readers.length}))},null,8,Pe),g("div",De,[g("span",{class:"text-sm text-gray-500",textContent:C(a(d)("common.page_size"))},null,8,Ee),_(te,{modelValue:a(w),"onUpdate:modelValue":[f[1]||(f[1]=t=>J(w)?w.value=t:null),l],items:a(A),size:"sm"},null,8,["modelValue","items"])])])]),footer:u(()=>[g("div",Be,[_(le,{page:a(k),"onUpdate:page":f[2]||(f[2]=t=>J(k)?k.value=t:null),"page-count":a(E).limit,total:a(r).readers.length,max:7,"show-last":"","show-first":""},null,8,["page","page-count","total"])])]),default:u(()=>[_(ae,{"model-value":a(N),data:a(U),columns:a(y),loading:a(r).isLoading,progress:{color:"primary",animation:"carousel"},ui:{th:"text-left text-nowrap whitespace-nowrap",td:"text-right",tr:"cursor-default [&>td]:pointer-events-none [&>td>*]:pointer-events-auto [&>td>input]:pointer-events-auto hover:bg-gray-50 dark:hover:bg-gray-800/30 transition-colors duration-200"},"onUpdate:modelValue":a(B)},_e({"readerEmail-cell":u(({row:t})=>[g("div",Ne,[_(b,{label:t.original.readerEmail,variant:"link",size:"sm",onClick:H(R=>p(t.original.readerEmail),["stop"])},null,8,["label","onClick"])])]),"readerWallet-cell":u(({row:t})=>[t.original.readerWallet?(T(),P(b,{key:0,class:"font-mono",label:a(O)(t.original.readerWallet),variant:"link",size:"sm",onClick:H(R=>v(t.original.readerWallet),["stop"])},null,8,["label","onClick"])):(T(),he("span",Me,"-"))]),"firstPurchaseTime-cell":u(({row:t})=>[g("span",{class:"text-sm",textContent:C(a(I)(t.original.firstPurchaseTime))},null,8,Re)]),"lastPurchaseTime-cell":u(({row:t})=>[g("span",{class:"text-sm",textContent:C(a(I)(t.original.lastPurchaseTime))},null,8,Ue)]),"lifetimeValue-cell":u(({row:t})=>[g("span",{class:"font-medium",textContent:C(`$${a(L)(t.original.lifetimeValue)}`)},null,8,We)]),"hasMessage-cell":u(({row:t})=>[g("div",je,[_(X,{color:t.original.hasMessage?"success":"neutral",label:t.original.hasMessage?"Y":"N",variant:"soft"},null,8,["color","label"])])]),_:2},[F(a(Y),t=>({name:`${t.key}-header`,fn:u(()=>[t.key!=="lifetimeValue"?(T(),P(b,{key:0,color:"neutral",variant:"ghost",label:t.label,"trailing-icon":a(V)(a(h).column,a(h).direction,t.key),onClick:()=>n(t.key)},null,8,["label","trailing-icon","onClick"])):(T(),P(Q,{key:1,text:"USD"},{default:u(()=>[_(b,{color:"neutral",variant:"ghost",label:t.label,"trailing-icon":a(V)(a(h).column,a(h).direction,t.key),onClick:()=>n(t.key)},null,8,["label","trailing-icon","onClick"])]),_:2},1024))])})),F(Object.values(a(r).booksInfo),t=>({name:`book_${t.classId}-header`,fn:u(()=>[_(Q,{text:t.name||t.classId,class:"cursor-help"},{default:u(()=>[_(b,{color:"neutral",variant:"ghost",label:t.name?.slice(0,1)||t.classId.slice(0,1),"trailing-icon":a(V)(a(h).column,a(h).direction,`book_${t.classId}`),onClick:()=>n(`book_${t.classId}`)},null,8,["label","trailing-icon","onClick"])]),_:2},1032,["text"])])})),F(Object.values(a(r).booksInfo),t=>({name:`book_${t.classId}-cell`,fn:u(({row:R})=>[g("div",ze,[_(X,{color:R.original[`book_${t.classId}`]?"success":"neutral",label:R.original[`book_${t.classId}`]?"Y":"N",variant:"soft"},null,8,["color","label"])])])}))]),1032,["model-value","data","columns","loading","onUpdate:modelValue"])]),_:1})]),_:1})}}});export{Fe as default};
