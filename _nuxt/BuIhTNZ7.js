import{_ as Ce}from"./BRD0zS0z.js";import{g as ye,Q as ke,B as we,A as Se,a as Ue,w as G,V as $e,o as Ve,e as u,l as $,m as v,n as i,p as l,q as t,c as S,Y as Ne,a1 as Me,L as r,a8 as Re,C as q,W as V,M as H,$ as I,a9 as Te,aa as X,ab as Ee,a0 as Pe,ac as Le,ad as Oe,a6 as Ae}from"./9S2XGRg9.js";import{_ as Be}from"./BAMg4a5m.js";import{_ as De}from"./D3om2a5D.js";import{_ as Fe}from"./drKZnbC8.js";import{_ as ze}from"./CL7xOAbk.js";import{_ as je}from"./CGyKrs8V.js";import{_ as qe}from"./CLuOJMie.js";import{_ as Je}from"./Bzm9dzjm.js";import{u as Qe}from"./DJApvAF_.js";import"./DVNOgE3D.js";import"./DvvTWQeW.js";import"./D89E3aNf.js";import"./CSf5BCM0.js";(function(){try{var p=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};p.SENTRY_RELEASE={id:"cd189bad150b481aa5ecb2e95de26ec677010e55"}}catch{}})();try{(function(){var p=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},c=new p.Error().stack;c&&(p._sentryDebugIds=p._sentryDebugIds||{},p._sentryDebugIds[c]="2da0ce65-15c7-4d85-8caf-ce4ee6292587",p._sentryDebugIdIdentifier="sentry-dbid-2da0ce65-15c7-4d85-8caf-ce4ee6292587")})()}catch{}const Ke={class:"flex items-center gap-2"},We=["textContent"],Ye={class:"flex items-start gap-4"},Ge=["src"],He={class:"flex flex-col justify-start"},Xe=["textContent"],Ze={class:"text-center"},eo={class:"flex items-center gap-2 px-4 sm:px-6"},oo={class:"flex items-center gap-2"},to={class:"flex justify-center items-center gap-4"},no={class:"space-y-4"},lo={class:"flex items-center gap-2"},ao={class:"flex justify-center gap-4"},so={class:"space-y-4"},Co=ye({__name:"index",setup(p){const{t:c}=ke(),Z=we(),P=Se(),{BOOK3_URL:ee}=Ue().public,L=Qe(),{lazyFetchClassMetadataById:J,lazyFetchClassListingInfoById:Q}=L,m=u([{id:0,value:""}]),K=u(1),g=u(!1),b=u(""),x=u(""),C=u([]),_=u(""),f=u([]),h=u(!1),U=u(!1),y=u(!1);G(h,o=>{o||(m.value=[{id:0,value:""}],K.value=1)});const oe=S(()=>{const o=[{accessorKey:"name",header:c("common.name"),class:""}];return y.value&&o.push({accessorKey:"delete-action",header:"",class:"w-12"}),o}),te=S(()=>{const o=[];return O.value.length&&o.push([{label:y.value?"Exit Edit Items":"Edit Items",icon:y.value?"i-heroicons-pencil-solid":"i-heroicons-pencil",onSelect:de}]),o.push([{label:"New Coupon",icon:"i-heroicons-tag",onSelect:()=>{g.value=!g.value}},{class:"text-red-500",label:"Clear All Coupons",icon:"i-heroicons-trash",disabled:!C.value.length,onSelect:pe}]),o});function ne(o){return o?o.map(e=>{const a=e.name;return{label:(typeof a=="object"?a?.zh||a?.en:a)||"",value:e.index||0}}):[]}const O=S(()=>f.value?.map((o,e)=>{const s=L.getClassListingInfoById(o.classId)?.prices,M=L.getClassMetadataById(o.classId),F=M?.data?.metadata;return{classId:o.classId,name:M?.name||"",prices:s?.map(z=>({...z})),image:Ae(F?.image||""),index:e}})),k=u([]),N=S(()=>k.value.map(e=>f.value[e.index]).sort((e,a)=>e?.priceIndex!==void 0&&!a?.priceIndex?-1:!e?.priceIndex&&a?.priceIndex!==void 0?1:0));G(O,o=>{o.length||(y.value=!1)});const w=S(()=>{const o=new URLSearchParams({utm_source:"direct-checkout",utm_medium:"pos"}),e=N.value.filter(a=>!!a).map(({classId:a,priceIndex:s})=>`${a}${s?`:${s}`:""}`).join(",");return o.append("products",e),_.value&&o.append("coupon",_.value),`${ee}/checkout?${o.toString()}`}),A=S(()=>"3ook Point Of Sale");$e({title:()=>A.value,ogTitle:()=>A.value}),Ve(()=>{try{const o=window.localStorage.getItem("nft_book_store_pos_items");if(o){const a=JSON.parse(o);f.value=a.map(s=>({classId:s.classId,priceIndex:s.priceIndex}))}const e=window.localStorage.getItem("nft_book_store_pos_coupons");if(e){const a=JSON.parse(e);C.value=a.map(s=>({name:s.name,code:s.code}))}}catch(o){console.error(o)}f.value.forEach(o=>{o.classId&&(J(o.classId),Q(o.classId))})});function le(){m.value.length&&m.value.push({id:K.value++,value:""})}function ae(o){m.value.splice(o,1)}function se(o,e){const a=m.value[o];a&&(a.error=void 0,a.value=e)}function ie(){m.value.forEach(o=>{o.error=void 0;let e=o.value.trim();e.startsWith("http")&&(e=new URL(e).pathname.split("/").pop()||""),e.startsWith("0x")?(f.value.push({classId:e,priceIndex:0}),J(e),Q(e)):o.error=new Error("Invalid product ID")}),m.value.every(o=>!o.error)&&(h.value=!1,B())}function re(o,{index:e}){const a=f.value[e];a&&(a.priceIndex=Number(o)),B()}function ce({index:o}){f.value.splice(o,1),k.value=k.value.filter(e=>e.index!==o),B()}function W(){h.value=!h.value}function de(){y.value=!y.value}function ue(){C.value.push({name:b.value,code:x.value}),b.value="",x.value="",Y(),P.add({title:"Added coupon",duration:2e3,color:"success"}),g.value=!1}function pe(){window.confirm("Are you sure you want to clear all coupons?")&&(C.value=[],_.value="",Y(),P.add({title:"Cleared all coupons",duration:2e3,color:"error"}))}function B(){window.localStorage.setItem("nft_book_store_pos_items",JSON.stringify(f.value))}function Y(){window.localStorage.setItem("nft_book_store_pos_coupons",JSON.stringify(C.value))}function me(){P.add({title:"Copied URL to clipboard",duration:2e3}),navigator.clipboard.writeText(w.value)}function fe(){window.open(w.value)}function _e(){U.value=!0}return(o,e)=>{const a=Ce,s=Me,M=Be,D=De,F=Re,z=Fe,ve=Te,R=Pe,T=Ee,ge=ze,j=Le,he=je,Ie=Ne,be=qe,xe=Je;return v(),$(xe,{key:t(Z).path},{default:i(()=>[l(a,{title:t(A)},null,8,["title"]),l(be,{ui:{base:"flex flex-col items-stretch grow space-y-4",padding:"max-md:px-0! max-md:py-0"}},{default:i(()=>[l(Ie,{class:"max-md:rounded-none",ui:{root:"flex flex-col grow",header:"flex justify-between items-center gap-4",body:"grow p-0",footer:"sticky bottom-0 bg-white dark:bg-gray-900 rounded-b-[inherit] px-0 sm:px-0 space-y-4"}},{header:i(()=>[r("div",Ke,[r("h2",{class:"text-xl font-bold",textContent:H(t(c)("sales_pos.sales_items")+(t(N).length>0?t(c)("sales_pos.selected_count",{count:t(N).length}):""))},null,8,We),l(s,{icon:"i-heroicons-plus-circle",variant:"soft",onClick:W})]),l(M,{items:t(te),popper:{placement:"bottom-end"}},{default:i(()=>[l(s,{color:"neutral",variant:"outline",icon:"i-heroicons-ellipsis-horizontal-circle"})]),_:1},8,["items"])]),footer:i(()=>[r("div",eo,[l(D,{modelValue:t(_),"onUpdate:modelValue":e[1]||(e[1]=n=>I(_)?_.value=n:null),class:"grow",items:t(C).map(n=>({label:n.name,value:n.code})),placeholder:t(c)("sales_pos.select_coupon")},null,8,["modelValue","items","placeholder"]),t(_)?(v(),$(s,{key:0,icon:"i-heroicons-x-mark-16-solid",size:"sm",color:"neutral",variant:"outline",onClick:e[2]||(e[2]=()=>{_.value=""})})):V("",!0)]),l(ve),l(he,{class:"w-full",items:[{value:"direct",label:t(c)("sales_pos.direct_checkout")}],ui:{root:"px-4 sm:px-6",content:"flex flex-col space-y-4"}},{content:i(({item:n})=>[n.value==="direct"?(v(),q(X,{key:0},[l(T,{label:t(c)("sales_pos.checkout_url")},{default:i(()=>[r("div",oo,[l(R,{modelValue:t(w),"onUpdate:modelValue":e[3]||(e[3]=d=>I(w)?w.value=d:null),class:"grow font-mono",readonly:""},null,8,["modelValue"]),l(s,{icon:"i-heroicons-clipboard-document",variant:"soft",color:"neutral",onClick:me})])]),_:1},8,["label"]),r("div",to,[l(s,{label:t(c)("sales_pos.view_cart"),size:"lg",onClick:fe},null,8,["label"]),l(s,{label:t(c)("sales_pos.generate_qr_code"),disabled:!t(N).length,size:"lg",onClick:_e},null,8,["label","disabled"]),l(j,{open:t(U),"onUpdate:open":e[5]||(e[5]=d=>I(U)?U.value=d:null)},{content:i(()=>[l(ge,{data:t(w),mode:"readonly","file-name":"likerland_checkout",width:280,height:280},{header:i(()=>[e[11]||(e[11]=r("h3",{class:"font-bold font-mono",textContent:"Scan to buy"},null,-1)),l(s,{icon:"i-heroicons-x-mark",color:"neutral",variant:"ghost",onClick:e[4]||(e[4]=d=>U.value=!1)})]),_:1},8,["data"])]),_:1},8,["open"])])],64)):V("",!0)]),_:1},8,["items"])]),default:i(()=>[l(z,{columns:t(oe),data:t(O),ui:{root:"static h-full",thead:"sticky top-0"},onSelect:e[0]||(e[0]=n=>{const d=t(k).findIndex(E=>E.index===n.original.index);d>=0?t(k).splice(d,1):t(k).push(n.original)})},{"name-cell":i(({row:n})=>[r("div",Ye,[n.original.image?(v(),q("img",{key:0,class:"w-[64px] object-contain rounded-sm",src:n.original.image,alt:"Item image"},null,8,Ge)):V("",!0),r("div",He,[r("div",{class:"whitespace-break-spaces",textContent:H(n.original.name)},null,8,Xe),n.original.classId&&(n.original.prices?.length??0)>1?(v(),$(D,{key:0,class:"mt-2","model-value":t(f)[n.original.index]?.priceIndex||0,items:ne(n.original.prices),"onUpdate:modelValue":d=>re(d,n.original)},null,8,["model-value","items","onUpdate:modelValue"])):V("",!0)])])]),"delete-action-header":i(()=>[r("div",Ze,[l(F,{name:"i-heroicons-trash-solid"})])]),"delete-action-cell":i(({row:n})=>[l(s,{icon:"i-heroicons-x-mark",color:"error",variant:"link",onClick:d=>ce(n.original)},null,8,["onClick"])]),_:1},8,["columns","data"])]),_:1}),l(j,{open:t(h),"onUpdate:open":e[6]||(e[6]=n=>I(h)?h.value=n:null)},{header:i(()=>[e[12]||(e[12]=r("h3",{class:"font-bold font-mono",textContent:"Add Item(s)"},null,-1)),l(s,{icon:"i-heroicons-x-mark",color:"neutral",variant:"link",onClick:W})]),body:i(()=>[r("div",no,[(v(!0),q(X,null,Oe(t(m),(n,d)=>(v(),$(T,{key:`input-${n.id}`,label:t(c)("sales_pos.enter_product_id_urls"),required:!0,error:n.error?.message},{default:i(()=>[r("div",lo,[l(R,{class:"grow font-mono","model-value":n.value,placeholder:"https://3ook.com/store/0x....","onUpdate:modelValue":E=>se(d,E)},null,8,["model-value","onUpdate:modelValue"]),t(m).length>1?(v(),$(s,{key:0,icon:"i-heroicons-x-circle",variant:"link",onClick:E=>ae(d)},null,8,["onClick"])):V("",!0)])]),_:2},1032,["label","error"]))),128)),r("div",ao,[l(s,{icon:"i-heroicons-plus-circle",label:t(c)("sales_pos.add"),variant:"outline",onClick:le},null,8,["label"])])])]),footer:i(()=>[l(s,{label:"Confirm",onClick:ie})]),_:1},8,["open"]),l(j,{open:t(g),"onUpdate:open":e[10]||(e[10]=n=>I(g)?g.value=n:null)},{header:i(()=>[e[13]||(e[13]=r("h3",{class:"font-bold",textContent:"Add Coupon"},null,-1)),l(s,{icon:"i-heroicons-x-mark-16-solid",color:"neutral",size:"xl",variant:"link",onClick:e[7]||(e[7]=n=>g.value=!1)})]),body:i(()=>[r("div",so,[l(T,{label:"Coupon Name",help:"For POS Display Only",required:!0},{default:i(()=>[l(R,{modelValue:t(b),"onUpdate:modelValue":e[8]||(e[8]=n=>I(b)?b.value=n:null),placeholder:"Fall Promotion"},null,8,["modelValue"])]),_:1}),l(T,{label:"Coupon Code",required:!0},{default:i(()=>[l(R,{modelValue:t(x),"onUpdate:modelValue":e[9]||(e[9]=n=>I(x)?x.value=n:null),class:"font-mono",placeholder:"FALLPROMO"},null,8,["modelValue"])]),_:1})])]),footer:i(()=>[l(s,{icon:"i-heroicons-plus-circle",label:"Add Coupon",disabled:!t(b)||!t(x),onClick:ue},null,8,["disabled"])]),_:1},8,["open"])]),_:1})]),_:1})}}});export{Co as default};
