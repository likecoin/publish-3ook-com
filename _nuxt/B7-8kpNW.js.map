{"version":3,"mappings":";w1CAGO,eAAeA,GAAsBC,EAAQC,EAAY,CAC5D,KAAM,CAAE,QAAAC,EAAS,GAAGC,CAAI,EAAKF,EACvBG,EAASJ,EAAO,UAAU,CAAE,QAAAE,CAAO,CAAE,EAE3C,OADeG,GAAUD,EAAQE,GAA4B,uBAAuB,EACtEH,CAAI,CACtB,CCNO,IAAKI,OACVA,EAAA,QAAU,UACVA,EAAA,gBAAkB,YAClBA,EAAA,eAAiB,iBACjBA,EAAA,aAAe,eACfA,EAAA,YAAc,cACdA,EAAA,QAAU,UACVA,EAAA,OAAS,SACTA,EAAA,QAAU,UACVA,EAAA,UAAY,YACZA,EAAA,OAAS,SAVCA,OAAA,IAaL,MAAMC,GAAuB,CAAC,aAAc,mBAAoB,cAAe,sBAAsB,EAE/FC,GAAkB,CAC7B,aACA,mBACA,cACA,qBACA,YACA,OACA,eACA,aACA,OACA,uBACA,eACA,gBACA,eACA,sBACA,eACA,YACA,aACA,UACF,EAEaC,GAA6D,CACxE,WAAY,OAAOC,EAAa,EAChC,aAAcC,GACd,oBAAqBC,GACrB,aAAc,OAAOC,EAAwB,EAC7C,WAAY,OAAOC,EAAsB,EACzC,SAAUC,EACZ,EAEaC,GAAqB,CAChC,GAAGR,GACH,WACA,eACA,mBACA,kBACA,mBACA,SACA,QACF,EAqHO,SAASS,GAAaC,EAAuBC,EAAkC,CACpF,MAAMC,EAAOF,EAAI,KACbA,EAAI,KAAK,MAAM,GAAG,EAAE,IAAIG,GAAKA,EAAE,MAAM,EAAE,OAAO,OAAO,EACrD,GAEEC,EAAYJ,EAAI,WAAa,WAAWA,EAAI,UAAU,EAAIR,GAEhE,MAAO,CACL,GAAI,OAAO,aACX,SAAAS,EACA,MAAOD,EAAI,YAAY,QAAU,GACjC,YAAaA,EAAI,kBAAkB,QAAU,GAC7C,WAAYA,EAAI,aAAa,QAAU,GACvC,kBAAmBA,EAAI,oBAAoB,OAC3C,UAAWA,EAAI,WAAW,QAAU,GACpC,KAAMA,EAAI,MAAM,OAChB,YAAaA,EAAI,cAAc,QAAU,GACzC,UAAW,MAAMI,CAAS,EAAIZ,GAAgBY,EAC9C,KAAAF,EACA,mBAAoBF,EAAI,sBAAsB,QAAU,GACxD,YAAaA,EAAI,cAAc,QAAU,OACzC,aAAcA,EAAI,eAAe,QAAU,OAC3C,YAAaA,EAAI,cAAc,QAAUP,GACzC,mBAAoBO,EAAI,qBAAqB,QAAUN,GACvD,cAAeM,EAAI,cAAc,OAAO,gBAAkB,QAC1D,SAAUA,EAAI,WAAW,QAAU,GACnC,UAAWA,EAAI,YAAY,OAAO,gBAAkB,OACpD,SAAUA,EAAI,UAAU,QAAUH,GAClC,OAAQ,UAEZ,CAEA,MAAMQ,GAAuB,CAAC,OAAQ,QAAS,EAAE,EAE1C,SAASC,GAAcC,EAAsBC,EAAwD,CAC1G,MAAMC,EAAsC,GACtC,CAAE,SAAAR,GAAaM,EAmCrB,GAjCKA,EAAK,OACRE,EAAO,KAAK,CAAE,SAAAR,EAAU,MAAO,aAAc,QAAS,wCAAyC,EAG5FM,EAAK,aACRE,EAAO,KAAK,CAAE,SAAAR,EAAU,MAAO,mBAAoB,QAAS,8CAA+C,EAGzGM,EAAK,aAAeA,EAAK,YAAY,OAAS,KAChDE,EAAO,KAAK,CAAE,SAAAR,EAAU,MAAO,mBAAoB,QAAS,8CAA+C,EAGxGM,EAAK,YACRE,EAAO,KAAK,CAAE,SAAAR,EAAU,MAAO,cAAe,QAAS,yCAA0C,EAG/FM,EAAK,YAAc,GAAKA,EAAK,UAAYG,IAC3CD,EAAO,KAAK,CAAE,SAAAR,EAAU,MAAO,aAAc,QAAS,kCAAmC,OAAQ,CAAE,SAAUS,EAAA,CAAc,CAAG,EAG3HH,EAAK,oBACRE,EAAO,KAAK,CAAE,SAAAR,EAAU,MAAO,uBAAwB,QAAS,mCAAoC,EAGlG,CAACM,EAAK,aAAe,CAACA,EAAK,cAC7BE,EAAO,KAAK,CAAE,SAAAR,EAAU,MAAO,6BAA8B,QAAS,mCAAoC,EAGxGM,EAAK,UAAY,CAACA,EAAK,eACzBE,EAAO,KAAK,CAAE,SAAAR,EAAU,MAAO,YAAa,QAAS,oDAAqD,EAIxGO,EAAQ,CACV,MAAMG,EAAiBH,EAAO,cAAc,OAAO,eAAiB,GAChEG,GAAkB,CAACN,GAAqB,SAASM,CAAc,GACjEF,EAAO,KAAK,CAAE,SAAAR,EAAU,MAAO,eAAgB,QAAS,oCAAqC,OAAQ,CAAE,MAAO,eAAgB,MAAOO,EAAO,aAAc,MAAK,EAAK,EAEtK,MAAMI,EAAeJ,EAAO,YAAY,OAAO,eAAiB,GAC5DI,GAAgB,CAACP,GAAqB,SAASO,CAAY,GAC7DH,EAAO,KAAK,CAAE,SAAAR,EAAU,MAAO,aAAc,QAAS,oCAAqC,OAAQ,CAAE,MAAO,aAAc,MAAOO,EAAO,WAAY,MAAK,EAAK,CAElK,CAEA,OAAOC,CACT,CAEO,SAASI,GAAeC,EAAsD,CACnF,MAAML,EAAsC,GACtCM,MAAW,IAEjB,UAAWR,KAAQO,EAAO,CACxB,MAAME,EAA+C,GACjDT,EAAK,oBAAsBS,EAAU,KAAK,CAAE,KAAMT,EAAK,mBAAoB,MAAO,uBAAwB,EAC1GA,EAAK,aAAeS,EAAU,KAAK,CAAE,KAAMT,EAAK,YAAa,MAAO,eAAgB,EACpFA,EAAK,cAAgBS,EAAU,KAAK,CAAE,KAAMT,EAAK,aAAc,MAAO,gBAAiB,EAE3F,SAAW,CAAE,KAAAU,EAAM,MAAAC,CAAA,IAAWF,EAAW,CACvC,MAAMG,EAAMF,EAAK,cACXG,EAAWL,EAAK,IAAII,CAAG,EACzBC,EACFX,EAAO,KAAK,CACV,SAAUF,EAAK,SACf,MAAAW,EACA,QAAS,uCACT,OAAQ,CAAE,SAAUD,EAAM,SAAUG,EAAS,SAAU,WAAYA,EAAS,MAAM,CACnF,EAEDL,EAAK,IAAII,EAAK,CAAE,SAAUZ,EAAK,SAAU,MAAAW,EAAO,CAEpD,CACF,CAEA,OAAOT,CACT,CAEO,SAASY,GAAed,EAAgD,CAC7E,MAAO,CACL,GAAIA,EAAK,GACT,SAAUA,EAAK,SACf,MAAOA,EAAK,MACZ,YAAaA,EAAK,YAClB,WAAYA,EAAK,WACjB,kBAAmBA,EAAK,kBACxB,UAAWA,EAAK,UAChB,KAAMA,EAAK,KACX,YAAaA,EAAK,YAClB,UAAWA,EAAK,UAChB,KAAMA,EAAK,KACX,mBAAoBA,EAAK,mBACzB,YAAaA,EAAK,YAClB,aAAcA,EAAK,aACnB,YAAaA,EAAK,YAClB,mBAAoBA,EAAK,mBACzB,cAAeA,EAAK,cACpB,SAAUA,EAAK,SACf,UAAWA,EAAK,UAChB,SAAUA,EAAK,SACf,OAAQA,EAAK,OACb,MAAOA,EAAK,MACZ,eAAgBA,EAAK,eACrB,cAAeA,EAAK,cACpB,cAAeA,EAAK,cACpB,eAAgBA,EAAK,eACrB,aAAcA,EAAK,aACnB,QAASA,EAAK,QACd,WAAYA,EAAK,WAErB,CAEO,SAASe,GAAiBC,EAAsD,CACrF,MAAO,CACL,GAAGA,EACH,UAAW,OACX,QAAS,OACT,SAAU,OAEd,CAUA,MAAMC,GAAmB,sBACnBC,GAAgB,sBAEf,SAASC,GAA8B1B,EAAgD,CAC5F,MAAM2B,EAAkC,GAExC,OAAI3B,EAAI,kBAAoBwB,GAAiB,KAAKxB,EAAI,gBAAgB,IACpE2B,EAAO,eAAiB3B,EAAI,kBAG1BA,EAAI,iBAAmBwB,GAAiB,KAAKxB,EAAI,eAAe,IAClE2B,EAAO,cAAgB3B,EAAI,iBAGzBA,EAAI,kBAAoBA,EAAI,iBAAiB,SAC/C2B,EAAO,eAAiB3B,EAAI,iBAAiB,QAG3CA,EAAI,UAAYA,EAAI,SAAS,WAAW,IAAI,IAC9C2B,EAAO,QAAU3B,EAAI,UAGnBA,EAAI,cAAgByB,GAAc,KAAKzB,EAAI,YAAY,IACzD2B,EAAO,WAAa3B,EAAI,cAGnB2B,CACT,CAEA,eAAsBC,GAAmBd,EAAwC,CAC/E,KAAM,CAAE,UAAWe,CAAA,EAAiB,MAAAC,GAAA,0BAAAD,CAAA,OAAM,QAAO,eAAoB,OAAAE,KAAA,qBAAAF,CAAA,2CAC/D,CAAE,OAAAG,CAAA,EAAW,MAAAF,GAAA,uBAAAE,CAAA,OAAM,QAAO,eAAY,OAAAD,KAAA,iBAAAC,CAAA,uBAEtCC,EAAOnB,EAAM,IAAIP,GAAQ,CAC7BA,EAAK,MACLA,EAAK,YACLA,EAAK,WACLA,EAAK,mBAAqB,GAC1BA,EAAK,UACLA,EAAK,MAAQ,GACbA,EAAK,aAAe,GACpBA,EAAK,UACLA,EAAK,KAAK,KAAK,GAAG,EAClBA,EAAK,mBACLA,EAAK,aAAe,GACpBA,EAAK,cAAgB,GACrBA,EAAK,YACLA,EAAK,mBACLA,EAAK,cAAgB,OAAS,QAC9BA,EAAK,SACLA,EAAK,UAAY,OAAS,QAC1BA,EAAK,SACLA,EAAK,SAAW,GAChBA,EAAK,YAAc,GACnBA,EAAK,gBAAkB,GACvBA,EAAK,eAAiB,GACtBA,EAAK,gBAAkB,GACvBA,EAAK,OACLA,EAAK,OAAS,GACf,EAEK2B,EAAaL,EAAaI,EAAM,CACpC,OAAQ,GACR,QAASnC,EAAA,CACV,EAEKqC,EAAM,SACNC,EAAO,IAAI,KAAK,CAACD,EAAMD,CAAU,EAAG,CAAE,KAAM,0BAA2B,EAC7EF,EAAOI,EAAM,sBAAsB,IAAI,OAAO,cAAc,MAAM,EAAG,EAAE,CAAC,MAAM,CAChF,CChZO,MAAMC,GAAkB,mCAExB,SAASC,GACdxB,EACAyB,EACAC,EACM,CACN,GAAI,CACF,MAAMC,EAA6B,CACjC,UAAWD,GAAa,OAAO,aAC/B,UAAW,IAAI,OAAO,cACtB,MAAO1B,EAAM,IAAIO,EAAa,EAC9B,aAAAkB,CAAA,EAEF,eAAe,QAAQF,GAAiB,KAAK,UAAUI,CAAO,CAAC,CACjE,OAASC,EAAO,CAEd,QAAQ,KAAK,wDAAyDA,CAAK,CAC7E,CACF,CAEO,SAASC,IAAmD,CACjE,GAAI,CACF,MAAMC,EAAS,eAAe,QAAQP,EAAe,EACrD,GAAIO,EACF,OAAO,KAAK,MAAMA,CAAM,CAE5B,OAASF,EAAO,CAEd,QAAQ,KAAK,0DAA2DA,CAAK,CAC/E,CACA,OAAO,IACT,CAEO,SAASG,IAAgC,CAC9C,GAAI,CACF,eAAe,WAAWR,EAAe,CAC3C,OAASK,EAAO,CAEd,QAAQ,KAAK,2DAA4DA,CAAK,CAChF,CACF,CAsBO,SAASI,GACdL,EACkB,CAClB,OAAOA,EAAQ,MAAM,IAAInB,EAAe,CAC1C,CC9DO,SAASyB,IAAoB,CAClC,MAAMC,EAAcC,GAAA,EACdC,EAAoBC,GAAA,EACpB,CAAE,OAAAC,CAAA,EAAWC,GAAYL,CAAW,EACpC,CAAE,MAAAM,CAAA,EAAUD,GAAYH,CAAiB,EACzC,CACJ,mCAAAK,EACA,0BAAAC,CAAA,EACEC,GAAA,EACE,CAAE,qBAAAC,CAAA,EAAyBC,GAAA,EAC3B,CAAE,iBAAAC,CAAA,EAAqBC,GAAA,EAAmB,OAEhD,eAAeC,EAAiBC,EAKC,CAC/B,IAAIC,EAAS,OAAO,KAAKD,EAAO,WAAW,EACvCE,EAAW,MAAMC,GAAkBF,CAAM,GAAK,GAC9C7C,EAEJ,GAAI4C,EAAO,QAAS,CAClB,KAAM,CAAE,wBAAAI,EAAyB,oBAAAC,GAAwB,MAAMC,GAAmB,CAAE,KAAMN,EAAO,YAAa,EAC9GC,EAAS,OAAO,KAAKI,CAAmB,EACxCH,EAAW,MAAMC,GAAkBF,CAAM,GAAK,GAC9C7C,EAAMgD,CACR,CAEA,MAAMG,EAAc,MAAMC,GAAwB,CAChD,SAAUP,EAAO,OACjB,SAAUD,EAAO,QAAU,OAAYE,CAAA,CACxC,EAEK,CAAE,WAAAO,EAAY,UAAWC,EAAmB,IAAAC,GAAQJ,EAE1D,GAAIG,EACF,MAAO,CACL,UAAWA,EACX,YAAa,GAAGb,CAAgB,IAAIa,CAAiB,GACrD,WAAYtD,EACZ,SAAA8C,CAAA,EAIJ,GAAI,CAACS,GAAO,CAACF,EACX,MAAM,IAAI,MAAM,oCAAoC,EAGtD,MAAMG,EAAO,KAAK,UAAU,CAC1B,KAAMV,EACN,SAAUD,EAAO,OAClB,EAED,MAAMT,EAAmC,CACvC,OAAQH,EAAO,MACf,GAAIoB,EACJ,MAAOI,GAAWF,CAAG,EACrB,KAAM,KAAK,OAAO,KAAKC,EAAM,OAAO,EAAE,SAAS,KAAK,CAAC,GACtD,EAED,MAAME,EAAS,MAAMnB,EAAqB,CACxC,GAAIc,EACJ,MAAOI,GAAWF,CAAG,EACrB,KAAM,KAAK,OAAO,KAAKC,EAAM,OAAO,EAAE,SAAS,KAAK,CAAC,GACtD,EAEKG,EAAU,MAAMtB,EAA0B,CAAE,KAAMqB,EAAQ,cAAe,EAAG,EAClF,GAAI,CAACC,GAAWA,EAAQ,SAAW,UACjC,MAAM,IAAI,MAAM,gCAAgC,EAGlD,KAAM,CAAE,UAAAC,EAAW,YAAAC,CAAA,EAAgB,MAAMC,GAAyBjB,EAAQ,CACxE,SAAUA,EAAO,OACjB,SAAAC,EACA,SAAUF,EAAO,SACjB,OAAAc,EACA,MAAOvB,EAAM,MACb,IAAAnC,CAAA,CACD,EAED,GAAI,CAAC4D,EACH,MAAM,IAAI,MAAM,kCAAkC,EAGpD,MAAO,CAAE,UAAAA,EAAW,YAAAC,EAAa,WAAY7D,EAAK,SAAA8C,CAAA,CACpD,CAEA,MAAO,CAAE,gBAAAH,CAAA,CACX,CCzFO,SAASoB,IAAiB,CAC/B,MAAMlC,EAAcC,GAAA,EACdC,EAAoBC,GAAA,EACpB,CAAE,OAAAC,EAAQ,OAAA+B,GAAW9B,GAAYL,CAAW,EAC5C,CAAE,0BAAAoC,GAA8BpC,EAChC,CAAE,eAAAqC,GAAmBnC,EACrB,CAAE,gBAAAY,CAAA,EAAoBf,GAAA,EACtB,CAAE,eAAAuC,CAAA,EAAmBC,GAAA,EACrB,CAAE,QAAAC,CAAA,EAAYC,GAAA,EACd,CAAE,UAAAC,CAAA,EAAc7B,GAAA,EAAmB,OAEnC8B,EAAeC,EAAI,EAAK,EACxBC,EAAcD,EAA2B,IAAI,EAC7CE,EAAcF,EAAI,EAAE,EAE1B,eAAeG,EACbxF,EACAyF,EAAiC,GACf,CAClB,KAAM,CAAE,eAAAC,EAAgB,QAAAC,CAAA,EAAYF,EAEpC,GAAI,CAMF,GALAL,EAAa,MAAQ,GACrBE,EAAY,MAAQtF,EAGpB,MAAM6E,EAAA,EACF,CAAChC,EAAO,OAAS,CAAC+B,EAAO,MAC3B,MAAM,IAAI,MAAM,sBAAsB,EAIxC,OAAI,CAAC5E,EAAK,gBAAkB,CAACA,EAAK,iBAChC0F,IAAiB1F,EAAK,GAAInB,EAAiB,eAAe,EAC1D,MAAM+G,EAAqB5F,EAAMyF,CAAS,GAIvCzF,EAAK,UACR0F,IAAiB1F,EAAK,GAAInB,EAAiB,YAAY,EACvD,MAAMgH,EAAsB7F,EAAMyF,CAAS,GAIxCzF,EAAK,aACR0F,IAAiB1F,EAAK,GAAInB,EAAiB,OAAO,EAClD,MAAMiH,EAAe9F,EAAMyF,CAAS,GAItCC,IAAiB1F,EAAK,GAAInB,EAAiB,OAAO,EAClD,MAAMkH,EAAkB/F,EAAMyF,CAAS,EAEvCC,IAAiB1F,EAAK,GAAInB,EAAiB,SAAS,EAC7C,EACT,OAASsD,EAAY,CACnB,MAAM6D,EAAe7D,GAAO,SAAWA,GAAO,YAAc,gBAC5D,OAAAwD,IAAU3F,EAAK,GAAIgG,CAAY,EAC/BN,IAAiB1F,EAAK,GAAInB,EAAiB,OAAQmH,CAAY,EACxD,EACT,SACEZ,EAAa,MAAQ,GACrBE,EAAY,MAAQ,KACpBC,EAAY,MAAQ,EACtB,CACF,CAEA,eAAeK,EACb5F,EACAyF,EACe,CACf,KAAM,CAAE,WAAAQ,GAAeR,EAEvB,GAAI,CAACzF,EAAK,eAAgB,CACxB,GAAI,CAACA,EAAK,UACR,MAAM,IAAI,MAAM,2BAA2B,EAE7CuF,EAAY,MAAQ,kBACpB,MAAMW,EAAc,MAAM3C,EAAgB,CACxC,YAAa,MAAMvD,EAAK,UAAU,cAClC,SAAUA,EAAK,UAAU,KACzB,SAAUA,EAAK,UAAU,KACzB,QAAS,GACV,EACDA,EAAK,eAAiBkG,EAAY,UAClClG,EAAK,cAAgBkG,EAAY,SACjCD,IAAajG,EAAK,GAAI,CACpB,eAAgBkG,EAAY,UAC5B,cAAeA,EAAY,SAC5B,CACH,CAEA,GAAI,CAAClG,EAAK,cAAe,CACvB,MAAMmG,EAAYnG,EAAK,UAAYA,EAAK,QACxC,GAAI,CAACmG,EACH,MAAM,IAAI,MAAM,qBAAqB,EAGvCZ,EAAY,MAAQ,kBACpB,MAAMa,EAAa,MAAM7C,EAAgB,CACvC,YAAa,MAAM4C,EAAU,cAC7B,SAAUA,EAAU,KACpB,SAAUA,EAAU,KACpB,QAASnG,EAAK,UACf,EACDA,EAAK,cAAgBoG,EAAW,UAChCpG,EAAK,eAAiBoG,EAAW,WACjCpG,EAAK,aAAeoG,EAAW,SAC/BH,IAAajG,EAAK,GAAI,CACpB,cAAeoG,EAAW,UAC1B,eAAgBA,EAAW,WAC3B,aAAcA,EAAW,SAC1B,CACH,CACF,CAEA,eAAeP,EACb7F,EACAyF,EACe,CACf,KAAM,CAAE,WAAAQ,GAAeR,EACvBF,EAAY,MAAQ,qBAEpB,MAAMc,EAAeC,GAAA,EAEfH,EAAYnG,EAAK,UAAYA,EAAK,QAClCuG,EAAWvG,EAAK,SAAW,OAAS,MACpCyE,EAAczE,EAAK,eACrB,GAAGqG,EAAa,uBAAuB,IAAIrG,EAAK,aAAa,QAAQA,EAAK,cAAc,GACxF,QAAQA,EAAK,aAAa,GAExBwG,EAAsB,CAC1B,CAAE,IAAK,QAAQxG,EAAK,cAAc,IAClC,CAAE,IAAKyE,CAAA,CAAY,EAGfgC,GAAepB,EAAI,CACvB,KAAM,OACN,MAAOrF,EAAK,MACZ,YAAaA,EAAK,YAClB,oBAAqB,GACrB,KAAMA,EAAK,MAAQ,GACnB,UAAWA,EAAK,UAChB,gBAAiBA,EAAK,aAAe,GACrC,OAAQ,CACN,KAAMA,EAAK,WACX,YAAaA,EAAK,mBAAqB,IAEzC,QAAS,sBACT,cAAe,GACf,oBAAAwG,EACA,iBAAkB,CAAC,CACjB,IAAK/B,EACL,KAAM8B,EACN,SAAUJ,GAAW,MAAQ,GAAGnG,EAAK,KAAK,IAAIuG,CAAQ,GACvD,EACD,SAAUvG,EAAK,SACf,YAAa,GACb,KAAMA,EAAK,KACX,SAAU,QAAQA,EAAK,cAAc,GACrC,MAAO,GACR,EAEK,CAAE,QAAA0G,CAAA,EAAY,MAAM3B,EAAe,CAAE,aAAA0B,GAAc,EACzDzG,EAAK,QAAU0G,EACfT,IAAajG,EAAK,GAAI,CAAE,QAAA0G,CAAA,CAAS,CACnC,CAEA,eAAeZ,EACb9F,EACAyF,EACe,CACf,KAAM,CAAE,WAAAQ,GAAeR,EAGvB,GAFAF,EAAY,MAAQ,cAEhB,CAACvF,EAAK,QACR,MAAM,IAAI,MAAM,oBAAoB,EAGtC,MAAM2G,EAAYC,GAEZC,EAAqB,CAACC,EAAeC,KAA2C,CACpF,MAAO,QAAQ/G,EAAK,cAAc,GAClC,aAAc,GAAGmF,CAAS,UAAUnF,EAAK,OAAO,IAAI,OAAO+G,CAAW,EAAID,CAAK,GAC/E,YAAa,SAAS,OAAOC,CAAW,EAAID,CAAK,OAAO9G,EAAK,KAAK,GAClE,KAAM,GAAGA,EAAK,KAAK,KAAK,OAAO+G,CAAW,EAAID,CAAK,GACnD,WAAY,CACV,CAAE,WAAY,SAAU,MAAO9G,EAAK,YACpC,CAAE,WAAY,YAAa,MAAOA,EAAK,UAAU,CACnD,GAGI,CAAE,OAAAsE,GAAW,MAAMW,EAAQ,CAC/B,QAASjF,EAAK,QACd,UAAA2G,EACA,mBAAAE,CAAA,CACD,EAED7G,EAAK,WAAasE,EAClB2B,IAAajG,EAAK,GAAI,CAAE,WAAYsE,EAAQ,CAC9C,CAEA,eAAeyB,EACb/F,EACAgH,EACe,CAGf,GAFAzB,EAAY,MAAQ,mBAEhB,CAACvF,EAAK,QACR,MAAM,IAAI,MAAM,oBAAoB,EAGtC,MAAMiH,EAAQ,CACZ,KAAM,CACJ,GAAIjH,EAAK,YACT,GAAIA,EAAK,aAEX,YAAa,CACX,GAAIA,EAAK,mBACT,GAAIA,EAAK,oBAEX,eAAgB,KAAK,MAAMA,EAAK,UAAY,GAAG,EAC/C,MAAOA,EAAK,UACZ,MAAO,EACP,cAAeA,EAAK,cACpB,mBAAoB,GACpB,WAAY,GACZ,SAAUA,EAAK,UAGjB,MAAM8E,EAAe9E,EAAK,QAAS,CACjC,uBAAwB,MACxB,iBAAkB,KAClB,iBAAkB,CAAC,4CAA4C,EAC/D,OAAQ,CAACiH,CAAK,EACd,gBAAiB,GACjB,wBAAyB,CAAC,CAACjH,EAAK,SAChC,aAAcA,EAAK,UACpB,CACH,CAEA,eAAekH,EACb3G,EACAkF,EAIgD,CAChD,IAAI0B,EAAY,EACZC,EAAS,EAEb,UAAWpH,KAAQO,EAAO,CAExB,GAAIkF,EAAU,gBAAkB,CAACA,EAAU,iBACzC,MAIF,GAAIzF,EAAK,SAAWnB,EAAiB,UAAW,CAC9CsI,IACA,QACF,CAEA,MAAME,EAAU,MAAM7B,EAAYxF,EAAMyF,CAAS,EAE7C4B,EACFF,IAEAC,IAGF3B,EAAU,iBAAiBzF,EAAMqH,CAAO,EAGxC,MAAM,IAAI,QAAQC,GAAW,WAAWA,EAAS,GAAI,CAAC,CACxD,CAEA,MAAO,CAAE,UAAAH,EAAW,OAAAC,CAAA,CACtB,CAEA,MAAO,CACL,aAAcG,GAASnC,CAAY,EACnC,YAAamC,GAASjC,CAAW,EACjC,YAAaiC,GAAShC,CAAW,EACjC,YAAAC,EACA,yBAAA0B,CAAA,CAEJ,4kCC8GA,KAAM,CAAE,EAAGM,CAAA,EAAOC,GAAA,EACZC,EAAQC,GAAA,EACR,CAAE,yBAAAT,EAA0B,YAAaU,EAAuB,YAAaC,CAAA,EAA0BlD,GAAA,EACvG,CAAE,iBAAAmD,CAAA,EAAqBC,GAAA,EACvB,CAAE,aAAAC,CAAA,EAAiBC,GAAA,EAGnB1C,EAAcF,EAA+C,KAAK,EAClE6C,EAAsB7C,EAAI,EAAK,EAC/B9E,EAAQ8E,EAAsB,EAAE,EAChC8C,EAAmB9C,EAAiC,EAAE,EACtD+C,EAAW/C,EAAI,EAAE,EACjBgD,EAAyBhD,EAAgD,EAAE,EAC3EiD,EAAgBjD,EAAY,EAAE,EAC9BD,EAAeC,EAAI,EAAK,EACxBkD,EAAWlD,EAAI,EAAK,EACpBmD,EAAqBnD,EAAI,EAAK,EAG9BoD,EAAeC,EAAS,IAC5BnI,EAAM,MAAM,UAAYoI,EAAE,SAAW9J,EAAiB,OAAO,GAGzD+J,EAAiBF,EAAS,IAC9BnI,EAAM,MAAM,UAAYoI,EAAE,SAAW9J,EAAiB,SAAS,GAG3DgK,EAAcH,EAAS,IAC3BnI,EAAM,MAAM,UAAYoI,EAAE,SAAW9J,EAAiB,MAAM,GAGxDiK,EAAiBJ,EAAS,IAC9BnI,EAAM,MAAM,OAAQoI,GACdA,EAAE,SAAW9J,EAAiB,WAC9B8J,EAAE,gBAAkBA,EAAE,cAAwB,GAC3C,CAACA,EAAE,WAAc,CAACA,EAAE,SAAW,CAACA,EAAE,QAC1C,GAGGI,EAAsBL,EAAS,IAAM,CACzC,MAAMM,MAAU,IAChB,OAAAzI,EAAM,MAAM,QAASP,GAAS,CACxBA,EAAK,oBAAsBgJ,EAAI,IAAIhJ,EAAK,mBAAmB,aAAa,EACxEA,EAAK,aAAegJ,EAAI,IAAIhJ,EAAK,YAAY,aAAa,EAC1DA,EAAK,cAAgBgJ,EAAI,IAAIhJ,EAAK,aAAa,aAAa,CAClE,CAAC,EACMgJ,CACT,CAAC,EAEKC,EAAaP,EAAS,IAC1BJ,EAAc,MAAM,OAAOY,GAAK,CAACH,EAAoB,MAAM,IAAIG,EAAE,KAAK,aAAa,CAAC,GAGhFC,EAAqBT,EAAS,IAClCnI,EAAM,MAAM,IAAIP,IAAS,CACvB,MAAOA,EAAK,MACZ,SAAU,CAAC,CAACA,EAAK,UACjB,cAAeA,EAAK,mBACpB,OAAQ,CAAC,CAACA,EAAK,QACf,YAAaA,EAAK,aAAe,GACjC,QAAS,CAAC,CAACA,EAAK,SAChB,aAAcA,EAAK,cAAgB,IACnC,GAGEoJ,EAAsB,CAC1B,CAAE,YAAa,SAAU,OAAQ5B,EAAG,4BAA4B,GAChE,CAAE,YAAa,WAAY,OAAQA,EAAG,8BAA8B,GACpE,CAAE,YAAa,eAAgB,OAAQA,EAAG,6BAA6B,GACvE,CAAE,YAAa,cAAe,OAAQA,EAAG,iCAAiC,EAAE,EAGxE6B,EAAmBtK,GAAgB,IAAKuK,GAAQ,CACpD,MAAMC,EAAazK,GAAqB,SAASwK,CAAG,EACpD,MAAO,CACL,OAAQA,EACR,SAAUC,EAAa,IAAM,GAC7B,aAAcvK,GAAmCsK,CAAG,GAAK,IACzD,YAAa9B,EAAG,4BAA4B8B,CAAG,EAAE,EAErD,CAAC,EAEKE,GAAad,EAAS,IAC1BnI,EAAM,MAAM,IAAIP,IAAS,CACvB,SAAUA,EAAK,SACf,MAAOA,EAAK,MACZ,WAAYA,EAAK,WACjB,UAAWA,EAAK,YAAc,EAAI,OAAS,IAAIA,EAAK,SAAS,GAC7D,YAAaA,EAAK,YAClB,SAAUA,EAAK,SACf,UAAWA,EAAK,UAChB,cAAeA,EAAK,cACpB,SAAUA,EAAK,UACf,GAIJyJ,GAAW,CACT,MAAOjC,EAAG,wBAAwB,EAClC,QAASA,EAAG,wBAAwB,EACrC,EAGDkC,GAAU,IAAM,CACdlB,EAAmB,MAAQpG,OAA4B,IACzD,CAAC,EAGD,SAASuH,EAAqBC,EAAc,CAE1C,MAAMC,EADSD,EAAM,OACD,QAAQ,CAAC,EAC7B,GAAI,CAACC,EAAQ,OAEb1B,EAAiB,MAAQ,GACzBC,EAAS,MAAQ,GAEjB,MAAM0B,EAAS,IAAI,WACnBA,EAAO,OAAUC,GAAM,CACrB,MAAMpI,EAAaoI,EAAE,QAAQ,OAC7BC,GAASrI,CAAU,CACrB,EACAmI,EAAO,WAAWD,CAAI,CACxB,CAEA,eAAeG,GAAUrI,EAAoB,CAC3CwG,EAAiB,MAAQ,GACzBC,EAAS,MAAQ,GAEjB,GAAI,CACF,MAAM6B,EAAUC,GAASvI,EAAY,CACnC,QAAS,GACT,iBAAkB,GAClB,KAAM,GACP,EAED,GAAIsI,EAAQ,SAAW,EAAG,CACxB7B,EAAS,MAAQZ,EAAG,wBAAwB,EAC5C,MACF,CAGA,MAAM2C,EAAU,OAAO,KAAKF,EAAQ,CAAC,CAAE,EACjCG,EAAkBtL,GAAqB,OAAOwK,GAAO,CAACa,EAAQ,SAASb,CAAG,CAAC,EACjF,GAAIc,EAAgB,OAAS,EAAG,CAC9BhC,EAAS,MAAQZ,EAAG,8BAA+B,CAAE,QAAS4C,EAAgB,KAAK,IAAI,EAAG,EAC1F,MACF,CAEA/B,EAAuB,MAAQ,OAAO,QAAQrJ,EAAkC,EAC7E,OAAO,CAAC,CAACsK,CAAG,IAAM,CAACa,EAAQ,SAASb,CAAG,CAAC,EACxC,IAAI,CAAC,CAACe,EAAQC,CAAY,KAAO,CAAE,OAAAD,EAAQ,aAAAC,CAAA,EAAe,EAE7D,MAAMC,EAAqBJ,EAAQ,SAAS,QAAQ,GAAKA,EAAQ,SAAS,UAAU,EAC9EK,EAAgC,GAChCC,EAAyC,GAyB/C,GAvBAR,EAAQ,QAAQ,CAACxK,EAAUqH,IAAkB,CAC3C,MAAM9G,EAAOR,GAAYC,EAAKqH,EAAQ,CAAC,EACjC5G,EAASH,GAAaC,EAAMP,CAAuB,EAMzD,GAJIS,EAAO,OAAS,GAClBuK,EAAU,KAAK,GAAGvK,CAAM,EAGtBqK,EAAoB,CACtB,MAAMG,EAASjL,EACTkL,GAAWxJ,GAA6BuJ,CAAM,EACpD,OAAO,OAAO1K,EAAM2K,EAAQ,EAExBD,EAAO,SAAW7L,EAAiB,WAAa8L,GAAS,UAC3D3K,EAAK,OAASnB,EAAiB,UAEnC,CAEA2L,EAAY,KAAKxK,CAAI,CACvB,CAAC,EAEDyK,EAAU,KAAK,GAAGnK,GAAckK,CAAW,CAAC,EAExCC,EAAU,OAAS,EAAG,CACxBtC,EAAiB,MAAQsC,EACzB,MACF,CAEA,GAAIF,EAAoB,CACtBrC,EAAoB,MAAQ,GAC5B,GAAI,CACF,MAAM0C,GAA4BJ,CAAW,CAC/C,SACEtC,EAAoB,MAAQ,EAC9B,CACF,CAEA3H,EAAM,MAAQiK,EACdjF,EAAY,MAAQ,QAEpBmC,EAAM,IAAI,CACR,KAAM,2BACN,MAAOF,EAAG,iCAAkC,CAAE,MAAOgD,EAAY,OAAQ,EACzE,MAAO,UACR,CACH,OAASrI,EAAY,CACnBuF,EAAM,IAAI,CACR,KAAM,iCACN,MAAOF,EAAG,6BAA6B,EACvC,YAAarF,EAAM,QACnB,MAAO,QACR,CACH,CACF,CAEA,eAAeyI,GAA6BC,EAAiC,CAC3E,UAAW7K,KAAQ6K,EAAe,CAChC,GAAI7K,EAAK,QACP,GAAI,CACF,MAAM8H,EAAiB9H,EAAK,OAAO,CACrC,MAAQ,CACNA,EAAK,QAAU,OACfA,EAAK,WAAa,OACdA,EAAK,SAAWnB,EAAiB,YACnCmB,EAAK,OAASnB,EAAiB,QAEnC,CAGF,GAAImB,EAAK,WACP,GAAI,CACF,MAAM3B,GAAsB2J,EAAc,CAAE,KAAMhI,EAAK,WAA6B,CACtF,MAAQ,CACNA,EAAK,WAAa,MACpB,CAEJ,CACF,CAEA,eAAe8K,IAAuB,CACpC,KAAM,CAAE,OAAArJ,CAAA,EAAW,MAAAF,GAAA,uBAAAE,CAAA,OAAM,QAAO,eAAY,OAAAD,KAAA,iBAAAC,CAAA,uBAuBtCE,EAAaL,GAAa,CArBd,CAChB,gBACA,wBACA,cACA,aACA,YACA,iBACA,aACA,OACA,gBACA,YACA,GACA,YACA,GACA,GACA,GACA,GACA,GACA,GAGwC,EAAG,CAC3C,OAAQ,GACR,QAASvC,EAAA,CACV,EAEK6C,EAAM,SACNC,EAAO,IAAI,KAAK,CAACD,EAAMD,CAAU,EAAG,CAAE,KAAM,0BAA2B,EAC7EF,EAAOI,EAAM,0BAA0B,CACzC,CAEA,SAASkJ,GAAmBnB,EAAc,CACxC,MAAMoB,EAASpB,EAAM,OACfqB,EAAQ,MAAM,KAAKD,EAAO,OAAS,EAAE,EAC3C1C,EAAc,MAAQ2C,EAGtB1K,EAAM,MAAM,QAASP,GAAS,CAC5BA,EAAK,UAAY,OACjBA,EAAK,QAAU,OACfA,EAAK,SAAW,MAClB,CAAC,EAGD,MAAMkL,MAAc,IACpBD,EAAM,QAASpB,GAAS,CACtBqB,EAAQ,IAAIrB,EAAK,KAAK,cAAeA,CAAI,CAC3C,CAAC,EAEDtJ,EAAM,MAAM,QAASP,GAAS,CAE5B,MAAMmL,EAAYD,EAAQ,IAAIlL,EAAK,mBAAmB,aAAa,EAMnE,GALImL,IACFnL,EAAK,UAAYmL,GAIfnL,EAAK,YAAa,CACpB,MAAMoL,EAAUF,EAAQ,IAAIlL,EAAK,YAAY,aAAa,EACtDoL,IACFpL,EAAK,QAAUoL,EAEnB,CAGA,GAAIpL,EAAK,aAAc,CACrB,MAAMqL,EAAWH,EAAQ,IAAIlL,EAAK,aAAa,aAAa,EACxDqL,IACFrL,EAAK,SAAWqL,EAEpB,CACF,CAAC,CACH,CAEA,eAAeC,IAAmB,CAChC/F,EAAY,MAAQ,aACpBH,EAAa,MAAQ,GACrBmD,EAAS,MAAQ,GAGjBxG,GAAsBxB,EAAM,MAAO,CAAC,EAEpC,MAAM2G,EAAyB3G,EAAM,MAAO,CAC1C,eAAgB,CAACgL,EAAQC,EAAQrJ,IAAU,CACzC,MAAMnC,EAAOO,EAAM,MAAM,KAAKoI,GAAKA,EAAE,KAAO4C,CAAM,EAC9CvL,IACFA,EAAK,OAASwL,EACVrJ,IAASnC,EAAK,MAAQmC,GAC1BJ,GAAsBxB,EAAM,MAAO,CAAC,EAExC,EACA,WAAY,CAACgL,EAAQE,IAAY,CAC/B,MAAMzL,EAAOO,EAAM,MAAM,KAAKoI,GAAKA,EAAE,KAAO4C,CAAM,EAC9CvL,IACF,OAAO,OAAOA,EAAMyL,CAAO,EAC3B1J,GAAsBxB,EAAM,MAAO,CAAC,EAExC,EACA,QAAS,CAACmL,EAASvJ,IAAU,CAC3BuF,EAAM,IAAI,CACR,KAAM,iCACN,MAAOF,EAAG,yBAAyB,EACnC,YAAarF,EACb,MAAO,QACP,SAAU,IACX,CACH,EACA,eAAgB,CAACnC,EAAMqH,IAAY,CAC7BA,GACFK,EAAM,IAAI,CACR,KAAM,2BACN,MAAOF,EAAG,6BAA8B,CAAE,MAAOxH,EAAK,MAAO,EAC7D,MAAO,UACP,SAAU,IACX,CAEL,EACA,eAAgB,IAAM,CAACuI,EAAS,MACjC,EAEDnD,EAAa,MAAQ,GAEjBwD,EAAe,MAAM,SAAWrI,EAAM,MAAM,SAC9C+B,GAAA,EACAoF,EAAM,IAAI,CACR,KAAM,2BACN,MAAOF,EAAG,2BAA2B,EACrC,MAAO,UACR,EAEL,CAEA,SAASmE,IAAmB,CAC1BpD,EAAS,MAAQ,EACnB,CAEA,SAASqD,IAAoB,CAC3BrD,EAAS,MAAQ,GACjB+C,GAAA,CACF,CAEA,SAASO,IAAe,CACtBtL,EAAM,MAAM,QAASP,GAAS,CACxBA,EAAK,SAAWnB,EAAiB,SACnCmB,EAAK,OAASnB,EAAiB,QAC/BmB,EAAK,MAAQ,OAEjB,CAAC,EACDsL,GAAA,CACF,CAEA,SAASQ,IAAiB,CACxB,MAAM5J,EAAUE,GAAA,EAChB,GAAI,CAACF,EAAW,OAEhB3B,EAAM,MAAQgC,GAAwBL,CAAO,EAG1B3B,EAAM,MAAM,KAAMoI,GAC/BA,EAAE,gBAAkBA,EAAE,cAAwB,GAC3C,CAACA,EAAE,WAAc,CAACA,EAAE,SAAW,CAACA,EAAE,QAC1C,EAGCpD,EAAY,MAAQ,QAEpBA,EAAY,MAAQ,YAExB,CAEA,SAASwG,IAAoB,CAC3BzJ,GAAA,EACA0J,GAAA,CACF,CAEA,SAASA,IAAY,CACnBzL,EAAM,MAAQ,GACd4H,EAAiB,MAAQ,GACzBC,EAAS,MAAQ,GACjBC,EAAuB,MAAQ,GAC/BC,EAAc,MAAQ,GACtB/C,EAAY,MAAQ,MACpBH,EAAa,MAAQ,GACrBmD,EAAS,MAAQ,EACnB,CAEA,SAAS0D,GAAgBT,EAAoE,CAC3F,OAAQA,EAAA,CACN,KAAK3M,EAAiB,UACpB,MAAO,UACT,KAAKA,EAAiB,OACpB,MAAO,QACT,KAAKA,EAAiB,QACpB,MAAO,UACT,QACE,MAAO,OAEb,CAEA,SAASqN,GAAgBV,EAAkC,CACzD,OAAOhE,EAAG,sBAAsBgE,CAAM,EAAE,CAC1C,8FA/0BEW,EAwYgBC,GAAA,gBAvYd,IAAoD,CAApDC,EAAoDC,EAAA,CAAvC,MAAOC,EAAA/E,CAAA,EAAE,6CAEtB6E,EAoYWG,GAAA,gBAlYT,IAsBS,CArBDD,EAAA/D,CAAA,IAAuB+D,EAAAnH,CAAA,OAD/B+G,EAsBSM,EAAA,OApBP,KAAK,iCACL,MAAM,OACN,QAAQ,OACP,MAAOF,EAAA/E,CAAA,EAAE,sCACT,YAAa+E,EAAA/E,CAAA,EAAE,8CAEL,UACT,IAWM,CAXNkF,EAWM,MAXNC,GAWM,CAVJN,EAIEO,EAAA,CAHC,MAAOL,EAAA/E,CAAA,EAAE,8BACV,MAAM,UACL,QAAOsE,EAAA,oBAEVO,EAIEO,EAAA,CAHC,MAAOL,EAAA/E,CAAA,EAAE,yBACV,QAAQ,UACP,QAAOuE,EAAA,kEAOHQ,EAAAhH,CAAA,IAAW,WAAxB4G,EAiCQU,EAAA,OAjC6B,GAAI,qBAC5B,SACT,IAEK,CAFLH,EAEK,KAFLI,GAEKC,EADAR,EAAA/E,CAAA,EAAE,2CAIT,IAcM,CAdNkF,EAcM,MAdNM,GAcM,CAbJX,EAMaY,EAAA,CANA,MAAOV,EAAA/E,CAAA,EAAE,0BAA4B,MAAM,qBACtD,IAIE,CAJF6E,EAIEa,EAAA,CAHA,KAAK,OACL,OAAO,OACN,SAAQvD,CAAA,uBAGb0C,EAKEO,EAAA,CAJC,MAAOL,EAAA/E,CAAA,EAAE,iCACV,QAAQ,UACR,KAAK,8BACJ,QAAOsD,EAAA,sBAIZ4B,EASU,UATVS,GASU,CARRT,EAEU,UAFVU,GAEUL,EADLR,EAAA/E,CAAA,EAAE,wCAEP6E,EAIEgB,EAAA,CAHA,MAAM,OACL,QAASjE,EACT,KAAMmD,EAAAlD,CAAA,wCAMAkD,EAAArE,CAAA,OAAbiE,EAKQU,EAAA,OAL2B,GAAI,+BACrC,IAGM,CAHNH,EAGM,MAHNY,GAGM,CAFJjB,EAAyEkB,EAAA,CAAlE,KAAK,yBAAyB,MAAM,8BAC3Cb,EAAuD,cAA9CH,EAAA/E,CAAA,EAAE,0DAMP+E,EAAApE,CAAA,EAAiB,OAAM,GAAQoE,EAAAhH,CAAA,IAAW,WADlD4G,EAcSM,EAAA,OAZP,KAAK,mCACL,MAAM,QACN,QAAQ,OACP,MAAOF,EAAA/E,CAAA,EAAE,mCAEC,cACT,IAIK,CAJLkF,EAIK,KAJLc,GAIK,EAHHC,EAAA,IAAAC,EAEKC,GAAA,KAAAC,GAFwBrB,EAAApE,CAAA,EAAgB,CAAjChG,EAAO2E,UAAnB4G,EAEK,MAF2C,IAAK5G,IAAKiG,EACrDR,EAAA/E,CAAA,EAAE,6BAAiCrF,EAAM,SAAQ,GAAM,KAAE4K,EAAG5K,EAAM,KAAK,EAAG,MAAG4K,EAAGR,EAAA/E,CAAA,EAAGrF,EAAM,QAASA,EAAM,QAAM,gDAQjHoK,EAAAnE,CAAA,GAAYmE,EAAAhH,CAAA,IAAW,WAD/B4G,EAMEM,EAAA,OAJA,KAAK,mCACL,MAAM,QACN,QAAQ,OACP,MAAOF,EAAAnE,CAAA,+BAIGmE,EAAAhH,CAAA,IAAW,aAAxB4G,EAsHQU,EAAA,OAtH+B,GAAI,qBAC9B,SACT,IAEK,CAFLH,EAEK,KAFLmB,GAEKd,EADAR,EAAA/E,CAAA,EAAE,2CAIT,IAcS,CAbD+E,EAAAlE,CAAA,EAAuB,OAAM,OADrC8D,EAcSM,EAAA,OAZP,KAAK,mCACL,MAAM,UACN,QAAQ,OACP,MAAOF,EAAA/E,CAAA,EAAE,kDAEC,cACT,IAIK,CAJLkF,EAIK,KAJLoB,GAIK,QAHHJ,EAEKC,GAAA,KAAAC,GAFarB,EAAAlE,CAAA,EAAPiB,QAAXoE,EAEK,MAFsC,IAAKpE,EAAI,SAClDoD,EAA6B,YAAAK,EAApBzD,EAAI,MAAM,OAAU,MAAGyD,EAAGR,EAAA/E,CAAA,EAAE,gCAAkC,KAAE,GAAAkF,EAAuC,cAAAK,EAA5BzD,EAAI,YAAY,+CAM5GoD,EAEI,IAFJqB,GAEIhB,EADCR,KAAE,8CAAkDA,EAAAhM,CAAA,EAAM,OAAM,MAIrEmM,EAyCM,MAzCNsB,GAyCM,CAxCJtB,EAEI,IAFJuB,GAEIlB,EADCR,EAAA/E,CAAA,EAAE,kCAEP6E,EAoCSgB,EAAA,CAnCN,QAAO,6BAAkDd,EAAA/E,CAAA,EAAE,6DAAkF+E,EAAA/E,CAAA,EAAE,uGAM/I,KAAM+E,EAAApD,CAAA,IAEI,mBAAgB+E,EACzB,CAMS,CAPoB,IAAAzO,KAAG,CAExBA,EAAI,SAAS,mBADrB0M,EAMSgC,EAAA,OAJN,MAAO5B,KAAc,qBAA2B9M,EAAI,SAAS,SAAQ,kBACtE,QAAQ,mBAER,IAAgC,KAA7BA,EAAI,SAAS,aAAa,wCAGtB,iBAAcyO,EACvB,CAMS,CAPkB,IAAAzO,KAAG,CAEtBA,EAAI,SAAS,iBADrB0M,EAMSgC,EAAA,OAJN,MAAO5B,KAAc,qBAA2B9M,EAAI,SAAS,OAAM,kBACpE,QAAQ,mBAER,IAA8B,KAA3BA,EAAI,SAAS,WAAW,wCAGpB,kBAAeyO,EACxB,CAMS,CAPmB,IAAAzO,KAAG,CAEvBA,EAAI,SAAS,kBADrB0M,EAMSgC,EAAA,OAJN,MAAO5B,KAAc,qBAA2B9M,EAAI,SAAS,QAAO,kBACrE,QAAQ,mBAER,IAA+B,KAA5BA,EAAI,SAAS,YAAY,qEAMpC4M,EAOaY,EAAA,CAPA,MAAOV,EAAA/E,CAAA,EAAE,wCACpB,IAKE,CALF6E,EAKEa,EAAA,CAJA,KAAK,OACL,YACA,OAAO,qBACN,SAAQnC,EAAA,uBAIJwB,EAAAjE,CAAA,EAAc,OAAM,GAA7BmF,EAAA,EAAAC,EAEI,IAFJU,GAEIrB,EADCR,KAAE,oCAAwCA,EAAAjE,CAAA,EAAc,OAAM,gBAK3DiE,EAAAtD,CAAA,EAAW,OAAM,OADzBkD,EAmBSM,EAAA,OAjBP,KAAK,mCACL,MAAM,UACN,QAAQ,OACP,MAAOF,EAAA/E,CAAA,EAAE,yCAA6C+E,EAAAtD,CAAA,EAAW,OAAM,IAE7D,cACT,IASM,CATNyD,EASM,MATN2B,GASM,QARJX,EAOSC,GAAA,KAAAC,GANQrB,EAAAtD,CAAA,EAARY,QADTsC,EAOSgC,EAAA,CALN,IAAKtE,EAAK,KACX,QAAQ,OACR,MAAM,sBAEN,IAAe,CAAZyE,EAAAvB,EAAAlD,EAAK,IAAI,0DAMpB6C,EAWM,MAXN6B,GAWM,CAVJlC,EAIEO,EAAA,CAHC,MAAOL,EAAA/E,CAAA,EAAE,oBACV,QAAQ,UACP,uBAAOjC,EAAA,MAAW,0BAErB8G,EAIEO,EAAA,CAHC,MAAOL,EAAA/E,CAAA,EAAE,wBACT,SAAU+E,EAAAzD,CAAA,EAAe,OAAM,EAC/B,uBAAOvD,EAAA,MAAW,4DAMZgH,EAAAhH,CAAA,IAAW,cAAxB4G,EA2DQU,EAAA,OA3DgC,GAAI,qBAC/B,SACT,IAEK,CAFLH,EAEK,KAFL8B,GAEKzB,EADAR,EAAA/E,CAAA,EAAE,4CAIT,IAEI,CAFJkF,EAEI,IAFJ+B,GAEI1B,EADCR,EAAA/E,CAAA,EAAE,sCAGPkF,EAEI,IAFJgC,GAEI3B,EADCR,KAAE,wCAA4CA,EAAAhM,CAAA,EAAM,OAAM,MAG/D8L,EA8BSgB,EAAA,CA7BN,QAAO,iEAAsGd,EAAA/E,CAAA,EAAE,4DAA+E+E,EAAA/E,CAAA,EAAE,kDAAqE+E,EAAA/E,CAAA,EAAE,mDAAsE+E,EAAA/E,CAAA,EAAE,gDAAmE+E,EAAA/E,CAAA,EAAE,kDAAqE+E,EAAA/E,CAAA,EAAE,+DAAkF+E,EAAA/E,CAAA,EAAE,4DAA+E+E,EAAA/E,CAAA,EAAE,2BAWhoB,KAAM+E,EAAA/C,EAAA,IAEI,iBAAc0E,EACvB,CAKS,CANkB,IAAAzO,KAAG,CAC9B4M,EAKS8B,EAAA,CAJN,MAAO1O,EAAI,SAAS,UAAS,oBAC9B,QAAQ,mBAER,IAAiE,CAA9D6O,EAAAvB,EAAAtN,EAAI,SAAS,UAAY8M,EAAA/E,CAAA,gBAAmB+E,EAAA/E,CAAA,EAAE,0CAG1C,qBAAkB0G,EAC3B,CAKS,CANsB,IAAAzO,KAAG,CAClC4M,EAKS8B,EAAA,CAJN,MAAO1O,EAAI,SAAS,cAAa,oBAClC,QAAQ,mBAER,IAAqE,CAAlE6O,EAAAvB,EAAAtN,EAAI,SAAS,cAAgB8M,EAAA/E,CAAA,gBAAmB+E,EAAA/E,CAAA,EAAE,qEAK3DkF,EAWM,MAXNiC,GAWM,CAVJtC,EAIEO,EAAA,CAHC,MAAOL,EAAA/E,CAAA,EAAE,oBACV,QAAQ,UACP,uBAAOjC,EAAA,MAAW,4BAErB8G,EAIEO,EAAA,CAHC,MAAOL,EAAA/E,CAAA,EAAE,4BACV,MAAM,UACL,QAAO8D,EAAA,wCAMDiB,EAAAhH,CAAA,IAAW,kBAAxB4G,EA2GQU,EAAA,OA3GoC,GAAI,qBACnC,SACT,IA+BM,CA/BNH,EA+BM,MA/BNkC,GA+BM,CA9BJlC,EAEK,KAFLmC,GAEK9B,EADAR,EAAA/E,CAAA,EAAE,+BAEPkF,EA0BM,MA1BNoC,GA0BM,CAxBIvC,EAAAnH,CAAA,IAAiBmH,EAAAhE,CAAA,OADzB4D,EAKES,EAAA,OAHC,MAAOL,EAAA/E,CAAA,EAAE,qBACV,QAAQ,UACP,QAAOmE,EAAA,8BAGFY,EAAAhE,CAAA,OADR4D,EAKES,EAAA,OAHC,MAAOL,EAAA/E,CAAA,EAAE,sBACV,MAAM,UACL,QAAOoE,EAAA,+BAGDW,EAAAnH,CAAA,GAAgBmH,EAAA1D,CAAA,EAAY,OAAM,OAD3CsD,EAKES,EAAA,OAHC,MAAOL,EAAA/E,CAAA,EAAE,4BACV,QAAQ,UACP,QAAOqE,EAAA,8BAGDU,EAAAnH,CAAA,gBADT+G,EAMES,EAAA,OAJC,MAAOL,EAAA/E,CAAA,EAAE,mCACV,QAAQ,UACR,KAAK,8BACJ,QAAKuH,EAAA,KAAAA,EAAA,GAAAC,GAAEzC,EAAAlL,EAAA,EAAkBkL,EAAAhM,CAAA,CAAK,uCAOvC,IAKM,CALNmM,EAKM,MALNuC,GAKM,CAJJvC,EAA8D,cAArDH,EAAA/E,CAAA,EAAE,sBAAwB,KAAEuF,EAAGR,EAAAhM,CAAA,EAAM,MAAM,KACpDmM,EAAkG,OAAlGwC,GAAkGnC,EAAlER,EAAA/E,CAAA,4BAA8B,KAAEuF,EAAGR,EAAA3D,CAAA,EAAe,MAAM,KACxF8D,EAA0F,OAA1FyC,GAA0FpC,EAA5DR,EAAA/E,CAAA,yBAA2B,KAAEuF,EAAGR,EAAA1D,CAAA,EAAY,MAAM,KAChF6D,EAA6F,OAA7F0C,GAA6FrC,EAA9DR,EAAA/E,CAAA,0BAA4B,KAAEuF,EAAGR,EAAA9D,CAAA,EAAa,MAAM,OAI7E8D,EAAAnH,CAAA,GAAgBmH,EAAA1D,CAAA,EAAY,UAAe0D,EAAA3D,CAAA,EAAe,OAAM,GAAQ2D,KAAe,OAASA,EAAAhM,CAAA,EAAM,YAD9G4L,EAIEkD,EAAA,OAFC,OAAS9C,EAAA3D,CAAA,EAAe,OAAS2D,EAAA1D,CAAA,EAAY,QAAU0D,EAAAhM,CAAA,EAAM,OAAM,IACnE,MAAOgM,EAAA1D,CAAA,EAAY,OAAM,yDAIjB0D,EAAA1E,CAAA,GAAX4F,IAAAC,EAOM,MAPN4B,GAOM,CANJ5C,EAEI,IAFJ6C,GAEIxC,EADCR,EAAA/E,CAAA,uCAAyC,KAAEuF,EAAGR,EAAA1E,CAAA,EAAsB,KAAK,KAE9E6E,EAEI,IAFJ8C,GAEIzC,EADCR,KAAwBA,EAAA/E,CAAA,sBAAuB+E,EAAA3E,CAAA,CAAqB,uBAK3EyE,EAgCSgB,EAAA,CA/BN,QAAO,iEAAsGd,EAAA/E,CAAA,EAAE,wDAA2E+E,EAAA/E,CAAA,EAAE,0DAM5L,KAAM+E,EAAAhM,CAAA,IAEI,cAAW2N,EACpB,CAUM,CAXkB,IAAAzO,KAAG,CAC3BiN,EAUM,MAVN+C,GAUM,CATJpD,EAKS8B,EAAA,CAJN,MAAOlC,GAAexM,EAAI,SAAS,MAAM,EAC1C,QAAQ,mBAER,IAAyC,CAAtC6O,EAAAvB,EAAAb,GAAezM,EAAI,SAAS,MAAM,6BAE3BA,EAAI,SAAS,OAAzBgO,EAAA,EAAAC,EAEO,OAFPgC,GAEO3C,EADFtN,EAAI,SAAS,KAAK,mBAIhB,eAAYyO,EACrB,CAOU,CARe,IAAAzO,KAAG,CAEpBA,EAAI,SAAS,SAAW8M,EAAA1N,CAAA,EAAiB,WAAaY,EAAI,SAAS,aAD3E0M,EAOUS,EAAA,OALP,GAAE,oBAAsBnN,EAAI,SAAS,OAAO,GAC7C,QAAQ,OACR,KAAK,iBAEL,IAA4B,KAAzB8M,EAAA/E,CAAA,EAAE,gFAMC,CAAA+E,EAAAnH,CAAA,GAAgBmH,EAAA3D,CAAA,EAAe,SAAW2D,EAAAhM,CAAA,EAAM,QAA5DkN,EAAA,EAAAC,EAUM,MAVNiC,GAUM,CATJtD,EAGEO,EAAA,CAFC,MAAOL,EAAA/E,CAAA,EAAE,6BACV,GAAG,+BAEL6E,EAIEO,EAAA,CAHC,MAAOL,EAAA/E,CAAA,EAAE,2BACV,QAAQ,UACP,QAAOwE,EAAA","names":["getTransactionReceipt","config","parameters","chainId","rest","client","getAction","viem_getTransactionReceipt","BookUploadStatus","CSV_REQUIRED_COLUMNS","CSV_ALL_COLUMNS","CSV_OPTIONAL_COLUMNS_WITH_DEFAULTS","DEFAULT_PRICE","CSV_DEFAULT_EDITION_NAME","CSV_DEFAULT_EDITION_DESCRIPTION","CSV_DEFAULT_AUTO_DELIVER","CSV_DEFAULT_ENABLE_DRM","CSV_DEFAULT_LANGUAGE","CSV_RESULT_COLUMNS","parseCSVRow","row","rowIndex","tags","t","listPrice","VALID_BOOLEAN_VALUES","validateBook","book","rawRow","errors","MINIMAL_PRICE","autoDeliverVal","enableDrmVal","validateBooks","books","seen","filenames","name","field","key","existing","serializeBook","deserializeBook","serialized","ARWEAVE_ID_REGEX","TX_HASH_REGEX","validateProgressFieldFormats","result","generateResultCSV","csvStringify","__vitePreload","n","saveAs","rows","csvContent","bom","blob","BULK_UPLOAD_KEY","saveBulkUploadSession","currentIndex","sessionId","session","error","loadBulkUploadSession","stored","clearBulkUploadSession","restoreBooksFromSession","useArweaveUpload","walletStore","useWalletStore","bookstoreApiStore","useBookstoreApiStore","wallet","storeToRefs","token","assertSufficientBalanceForTransfer","waitForTransactionReceipt","useNFTContractWriter","sendTransactionAsync","useSendTransaction","ARWEAVE_ENDPOINT","useRuntimeConfig","uploadToArweave","params","buffer","ipfsHash","calculateIPFSHash","rawEncryptedKeyAsBase64","combinedArrayBuffer","encryptDataWithAES","priceResult","estimateBundlrFilePrice","evmAddress","existingArweaveId","ETH","memo","parseEther","txHash","receipt","arweaveId","arweaveLink","uploadSingleFileToBundlr","useBulkUpload","signer","validateWalletConsistency","newBookListing","createNFTClass","useNFTClassCreator","mintNFT","useNFTMinter","BOOK3_URL","isProcessing","ref","currentBook","currentStep","processBook","callbacks","onStatusChange","onError","uploadFilesToArweave","createNFTClassForBook","mintNFTForBook","createBookListing","errorMessage","onProgress","coverResult","ebookFile","bookResult","apiEndpoints","getApiEndpoints","fileType","contentFingerprints","iscnFormData","classId","mintCount","NFT_DEFAULT_MINT_AMOUNT","buildTokenMetadata","index","fromTokenId","_callbacks","price","processBooksSequentially","completed","failed","success","resolve","readonly","$t","useI18n","toast","useToast","currentProcessingStep","currentProcessingBook","getClassMetadata","useNFTContractReader","$wagmiConfig","useNuxtApp","isVerifyingProgress","validationErrors","csvError","missingOptionalColumns","selectedFiles","isPaused","hasExistingSession","pendingBooks","computed","b","completedBooks","failedBooks","unmatchedBooks","expectedFilenameSet","set","extraFiles","f","fileMatchingStatus","csvColumnRefColumns","csvColumnRefData","col","isRequired","reviewData","useSeoMeta","onMounted","handleCSVFileUpload","event","file","reader","e","parseCSV","records","csvParse","headers","missingRequired","column","defaultValue","hasProgressColumns","parsedBooks","allErrors","csvRow","progress","verifyProgressFieldsOnChain","booksToVerify","downloadCSVTemplate","handleFilesChange","target","files","fileMap","coverFile","pdfFile","epubFile","startProcessing","bookId","status","updates","_bookId","pauseProcessing","resumeProcessing","retryFailed","resumeSession","clearAndStartNew","resetAll","getStatusColor","getStatusLabel","_createBlock","_component_PageContainer","_createVNode","_component_PageHeader","_unref","_component_PageBody","_component_UAlert","_createElementVNode","_hoisted_1","_component_UButton","_component_UCard","_hoisted_2","_toDisplayString","_hoisted_3","_component_UFormField","_component_UInput","_hoisted_4","_hoisted_5","_component_UTable","_hoisted_6","_component_UIcon","_hoisted_7","_openBlock","_createElementBlock","_Fragment","_renderList","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_withCtx","_component_UBadge","_hoisted_13","_hoisted_14","_createTextVNode","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_cache","$event","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_component_UProgress","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32"],"ignoreList":[],"sources":["../../../node_modules/@wagmi/core/dist/esm/actions/getTransactionReceipt.js","../../../utils/bulk-upload.type.ts","../../../utils/bulkUploadSession.ts","../../../composables/useArweaveUpload.ts","../../../composables/useBulkUpload.ts","../../../pages/bulk-upload.vue"],"sourcesContent":["import { getTransactionReceipt as viem_getTransactionReceipt, } from 'viem/actions';\nimport { getAction } from '../utils/getAction.js';\n/** https://wagmi.sh/core/api/actions/getTransactionReceipt */\nexport async function getTransactionReceipt(config, parameters) {\n    const { chainId, ...rest } = parameters;\n    const client = config.getClient({ chainId });\n    const action = getAction(client, viem_getTransactionReceipt, 'getTransactionReceipt');\n    return action(rest);\n}\n//# sourceMappingURL=getTransactionReceipt.js.map","import { DEFAULT_PRICE, MINIMAL_PRICE, CSV_DEFAULT_LANGUAGE, CSV_DEFAULT_AUTO_DELIVER, CSV_DEFAULT_ENABLE_DRM, CSV_DEFAULT_EDITION_NAME, CSV_DEFAULT_EDITION_DESCRIPTION } from '~/constant'\n\nexport enum BookUploadStatus {\n  PENDING = 'pending',\n  UPLOADING_FILES = 'uploading',\n  FILES_UPLOADED = 'files_uploaded',\n  CREATING_NFT = 'creating_nft',\n  NFT_CREATED = 'nft_created',\n  MINTING = 'minting',\n  MINTED = 'minted',\n  LISTING = 'listing',\n  COMPLETED = 'completed',\n  FAILED = 'failed'\n}\n\nexport const CSV_REQUIRED_COLUMNS = ['book_title', 'book_description', 'author_name', 'cover_image_filename']\n\nexport const CSV_ALL_COLUMNS = [\n  'book_title',\n  'book_description',\n  'author_name',\n  'author_description',\n  'publisher',\n  'isbn',\n  'publish_date',\n  'list_price',\n  'tags',\n  'cover_image_filename',\n  'pdf_filename',\n  'epub_filename',\n  'edition_name',\n  'edition_description',\n  'auto_deliver',\n  'auto_memo',\n  'enable_drm',\n  'language'\n]\n\nexport const CSV_OPTIONAL_COLUMNS_WITH_DEFAULTS: Record<string, string> = {\n  list_price: String(DEFAULT_PRICE),\n  edition_name: CSV_DEFAULT_EDITION_NAME,\n  edition_description: CSV_DEFAULT_EDITION_DESCRIPTION,\n  auto_deliver: String(CSV_DEFAULT_AUTO_DELIVER),\n  enable_drm: String(CSV_DEFAULT_ENABLE_DRM),\n  language: CSV_DEFAULT_LANGUAGE\n}\n\nexport const CSV_RESULT_COLUMNS = [\n  ...CSV_ALL_COLUMNS,\n  'class_id',\n  'mint_tx_hash',\n  'cover_arweave_id',\n  'book_arweave_id',\n  'book_arweave_key',\n  'status',\n  'remark'\n]\n\nexport interface BulkUploadCSVRow {\n  book_title: string\n  book_description: string\n  author_name: string\n  author_description?: string\n  publisher?: string\n  isbn?: string\n  publish_date?: string\n  list_price?: string\n  tags?: string\n  cover_image_filename: string\n  pdf_filename?: string\n  epub_filename?: string\n  edition_name?: string\n  edition_description?: string\n  auto_deliver?: string\n  auto_memo?: string\n  enable_drm?: string\n  language?: string\n  // Resume fields (from result CSV)\n  class_id?: string\n  mint_tx_hash?: string\n  cover_arweave_id?: string\n  book_arweave_id?: string\n  book_arweave_key?: string\n  status?: string\n  remark?: string\n}\n\nexport interface BulkUploadBook {\n  id: string\n  rowIndex: number\n  // CSV fields\n  title: string\n  description: string\n  authorName: string\n  authorDescription?: string\n  publisher: string\n  isbn?: string\n  publishDate?: string\n  listPrice: number\n  tags: string[]\n  coverImageFilename: string\n  pdfFilename?: string\n  epubFilename?: string\n  editionName: string\n  editionDescription: string\n  isAutoDeliver: boolean\n  autoMemo: string\n  enableDRM: boolean\n  language: string\n  // Runtime state\n  status: BookUploadStatus\n  error?: string\n  // File references (for matching)\n  coverFile?: File\n  pdfFile?: File\n  epubFile?: File\n  // Progress tracking (persisted for resume)\n  coverArweaveId?: string\n  coverIpfsHash?: string\n  bookArweaveId?: string\n  bookArweaveKey?: string\n  bookIpfsHash?: string\n  classId?: string\n  mintTxHash?: string\n}\n\nexport interface SerializedBulkUploadBook {\n  id: string\n  rowIndex: number\n  title: string\n  description: string\n  authorName: string\n  authorDescription?: string\n  publisher: string\n  isbn?: string\n  publishDate?: string\n  listPrice: number\n  tags: string[]\n  coverImageFilename: string\n  pdfFilename?: string\n  epubFilename?: string\n  editionName: string\n  editionDescription: string\n  isAutoDeliver: boolean\n  autoMemo: string\n  enableDRM: boolean\n  language: string\n  status: BookUploadStatus\n  error?: string\n  // Progress tracking\n  coverArweaveId?: string\n  coverIpfsHash?: string\n  bookArweaveId?: string\n  bookArweaveKey?: string\n  bookIpfsHash?: string\n  classId?: string\n  mintTxHash?: string\n}\n\nexport interface BulkUploadSession {\n  sessionId: string\n  createdAt: string\n  books: SerializedBulkUploadBook[]\n  currentIndex: number\n}\n\nexport interface BulkUploadValidationError {\n  rowIndex: number\n  field: string\n  message: string\n  params?: Record<string, string | number>\n}\n\nexport function parseCSVRow (row: BulkUploadCSVRow, rowIndex: number): BulkUploadBook {\n  const tags = row.tags\n    ? row.tags.split(',').map(t => t.trim()).filter(Boolean)\n    : []\n\n  const listPrice = row.list_price ? parseFloat(row.list_price) : DEFAULT_PRICE\n\n  return {\n    id: crypto.randomUUID(),\n    rowIndex,\n    title: row.book_title?.trim() || '',\n    description: row.book_description?.trim() || '',\n    authorName: row.author_name?.trim() || '',\n    authorDescription: row.author_description?.trim(),\n    publisher: row.publisher?.trim() || '',\n    isbn: row.isbn?.trim(),\n    publishDate: row.publish_date?.trim() || '',\n    listPrice: isNaN(listPrice) ? DEFAULT_PRICE : listPrice,\n    tags,\n    coverImageFilename: row.cover_image_filename?.trim() || '',\n    pdfFilename: row.pdf_filename?.trim() || undefined,\n    epubFilename: row.epub_filename?.trim() || undefined,\n    editionName: row.edition_name?.trim() || CSV_DEFAULT_EDITION_NAME,\n    editionDescription: row.edition_description?.trim() || CSV_DEFAULT_EDITION_DESCRIPTION,\n    isAutoDeliver: row.auto_deliver?.trim().toLowerCase() !== 'false',\n    autoMemo: row.auto_memo?.trim() || '',\n    enableDRM: row.enable_drm?.trim().toLowerCase() === 'true',\n    language: row.language?.trim() || CSV_DEFAULT_LANGUAGE,\n    status: BookUploadStatus.PENDING\n  }\n}\n\nconst VALID_BOOLEAN_VALUES = ['true', 'false', '']\n\nexport function validateBook (book: BulkUploadBook, rawRow?: BulkUploadCSVRow): BulkUploadValidationError[] {\n  const errors: BulkUploadValidationError[] = []\n  const { rowIndex } = book\n\n  if (!book.title) {\n    errors.push({ rowIndex, field: 'book_title', message: 'bulk_upload.error_book_title_required' })\n  }\n\n  if (!book.description) {\n    errors.push({ rowIndex, field: 'book_description', message: 'bulk_upload.error_book_description_required' })\n  }\n\n  if (book.description && book.description.length > 1000) {\n    errors.push({ rowIndex, field: 'book_description', message: 'bulk_upload.error_book_description_too_long' })\n  }\n\n  if (!book.authorName) {\n    errors.push({ rowIndex, field: 'author_name', message: 'bulk_upload.error_author_name_required' })\n  }\n\n  if (book.listPrice !== 0 && book.listPrice < MINIMAL_PRICE) {\n    errors.push({ rowIndex, field: 'list_price', message: 'bulk_upload.error_invalid_price', params: { minPrice: MINIMAL_PRICE } })\n  }\n\n  if (!book.coverImageFilename) {\n    errors.push({ rowIndex, field: 'cover_image_filename', message: 'bulk_upload.error_cover_required' })\n  }\n\n  if (!book.pdfFilename && !book.epubFilename) {\n    errors.push({ rowIndex, field: 'pdf_filename/epub_filename', message: 'bulk_upload.error_ebook_required' })\n  }\n\n  if (book.autoMemo && !book.isAutoDeliver) {\n    errors.push({ rowIndex, field: 'auto_memo', message: 'bulk_upload.error_auto_memo_requires_auto_deliver' })\n  }\n\n  // Validate boolean fields contain valid values\n  if (rawRow) {\n    const autoDeliverVal = rawRow.auto_deliver?.trim().toLowerCase() ?? ''\n    if (autoDeliverVal && !VALID_BOOLEAN_VALUES.includes(autoDeliverVal)) {\n      errors.push({ rowIndex, field: 'auto_deliver', message: 'bulk_upload.error_invalid_boolean', params: { field: 'auto_deliver', value: rawRow.auto_deliver!.trim() } })\n    }\n    const enableDrmVal = rawRow.enable_drm?.trim().toLowerCase() ?? ''\n    if (enableDrmVal && !VALID_BOOLEAN_VALUES.includes(enableDrmVal)) {\n      errors.push({ rowIndex, field: 'enable_drm', message: 'bulk_upload.error_invalid_boolean', params: { field: 'enable_drm', value: rawRow.enable_drm!.trim() } })\n    }\n  }\n\n  return errors\n}\n\nexport function validateBooks (books: BulkUploadBook[]): BulkUploadValidationError[] {\n  const errors: BulkUploadValidationError[] = []\n  const seen = new Map<string, { rowIndex: number; field: string }>()\n\n  for (const book of books) {\n    const filenames: { name: string; field: string }[] = []\n    if (book.coverImageFilename) { filenames.push({ name: book.coverImageFilename, field: 'cover_image_filename' }) }\n    if (book.pdfFilename) { filenames.push({ name: book.pdfFilename, field: 'pdf_filename' }) }\n    if (book.epubFilename) { filenames.push({ name: book.epubFilename, field: 'epub_filename' }) }\n\n    for (const { name, field } of filenames) {\n      const key = name.toLowerCase()\n      const existing = seen.get(key)\n      if (existing) {\n        errors.push({\n          rowIndex: book.rowIndex,\n          field,\n          message: 'bulk_upload.error_duplicate_filename',\n          params: { filename: name, otherRow: existing.rowIndex, otherField: existing.field }\n        })\n      } else {\n        seen.set(key, { rowIndex: book.rowIndex, field })\n      }\n    }\n  }\n\n  return errors\n}\n\nexport function serializeBook (book: BulkUploadBook): SerializedBulkUploadBook {\n  return {\n    id: book.id,\n    rowIndex: book.rowIndex,\n    title: book.title,\n    description: book.description,\n    authorName: book.authorName,\n    authorDescription: book.authorDescription,\n    publisher: book.publisher,\n    isbn: book.isbn,\n    publishDate: book.publishDate,\n    listPrice: book.listPrice,\n    tags: book.tags,\n    coverImageFilename: book.coverImageFilename,\n    pdfFilename: book.pdfFilename,\n    epubFilename: book.epubFilename,\n    editionName: book.editionName,\n    editionDescription: book.editionDescription,\n    isAutoDeliver: book.isAutoDeliver,\n    autoMemo: book.autoMemo,\n    enableDRM: book.enableDRM,\n    language: book.language,\n    status: book.status,\n    error: book.error,\n    coverArweaveId: book.coverArweaveId,\n    coverIpfsHash: book.coverIpfsHash,\n    bookArweaveId: book.bookArweaveId,\n    bookArweaveKey: book.bookArweaveKey,\n    bookIpfsHash: book.bookIpfsHash,\n    classId: book.classId,\n    mintTxHash: book.mintTxHash\n  }\n}\n\nexport function deserializeBook (serialized: SerializedBulkUploadBook): BulkUploadBook {\n  return {\n    ...serialized,\n    coverFile: undefined,\n    pdfFile: undefined,\n    epubFile: undefined\n  }\n}\n\nexport interface ValidatedProgressFields {\n  coverArweaveId?: string\n  bookArweaveId?: string\n  bookArweaveKey?: string\n  classId?: string\n  mintTxHash?: string\n}\n\nconst ARWEAVE_ID_REGEX = /^[a-zA-Z0-9_-]{43}$/\nconst TX_HASH_REGEX = /^0x[a-fA-F0-9]{64}$/\n\nexport function validateProgressFieldFormats (row: BulkUploadCSVRow): ValidatedProgressFields {\n  const result: ValidatedProgressFields = {}\n\n  if (row.cover_arweave_id && ARWEAVE_ID_REGEX.test(row.cover_arweave_id)) {\n    result.coverArweaveId = row.cover_arweave_id\n  }\n\n  if (row.book_arweave_id && ARWEAVE_ID_REGEX.test(row.book_arweave_id)) {\n    result.bookArweaveId = row.book_arweave_id\n  }\n\n  if (row.book_arweave_key && row.book_arweave_key.trim()) {\n    result.bookArweaveKey = row.book_arweave_key.trim()\n  }\n\n  if (row.class_id && row.class_id.startsWith('0x')) {\n    result.classId = row.class_id\n  }\n\n  if (row.mint_tx_hash && TX_HASH_REGEX.test(row.mint_tx_hash)) {\n    result.mintTxHash = row.mint_tx_hash\n  }\n\n  return result\n}\n\nexport async function generateResultCSV (books: BulkUploadBook[]): Promise<void> {\n  const { stringify: csvStringify } = await import('csv-stringify/sync')\n  const { saveAs } = await import('file-saver')\n\n  const rows = books.map(book => [\n    book.title,\n    book.description,\n    book.authorName,\n    book.authorDescription || '',\n    book.publisher,\n    book.isbn || '',\n    book.publishDate || '',\n    book.listPrice,\n    book.tags.join(','),\n    book.coverImageFilename,\n    book.pdfFilename || '',\n    book.epubFilename || '',\n    book.editionName,\n    book.editionDescription,\n    book.isAutoDeliver ? 'true' : 'false',\n    book.autoMemo,\n    book.enableDRM ? 'true' : 'false',\n    book.language,\n    book.classId || '',\n    book.mintTxHash || '',\n    book.coverArweaveId || '',\n    book.bookArweaveId || '',\n    book.bookArweaveKey || '',\n    book.status,\n    book.error || ''\n  ])\n\n  const csvContent = csvStringify(rows, {\n    header: true,\n    columns: CSV_RESULT_COLUMNS\n  })\n\n  const bom = '\\uFEFF'\n  const blob = new Blob([bom + csvContent], { type: 'text/csv;charset=utf-8;' })\n  saveAs(blob, `bulk-upload-result-${new Date().toISOString().slice(0, 10)}.csv`)\n}\n","import type {\n  BulkUploadSession,\n  BulkUploadBook,\n  SerializedBulkUploadBook\n} from './bulk-upload.type'\nimport { serializeBook, deserializeBook } from './bulk-upload.type'\n\nexport const BULK_UPLOAD_KEY = 'publish_book_bulk_upload_session'\n\nexport function saveBulkUploadSession (\n  books: BulkUploadBook[],\n  currentIndex: number,\n  sessionId?: string\n): void {\n  try {\n    const session: BulkUploadSession = {\n      sessionId: sessionId || crypto.randomUUID(),\n      createdAt: new Date().toISOString(),\n      books: books.map(serializeBook),\n      currentIndex\n    }\n    sessionStorage.setItem(BULK_UPLOAD_KEY, JSON.stringify(session))\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.warn('Failed to save bulk upload session to sessionStorage:', error)\n  }\n}\n\nexport function loadBulkUploadSession (): BulkUploadSession | null {\n  try {\n    const stored = sessionStorage.getItem(BULK_UPLOAD_KEY)\n    if (stored) {\n      return JSON.parse(stored)\n    }\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.warn('Failed to read bulk upload session from sessionStorage:', error)\n  }\n  return null\n}\n\nexport function clearBulkUploadSession (): void {\n  try {\n    sessionStorage.removeItem(BULK_UPLOAD_KEY)\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.warn('Failed to clear bulk upload session from sessionStorage:', error)\n  }\n}\n\nexport function updateBookInSession (\n  bookId: string,\n  updates: Partial<SerializedBulkUploadBook>\n): void {\n  const session = loadBulkUploadSession()\n  if (!session) { return }\n\n  const book = session.books.find(b => b.id === bookId)\n  if (!book) { return }\n\n  Object.assign(book, updates)\n\n  try {\n    sessionStorage.setItem(BULK_UPLOAD_KEY, JSON.stringify(session))\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.warn('Failed to update book in session:', error)\n  }\n}\n\nexport function restoreBooksFromSession (\n  session: BulkUploadSession\n): BulkUploadBook[] {\n  return session.books.map(deserializeBook)\n}\n","import { useSendTransaction } from '@wagmi/vue'\nimport { parseEther } from 'viem'\nimport { estimateBundlrFilePrice, uploadSingleFileToBundlr } from '~/utils/arweave'\nimport { encryptDataWithAES } from '~/utils/encryption'\n\nexport interface ArweaveUploadResult {\n  arweaveId: string\n  arweaveLink: string\n  ipfsHash: string\n  arweaveKey?: string\n}\n\nexport function useArweaveUpload () {\n  const walletStore = useWalletStore()\n  const bookstoreApiStore = useBookstoreApiStore()\n  const { wallet } = storeToRefs(walletStore)\n  const { token } = storeToRefs(bookstoreApiStore)\n  const {\n    assertSufficientBalanceForTransfer,\n    waitForTransactionReceipt\n  } = useNFTContractWriter()\n  const { sendTransactionAsync } = useSendTransaction()\n  const { ARWEAVE_ENDPOINT } = useRuntimeConfig().public\n\n  async function uploadToArweave (params: {\n    arrayBuffer: ArrayBuffer\n    fileSize: number\n    fileType: string\n    encrypt: boolean\n  }): Promise<ArweaveUploadResult> {\n    let buffer = Buffer.from(params.arrayBuffer)\n    let ipfsHash = await calculateIPFSHash(buffer) || ''\n    let key: string | undefined\n\n    if (params.encrypt) {\n      const { rawEncryptedKeyAsBase64, combinedArrayBuffer } = await encryptDataWithAES({ data: params.arrayBuffer })\n      buffer = Buffer.from(combinedArrayBuffer)\n      ipfsHash = await calculateIPFSHash(buffer) || ''\n      key = rawEncryptedKeyAsBase64\n    }\n\n    const priceResult = await estimateBundlrFilePrice({\n      fileSize: buffer.length,\n      ipfsHash: params.encrypt ? undefined : ipfsHash\n    })\n\n    const { evmAddress, arweaveId: existingArweaveId, ETH } = priceResult\n\n    if (existingArweaveId) {\n      return {\n        arweaveId: existingArweaveId,\n        arweaveLink: `${ARWEAVE_ENDPOINT}/${existingArweaveId}`,\n        arweaveKey: key,\n        ipfsHash\n      }\n    }\n\n    if (!ETH || !evmAddress) {\n      throw new Error('Failed to get Arweave fee estimate')\n    }\n\n    const memo = JSON.stringify({\n      ipfs: ipfsHash,\n      fileSize: buffer.length\n    })\n\n    await assertSufficientBalanceForTransfer({\n      wallet: wallet.value!,\n      to: evmAddress as `0x${string}`,\n      value: parseEther(ETH),\n      data: `0x${Buffer.from(memo, 'utf-8').toString('hex')}` as `0x${string}`\n    })\n\n    const txHash = await sendTransactionAsync({\n      to: evmAddress as `0x${string}`,\n      value: parseEther(ETH),\n      data: `0x${Buffer.from(memo, 'utf-8').toString('hex')}`\n    })\n\n    const receipt = await waitForTransactionReceipt({ hash: txHash, confirmations: 2 })\n    if (!receipt || receipt.status !== 'success') {\n      throw new Error('Arweave fee transaction failed')\n    }\n\n    const { arweaveId, arweaveLink } = await uploadSingleFileToBundlr(buffer, {\n      fileSize: buffer.length,\n      ipfsHash,\n      fileType: params.fileType,\n      txHash,\n      token: token.value,\n      key\n    })\n\n    if (!arweaveId) {\n      throw new Error('Failed to upload file to Arweave')\n    }\n\n    return { arweaveId, arweaveLink, arweaveKey: key, ipfsHash }\n  }\n\n  return { uploadToArweave }\n}\n","import type { BulkUploadBook } from '~/utils/bulk-upload.type'\nimport { BookUploadStatus } from '~/utils/bulk-upload.type'\nimport { NFT_DEFAULT_MINT_AMOUNT } from '~/constant'\nimport { getApiEndpoints } from '~/constant/api'\nimport type { NFTTokenMetadata } from '~/composables/useNFTMinter'\n\ninterface ProcessingCallbacks {\n  onStatusChange?: (bookId: string, status: BookUploadStatus, message?: string) => void\n  onProgress?: (bookId: string, updates: Partial<BulkUploadBook>) => void\n  onError?: (bookId: string, error: string) => void\n}\n\nexport function useBulkUpload () {\n  const walletStore = useWalletStore()\n  const bookstoreApiStore = useBookstoreApiStore()\n  const { wallet, signer } = storeToRefs(walletStore)\n  const { validateWalletConsistency } = walletStore\n  const { newBookListing } = bookstoreApiStore\n  const { uploadToArweave } = useArweaveUpload()\n  const { createNFTClass } = useNFTClassCreator()\n  const { mintNFT } = useNFTMinter()\n  const { BOOK3_URL } = useRuntimeConfig().public\n\n  const isProcessing = ref(false)\n  const currentBook = ref<BulkUploadBook | null>(null)\n  const currentStep = ref('')\n\n  async function processBook (\n    book: BulkUploadBook,\n    callbacks: ProcessingCallbacks = {}\n  ): Promise<boolean> {\n    const { onStatusChange, onError } = callbacks\n\n    try {\n      isProcessing.value = true\n      currentBook.value = book\n\n      // Ensure wallet is connected\n      await validateWalletConsistency()\n      if (!wallet.value || !signer.value) {\n        throw new Error('Wallet not connected')\n      }\n\n      // Step 1: Upload files to Arweave\n      if (!book.coverArweaveId || !book.bookArweaveId) {\n        onStatusChange?.(book.id, BookUploadStatus.UPLOADING_FILES)\n        await uploadFilesToArweave(book, callbacks)\n      }\n\n      // Step 2: Create NFT class (ISCN registration)\n      if (!book.classId) {\n        onStatusChange?.(book.id, BookUploadStatus.CREATING_NFT)\n        await createNFTClassForBook(book, callbacks)\n      }\n\n      // Step 3: Mint NFT\n      if (!book.mintTxHash) {\n        onStatusChange?.(book.id, BookUploadStatus.MINTING)\n        await mintNFTForBook(book, callbacks)\n      }\n\n      // Step 4: Create book listing\n      onStatusChange?.(book.id, BookUploadStatus.LISTING)\n      await createBookListing(book, callbacks)\n\n      onStatusChange?.(book.id, BookUploadStatus.COMPLETED)\n      return true\n    } catch (error: any) {\n      const errorMessage = error?.message || error?.toString() || 'Unknown error'\n      onError?.(book.id, errorMessage)\n      onStatusChange?.(book.id, BookUploadStatus.FAILED, errorMessage)\n      return false\n    } finally {\n      isProcessing.value = false\n      currentBook.value = null\n      currentStep.value = ''\n    }\n  }\n\n  async function uploadFilesToArweave (\n    book: BulkUploadBook,\n    callbacks: ProcessingCallbacks\n  ): Promise<void> {\n    const { onProgress } = callbacks\n\n    if (!book.coverArweaveId) {\n      if (!book.coverFile) {\n        throw new Error('No cover image file found')\n      }\n      currentStep.value = 'uploading_cover'\n      const coverResult = await uploadToArweave({\n        arrayBuffer: await book.coverFile.arrayBuffer(),\n        fileSize: book.coverFile.size,\n        fileType: book.coverFile.type,\n        encrypt: false\n      })\n      book.coverArweaveId = coverResult.arweaveId\n      book.coverIpfsHash = coverResult.ipfsHash\n      onProgress?.(book.id, {\n        coverArweaveId: coverResult.arweaveId,\n        coverIpfsHash: coverResult.ipfsHash\n      })\n    }\n\n    if (!book.bookArweaveId) {\n      const ebookFile = book.epubFile || book.pdfFile\n      if (!ebookFile) {\n        throw new Error('No ebook file found')\n      }\n\n      currentStep.value = 'uploading_ebook'\n      const bookResult = await uploadToArweave({\n        arrayBuffer: await ebookFile.arrayBuffer(),\n        fileSize: ebookFile.size,\n        fileType: ebookFile.type,\n        encrypt: book.enableDRM\n      })\n      book.bookArweaveId = bookResult.arweaveId\n      book.bookArweaveKey = bookResult.arweaveKey\n      book.bookIpfsHash = bookResult.ipfsHash\n      onProgress?.(book.id, {\n        bookArweaveId: bookResult.arweaveId,\n        bookArweaveKey: bookResult.arweaveKey,\n        bookIpfsHash: bookResult.ipfsHash\n      })\n    }\n  }\n\n  async function createNFTClassForBook (\n    book: BulkUploadBook,\n    callbacks: ProcessingCallbacks\n  ): Promise<void> {\n    const { onProgress } = callbacks\n    currentStep.value = 'creating_nft_class'\n\n    const apiEndpoints = getApiEndpoints()\n\n    const ebookFile = book.epubFile || book.pdfFile\n    const fileType = book.epubFile ? 'epub' : 'pdf'\n    const arweaveLink = book.bookArweaveKey\n      ? `${apiEndpoints.API_GET_ARWEAVE_V2_LINK}/${book.bookArweaveId}?key=${book.bookArweaveKey}`\n      : `ar://${book.bookArweaveId}`\n\n    const contentFingerprints = [\n      { url: `ar://${book.coverArweaveId}` },\n      { url: arweaveLink }\n    ]\n\n    const iscnFormData = ref({\n      type: 'Book',\n      title: book.title,\n      description: book.description,\n      alternativeHeadline: '',\n      isbn: book.isbn || '',\n      publisher: book.publisher,\n      publicationDate: book.publishDate || '',\n      author: {\n        name: book.authorName,\n        description: book.authorDescription || ''\n      },\n      license: 'All Rights Reserved',\n      customLicense: '',\n      contentFingerprints,\n      downloadableUrls: [{\n        url: arweaveLink,\n        type: fileType,\n        fileName: ebookFile?.name || `${book.title}.${fileType}`\n      }],\n      language: book.language,\n      bookInfoUrl: '',\n      tags: book.tags,\n      coverUrl: `ar://${book.coverArweaveId}`,\n      genre: ''\n    })\n\n    const { classId } = await createNFTClass({ iscnFormData })\n    book.classId = classId\n    onProgress?.(book.id, { classId })\n  }\n\n  async function mintNFTForBook (\n    book: BulkUploadBook,\n    callbacks: ProcessingCallbacks\n  ): Promise<void> {\n    const { onProgress } = callbacks\n    currentStep.value = 'minting_nft'\n\n    if (!book.classId) {\n      throw new Error('Class ID not found')\n    }\n\n    const mintCount = NFT_DEFAULT_MINT_AMOUNT\n\n    const buildTokenMetadata = (index: number, fromTokenId: bigint): NFTTokenMetadata => ({\n      image: `ar://${book.coverArweaveId}`,\n      external_url: `${BOOK3_URL}/store/${book.classId}/${Number(fromTokenId) + index}`,\n      description: `Copy #${Number(fromTokenId) + index} of ${book.title}`,\n      name: `${book.title} #${Number(fromTokenId) + index}`,\n      attributes: [\n        { trait_type: 'Author', value: book.authorName },\n        { trait_type: 'Publisher', value: book.publisher }\n      ]\n    })\n\n    const { txHash } = await mintNFT({\n      classId: book.classId,\n      mintCount,\n      buildTokenMetadata\n    })\n\n    book.mintTxHash = txHash\n    onProgress?.(book.id, { mintTxHash: txHash })\n  }\n\n  async function createBookListing (\n    book: BulkUploadBook,\n    _callbacks: ProcessingCallbacks\n  ): Promise<void> {\n    currentStep.value = 'creating_listing'\n\n    if (!book.classId) {\n      throw new Error('Class ID not found')\n    }\n\n    const price = {\n      name: {\n        en: book.editionName,\n        zh: book.editionName\n      },\n      description: {\n        en: book.editionDescription,\n        zh: book.editionDescription\n      },\n      priceInDecimal: Math.round(book.listPrice * 100),\n      price: book.listPrice,\n      stock: 0,\n      isAutoDeliver: book.isAutoDeliver,\n      isAllowCustomPrice: true,\n      isUnlisted: false,\n      autoMemo: book.autoMemo\n    }\n\n    await newBookListing(book.classId, {\n      defaultPaymentCurrency: 'USD',\n      connectedWallets: null,\n      moderatorWallets: ['0xa037Feb6508A8C2F93bb19f6721730C45921f2D0'],\n      prices: [price],\n      mustClaimToView: true,\n      enableCustomMessagePage: !!book.autoMemo,\n      hideDownload: book.enableDRM\n    })\n  }\n\n  async function processBooksSequentially (\n    books: BulkUploadBook[],\n    callbacks: ProcessingCallbacks & {\n      onBookComplete?: (book: BulkUploadBook, success: boolean) => void\n      shouldContinue?: () => boolean\n    }\n  ): Promise<{ completed: number; failed: number }> {\n    let completed = 0\n    let failed = 0\n\n    for (const book of books) {\n      // Check if we should continue\n      if (callbacks.shouldContinue && !callbacks.shouldContinue()) {\n        break\n      }\n\n      // Skip already completed books\n      if (book.status === BookUploadStatus.COMPLETED) {\n        completed++\n        continue\n      }\n\n      const success = await processBook(book, callbacks)\n\n      if (success) {\n        completed++\n      } else {\n        failed++\n      }\n\n      callbacks.onBookComplete?.(book, success)\n\n      // Small delay between books to avoid rate limiting\n      await new Promise(resolve => setTimeout(resolve, 2000))\n    }\n\n    return { completed, failed }\n  }\n\n  return {\n    isProcessing: readonly(isProcessing),\n    currentBook: readonly(currentBook),\n    currentStep: readonly(currentStep),\n    processBook,\n    processBooksSequentially\n  }\n}\n","<template>\n  <PageContainer>\n    <PageHeader :title=\"$t('bulk_upload.page_title')\" />\n\n    <PageBody>\n      <!-- Resume Session Alert -->\n      <UAlert\n        v-if=\"hasExistingSession && !isProcessing\"\n        icon=\"i-heroicons-information-circle\"\n        color=\"info\"\n        variant=\"soft\"\n        :title=\"$t('bulk_upload.existing_session_found')\"\n        :description=\"$t('bulk_upload.existing_session_description')\"\n      >\n        <template #actions>\n          <div class=\"flex gap-2\">\n            <UButton\n              :label=\"$t('bulk_upload.resume_session')\"\n              color=\"primary\"\n              @click=\"resumeSession\"\n            />\n            <UButton\n              :label=\"$t('bulk_upload.start_new')\"\n              variant=\"outline\"\n              @click=\"clearAndStartNew\"\n            />\n          </div>\n        </template>\n      </UAlert>\n\n      <!-- Step 1: CSV Upload -->\n      <UCard v-if=\"currentStep === 'csv'\" :ui=\"{ body: 'space-y-4' }\">\n        <template #header>\n          <h3 class=\"font-bold\">\n            {{ $t('bulk_upload.step1_title') }}\n          </h3>\n        </template>\n\n        <div class=\"flex items-end gap-4\">\n          <UFormField :label=\"$t('bulk_upload.upload_csv')\" class=\"flex-1\">\n            <UInput\n              type=\"file\"\n              accept=\".csv\"\n              @change=\"handleCSVFileUpload\"\n            />\n          </UFormField>\n          <UButton\n            :label=\"$t('bulk_upload.download_template')\"\n            variant=\"outline\"\n            icon=\"i-heroicons-arrow-down-tray\"\n            @click=\"downloadCSVTemplate\"\n          />\n        </div>\n\n        <details class=\"text-sm\">\n          <summary class=\"cursor-pointer font-medium text-gray-600 hover:text-gray-900\">\n            {{ $t('bulk_upload.csv_column_reference') }}\n          </summary>\n          <UTable\n            class=\"mt-2\"\n            :columns=\"csvColumnRefColumns\"\n            :data=\"csvColumnRefData\"\n          />\n        </details>\n      </UCard>\n\n      <!-- Verifying Progress Loading -->\n      <UCard v-if=\"isVerifyingProgress\" :ui=\"{ body: 'space-y-4' }\">\n        <div class=\"flex items-center gap-3\">\n          <UIcon name=\"i-heroicons-arrow-path\" class=\"animate-spin text-primary\" />\n          <span>{{ $t('bulk_upload.verifying_progress') }}</span>\n        </div>\n      </UCard>\n\n      <!-- Validation Errors -->\n      <UAlert\n        v-if=\"validationErrors.length > 0 && currentStep === 'csv'\"\n        icon=\"i-heroicons-exclamation-triangle\"\n        color=\"error\"\n        variant=\"soft\"\n        :title=\"$t('bulk_upload.validation_errors')\"\n      >\n        <template #description>\n          <ul class=\"list-disc pl-4 mt-2\">\n            <li v-for=\"(error, index) in validationErrors\" :key=\"index\">\n              {{ $t('bulk_upload.error_row', { row: error.rowIndex }) }}: {{ error.field }} - {{ $t(error.message, error.params || {}) }}\n            </li>\n          </ul>\n        </template>\n      </UAlert>\n\n      <!-- CSV-level Errors -->\n      <UAlert\n        v-if=\"csvError && currentStep === 'csv'\"\n        icon=\"i-heroicons-exclamation-triangle\"\n        color=\"error\"\n        variant=\"soft\"\n        :title=\"csvError\"\n      />\n\n      <!-- Step 2: File Selection -->\n      <UCard v-if=\"currentStep === 'files'\" :ui=\"{ body: 'space-y-4' }\">\n        <template #header>\n          <h3 class=\"font-bold\">\n            {{ $t('bulk_upload.step2_title') }}\n          </h3>\n        </template>\n\n        <UAlert\n          v-if=\"missingOptionalColumns.length > 0\"\n          icon=\"i-heroicons-exclamation-triangle\"\n          color=\"warning\"\n          variant=\"soft\"\n          :title=\"$t('bulk_upload.missing_optional_columns_warning')\"\n        >\n          <template #description>\n            <ul class=\"list-disc pl-4 mt-2 text-sm\">\n              <li v-for=\"col in missingOptionalColumns\" :key=\"col.column\">\n                <code>{{ col.column }}</code>  {{ $t('bulk_upload.csv_col_default') }}: <strong>{{ col.defaultValue }}</strong>\n              </li>\n            </ul>\n          </template>\n        </UAlert>\n\n        <p class=\"text-sm text-gray-600\">\n          {{ $t('bulk_upload.select_files_description', { count: books.length }) }}\n        </p>\n\n        <!-- Expected Files & Matching Status -->\n        <div class=\"space-y-2\">\n          <p class=\"font-medium\">\n            {{ $t('bulk_upload.expected_files') }}\n          </p>\n          <UTable\n            :columns=\"[\n              { accessorKey: 'title', header: $t('bulk_upload.book_title') },\n              { accessorKey: 'coverStatus', header: $t('bulk_upload.cover') },\n              { accessorKey: 'pdfStatus', header: 'PDF' },\n              { accessorKey: 'epubStatus', header: 'EPUB' },\n            ]\"\n            :data=\"fileMatchingStatus\"\n          >\n            <template #coverStatus-cell=\"{ row }\">\n              <UBadge\n                v-if=\"row.original.coverFilename\"\n                :color=\"selectedFiles.length === 0 ? 'neutral' : row.original.hasCover ? 'success' : 'error'\"\n                variant=\"soft\"\n              >\n                {{ row.original.coverFilename }}\n              </UBadge>\n            </template>\n            <template #pdfStatus-cell=\"{ row }\">\n              <UBadge\n                v-if=\"row.original.pdfFilename\"\n                :color=\"selectedFiles.length === 0 ? 'neutral' : row.original.hasPdf ? 'success' : 'error'\"\n                variant=\"soft\"\n              >\n                {{ row.original.pdfFilename }}\n              </UBadge>\n            </template>\n            <template #epubStatus-cell=\"{ row }\">\n              <UBadge\n                v-if=\"row.original.epubFilename\"\n                :color=\"selectedFiles.length === 0 ? 'neutral' : row.original.hasEpub ? 'success' : 'error'\"\n                variant=\"soft\"\n              >\n                {{ row.original.epubFilename }}\n              </UBadge>\n            </template>\n          </UTable>\n        </div>\n\n        <UFormField :label=\"$t('bulk_upload.select_files')\">\n          <UInput\n            type=\"file\"\n            multiple\n            accept=\"image/*,.pdf,.epub\"\n            @change=\"handleFilesChange\"\n          />\n        </UFormField>\n\n        <p v-if=\"selectedFiles.length > 0\" class=\"text-sm font-medium\">\n          {{ $t('bulk_upload.files_selected', { count: selectedFiles.length }) }}\n        </p>\n\n        <!-- Extra files warning -->\n        <UAlert\n          v-if=\"extraFiles.length > 0\"\n          icon=\"i-heroicons-exclamation-triangle\"\n          color=\"warning\"\n          variant=\"soft\"\n          :title=\"$t('bulk_upload.extra_files_warning', { count: extraFiles.length })\"\n        >\n          <template #description>\n            <div class=\"flex flex-wrap gap-1 mt-2\">\n              <UBadge\n                v-for=\"file in extraFiles\"\n                :key=\"file.name\"\n                variant=\"soft\"\n                color=\"warning\"\n              >\n                {{ file.name }}\n              </UBadge>\n            </div>\n          </template>\n        </UAlert>\n\n        <div class=\"flex justify-between\">\n          <UButton\n            :label=\"$t('bulk_upload.back')\"\n            variant=\"outline\"\n            @click=\"currentStep = 'csv'\"\n          />\n          <UButton\n            :label=\"$t('bulk_upload.continue')\"\n            :disabled=\"unmatchedBooks.length > 0\"\n            @click=\"currentStep = 'review'\"\n          />\n        </div>\n      </UCard>\n\n      <!-- Step 3: Review -->\n      <UCard v-if=\"currentStep === 'review'\" :ui=\"{ body: 'space-y-4' }\">\n        <template #header>\n          <h3 class=\"font-bold\">\n            {{ $t('bulk_upload.review_title') }}\n          </h3>\n        </template>\n\n        <p class=\"text-sm text-gray-600\">\n          {{ $t('bulk_upload.review_description') }}\n        </p>\n\n        <p class=\"font-medium\">\n          {{ $t('bulk_upload.total_transactions', { count: books.length }) }}\n        </p>\n\n        <UTable\n          :columns=\"[\n            { accessorKey: 'rowIndex', header: '#' },\n            { accessorKey: 'title', header: $t('bulk_upload.book_title') },\n            { accessorKey: 'authorName', header: $t('common.author') },\n            { accessorKey: 'listPrice', header: $t('common.price') },\n            { accessorKey: 'editionName', header: $t('form.edition') },\n            { accessorKey: 'language', header: $t('form.language') },\n            { accessorKey: 'enableDRM', header: $t('bulk_upload.enable_drm') },\n            { accessorKey: 'isAutoDeliver', header: $t('bulk_upload.auto_deliver') },\n            { accessorKey: 'autoMemo', header: $t('bulk_upload.auto_memo') },\n          ]\"\n          :data=\"reviewData\"\n        >\n          <template #enableDRM-cell=\"{ row }\">\n            <UBadge\n              :color=\"row.original.enableDRM ? 'primary' : 'neutral'\"\n              variant=\"soft\"\n            >\n              {{ row.original.enableDRM ? $t('common.yes') : $t('common.no') }}\n            </UBadge>\n          </template>\n          <template #isAutoDeliver-cell=\"{ row }\">\n            <UBadge\n              :color=\"row.original.isAutoDeliver ? 'primary' : 'neutral'\"\n              variant=\"soft\"\n            >\n              {{ row.original.isAutoDeliver ? $t('common.yes') : $t('common.no') }}\n            </UBadge>\n          </template>\n        </UTable>\n\n        <div class=\"flex justify-between\">\n          <UButton\n            :label=\"$t('bulk_upload.back')\"\n            variant=\"outline\"\n            @click=\"currentStep = 'files'\"\n          />\n          <UButton\n            :label=\"$t('bulk_upload.start_upload')\"\n            color=\"primary\"\n            @click=\"startProcessing\"\n          />\n        </div>\n      </UCard>\n\n      <!-- Step 4: Processing -->\n      <UCard v-if=\"currentStep === 'processing'\" :ui=\"{ body: 'space-y-4' }\">\n        <template #header>\n          <div class=\"flex justify-between items-center\">\n            <h3 class=\"font-bold\">\n              {{ $t('bulk_upload.step4_title') }}\n            </h3>\n            <div class=\"flex gap-2\">\n              <UButton\n                v-if=\"isProcessing && !isPaused\"\n                :label=\"$t('bulk_upload.pause')\"\n                variant=\"outline\"\n                @click=\"pauseProcessing\"\n              />\n              <UButton\n                v-if=\"isPaused\"\n                :label=\"$t('bulk_upload.resume')\"\n                color=\"primary\"\n                @click=\"resumeProcessing\"\n              />\n              <UButton\n                v-if=\"!isProcessing && failedBooks.length > 0\"\n                :label=\"$t('bulk_upload.retry_failed')\"\n                variant=\"outline\"\n                @click=\"retryFailed\"\n              />\n              <UButton\n                v-if=\"!isProcessing\"\n                :label=\"$t('bulk_upload.download_result_csv')\"\n                variant=\"outline\"\n                icon=\"i-heroicons-arrow-down-tray\"\n                @click=\"generateResultCSV(books)\"\n              />\n            </div>\n          </div>\n        </template>\n\n        <!-- Progress Summary -->\n        <div class=\"flex gap-4 text-sm\">\n          <span>{{ $t('bulk_upload.total') }}: {{ books.length }}</span>\n          <span class=\"text-green-600\">{{ $t('bulk_upload.completed') }}: {{ completedBooks.length }}</span>\n          <span class=\"text-red-600\">{{ $t('bulk_upload.failed') }}: {{ failedBooks.length }}</span>\n          <span class=\"text-gray-500\">{{ $t('bulk_upload.pending') }}: {{ pendingBooks.length }}</span>\n        </div>\n\n        <UProgress\n          v-if=\"isProcessing || failedBooks.length > 0 || (completedBooks.length > 0 && completedBooks.length < books.length)\"\n          :value=\"((completedBooks.length + failedBooks.length) / books.length) * 100\"\n          :color=\"failedBooks.length > 0 ? 'error' : 'primary'\"\n        />\n\n        <!-- Current Processing Status -->\n        <div v-if=\"currentProcessingBook\" class=\"p-4 bg-gray-50 rounded-lg\">\n          <p class=\"font-medium\">\n            {{ $t('bulk_upload.currently_processing') }}: {{ currentProcessingBook.title }}\n          </p>\n          <p class=\"text-sm text-gray-600\">\n            {{ currentProcessingStep ? $t(`bulk_upload.step_${currentProcessingStep}`) : '' }}\n          </p>\n        </div>\n\n        <!-- Books Table -->\n        <UTable\n          :columns=\"[\n            { accessorKey: 'rowIndex', header: '#' },\n            { accessorKey: 'title', header: $t('bulk_upload.book_title') },\n            { accessorKey: 'status', header: $t('bulk_upload.status') },\n            { accessorKey: 'actions', header: '' },\n          ]\"\n          :data=\"books\"\n        >\n          <template #status-cell=\"{ row }\">\n            <div class=\"flex items-center gap-2\">\n              <UBadge\n                :color=\"getStatusColor(row.original.status)\"\n                variant=\"soft\"\n              >\n                {{ getStatusLabel(row.original.status) }}\n              </UBadge>\n              <span v-if=\"row.original.error\" class=\"text-xs text-red-600\">\n                {{ row.original.error }}\n              </span>\n            </div>\n          </template>\n          <template #actions-cell=\"{ row }\">\n            <UButton\n              v-if=\"row.original.status === BookUploadStatus.COMPLETED && row.original.classId\"\n              :to=\"`/my-books/status/${row.original.classId}`\"\n              variant=\"link\"\n              size=\"xs\"\n            >\n              {{ $t('bulk_upload.view') }}\n            </UButton>\n          </template>\n        </UTable>\n\n        <!-- Completion Actions -->\n        <div v-if=\"!isProcessing && completedBooks.length === books.length\" class=\"flex justify-center gap-4\">\n          <UButton\n            :label=\"$t('bulk_upload.view_my_books')\"\n            to=\"/my-books\"\n          />\n          <UButton\n            :label=\"$t('bulk_upload.upload_more')\"\n            variant=\"outline\"\n            @click=\"resetAll\"\n          />\n        </div>\n      </UCard>\n    </PageBody>\n  </PageContainer>\n</template>\n\n<script setup lang=\"ts\">\nimport { parse as csvParse } from 'csv-parse/sync'\nimport { stringify as csvStringify } from 'csv-stringify/sync'\nimport { getTransactionReceipt } from '@wagmi/vue/actions'\nimport type { BulkUploadBook, BulkUploadCSVRow, BulkUploadValidationError } from '~/utils/bulk-upload.type'\nimport { BookUploadStatus, parseCSVRow, validateBook, validateBooks, validateProgressFieldFormats, generateResultCSV, CSV_ALL_COLUMNS, CSV_REQUIRED_COLUMNS, CSV_OPTIONAL_COLUMNS_WITH_DEFAULTS } from '~/utils/bulk-upload.type'\nimport {\n  loadBulkUploadSession,\n  clearBulkUploadSession,\n  saveBulkUploadSession,\n  restoreBooksFromSession\n} from '~/utils/bulkUploadSession'\n\nconst { t: $t } = useI18n()\nconst toast = useToast()\nconst { processBooksSequentially, currentStep: currentProcessingStep, currentBook: currentProcessingBook } = useBulkUpload()\nconst { getClassMetadata } = useNFTContractReader()\nconst { $wagmiConfig } = useNuxtApp()\n\n// State\nconst currentStep = ref<'csv' | 'files' | 'review' | 'processing'>('csv')\nconst isVerifyingProgress = ref(false)\nconst books = ref<BulkUploadBook[]>([])\nconst validationErrors = ref<BulkUploadValidationError[]>([])\nconst csvError = ref('')\nconst missingOptionalColumns = ref<{ column: string; defaultValue: string }[]>([])\nconst selectedFiles = ref<File[]>([])\nconst isProcessing = ref(false)\nconst isPaused = ref(false)\nconst hasExistingSession = ref(false)\n\n// Computed\nconst pendingBooks = computed(() =>\n  books.value.filter(b => b.status === BookUploadStatus.PENDING)\n)\n\nconst completedBooks = computed(() =>\n  books.value.filter(b => b.status === BookUploadStatus.COMPLETED)\n)\n\nconst failedBooks = computed(() =>\n  books.value.filter(b => b.status === BookUploadStatus.FAILED)\n)\n\nconst unmatchedBooks = computed(() =>\n  books.value.filter((b) => {\n    if (b.status === BookUploadStatus.COMPLETED) { return false }\n    if (b.coverArweaveId && b.bookArweaveId) { return false }\n    return !b.coverFile || (!b.pdfFile && !b.epubFile)\n  })\n)\n\nconst expectedFilenameSet = computed(() => {\n  const set = new Set<string>()\n  books.value.forEach((book) => {\n    if (book.coverImageFilename) { set.add(book.coverImageFilename.toLowerCase()) }\n    if (book.pdfFilename) { set.add(book.pdfFilename.toLowerCase()) }\n    if (book.epubFilename) { set.add(book.epubFilename.toLowerCase()) }\n  })\n  return set\n})\n\nconst extraFiles = computed(() =>\n  selectedFiles.value.filter(f => !expectedFilenameSet.value.has(f.name.toLowerCase()))\n)\n\nconst fileMatchingStatus = computed(() =>\n  books.value.map(book => ({\n    title: book.title,\n    hasCover: !!book.coverFile,\n    coverFilename: book.coverImageFilename,\n    hasPdf: !!book.pdfFile,\n    pdfFilename: book.pdfFilename || '',\n    hasEpub: !!book.epubFile,\n    epubFilename: book.epubFilename || ''\n  }))\n)\n\nconst csvColumnRefColumns = [\n  { accessorKey: 'column', header: $t('bulk_upload.csv_col_column') },\n  { accessorKey: 'required', header: $t('bulk_upload.csv_col_required') },\n  { accessorKey: 'defaultValue', header: $t('bulk_upload.csv_col_default') },\n  { accessorKey: 'description', header: $t('bulk_upload.csv_col_description') }\n]\n\nconst csvColumnRefData = CSV_ALL_COLUMNS.map((col) => {\n  const isRequired = CSV_REQUIRED_COLUMNS.includes(col)\n  return {\n    column: col,\n    required: isRequired ? '' : '',\n    defaultValue: CSV_OPTIONAL_COLUMNS_WITH_DEFAULTS[col] || '',\n    description: $t(`bulk_upload.csv_col_desc_${col}`)\n  }\n})\n\nconst reviewData = computed(() =>\n  books.value.map(book => ({\n    rowIndex: book.rowIndex,\n    title: book.title,\n    authorName: book.authorName,\n    listPrice: book.listPrice === 0 ? 'Free' : `$${book.listPrice}`,\n    editionName: book.editionName,\n    language: book.language,\n    enableDRM: book.enableDRM,\n    isAutoDeliver: book.isAutoDeliver,\n    autoMemo: book.autoMemo\n  }))\n)\n\n// SEO\nuseSeoMeta({\n  title: $t('bulk_upload.page_title'),\n  ogTitle: $t('bulk_upload.page_title')\n})\n\n// Initialize\nonMounted(() => {\n  hasExistingSession.value = loadBulkUploadSession() !== null\n})\n\n// Methods\nfunction handleCSVFileUpload (event: Event) {\n  const target = event.target as HTMLInputElement\n  const file = target.files?.[0]\n  if (!file) { return }\n\n  validationErrors.value = []\n  csvError.value = ''\n\n  const reader = new FileReader()\n  reader.onload = (e) => {\n    const csvContent = e.target?.result as string\n    parseCSV(csvContent)\n  }\n  reader.readAsText(file)\n}\n\nasync function parseCSV (csvContent: string) {\n  validationErrors.value = []\n  csvError.value = ''\n\n  try {\n    const records = csvParse(csvContent, {\n      columns: true,\n      skip_empty_lines: true,\n      trim: true\n    }) as Record<string, string>[]\n\n    if (records.length === 0) {\n      csvError.value = $t('bulk_upload.no_records')\n      return\n    }\n\n    // Validate headers\n    const headers = Object.keys(records[0]!)\n    const missingRequired = CSV_REQUIRED_COLUMNS.filter(col => !headers.includes(col))\n    if (missingRequired.length > 0) {\n      csvError.value = $t('bulk_upload.invalid_headers', { columns: missingRequired.join(', ') })\n      return\n    }\n\n    missingOptionalColumns.value = Object.entries(CSV_OPTIONAL_COLUMNS_WITH_DEFAULTS)\n      .filter(([col]) => !headers.includes(col))\n      .map(([column, defaultValue]) => ({ column, defaultValue }))\n\n    const hasProgressColumns = headers.includes('status') || headers.includes('class_id')\n    const parsedBooks: BulkUploadBook[] = []\n    const allErrors: BulkUploadValidationError[] = []\n\n    records.forEach((row: any, index: number) => {\n      const book = parseCSVRow(row, index + 1)\n      const errors = validateBook(book, row as BulkUploadCSVRow)\n\n      if (errors.length > 0) {\n        allErrors.push(...errors)\n      }\n\n      if (hasProgressColumns) {\n        const csvRow = row as BulkUploadCSVRow\n        const progress = validateProgressFieldFormats(csvRow)\n        Object.assign(book, progress)\n\n        if (csvRow.status === BookUploadStatus.COMPLETED && progress.classId) {\n          book.status = BookUploadStatus.COMPLETED\n        }\n      }\n\n      parsedBooks.push(book)\n    })\n\n    allErrors.push(...validateBooks(parsedBooks))\n\n    if (allErrors.length > 0) {\n      validationErrors.value = allErrors\n      return\n    }\n\n    if (hasProgressColumns) {\n      isVerifyingProgress.value = true\n      try {\n        await verifyProgressFieldsOnChain(parsedBooks)\n      } finally {\n        isVerifyingProgress.value = false\n      }\n    }\n\n    books.value = parsedBooks\n    currentStep.value = 'files'\n\n    toast.add({\n      icon: 'i-heroicons-check-circle',\n      title: $t('bulk_upload.csv_parsed_success', { count: parsedBooks.length }),\n      color: 'success'\n    })\n  } catch (error: any) {\n    toast.add({\n      icon: 'i-heroicons-exclamation-circle',\n      title: $t('bulk_upload.csv_parse_error'),\n      description: error.message,\n      color: 'error'\n    })\n  }\n}\n\nasync function verifyProgressFieldsOnChain (booksToVerify: BulkUploadBook[]) {\n  for (const book of booksToVerify) {\n    if (book.classId) {\n      try {\n        await getClassMetadata(book.classId)\n      } catch {\n        book.classId = undefined\n        book.mintTxHash = undefined\n        if (book.status === BookUploadStatus.COMPLETED) {\n          book.status = BookUploadStatus.PENDING\n        }\n      }\n    }\n\n    if (book.mintTxHash) {\n      try {\n        await getTransactionReceipt($wagmiConfig, { hash: book.mintTxHash as `0x${string}` })\n      } catch {\n        book.mintTxHash = undefined\n      }\n    }\n  }\n}\n\nasync function downloadCSVTemplate () {\n  const { saveAs } = await import('file-saver')\n\n  const sampleRow = [\n    'My Book Title',\n    'A great book about...',\n    'Author Name',\n    'Author bio',\n    'Publisher',\n    '978-1234567890',\n    '2024-01-15',\n    '4.99',\n    'fiction,novel',\n    'cover.jpg',\n    '',\n    'book.epub',\n    '',\n    '',\n    '',\n    '',\n    '',\n    ''\n  ]\n\n  const csvContent = csvStringify([sampleRow], {\n    header: true,\n    columns: CSV_ALL_COLUMNS\n  })\n\n  const bom = '\\uFEFF'\n  const blob = new Blob([bom + csvContent], { type: 'text/csv;charset=utf-8;' })\n  saveAs(blob, 'bulk-upload-template.csv')\n}\n\nfunction handleFilesChange (event: Event) {\n  const target = event.target as HTMLInputElement\n  const files = Array.from(target.files || [])\n  selectedFiles.value = files\n\n  // Clear all previous file matches\n  books.value.forEach((book) => {\n    book.coverFile = undefined\n    book.pdfFile = undefined\n    book.epubFile = undefined\n  })\n\n  // Match files to books\n  const fileMap = new Map<string, File>()\n  files.forEach((file) => {\n    fileMap.set(file.name.toLowerCase(), file)\n  })\n\n  books.value.forEach((book) => {\n    // Match cover image\n    const coverFile = fileMap.get(book.coverImageFilename.toLowerCase())\n    if (coverFile) {\n      book.coverFile = coverFile\n    }\n\n    // Match PDF\n    if (book.pdfFilename) {\n      const pdfFile = fileMap.get(book.pdfFilename.toLowerCase())\n      if (pdfFile) {\n        book.pdfFile = pdfFile\n      }\n    }\n\n    // Match EPUB\n    if (book.epubFilename) {\n      const epubFile = fileMap.get(book.epubFilename.toLowerCase())\n      if (epubFile) {\n        book.epubFile = epubFile\n      }\n    }\n  })\n}\n\nasync function startProcessing () {\n  currentStep.value = 'processing'\n  isProcessing.value = true\n  isPaused.value = false\n\n  // Save session\n  saveBulkUploadSession(books.value, 0)\n\n  await processBooksSequentially(books.value, {\n    onStatusChange: (bookId, status, error) => {\n      const book = books.value.find(b => b.id === bookId)\n      if (book) {\n        book.status = status\n        if (error) { book.error = error }\n        saveBulkUploadSession(books.value, 0)\n      }\n    },\n    onProgress: (bookId, updates) => {\n      const book = books.value.find(b => b.id === bookId)\n      if (book) {\n        Object.assign(book, updates)\n        saveBulkUploadSession(books.value, 0)\n      }\n    },\n    onError: (_bookId, error) => {\n      toast.add({\n        icon: 'i-heroicons-exclamation-circle',\n        title: $t('bulk_upload.book_failed'),\n        description: error,\n        color: 'error',\n        duration: 5000\n      })\n    },\n    onBookComplete: (book, success) => {\n      if (success) {\n        toast.add({\n          icon: 'i-heroicons-check-circle',\n          title: $t('bulk_upload.book_completed', { title: book.title }),\n          color: 'success',\n          duration: 3000\n        })\n      }\n    },\n    shouldContinue: () => !isPaused.value\n  })\n\n  isProcessing.value = false\n\n  if (completedBooks.value.length === books.value.length) {\n    clearBulkUploadSession()\n    toast.add({\n      icon: 'i-heroicons-check-circle',\n      title: $t('bulk_upload.all_completed'),\n      color: 'success'\n    })\n  }\n}\n\nfunction pauseProcessing () {\n  isPaused.value = true\n}\n\nfunction resumeProcessing () {\n  isPaused.value = false\n  startProcessing()\n}\n\nfunction retryFailed () {\n  books.value.forEach((book) => {\n    if (book.status === BookUploadStatus.FAILED) {\n      book.status = BookUploadStatus.PENDING\n      book.error = undefined\n    }\n  })\n  startProcessing()\n}\n\nfunction resumeSession () {\n  const session = loadBulkUploadSession()\n  if (!session) { return }\n\n  books.value = restoreBooksFromSession(session)\n\n  // If all books have their Arweave uploads done, go straight to processing\n  const needsFiles = books.value.some((b) => {\n    if (b.coverArweaveId && b.bookArweaveId) { return false }\n    return !b.coverFile || (!b.pdfFile && !b.epubFile)\n  })\n\n  if (needsFiles) {\n    currentStep.value = 'files'\n  } else {\n    currentStep.value = 'processing'\n  }\n}\n\nfunction clearAndStartNew () {\n  clearBulkUploadSession()\n  resetAll()\n}\n\nfunction resetAll () {\n  books.value = []\n  validationErrors.value = []\n  csvError.value = ''\n  missingOptionalColumns.value = []\n  selectedFiles.value = []\n  currentStep.value = 'csv'\n  isProcessing.value = false\n  isPaused.value = false\n}\n\nfunction getStatusColor (status: BookUploadStatus): 'success' | 'error' | 'neutral' | 'info' {\n  switch (status) {\n    case BookUploadStatus.COMPLETED:\n      return 'success'\n    case BookUploadStatus.FAILED:\n      return 'error'\n    case BookUploadStatus.PENDING:\n      return 'neutral'\n    default:\n      return 'info'\n  }\n}\n\nfunction getStatusLabel (status: BookUploadStatus): string {\n  return $t(`bulk_upload.status_${status}`)\n}\n</script>\n"],"file":"B7-8kpNW.js"}