const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DlLnxKJX.js","./9S2XGRg9.js","./entry.Cz7mG32V.css","./BUjaqu0r.js","./dJIpU6wD.js","./BxkXgiy8.js","./BP1oHQun.js"])))=>i.map(i=>d[i]);
import{bW as m,cq as I,cr as T,c6 as _,cs as S,ct as P,cu as B,a as A,aD as $,cv as C,c as g,e as U,cw as v,cx as x,cy as N,cz as R}from"./9S2XGRg9.js";import{g as f}from"./BFNvVrx5.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"cd189bad150b481aa5ecb2e95de26ec677010e55"}}catch{}})();try{(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="264ef817-7efe-4f79-905b-bff1af6afa83",e._sentryDebugIdIdentifier="sentry-dbid-264ef817-7efe-4f79-905b-bff1af6afa83")})()}catch{}class K extends m{constructor({value:t}){super(`Number \`${t}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function L(e,t){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new K({value:e});let[i,n="0"]=e.split(".");const s=i.startsWith("-");if(s&&(i=i.slice(1)),n=n.replace(/(0+)$/,""),t===0)Math.round(+`.${n}`)===1&&(i=`${BigInt(i)+1n}`),n="";else if(n.length>t){const[a,o,l]=[n.slice(0,t-1),n.slice(t-1,t),n.slice(t)],r=Math.round(+`${o}.${l}`);r>9?n=`${BigInt(a)+BigInt(1)}0`.padStart(a.length+1,"0"):n=`${a}${r}`,n.length>t&&(n=n.slice(1),i=`${BigInt(i)+1n}`),n=n.slice(0,t)}else n=n.padEnd(t,"0");return BigInt(`${s?"-":""}${i}${n}`)}function X(e,t="wei"){return L(e,I[t])}async function k(e,t){const{account:i,chainId:n,connector:s,...a}=t;let o;return typeof i=="object"&&i?.type==="local"?o=e.getClient({chainId:n}):o=await T(e,{account:i??void 0,assertChainId:!1,chainId:n,connector:s}),await _(o,S,"sendTransaction")({...a,...i?{account:i}:{},chain:n?{id:n}:null,gas:a.gas??void 0})}function V(e){return{mutationFn(t){return k(e,t)},mutationKey:["sendTransaction"]}}function J(e={}){const{mutation:t}=e,i=P(e),n=V(i),{mutate:s,mutateAsync:a,...o}=B({...t,...n});return{...o,sendTransaction:s,sendTransactionAsync:a}}class H{pubKey=null;fileSize=0;ipfsHash="";txHash="";token="";constructor({publicKey:t,fileSize:i,ipfsHash:n,txHash:s,token:a}){this.pubKey=Buffer.from(t,"base64"),this.fileSize=i,this.ipfsHash=n,this.txHash=s,this.token=a}setLikeCoinTxInfo({fileSize:t,ipfsHash:i,txHash:n}){this.fileSize=t,this.ipfsHash=i,this.txHash=n}setPublicKey(t){this.pubKey=Buffer.from(t,"base64")}getPublicKey(){return this.pubKey}setAuthToken(t){this.token=t}getSigner=()=>({getAddress:()=>this.pubKey?.toString(),_signTypedData:async(t,i,n)=>{const s=Buffer.from(n["Transaction hash"]).toString("base64"),a=f(),o=await $fetch(a.API_POST_ARWEAVE_V2_SIGN,{method:"POST",body:{signatureData:s,fileSize:this.fileSize,ipfsHash:this.ipfsHash,txToken:"BASEETH",txHash:this.txHash},headers:{Authorization:this.token?`Bearer ${this.token}`:""}}),{signature:l}=o,r=Buffer.from(l,"base64");return Buffer.concat([Buffer.from([0]),r]).toString("hex")}});_ready(){}}let y=null;async function W({fileSize:e,ipfsHash:t,txHash:i,token:n}){const s=f(),a=await $fetch(s.API_GET_ARWEAVE_V2_PUBLIC_KEY),{publicKey:o}=a;return new H({publicKey:o,fileSize:e,ipfsHash:t,txHash:i,token:n})}async function z({fileSize:e,ipfsHash:t,txHash:i,token:n}){if(y||({WebIrys:y}=await $(()=>import("./DlLnxKJX.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url)),!y)throw new Error("Failed to load WebIrys from @irys/sdk");const s=await W({fileSize:e,ipfsHash:t,txHash:i,token:n}),{IS_TESTNET:a}=A().public,o=new y({url:a?"https://devnet.irys.xyz":"https://node1.irys.xyz",token:"base-eth",wallet:{provider:s}});return await o.ready(),o}async function Q({fileSize:e,ipfsHash:t}){const i=f();return await $fetch(i.API_POST_ARWEAVE_V2_ESTIMATE,{method:"POST",body:{fileSize:e,ipfsHash:t}})}async function Z(e,{fileType:t,fileSize:i,ipfsHash:n,txHash:s,token:a,key:o}){const l=await z({fileSize:i,ipfsHash:n,txHash:s,token:a}),r=[{name:"App-Name",value:"publish.3ook.com"},{name:"App-Version",value:"2.0"},{name:"User-Agent",value:"publish.3ook.com"},{name:"IPFS-CID",value:n}];t&&r.push({name:"Content-Type",value:t}),o&&r.push({name:"Content-Encoding",value:"aes256gcm"});const c=(await l.upload(e,{tags:r})).id,{ARWEAVE_ENDPOINT:p}=A().public;let h=`${p}/${c}`;if(c){const b=f(),w=await $fetch(b.API_POST_ARWEAVE_V2_REGISTER,{method:"POST",body:{fileSize:i,ipfsHash:n,txHash:s,arweaveId:c,key:o},headers:{Authorization:a?`Bearer ${a}`:""}});w?.link&&(h=w.link)}return{arweaveId:c,arweaveLink:h,arweaveKey:o}}function M(){let e;if(typeof window<"u"&&window.crypto)e=window.crypto;else throw new Error("Crypto API is not available.");return e}function O(e,t){const i=new Uint8Array(e.byteLength+t.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(t),e.byteLength),i.buffer}function G(e){return Buffer.from(e).toString("base64")}async function j(e){const t=M(),i=await t.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),n=t.getRandomValues(new Uint8Array(12)),s=await t.subtle.encrypt({name:"AES-GCM",iv:n},i,e.data),a=O(n.buffer,s),o=await t.subtle.exportKey("raw",i);return{rawEncryptedKeyAsBase64:G(o),combinedArrayBuffer:a}}function D(e){if(!e||!/^[\x20-\x7E]+$/.test(e))return!1;try{const t=new URL(e);return["http:","https:","ar:","ipfs:"].includes(t.protocol)}catch{return!1}}function F(e){const{tagsString:t="",license:i,author:n,authorDescription:s,contentFingerprints:a=[],publisher:o,...l}=e,r=[...a];return{...l,publisher:o,author:n&&s?{name:n,description:s}:n,keywords:t.split(","),usageInfo:i,contentFingerprints:[...new Set(r)]}}function ee(e,t=C){const i=[],n=e.description||"";return e.title||i.push("Please fill in the title"),n?n.length>t&&i.push(`Description cannot exceed ${t} characters`):i.push("Please fill in the description"),e.author?.name||i.push("Please fill in the author name"),(!Array.isArray(e.contentFingerprints)||!e.contentFingerprints.some(s=>!!s.url))&&i.push("Please provide at least one content URL"),e.coverUrl?D(e.coverUrl)||i.push("Cover image URL must be a valid URL with http://, https://, ar://, or ipfs:// protocol"):i.push("Please provide a cover image URL"),i}const E=e=>{switch(e){case"epub":return"application/epub+zip";case"pdf":return"application/pdf";default:return"application/octet-stream"}};function te({iscnFormData:e,iscnChainData:t=U({})}){const i=r=>{switch(r){case"application/epub+zip":return"epub";case"application/pdf":return"pdf";case"application/octet-stream":default:return""}},n=g(()=>{const u=f().API_GET_ARWEAVE_V2_LINK;if(e.value.downloadableUrls?.length)return{"@type":"ReadAction",target:e.value.downloadableUrls.map(c=>{const p=c.url?.startsWith(u)||c.url?.includes("?key=");return{"@type":"EntryPoint",contentType:E(c.type),url:c.url,name:c.fileName,encodingType:p?"aes256gcm":void 0}})}}),s=g(()=>t?.value||{}),a=r=>{const u=[];return r.author&&u.push({trait_type:"Author",value:r.author.name||r.author}),r.publisher&&u.push({trait_type:"Publisher",value:r.publisher}),r.publicationDate&&u.push({trait_type:"Publish Date",display_type:"date",value:(new Date(r.publicationDate).getTime()||0)/1e3}),u.length?u:void 0},o=g(()=>({...s.value,"@type":e.value.type,name:e.value.title,description:e.value.description,descriptionFull:e.value.descriptionFull||void 0,alternativeHeadline:e.value.alternativeHeadline||void 0,author:e.value.author.name,authorDescription:e.value.author.description,license:e.value.license==="Other"?e.value.customLicense:e.value.license,contentFingerprints:e.value.contentFingerprints.map(r=>r.url),inLanguage:e.value.language,publisher:e.value.publisher,isbn:e.value.isbn,datePublished:e.value.publicationDate?new Date(e.value.publicationDate).toISOString().split("T")[0]:void 0,url:e.value.bookInfoUrl,tagsString:e.value.tags?.join(", ")||"",thumbnailUrl:e.value.coverUrl,genre:e.value.genre||void 0,potentialAction:n.value,attributes:a(e.value)}));return{getFileMimeType:E,getFileTypeFromMime:i,payload:o,computeISCNSalt:r=>{const u=n.value?.target[0]?.url||"",c=v("0x0001","bytes"),p=x(N(u)),h=v(p,"bytes").slice(0,10),b=v(r,"bytes"),d=new Uint8Array(32);return d.set(b,0),d.set(c,20),d.set(h,22),R(d)}}}export{J as a,Q as b,Z as c,j as e,F as f,X as p,te as u,ee as v};
