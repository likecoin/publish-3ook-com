{"version":3,"mappings":"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","names":["CSV_HEADER","ITEMS_PER_PAGE","$t","useI18n","BOOK3_URL","useRuntimeConfig","toast","useToast","csvInput","ref","csvInputPlaceholder","selectedQRCodeIcon","DEFAULT_QR_CODE_ICON","selectedQRCodeColor","DEFAULT_QR_CODE_COLOR","selectedQRCodeDotStyle","DEFAULT_QR_CODE_DOT_STYLE","isEditingQRCodeConfig","qrCodeRef","urlItems","pagesForPrint","computed","chunks","i","watch","useSeoMeta","onMounted","loadedInput","nextTick","drawQRCodes","error","getQRCodeStyleOptions","getQRCodeIcon","input","csvParse","QRCodeStyling","__vitePreload","n","item","index","qrcode","getQRCodeOptions","element","handleFileChange","event","files","file","reader","e","text","handleClickPrint","handleClickDownload","downloadQRCodes","_createBlock","_component_PageBody","_createElementVNode","_hoisted_1","_toDisplayString","_unref","_createVNode","_component_UFormField","_component_UInput","_component_USeparator","_component_UTextarea","$event","_hoisted_2","_component_UButton","_component_UModal","_component_QRCodeGenerator","_hoisted_3","_hoisted_4","_createElementBlock","_Fragment","_hoisted_5","_openBlock","_renderList","items","page","_hoisted_6"],"ignoreList":[],"sources":["../../../pages/batch-qrcode.vue"],"sourcesContent":["<template>\n  <PageBody class=\"print:space-y-0 print:p-0\">\n    <h1 class=\"text-lg font-bold font-mono print:hidden\">\n      {{ $t('batch_qrcode.page_title') }}\n    </h1>\n\n    <UFormField\n      :label=\"$t('batch_qrcode.upload_csv')\"\n      class=\"print:hidden\"\n    >\n      <UInput type=\"file\" accept=\"csv\" @change=\"handleFileChange\" />\n    </UFormField>\n    <USeparator class=\"print:hidden\" :label=\"$t('batch_qrcode.or_divider')\" />\n    <UFormField\n      class=\"print:hidden\"\n      :label=\"$t('batch_qrcode.input_csv')\"\n    >\n      <UTextarea\n        v-model=\"csvInput\"\n        class=\"font-mono\"\n        :placeholder=\"csvInputPlaceholder\"\n        :resize=\"true\"\n      />\n    </UFormField>\n\n    <div class=\"print:hidden flex justify-center\">\n      <UButton\n        :label=\"$t('batch_qrcode.qr_appearance')\"\n        variant=\"outline\"\n        @click=\"isEditingQRCodeConfig = true\"\n      />\n    </div>\n\n    <UModal v-model:open=\"isEditingQRCodeConfig\">\n      <template #content>\n        <QRCodeGenerator\n          v-model:icon=\"selectedQRCodeIcon\"\n          v-model:color=\"selectedQRCodeColor\"\n          v-model:dot-style=\"selectedQRCodeDotStyle\"\n          :data=\"`${BOOK3_URL}/store`\"\n          :width=\"500\"\n          :height=\"500\"\n          mode=\"config\"\n          @save=\"isEditingQRCodeConfig = false\"\n        >\n          <template #header>\n            <h3 class=\"font-bold font-mono\">\n              {{ $t('batch_qrcode.qr_config') }}\n            </h3>\n            <UButton\n              icon=\"i-heroicons-x-mark\"\n              color=\"neutral\"\n              variant=\"ghost\"\n              @click=\"isEditingQRCodeConfig = false\"\n            />\n          </template>\n        </QRCodeGenerator>\n      </template>\n    </UModal>\n\n    <nav class=\"flex justify-center items-center gap-2 print:hidden\">\n      <UButton\n        v-if=\"!urlItems?.length\"\n        :label=\"$t('batch_qrcode.generate')\"\n        size=\"lg\"\n        :disabled=\"!csvInput\"\n        @click=\"drawQRCodes\"\n      />\n      <template v-else>\n        <UButton\n          :label=\"$t('batch_qrcode.print')\"\n          size=\"lg\"\n          variant=\"outline\"\n          @click=\"handleClickPrint\"\n        />\n        <UButton\n          :label=\"$t('batch_qrcode.download')\"\n          size=\"lg\"\n          variant=\"outline\"\n          @click=\"handleClickDownload\"\n        />\n      </template>\n    </nav>\n\n    <div class=\"flex flex-col items-center gap-[2cm] print:gap-0\">\n      <ul\n        v-for=\"(items, page) in pagesForPrint\"\n        :key=\"page\"\n        class=\"w-[20cm] grid grid-cols-3 items-center gap-[0.25cm] py-[0.5cm] break-before-page\"\n      >\n        <li\n          v-for=\"item in items\"\n          :key=\"item.key || item.url\"\n        >\n          <figure ref=\"qrCodeRef\" class=\"qrcode\">\n            <figcaption class=\"text-xs text-center font-mono\">\n              {{ item.key || item.url }}\n            </figcaption>\n          </figure>\n        </li>\n      </ul>\n    </div>\n  </PageBody>\n</template>\n\n<script setup lang=\"ts\">\nimport { parse as csvParse } from 'csv-parse/sync'\nconst { t: $t } = useI18n()\n\nconst CSV_HEADER = 'key,url'\n\ndefinePageMeta({ layout: 'page' })\n\nconst { BOOK3_URL } = useRuntimeConfig().public\n\nconst toast = useToast()\n\nconst csvInput = ref('')\nconst csvInputPlaceholder = `${CSV_HEADER}\nexample01,https://example01.com\nexample02,https://example02.com`\n\nconst selectedQRCodeIcon = ref(DEFAULT_QR_CODE_ICON)\nconst selectedQRCodeColor = ref(DEFAULT_QR_CODE_COLOR)\nconst selectedQRCodeDotStyle = ref(DEFAULT_QR_CODE_DOT_STYLE)\nconst isEditingQRCodeConfig = ref(false)\n\nconst qrCodeRef = ref<HTMLElement[] | undefined>(undefined)\nconst urlItems = ref<{ key: string, url: string }[]>([])\n\nconst ITEMS_PER_PAGE = 12\n\nconst pagesForPrint = computed(() => {\n  // split urlItems into chunks of 12 items\n  const chunks = []\n  for (let i = 0; i < urlItems.value.length; i += ITEMS_PER_PAGE) {\n    chunks.push(urlItems.value.slice(i, i + ITEMS_PER_PAGE))\n  }\n  return chunks\n})\n\nwatch(csvInput, () => {\n  urlItems.value = []\n})\n\nwatch(selectedQRCodeIcon, () => {\n  urlItems.value = []\n})\n\nuseSeoMeta({\n  title: 'Batch Create Book QR Codes',\n  ogTitle: 'Batch Create Book QR Codes'\n})\n\nonMounted(() => {\n  try {\n    const loadedInput = sessionStorage.getItem('nft_book_press_batch_qrcode')\n    if (loadedInput) {\n      csvInput.value = loadedInput\n      sessionStorage.removeItem('nft_book_press_batch_qrcode')\n    }\n    nextTick(() => {\n      if (csvInput.value) {\n        drawQRCodes()\n      }\n    })\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(error)\n  }\n})\n\nfunction getQRCodeStyleOptions () {\n  return {\n    image: selectedQRCodeIcon.value === 'none' ? undefined : getQRCodeIcon(selectedQRCodeIcon.value),\n    fillColor: selectedQRCodeColor.value,\n    dotStyle: selectedQRCodeDotStyle.value\n  }\n}\n\nasync function drawQRCodes () {\n  try {\n    let input = csvInput.value\n    if (!input.includes(CSV_HEADER)) {\n      input = `${CSV_HEADER}\\n${input}`\n    }\n    urlItems.value = csvParse(input, {\n      columns: true,\n      skip_empty_lines: true\n    }) as { key: string, url: string }[]\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(error)\n    toast.add({\n      icon: 'i-heroicons-exclamation-circle',\n      title: $t('batch_qrcode.parse_csv_error'),\n      duration: 0,\n      color: 'error'\n    })\n  }\n\n  const { default: QRCodeStyling } = await import('@likecoin/qr-code-styling')\n  urlItems.value.forEach((item, index: number) => {\n    const qrcode = new QRCodeStyling(getQRCodeOptions({\n      margin: 0,\n      data: item.url,\n      ...getQRCodeStyleOptions()\n    }))\n    const element = qrCodeRef.value?.[index] as HTMLElement | undefined\n    if (element) {\n      element.querySelector('svg')?.remove()\n      qrcode.append(element)\n\n      // HACK: Add viewBox attribute to fix the auto resize of SVG\n      element.querySelector('svg')?.setAttribute('viewBox', '0 0 300 300')\n    }\n  })\n}\n\nfunction handleFileChange (event: Event) {\n  const files = (event.target as HTMLInputElement)?.files\n  if (!files?.length) { return }\n  const file = files[0]\n  if (!file) { return }\n  const reader = new FileReader()\n  reader.onload = (e) => {\n    const text = e.target?.result\n    if (typeof text === 'string') {\n      csvInput.value = text\n    }\n  }\n  reader.readAsText(file)\n}\n\nfunction handleClickPrint () {\n  if (csvInput.value) {\n    window.print()\n  }\n}\n\nfunction handleClickDownload () {\n  downloadQRCodes(\n    urlItems.value.map(item => ({\n      filename: item.key,\n      url: item.url\n    })),\n    {\n      qrCodeOptions: {\n        ...getQRCodeStyleOptions(),\n        margin: 40,\n        width: 1024,\n        height: 1024\n      }\n    }\n  )\n}\n</script>\n\n<style>\nfigure.qrcode > svg {\n  @apply w-[6.2cm] h-[6.2cm] border p-[0.2cm];\n}\n</style>\n"],"file":"p2wTB4O6.js"}