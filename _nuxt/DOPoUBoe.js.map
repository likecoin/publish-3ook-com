{"version":3,"file":"DOPoUBoe.js","sources":["../../../stores/stripe.ts"],"sourcesContent":["import type { StripeRefreshResponse } from '~/utils/api'\n\ninterface StripeConnectStatus {\n  hasAccount: boolean\n  isReady: boolean\n  email?: string\n  stripeConnectAccountId?: string\n}\n\nfunction getStripeConnectStatusDefault (): StripeConnectStatus {\n  return {\n    isReady: false,\n    hasAccount: false,\n    email: '',\n    stripeConnectAccountId: ''\n  }\n}\n\nexport const useStripeStore = defineStore('stripe-connect', () => {\n  const { LIKE_CO_API } = useRuntimeConfig().public\n\n  const bookstoreApiStore = useBookstoreApiStore()\n  const { token } = storeToRefs(bookstoreApiStore)\n\n  const stripeConnectStatusWalletMap = ref({} as Record<string, StripeConnectStatus>)\n\n  const getStripeConnectStatusByWallet = computed(() => (wallet: string) => {\n    return stripeConnectStatusWalletMap.value[wallet] || getStripeConnectStatusDefault()\n  })\n\n  async function fetchStripeConnectStatusByWallet (wallet: string) {\n    if (!stripeConnectStatusWalletMap.value[wallet]) {\n      stripeConnectStatusWalletMap.value[wallet] = getStripeConnectStatusDefault()\n    }\n    const data = await $fetch<StripeConnectStatus>(`${LIKE_CO_API}/likernft/book/user/connect/status`, {\n      headers: {\n        authorization: `Bearer ${token.value}`\n      },\n      query: {\n        wallet\n      }\n    })\n    if (!data) {\n      return stripeConnectStatusWalletMap.value[wallet]\n    }\n    stripeConnectStatusWalletMap.value[wallet] = data\n    return data\n  }\n\n  async function refreshStripeConnectStatus (wallet: string) {\n    await fetchStripeConnectStatusByWallet(wallet)\n\n    const currentStatus = stripeConnectStatusWalletMap.value[wallet]\n\n    if (currentStatus?.hasAccount && !currentStatus?.isReady) {\n      const data = await $fetch<StripeRefreshResponse>(`${LIKE_CO_API}/likernft/book/user/connect/refresh`, {\n        method: 'POST',\n        headers: {\n          authorization: `Bearer ${token.value}`\n        }\n      })\n\n      if (data.isReady) {\n        stripeConnectStatusWalletMap.value[wallet] = {\n          ...currentStatus,\n          isReady: true\n        }\n      }\n    }\n    return stripeConnectStatusWalletMap.value[wallet]\n  }\n\n  return {\n    stripeConnectStatusWalletMap,\n    getStripeConnectStatusByWallet,\n    fetchStripeConnectStatusByWallet,\n    refreshStripeConnectStatus\n  }\n})\n"],"names":["getStripeConnectStatusDefault","useStripeStore","defineStore","LIKE_CO_API","useRuntimeConfig","bookstoreApiStore","useBookstoreApiStore","token","storeToRefs","stripeConnectStatusWalletMap","ref","getStripeConnectStatusByWallet","computed","wallet","fetchStripeConnectStatusByWallet","data","refreshStripeConnectStatus","currentStatus"],"mappings":"umBASA,SAASA,GAAsD,CAC7D,MAAO,CACL,QAAS,GACT,WAAY,GACZ,MAAO,GACP,uBAAwB,EAAA,CAE5B,CAEO,MAAMC,EAAiBC,EAAY,iBAAkB,IAAM,CAChE,KAAM,CAAE,YAAAC,CAAA,EAAgBC,EAAA,EAAmB,OAErCC,EAAoBC,EAAA,EACpB,CAAE,MAAAC,CAAA,EAAUC,EAAYH,CAAiB,EAEzCI,EAA+BC,EAAI,EAAyC,EAE5EC,EAAiCC,EAAS,IAAOC,GAC9CJ,EAA6B,MAAMI,CAAM,GAAKb,EAAA,CACtD,EAED,eAAec,EAAkCD,EAAgB,CAC1DJ,EAA6B,MAAMI,CAAM,IAC5CJ,EAA6B,MAAMI,CAAM,EAAIb,EAAA,GAE/C,MAAMe,EAAO,MAAM,OAA4B,GAAGZ,CAAW,qCAAsC,CACjG,QAAS,CACP,cAAe,UAAUI,EAAM,KAAK,EAAA,EAEtC,MAAO,CACL,OAAAM,CAAA,CACF,CACD,EACD,OAAKE,GAGLN,EAA6B,MAAMI,CAAM,EAAIE,EACtCA,GAHEN,EAA6B,MAAMI,CAAM,CAIpD,CAEA,eAAeG,EAA4BH,EAAgB,CACzD,MAAMC,EAAiCD,CAAM,EAE7C,MAAMI,EAAgBR,EAA6B,MAAMI,CAAM,EAE/D,OAAII,GAAe,YAAc,CAACA,GAAe,UAClC,MAAM,OAA8B,GAAGd,CAAW,sCAAuC,CACpG,OAAQ,OACR,QAAS,CACP,cAAe,UAAUI,EAAM,KAAK,EAAA,CACtC,CACD,GAEQ,UACPE,EAA6B,MAAMI,CAAM,EAAI,CAC3C,GAAGI,EACH,QAAS,EAAA,GAIRR,EAA6B,MAAMI,CAAM,CAClD,CAEA,MAAO,CACL,6BAAAJ,EACA,+BAAAE,EACA,iCAAAG,EACA,2BAAAE,CAAA,CAEJ,CAAC"}