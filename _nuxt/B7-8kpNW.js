const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./9S2XGRg9.js","./entry.Cz7mG32V.css"])))=>i.map(i=>d[i]);
import{c6 as Ke,c7 as Ve,c8 as Ie,c9 as Fe,ca as Ae,cb as He,cc as Ge,cd as re,aD as oe,ce as pe,u as Ee,b as De,s as ce,a as Ce,cf as fe,r as se,e as R,as as qe,g as ze,Q as We,A as je,cg as Xe,V as Je,o as Ye,l as D,m as v,n as p,p as I,q as t,W as F,X as Qe,L as f,a1 as Ze,Y as et,ab as tt,a0 as at,M as c,a8 as st,C as q,aa as ie,ad as ne,N as z,c as W,aq as it,ao as nt,ch as lt}from"./9S2XGRg9.js";import{_ as rt}from"./BRD0zS0z.js";import{_ as ot}from"./drKZnbC8.js";import{_ as ct}from"./CLuOJMie.js";import{_ as ut}from"./Bzm9dzjm.js";import{p as dt}from"./Do9u-xqN.js";import{g as _t}from"./BFNvVrx5.js";import{a as pt,e as ft,b as mt,p as me,c as vt}from"./2HupUEEh.js";import{u as gt,b as ht}from"./CFNaZjOu.js";import{u as yt}from"./DQMAjF9Q.js";import{u as bt}from"./CSf5BCM0.js";import"./DVNOgE3D.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"cd189bad150b481aa5ecb2e95de26ec677010e55"}}catch{}})();try{(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new e.Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="4d80e394-6618-4f56-ba5f-8a8ffb669424",e._sentryDebugIdIdentifier="sentry-dbid-4d80e394-6618-4f56-ba5f-8a8ffb669424")})()}catch{}async function wt(e,a){const{chainId:_,...u}=a,C=e.getClient({chainId:_});return Ke(C,Ve,"getTransactionReceipt")(u)}var E=(e=>(e.PENDING="pending",e.UPLOADING_FILES="uploading",e.FILES_UPLOADED="files_uploaded",e.CREATING_NFT="creating_nft",e.NFT_CREATED="nft_created",e.MINTING="minting",e.MINTED="minted",e.LISTING="listing",e.COMPLETED="completed",e.FAILED="failed",e))(E||{});const ve=["book_title","book_description","author_name","cover_image_filename"],ue=["book_title","book_description","author_name","author_description","publisher","isbn","publish_date","list_price","tags","cover_image_filename","pdf_filename","epub_filename","edition_name","edition_description","auto_deliver","auto_memo","enable_drm","language"],ge={list_price:String(re),edition_name:Ae,edition_description:Fe,auto_deliver:String(Ge),enable_drm:String(He),language:Ie},It=[...ue,"class_id","mint_tx_hash","cover_arweave_id","book_arweave_id","book_arweave_key","status","remark"];function Ft(e,a){const _=e.tags?e.tags.split(",").map(C=>C.trim()).filter(Boolean):[],u=e.list_price?parseFloat(e.list_price):re;return{id:crypto.randomUUID(),rowIndex:a,title:e.book_title?.trim()||"",description:e.book_description?.trim()||"",authorName:e.author_name?.trim()||"",authorDescription:e.author_description?.trim(),publisher:e.publisher?.trim()||"",isbn:e.isbn?.trim(),publishDate:e.publish_date?.trim()||"",listPrice:isNaN(u)?re:u,tags:_,coverImageFilename:e.cover_image_filename?.trim()||"",pdfFilename:e.pdf_filename?.trim()||void 0,epubFilename:e.epub_filename?.trim()||void 0,editionName:e.edition_name?.trim()||Ae,editionDescription:e.edition_description?.trim()||Fe,isAutoDeliver:e.auto_deliver?.trim().toLowerCase()!=="false",autoMemo:e.auto_memo?.trim()||"",enableDRM:e.enable_drm?.trim().toLowerCase()==="true",language:e.language?.trim()||Ie,status:"pending"}}const he=["true","false",""];function At(e,a){const _=[],{rowIndex:u}=e;if(e.title||_.push({rowIndex:u,field:"book_title",message:"bulk_upload.error_book_title_required"}),e.description||_.push({rowIndex:u,field:"book_description",message:"bulk_upload.error_book_description_required"}),e.description&&e.description.length>1e3&&_.push({rowIndex:u,field:"book_description",message:"bulk_upload.error_book_description_too_long"}),e.authorName||_.push({rowIndex:u,field:"author_name",message:"bulk_upload.error_author_name_required"}),e.listPrice!==0&&e.listPrice<pe&&_.push({rowIndex:u,field:"list_price",message:"bulk_upload.error_invalid_price",params:{minPrice:pe}}),e.coverImageFilename||_.push({rowIndex:u,field:"cover_image_filename",message:"bulk_upload.error_cover_required"}),!e.pdfFilename&&!e.epubFilename&&_.push({rowIndex:u,field:"pdf_filename/epub_filename",message:"bulk_upload.error_ebook_required"}),e.autoMemo&&!e.isAutoDeliver&&_.push({rowIndex:u,field:"auto_memo",message:"bulk_upload.error_auto_memo_requires_auto_deliver"}),a){const C=a.auto_deliver?.trim().toLowerCase()??"";C&&!he.includes(C)&&_.push({rowIndex:u,field:"auto_deliver",message:"bulk_upload.error_invalid_boolean",params:{field:"auto_deliver",value:a.auto_deliver.trim()}});const N=a.enable_drm?.trim().toLowerCase()??"";N&&!he.includes(N)&&_.push({rowIndex:u,field:"enable_drm",message:"bulk_upload.error_invalid_boolean",params:{field:"enable_drm",value:a.enable_drm.trim()}})}return _}function Et(e){const a=[],_=new Map;for(const u of e){const C=[];u.coverImageFilename&&C.push({name:u.coverImageFilename,field:"cover_image_filename"}),u.pdfFilename&&C.push({name:u.pdfFilename,field:"pdf_filename"}),u.epubFilename&&C.push({name:u.epubFilename,field:"epub_filename"});for(const{name:N,field:O}of C){const o=N.toLowerCase(),g=_.get(o);g?a.push({rowIndex:u.rowIndex,field:O,message:"bulk_upload.error_duplicate_filename",params:{filename:N,otherRow:g.rowIndex,otherField:g.field}}):_.set(o,{rowIndex:u.rowIndex,field:O})}}return a}function Dt(e){return{id:e.id,rowIndex:e.rowIndex,title:e.title,description:e.description,authorName:e.authorName,authorDescription:e.authorDescription,publisher:e.publisher,isbn:e.isbn,publishDate:e.publishDate,listPrice:e.listPrice,tags:e.tags,coverImageFilename:e.coverImageFilename,pdfFilename:e.pdfFilename,epubFilename:e.epubFilename,editionName:e.editionName,editionDescription:e.editionDescription,isAutoDeliver:e.isAutoDeliver,autoMemo:e.autoMemo,enableDRM:e.enableDRM,language:e.language,status:e.status,error:e.error,coverArweaveId:e.coverArweaveId,coverIpfsHash:e.coverIpfsHash,bookArweaveId:e.bookArweaveId,bookArweaveKey:e.bookArweaveKey,bookIpfsHash:e.bookIpfsHash,classId:e.classId,mintTxHash:e.mintTxHash}}function Ct(e){return{...e,coverFile:void 0,pdfFile:void 0,epubFile:void 0}}const ye=/^[a-zA-Z0-9_-]{43}$/,xt=/^0x[a-fA-F0-9]{64}$/;function Tt(e){const a={};return e.cover_arweave_id&&ye.test(e.cover_arweave_id)&&(a.coverArweaveId=e.cover_arweave_id),e.book_arweave_id&&ye.test(e.book_arweave_id)&&(a.bookArweaveId=e.book_arweave_id),e.book_arweave_key&&e.book_arweave_key.trim()&&(a.bookArweaveKey=e.book_arweave_key.trim()),e.class_id&&e.class_id.startsWith("0x")&&(a.classId=e.class_id),e.mint_tx_hash&&xt.test(e.mint_tx_hash)&&(a.mintTxHash=e.mint_tx_hash),a}async function Nt(e){const{stringify:a}=await oe(async()=>{const{stringify:o}=await import("./9S2XGRg9.js").then(g=>g.fx);return{stringify:o}},__vite__mapDeps([0,1]),import.meta.url),{saveAs:_}=await oe(async()=>{const{saveAs:o}=await import("./CRnp019L.js").then(g=>g.F);return{saveAs:o}},[],import.meta.url),u=e.map(o=>[o.title,o.description,o.authorName,o.authorDescription||"",o.publisher,o.isbn||"",o.publishDate||"",o.listPrice,o.tags.join(","),o.coverImageFilename,o.pdfFilename||"",o.epubFilename||"",o.editionName,o.editionDescription,o.isAutoDeliver?"true":"false",o.autoMemo,o.enableDRM?"true":"false",o.language,o.classId||"",o.mintTxHash||"",o.coverArweaveId||"",o.bookArweaveId||"",o.bookArweaveKey||"",o.status,o.error||""]),C=a(u,{header:!0,columns:It}),N="\uFEFF",O=new Blob([N+C],{type:"text/csv;charset=utf-8;"});_(O,`bulk-upload-result-${new Date().toISOString().slice(0,10)}.csv`)}const de="publish_book_bulk_upload_session";function le(e,a,_){try{const u={sessionId:_||crypto.randomUUID(),createdAt:new Date().toISOString(),books:e.map(Dt),currentIndex:a};sessionStorage.setItem(de,JSON.stringify(u))}catch(u){console.warn("Failed to save bulk upload session to sessionStorage:",u)}}function be(){try{const e=sessionStorage.getItem(de);if(e)return JSON.parse(e)}catch(e){console.warn("Failed to read bulk upload session from sessionStorage:",e)}return null}function we(){try{sessionStorage.removeItem(de)}catch(e){console.warn("Failed to clear bulk upload session from sessionStorage:",e)}}function St(e){return e.books.map(Ct)}function Lt(){const e=Ee(),a=De(),{wallet:_}=ce(e),{token:u}=ce(a),{assertSufficientBalanceForTransfer:C,waitForTransactionReceipt:N}=gt(),{sendTransactionAsync:O}=pt(),{ARWEAVE_ENDPOINT:o}=Ce().public;async function g(U){let r=Buffer.from(U.arrayBuffer),T=await fe(r)||"",x;if(U.encrypt){const{rawEncryptedKeyAsBase64:A,combinedArrayBuffer:w}=await ft({data:U.arrayBuffer});r=Buffer.from(w),T=await fe(r)||"",x=A}const H=await mt({fileSize:r.length,ipfsHash:U.encrypt?void 0:T}),{evmAddress:k,arweaveId:S,ETH:B}=H;if(S)return{arweaveId:S,arweaveLink:`${o}/${S}`,arweaveKey:x,ipfsHash:T};if(!B||!k)throw new Error("Failed to get Arweave fee estimate");const j=JSON.stringify({ipfs:T,fileSize:r.length});await C({wallet:_.value,to:k,value:me(B),data:`0x${Buffer.from(j,"utf-8").toString("hex")}`});const J=await O({to:k,value:me(B),data:`0x${Buffer.from(j,"utf-8").toString("hex")}`}),s=await N({hash:J,confirmations:2});if(!s||s.status!=="success")throw new Error("Arweave fee transaction failed");const{arweaveId:h,arweaveLink:b}=await vt(r,{fileSize:r.length,ipfsHash:T,fileType:U.fileType,txHash:J,token:u.value,key:x});if(!h)throw new Error("Failed to upload file to Arweave");return{arweaveId:h,arweaveLink:b,arweaveKey:x,ipfsHash:T}}return{uploadToArweave:g}}function Pt(){const e=Ee(),a=De(),{wallet:_,signer:u}=ce(e),{validateWalletConsistency:C}=e,{newBookListing:N}=a,{uploadToArweave:O}=Lt(),{createNFTClass:o}=yt(),{mintNFT:g}=ht(),{BOOK3_URL:U}=Ce().public,r=R(!1),T=R(null),x=R("");async function H(s,h={}){const{onStatusChange:b,onError:A}=h;try{if(r.value=!0,T.value=s,await C(),!_.value||!u.value)throw new Error("Wallet not connected");return(!s.coverArweaveId||!s.bookArweaveId)&&(b?.(s.id,E.UPLOADING_FILES),await k(s,h)),s.classId||(b?.(s.id,E.CREATING_NFT),await S(s,h)),s.mintTxHash||(b?.(s.id,E.MINTING),await B(s,h)),b?.(s.id,E.LISTING),await j(s,h),b?.(s.id,E.COMPLETED),!0}catch(w){const $=w?.message||w?.toString()||"Unknown error";return A?.(s.id,$),b?.(s.id,E.FAILED,$),!1}finally{r.value=!1,T.value=null,x.value=""}}async function k(s,h){const{onProgress:b}=h;if(!s.coverArweaveId){if(!s.coverFile)throw new Error("No cover image file found");x.value="uploading_cover";const A=await O({arrayBuffer:await s.coverFile.arrayBuffer(),fileSize:s.coverFile.size,fileType:s.coverFile.type,encrypt:!1});s.coverArweaveId=A.arweaveId,s.coverIpfsHash=A.ipfsHash,b?.(s.id,{coverArweaveId:A.arweaveId,coverIpfsHash:A.ipfsHash})}if(!s.bookArweaveId){const A=s.epubFile||s.pdfFile;if(!A)throw new Error("No ebook file found");x.value="uploading_ebook";const w=await O({arrayBuffer:await A.arrayBuffer(),fileSize:A.size,fileType:A.type,encrypt:s.enableDRM});s.bookArweaveId=w.arweaveId,s.bookArweaveKey=w.arweaveKey,s.bookIpfsHash=w.ipfsHash,b?.(s.id,{bookArweaveId:w.arweaveId,bookArweaveKey:w.arweaveKey,bookIpfsHash:w.ipfsHash})}}async function S(s,h){const{onProgress:b}=h;x.value="creating_nft_class";const A=_t(),w=s.epubFile||s.pdfFile,$=s.epubFile?"epub":"pdf",K=s.bookArweaveKey?`${A.API_GET_ARWEAVE_V2_LINK}/${s.bookArweaveId}?key=${s.bookArweaveKey}`:`ar://${s.bookArweaveId}`,X=[{url:`ar://${s.coverArweaveId}`},{url:K}],te=R({type:"Book",title:s.title,description:s.description,alternativeHeadline:"",isbn:s.isbn||"",publisher:s.publisher,publicationDate:s.publishDate||"",author:{name:s.authorName,description:s.authorDescription||""},license:"All Rights Reserved",customLicense:"",contentFingerprints:X,downloadableUrls:[{url:K,type:$,fileName:w?.name||`${s.title}.${$}`}],language:s.language,bookInfoUrl:"",tags:s.tags,coverUrl:`ar://${s.coverArweaveId}`,genre:""}),{classId:Q}=await o({iscnFormData:te});s.classId=Q,b?.(s.id,{classId:Q})}async function B(s,h){const{onProgress:b}=h;if(x.value="minting_nft",!s.classId)throw new Error("Class ID not found");const A=qe,w=(K,X)=>({image:`ar://${s.coverArweaveId}`,external_url:`${U}/store/${s.classId}/${Number(X)+K}`,description:`Copy #${Number(X)+K} of ${s.title}`,name:`${s.title} #${Number(X)+K}`,attributes:[{trait_type:"Author",value:s.authorName},{trait_type:"Publisher",value:s.publisher}]}),{txHash:$}=await g({classId:s.classId,mintCount:A,buildTokenMetadata:w});s.mintTxHash=$,b?.(s.id,{mintTxHash:$})}async function j(s,h){if(x.value="creating_listing",!s.classId)throw new Error("Class ID not found");const b={name:{en:s.editionName,zh:s.editionName},description:{en:s.editionDescription,zh:s.editionDescription},priceInDecimal:Math.round(s.listPrice*100),price:s.listPrice,stock:0,isAutoDeliver:s.isAutoDeliver,isAllowCustomPrice:!0,isUnlisted:!1,autoMemo:s.autoMemo};await N(s.classId,{defaultPaymentCurrency:"USD",connectedWallets:null,moderatorWallets:["0xa037Feb6508A8C2F93bb19f6721730C45921f2D0"],prices:[b],mustClaimToView:!0,enableCustomMessagePage:!!s.autoMemo,hideDownload:s.enableDRM})}async function J(s,h){let b=0,A=0;for(const w of s){if(h.shouldContinue&&!h.shouldContinue())break;if(w.status===E.COMPLETED){b++;continue}const $=await H(w,h);$?b++:A++,h.onBookComplete?.(w,$),await new Promise(K=>setTimeout(K,2e3))}return{completed:b,failed:A}}return{isProcessing:se(r),currentBook:se(T),currentStep:se(x),processBook:H,processBooksSequentially:J}}const kt={class:"flex gap-2"},Mt={class:"font-bold"},Rt={class:"flex items-end gap-4"},Bt={class:"text-sm"},$t={class:"cursor-pointer font-medium text-gray-600 hover:text-gray-900"},Ot={class:"flex items-center gap-3"},Ut={class:"list-disc pl-4 mt-2"},Kt={class:"font-bold"},Vt={class:"list-disc pl-4 mt-2 text-sm"},Ht={class:"text-sm text-gray-600"},Gt={class:"space-y-2"},qt={class:"font-medium"},zt={key:1,class:"text-sm font-medium"},Wt={class:"flex flex-wrap gap-1 mt-2"},jt={class:"flex justify-between"},Xt={class:"font-bold"},Jt={class:"text-sm text-gray-600"},Yt={class:"font-medium"},Qt={class:"flex justify-between"},Zt={class:"flex justify-between items-center"},ea={class:"font-bold"},ta={class:"flex gap-2"},aa={class:"flex gap-4 text-sm"},sa={class:"text-green-600"},ia={class:"text-red-600"},na={class:"text-gray-500"},la={key:1,class:"p-4 bg-gray-50 rounded-lg"},ra={class:"font-medium"},oa={class:"text-sm text-gray-600"},ca={class:"flex items-center gap-2"},ua={key:0,class:"text-xs text-red-600"},da={key:2,class:"flex justify-center gap-4"},Aa=ze({__name:"bulk-upload",setup(e){const{t:a}=We(),_=je(),{processBooksSequentially:u,currentStep:C,currentBook:N}=Pt(),{getClassMetadata:O}=bt(),{$wagmiConfig:o}=Xe(),g=R("csv"),U=R(!1),r=R([]),T=R([]),x=R(""),H=R([]),k=R([]),S=R(!1),B=R(!1),j=R(!1),J=W(()=>r.value.filter(i=>i.status===E.PENDING)),s=W(()=>r.value.filter(i=>i.status===E.COMPLETED)),h=W(()=>r.value.filter(i=>i.status===E.FAILED)),b=W(()=>r.value.filter(i=>i.status===E.COMPLETED||i.coverArweaveId&&i.bookArweaveId?!1:!i.coverFile||!i.pdfFile&&!i.epubFile)),A=W(()=>{const i=new Set;return r.value.forEach(n=>{n.coverImageFilename&&i.add(n.coverImageFilename.toLowerCase()),n.pdfFilename&&i.add(n.pdfFilename.toLowerCase()),n.epubFilename&&i.add(n.epubFilename.toLowerCase())}),i}),w=W(()=>k.value.filter(i=>!A.value.has(i.name.toLowerCase()))),$=W(()=>r.value.map(i=>({title:i.title,hasCover:!!i.coverFile,coverFilename:i.coverImageFilename,hasPdf:!!i.pdfFile,pdfFilename:i.pdfFilename||"",hasEpub:!!i.epubFile,epubFilename:i.epubFilename||""}))),K=[{accessorKey:"column",header:a("bulk_upload.csv_col_column")},{accessorKey:"required",header:a("bulk_upload.csv_col_required")},{accessorKey:"defaultValue",header:a("bulk_upload.csv_col_default")},{accessorKey:"description",header:a("bulk_upload.csv_col_description")}],X=ue.map(i=>{const n=ve.includes(i);return{column:i,required:n?"✓":"",defaultValue:ge[i]||"—",description:a(`bulk_upload.csv_col_desc_${i}`)}}),te=W(()=>r.value.map(i=>({rowIndex:i.rowIndex,title:i.title,authorName:i.authorName,listPrice:i.listPrice===0?"Free":`$${i.listPrice}`,editionName:i.editionName,language:i.language,enableDRM:i.enableDRM,isAutoDeliver:i.isAutoDeliver,autoMemo:i.autoMemo})));Je({title:a("bulk_upload.page_title"),ogTitle:a("bulk_upload.page_title")}),Ye(()=>{j.value=be()!==null});function Q(i){const y=i.target.files?.[0];if(!y)return;T.value=[],x.value="";const d=new FileReader;d.onload=m=>{const L=m.target?.result;xe(L)},d.readAsText(y)}async function xe(i){T.value=[],x.value="";try{const n=dt(i,{columns:!0,skip_empty_lines:!0,trim:!0});if(n.length===0){x.value=a("bulk_upload.no_records");return}const y=Object.keys(n[0]),d=ve.filter(M=>!y.includes(M));if(d.length>0){x.value=a("bulk_upload.invalid_headers",{columns:d.join(", ")});return}H.value=Object.entries(ge).filter(([M])=>!y.includes(M)).map(([M,G])=>({column:M,defaultValue:G}));const m=y.includes("status")||y.includes("class_id"),L=[],P=[];if(n.forEach((M,G)=>{const Y=Ft(M,G+1),V=At(Y,M);if(V.length>0&&P.push(...V),m){const Z=M,ee=Tt(Z);Object.assign(Y,ee),Z.status===E.COMPLETED&&ee.classId&&(Y.status=E.COMPLETED)}L.push(Y)}),P.push(...Et(L)),P.length>0){T.value=P;return}if(m){U.value=!0;try{await Te(L)}finally{U.value=!1}}r.value=L,g.value="files",_.add({icon:"i-heroicons-check-circle",title:a("bulk_upload.csv_parsed_success",{count:L.length}),color:"success"})}catch(n){_.add({icon:"i-heroicons-exclamation-circle",title:a("bulk_upload.csv_parse_error"),description:n.message,color:"error"})}}async function Te(i){for(const n of i){if(n.classId)try{await O(n.classId)}catch{n.classId=void 0,n.mintTxHash=void 0,n.status===E.COMPLETED&&(n.status=E.PENDING)}if(n.mintTxHash)try{await wt(o,{hash:n.mintTxHash})}catch{n.mintTxHash=void 0}}}async function Ne(){const{saveAs:i}=await oe(async()=>{const{saveAs:L}=await import("./CRnp019L.js").then(P=>P.F);return{saveAs:L}},[],import.meta.url),y=lt([["My Book Title","A great book about...","Author Name","Author bio","Publisher","978-1234567890","2024-01-15","4.99","fiction,novel","cover.jpg","","book.epub","","","","","",""]],{header:!0,columns:ue}),d="\uFEFF",m=new Blob([d+y],{type:"text/csv;charset=utf-8;"});i(m,"bulk-upload-template.csv")}function Se(i){const n=i.target,y=Array.from(n.files||[]);k.value=y,r.value.forEach(m=>{m.coverFile=void 0,m.pdfFile=void 0,m.epubFile=void 0});const d=new Map;y.forEach(m=>{d.set(m.name.toLowerCase(),m)}),r.value.forEach(m=>{const L=d.get(m.coverImageFilename.toLowerCase());if(L&&(m.coverFile=L),m.pdfFilename){const P=d.get(m.pdfFilename.toLowerCase());P&&(m.pdfFile=P)}if(m.epubFilename){const P=d.get(m.epubFilename.toLowerCase());P&&(m.epubFile=P)}})}async function ae(){g.value="processing",S.value=!0,B.value=!1,le(r.value,0),await u(r.value,{onStatusChange:(i,n,y)=>{const d=r.value.find(m=>m.id===i);d&&(d.status=n,y&&(d.error=y),le(r.value,0))},onProgress:(i,n)=>{const y=r.value.find(d=>d.id===i);y&&(Object.assign(y,n),le(r.value,0))},onError:(i,n)=>{_.add({icon:"i-heroicons-exclamation-circle",title:a("bulk_upload.book_failed"),description:n,color:"error",duration:5e3})},onBookComplete:(i,n)=>{n&&_.add({icon:"i-heroicons-check-circle",title:a("bulk_upload.book_completed",{title:i.title}),color:"success",duration:3e3})},shouldContinue:()=>!B.value}),S.value=!1,s.value.length===r.value.length&&(we(),_.add({icon:"i-heroicons-check-circle",title:a("bulk_upload.all_completed"),color:"success"}))}function Le(){B.value=!0}function Pe(){B.value=!1,ae()}function ke(){r.value.forEach(i=>{i.status===E.FAILED&&(i.status=E.PENDING,i.error=void 0)}),ae()}function Me(){const i=be();if(!i)return;r.value=St(i),r.value.some(y=>y.coverArweaveId&&y.bookArweaveId?!1:!y.coverFile||!y.pdfFile&&!y.epubFile)?g.value="files":g.value="processing"}function Re(){we(),_e()}function _e(){r.value=[],T.value=[],x.value="",H.value=[],k.value=[],g.value="csv",S.value=!1,B.value=!1}function Be(i){switch(i){case E.COMPLETED:return"success";case E.FAILED:return"error";case E.PENDING:return"neutral";default:return"info"}}function $e(i){return a(`bulk_upload.status_${i}`)}return(i,n)=>{const y=rt,d=Ze,m=Qe,L=at,P=tt,M=ot,G=et,Y=st,V=it,Z=nt,ee=ct,Oe=ut;return v(),D(Oe,null,{default:p(()=>[I(y,{title:t(a)("bulk_upload.page_title")},null,8,["title"]),I(ee,null,{default:p(()=>[t(j)&&!t(S)?(v(),D(m,{key:0,icon:"i-heroicons-information-circle",color:"info",variant:"soft",title:t(a)("bulk_upload.existing_session_found"),description:t(a)("bulk_upload.existing_session_description")},{actions:p(()=>[f("div",kt,[I(d,{label:t(a)("bulk_upload.resume_session"),color:"primary",onClick:Me},null,8,["label"]),I(d,{label:t(a)("bulk_upload.start_new"),variant:"outline",onClick:Re},null,8,["label"])])]),_:1},8,["title","description"])):F("",!0),t(g)==="csv"?(v(),D(G,{key:1,ui:{body:"space-y-4"}},{header:p(()=>[f("h3",Mt,c(t(a)("bulk_upload.step1_title")),1)]),default:p(()=>[f("div",Rt,[I(P,{label:t(a)("bulk_upload.upload_csv"),class:"flex-1"},{default:p(()=>[I(L,{type:"file",accept:".csv",onChange:Q})]),_:1},8,["label"]),I(d,{label:t(a)("bulk_upload.download_template"),variant:"outline",icon:"i-heroicons-arrow-down-tray",onClick:Ne},null,8,["label"])]),f("details",Bt,[f("summary",$t,c(t(a)("bulk_upload.csv_column_reference")),1),I(M,{class:"mt-2",columns:K,data:t(X)},null,8,["data"])])]),_:1})):F("",!0),t(U)?(v(),D(G,{key:2,ui:{body:"space-y-4"}},{default:p(()=>[f("div",Ot,[I(Y,{name:"i-heroicons-arrow-path",class:"animate-spin text-primary"}),f("span",null,c(t(a)("bulk_upload.verifying_progress")),1)])]),_:1})):F("",!0),t(T).length>0&&t(g)==="csv"?(v(),D(m,{key:3,icon:"i-heroicons-exclamation-triangle",color:"error",variant:"soft",title:t(a)("bulk_upload.validation_errors")},{description:p(()=>[f("ul",Ut,[(v(!0),q(ie,null,ne(t(T),(l,Ue)=>(v(),q("li",{key:Ue},c(t(a)("bulk_upload.error_row",{row:l.rowIndex}))+": "+c(l.field)+" - "+c(t(a)(l.message,l.params||{})),1))),128))])]),_:1},8,["title"])):F("",!0),t(x)&&t(g)==="csv"?(v(),D(m,{key:4,icon:"i-heroicons-exclamation-triangle",color:"error",variant:"soft",title:t(x)},null,8,["title"])):F("",!0),t(g)==="files"?(v(),D(G,{key:5,ui:{body:"space-y-4"}},{header:p(()=>[f("h3",Kt,c(t(a)("bulk_upload.step2_title")),1)]),default:p(()=>[t(H).length>0?(v(),D(m,{key:0,icon:"i-heroicons-exclamation-triangle",color:"warning",variant:"soft",title:t(a)("bulk_upload.missing_optional_columns_warning")},{description:p(()=>[f("ul",Vt,[(v(!0),q(ie,null,ne(t(H),l=>(v(),q("li",{key:l.column},[f("code",null,c(l.column),1),z(" → "+c(t(a)("bulk_upload.csv_col_default"))+": ",1),f("strong",null,c(l.defaultValue),1)]))),128))])]),_:1},8,["title"])):F("",!0),f("p",Ht,c(t(a)("bulk_upload.select_files_description",{count:t(r).length})),1),f("div",Gt,[f("p",qt,c(t(a)("bulk_upload.expected_files")),1),I(M,{columns:[{accessorKey:"title",header:t(a)("bulk_upload.book_title")},{accessorKey:"coverStatus",header:t(a)("bulk_upload.cover")},{accessorKey:"pdfStatus",header:"PDF"},{accessorKey:"epubStatus",header:"EPUB"}],data:t($)},{"coverStatus-cell":p(({row:l})=>[l.original.coverFilename?(v(),D(V,{key:0,color:t(k).length===0?"neutral":l.original.hasCover?"success":"error",variant:"soft"},{default:p(()=>[z(c(l.original.coverFilename),1)]),_:2},1032,["color"])):F("",!0)]),"pdfStatus-cell":p(({row:l})=>[l.original.pdfFilename?(v(),D(V,{key:0,color:t(k).length===0?"neutral":l.original.hasPdf?"success":"error",variant:"soft"},{default:p(()=>[z(c(l.original.pdfFilename),1)]),_:2},1032,["color"])):F("",!0)]),"epubStatus-cell":p(({row:l})=>[l.original.epubFilename?(v(),D(V,{key:0,color:t(k).length===0?"neutral":l.original.hasEpub?"success":"error",variant:"soft"},{default:p(()=>[z(c(l.original.epubFilename),1)]),_:2},1032,["color"])):F("",!0)]),_:1},8,["columns","data"])]),I(P,{label:t(a)("bulk_upload.select_files")},{default:p(()=>[I(L,{type:"file",multiple:"",accept:"image/*,.pdf,.epub",onChange:Se})]),_:1},8,["label"]),t(k).length>0?(v(),q("p",zt,c(t(a)("bulk_upload.files_selected",{count:t(k).length})),1)):F("",!0),t(w).length>0?(v(),D(m,{key:2,icon:"i-heroicons-exclamation-triangle",color:"warning",variant:"soft",title:t(a)("bulk_upload.extra_files_warning",{count:t(w).length})},{description:p(()=>[f("div",Wt,[(v(!0),q(ie,null,ne(t(w),l=>(v(),D(V,{key:l.name,variant:"soft",color:"warning"},{default:p(()=>[z(c(l.name),1)]),_:2},1024))),128))])]),_:1},8,["title"])):F("",!0),f("div",jt,[I(d,{label:t(a)("bulk_upload.back"),variant:"outline",onClick:n[0]||(n[0]=l=>g.value="csv")},null,8,["label"]),I(d,{label:t(a)("bulk_upload.continue"),disabled:t(b).length>0,onClick:n[1]||(n[1]=l=>g.value="review")},null,8,["label","disabled"])])]),_:1})):F("",!0),t(g)==="review"?(v(),D(G,{key:6,ui:{body:"space-y-4"}},{header:p(()=>[f("h3",Xt,c(t(a)("bulk_upload.review_title")),1)]),default:p(()=>[f("p",Jt,c(t(a)("bulk_upload.review_description")),1),f("p",Yt,c(t(a)("bulk_upload.total_transactions",{count:t(r).length})),1),I(M,{columns:[{accessorKey:"rowIndex",header:"#"},{accessorKey:"title",header:t(a)("bulk_upload.book_title")},{accessorKey:"authorName",header:t(a)("common.author")},{accessorKey:"listPrice",header:t(a)("common.price")},{accessorKey:"editionName",header:t(a)("form.edition")},{accessorKey:"language",header:t(a)("form.language")},{accessorKey:"enableDRM",header:t(a)("bulk_upload.enable_drm")},{accessorKey:"isAutoDeliver",header:t(a)("bulk_upload.auto_deliver")},{accessorKey:"autoMemo",header:t(a)("bulk_upload.auto_memo")}],data:t(te)},{"enableDRM-cell":p(({row:l})=>[I(V,{color:l.original.enableDRM?"primary":"neutral",variant:"soft"},{default:p(()=>[z(c(l.original.enableDRM?t(a)("common.yes"):t(a)("common.no")),1)]),_:2},1032,["color"])]),"isAutoDeliver-cell":p(({row:l})=>[I(V,{color:l.original.isAutoDeliver?"primary":"neutral",variant:"soft"},{default:p(()=>[z(c(l.original.isAutoDeliver?t(a)("common.yes"):t(a)("common.no")),1)]),_:2},1032,["color"])]),_:1},8,["columns","data"]),f("div",Qt,[I(d,{label:t(a)("bulk_upload.back"),variant:"outline",onClick:n[2]||(n[2]=l=>g.value="files")},null,8,["label"]),I(d,{label:t(a)("bulk_upload.start_upload"),color:"primary",onClick:ae},null,8,["label"])])]),_:1})):F("",!0),t(g)==="processing"?(v(),D(G,{key:7,ui:{body:"space-y-4"}},{header:p(()=>[f("div",Zt,[f("h3",ea,c(t(a)("bulk_upload.step4_title")),1),f("div",ta,[t(S)&&!t(B)?(v(),D(d,{key:0,label:t(a)("bulk_upload.pause"),variant:"outline",onClick:Le},null,8,["label"])):F("",!0),t(B)?(v(),D(d,{key:1,label:t(a)("bulk_upload.resume"),color:"primary",onClick:Pe},null,8,["label"])):F("",!0),!t(S)&&t(h).length>0?(v(),D(d,{key:2,label:t(a)("bulk_upload.retry_failed"),variant:"outline",onClick:ke},null,8,["label"])):F("",!0),t(S)?F("",!0):(v(),D(d,{key:3,label:t(a)("bulk_upload.download_result_csv"),variant:"outline",icon:"i-heroicons-arrow-down-tray",onClick:n[3]||(n[3]=l=>t(Nt)(t(r)))},null,8,["label"]))])])]),default:p(()=>[f("div",aa,[f("span",null,c(t(a)("bulk_upload.total"))+": "+c(t(r).length),1),f("span",sa,c(t(a)("bulk_upload.completed"))+": "+c(t(s).length),1),f("span",ia,c(t(a)("bulk_upload.failed"))+": "+c(t(h).length),1),f("span",na,c(t(a)("bulk_upload.pending"))+": "+c(t(J).length),1)]),t(S)||t(h).length>0||t(s).length>0&&t(s).length<t(r).length?(v(),D(Z,{key:0,value:(t(s).length+t(h).length)/t(r).length*100,color:t(h).length>0?"error":"primary"},null,8,["value","color"])):F("",!0),t(N)?(v(),q("div",la,[f("p",ra,c(t(a)("bulk_upload.currently_processing"))+": "+c(t(N).title),1),f("p",oa,c(t(C)?t(a)(`bulk_upload.step_${t(C)}`):""),1)])):F("",!0),I(M,{columns:[{accessorKey:"rowIndex",header:"#"},{accessorKey:"title",header:t(a)("bulk_upload.book_title")},{accessorKey:"status",header:t(a)("bulk_upload.status")},{accessorKey:"actions",header:""}],data:t(r)},{"status-cell":p(({row:l})=>[f("div",ca,[I(V,{color:Be(l.original.status),variant:"soft"},{default:p(()=>[z(c($e(l.original.status)),1)]),_:2},1032,["color"]),l.original.error?(v(),q("span",ua,c(l.original.error),1)):F("",!0)])]),"actions-cell":p(({row:l})=>[l.original.status===t(E).COMPLETED&&l.original.classId?(v(),D(d,{key:0,to:`/my-books/status/${l.original.classId}`,variant:"link",size:"xs"},{default:p(()=>[z(c(t(a)("bulk_upload.view")),1)]),_:1},8,["to"])):F("",!0)]),_:1},8,["columns","data"]),!t(S)&&t(s).length===t(r).length?(v(),q("div",da,[I(d,{label:t(a)("bulk_upload.view_my_books"),to:"/my-books"},null,8,["label"]),I(d,{label:t(a)("bulk_upload.upload_more"),variant:"outline",onClick:_e},null,8,["label"])])):F("",!0)]),_:1})):F("",!0)]),_:1})]),_:1})}}});export{Aa as default};
