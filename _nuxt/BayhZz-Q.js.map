{"version":3,"file":"BayhZz-Q.js","sources":["../../../components/PlaceholderCard.vue","../../../composables/useMessageCharCount.ts","../../../pages/my-books/send/[classId].vue"],"sourcesContent":["<template>\n  <div class=\"relative overflow-hidden rounded border border-dashed border-gray-400 dark:border-gray-500 opacity-75 flex items-center justify-center p-4\">\n    <svg class=\"absolute inset-0 h-full w-full stroke-gray-900/10 dark:stroke-white/10\" fill=\"none\">\n      <defs>\n        <pattern\n          id=\"placeholder-pattern\"\n          x=\"0\"\n          y=\"0\"\n          width=\"10\"\n          height=\"10\"\n          patternUnits=\"userSpaceOnUse\"\n        >\n          <path d=\"M-3 13 15-5M-5 5l18-18M-1 21 17 3\" />\n        </pattern>\n      </defs>\n      <rect stroke=\"none\" fill=\"url(#placeholder-pattern)\" width=\"100%\" height=\"100%\" />\n    </svg>\n    <slot />\n  </div>\n</template>\n","interface UseMessageCharCountReturn {\n  messageCharCount: ComputedRef<number>;\n  isLimitReached: ComputedRef<boolean>;\n}\n\nfunction isFullWidthChar (char: string): boolean {\n  return char.charCodeAt(0) > 255\n}\n\nexport function useMessageCharCount (memo: Ref<string | undefined>, limit: number): UseMessageCharCountReturn {\n  const messageCharCount = computed((): number => {\n    const value = memo.value || ''\n    let count = 0\n    for (let i = 0; i < value.length; i++) {\n      const char = value[i]\n      if (char) {\n        count += isFullWidthChar(char) ? 2 : 1\n      }\n    }\n    return count\n  })\n\n  const isLimitReached = computed((): boolean => {\n    return messageCharCount.value > limit\n  })\n\n  return {\n    messageCharCount,\n    isLimitReached\n  }\n}\n","<template>\n  <PageBody>\n    <h1 class=\"text-lg font-bold font-mono\">\n      Deliver NFT Book \"{{ nftClassName || classId }}\"\n    </h1>\n\n    <UAlert\n      v-if=\"error.message\"\n      icon=\"i-heroicons-exclamation-triangle\"\n      color=\"error\"\n      variant=\"soft\"\n      :title=\"`${error.message}`\"\n      :actions=\"error.actions\"\n      :close=\"{ icon: 'i-heroicons-x-mark-20-solid', color: 'error', variant: 'link' }\"\n      @close=\"error = { message: '', actions: [] }\"\n    />\n\n    <UProgress v-if=\"isLoading\" animation=\"carousel\">\n      <template #indicator>\n        Loading...\n      </template>\n    </UProgress>\n\n    <UCard\n      v-if=\"bookstoreApiStore.isAuthenticated\"\n      :ui=\"{\n        body: 'space-y-6',\n        footer: 'flex justify-center gap-2'\n      }\"\n    >\n      <UCard :ui=\"{ body: 'p-0' }\">\n        <table class=\"divide-y w-full\">\n          <tbody>\n            <tr>\n              <th class=\"text-left px-4 py-3\">\n                {{ $t('table.buyer_email') }}\n              </th><td class=\"px-4 py-3\">\n                {{ orderInfo.email }}\n              </td>\n            </tr>\n            <tr v-if=\"orderInfo.giftInfo?.toEmail\">\n              <th class=\"text-left px-4 py-3\">\n                {{ $t('table.reader_email') }}\n              </th><td class=\"px-4 py-3\">\n                {{ orderInfo.giftInfo?.toEmail || orderInfo.email }}\n              </td>\n            </tr>\n            <tr>\n              <th class=\"text-left px-4 py-3\">\n                {{ $t('table.status') }}\n              </th><td class=\"px-4 py-3\">\n                {{ orderInfo.status }}\n              </td>\n            </tr>\n            <tr>\n              <th class=\"text-left px-4 py-3\">\n                Buyer Wallet\n              </th><td class=\"px-4 py-3\">\n                {{ orderInfo.wallet }}\n              </td>\n            </tr>\n            <tr>\n              <th class=\"text-left px-4 py-3\">\n                {{ $t('table.price_name') }}\n              </th><td class=\"px-4 py-3\">\n                {{ orderInfo.priceName }}\n              </td>\n            </tr>\n            <tr>\n              <th class=\"text-left px-4 py-3\">\n                Price\n              </th><td class=\"px-4 py-3\">\n                {{ orderInfo.price }}\n              </td>\n            </tr>\n            <tr>\n              <th class=\"text-left px-4 py-3\">\n                Quantity\n              </th><td class=\"px-4 py-3\">\n                {{ orderInfo.quantity }}\n              </td>\n            </tr>\n            <tr>\n              <th class=\"text-left px-4 py-3\">\n                Sales channel\n              </th><td class=\"px-4 py-3\">\n                {{ orderInfo.from }}\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </UCard>\n\n      <UCard>\n        <div class=\"space-y-2 mb-4\">\n          <h5 class=\"text-sm font-bold\" v-text=\"`${$t('nft_book_form.buyer_message')}`\" />\n          <p v-text=\"orderInfo.message\" />\n        </div>\n\n        <UFormField\n          :label=\"$t('nft_book_form.author_message')\"\n          :error=\"isLimitReached\"\n          :hint=\"`${messageCharCount} / ${AUTHOR_MESSAGE_LIMIT}`\"\n        >\n          <UTextarea\n            v-model=\"memo\"\n          />\n        </UFormField>\n      </UCard>\n\n      <UFormField\n        :label=\"$t('form.nft_id_label')\"\n        class=\"mb-4\"\n        :error=\"nftIdError\"\n        :ui=\"{ description: 'text-gray-400 dark:text-gray-600' }\"\n      >\n        <div class=\"flex flex-wrap items-center justify-center gap-2 w-full\">\n          <div\n            v-if=\"orderInfo.quantity\"\n            :class=\"[orderInfo.quantity > 1 ? 'w-full' : 'grow', 'space-y-1', 'relative']\"\n          >\n            <UInput\n              v-for=\"i in orderInfo.quantity\"\n              :key=\"`nft-id-input-${i}`\"\n              ref=\"nftIdInputRef\"\n              v-model=\"nftIdInput[i - 1]\"\n              :disabled=\"!isSingleQuantity\"\n              class=\"font-mono\"\n            >\n              <template v-if=\"orderInfo.quantity > 1\" #leading>\n                <span class=\"text-sm text-gray-400 dark:text-gray-600\">#{{ i }}</span>\n              </template>\n            </UInput>\n            <span v-if=\"validationError\" class=\"text-xs text-red-500 absolute\" v-text=\"validationError\" />\n            <span v-else-if=\"isNftIdConfirmed && isSingleQuantity\" class=\"text-xs text-green-500 absolute\" v-text=\"$t('button.confirmed')\" />\n          </div>\n          <UButton\n            v-if=\"isSingleQuantity\"\n            :label=\"$t('button.confirm_nft_id')\"\n            :disabled=\"isLoading || isVerifyingNFTId || !hasValidNftInput\"\n            variant=\"outline\"\n            :loading=\"isVerifyingNFTId\"\n            color=\"primary\"\n            @click=\"handleConfirmNFTId\"\n          />\n          <USeparator v-if=\"isSingleQuantity\" :class=\"['text-sm text-gray-600', 'sm:w-min']\">\n            OR\n          </USeparator>\n          <UButton\n            v-if=\"isSingleQuantity\"\n            :label=\"$t('button.check_all_nft_ids')\"\n            :disabled=\"isLoading\"\n            variant=\"outline\"\n            @click=\"onCheckOwnedIds\"\n          />\n        </div>\n      </UFormField>\n\n      <PlaceholderCard class=\"h-[300px]\">\n        <img\n          v-if=\"nftImage\"\n          class=\"max-w-[180px] w-full h-full object-contain\"\n          alt=\"preview\"\n          :src=\"nftImage\"\n        >\n      </PlaceholderCard>\n\n      <template #footer>\n        <UButton\n          :label=\"$t('nft_send.sign_and_send')\"\n          :disabled=\"isSendButtonDisabled\"\n          size=\"xl\"\n          @click=\"onSendNFTStart\"\n        />\n      </template>\n    </UCard>\n    <UModal v-model:open=\"showRestockModal\">\n      <template #content>\n        <LiteMintNFT\n          :is-restock=\"true\"\n          :iscn-id=\"classId\"\n          @submit=\"handleFinishRestock\"\n        />\n      </template>\n    </UModal>\n  </PageBody>\n</template>\n\n<script setup lang=\"ts\">\nconst { t: $t } = useI18n()\n\nimport { useWriteContract } from '@wagmi/vue'\nimport { parseImageURLFromMetadata } from '~/utils'\nimport { AUTHOR_MESSAGE_LIMIT } from '~/constant'\nimport { LIKE_NFT_CLASS_ABI } from '~/contracts/likeNFT'\n\nconst { LIKE_CO_API } = useRuntimeConfig().public\n\nconst store = useWalletStore()\nconst { wallet, signer } = storeToRefs(store)\nconst { validateWalletConsistency } = store\n\nconst bookstoreApiStore = useBookstoreApiStore()\nconst { token, wallet: sessionWallet } = storeToRefs(bookstoreApiStore)\n\nconst nftStore = useNftStore()\nconst { lazyFetchClassMetadataById } = nftStore\n\nconst route = useRoute()\nconst localeRoute = useLocaleRoute()\n\nconst { writeContractAsync } = useWriteContract()\nconst { getBalanceOf, getTokenIdByOwnerIndex } = useNFTContractReader()\nconst { assertSufficientBalanceForTransaction, waitForTransactionReceipt } = useNFTContractWriter()\n\nconst { showErrorToast } = useToastComposable()\nconst error = ref({ message: '', actions: [] as { label: string; variant: 'solid' | 'outline' | 'soft' | 'subtle' | 'ghost' | 'link'; color: 'error' | 'primary' | 'neutral'; click: () => void }[] })\nconst isLoading = ref(false)\nconst classId = computed(() => route.params.classId as string)\nconst paymentId = computed(() => route.query.payment_id as string)\nconst ownerWallet = computed(() => route.query.owner_wallet as string || sessionWallet.value)\nconst memo = ref($t('nft_book_form.default_memo'))\nconst { messageCharCount, isLimitReached } = useMessageCharCount(memo, AUTHOR_MESSAGE_LIMIT)\nconst { getNFTMetadata, getNFTOwner } = useNFTContractReader()\n\nconst nftIdInput = ref([] as string[])\nconst nftIds = ref([] as number[])\nconst isVerifyingNFTId = ref(false)\nconst nftIdError = ref('')\nconst isNftIdConfirmed = ref(false)\nconst nftIdInputRef = ref<string[] | undefined>(undefined)\n\ninterface OrderInfo {\n  email?: string\n  giftInfo?: { toEmail?: string }\n  status?: string\n  wallet?: string\n  priceName?: string\n  price?: number\n  quantity?: number\n  from?: string\n  message?: string\n}\nconst orderInfo = ref<OrderInfo>({})\nconst nftImage = ref('')\n\nconst showRestockModal = ref(false)\nconst validationError = ref('')\n\nconst { NFT_ITEM_URL } = useRuntimeConfig().public\nconst hasValidNftInput = computed(() => nftIdInput.value.some(id => id.trim() !== ''))\nconst isSendButtonDisabled = computed(() => isLoading.value || isVerifyingNFTId.value || !!nftIdError.value || isLimitReached.value || !isNftIdConfirmed.value)\nconst isSingleQuantity = computed(() => orderInfo.value.quantity === 1)\n\nconst nftClassName = computed(() => nftStore.getClassMetadataById(classId.value as string)?.name)\n\nwatch(isLoading, (newIsLoading) => {\n  if (newIsLoading) { error.value = { message: '', actions: [] } }\n})\n\nwatch(nftIdInput, (_, oldVal) => {\n  if (oldVal && oldVal.length > 0 && isSingleQuantity.value) {\n    isNftIdConfirmed.value = false\n    validationError.value = ''\n    nftIdError.value = ''\n  }\n}, { deep: true })\n\nonMounted(async () => {\n  const data = await $fetch(`${LIKE_CO_API}/likernft/book/purchase/${classId.value}/status/${paymentId.value}`,\n    {\n      headers: {\n        authorization: `Bearer ${token.value}`\n      }\n    })\n  orderInfo.value = data as OrderInfo\n  lazyFetchClassMetadataById(classId.value as string)\n  await fetchNextNFTId(orderInfo.value.quantity || 1)\n})\n\nasync function handleConfirmNFTId () {\n  if (!hasValidNftInput.value) { return }\n\n  try {\n    validationError.value = ''\n    nftIdError.value = ''\n\n    nftIds.value = nftIdInput.value.filter(id => id.trim() !== '').map(id => Number(id))\n\n    if (nftIds.value.includes(0)) {\n      validationError.value = $t('error.nft_id_reserved_for_author')\n      nftIds.value = []\n      return\n    }\n\n    const firstNftId = nftIds.value[0]\n    if (!firstNftId) {\n      validationError.value = $t('error.invalid_nft_id')\n      return\n    }\n\n    const [metadata, ownerResult] = await Promise.all([\n      fetchNFTMetadata(),\n      getNFTOwner(classId.value, firstNftId)\n    ])\n    const owner = ownerResult as string\n    if (!metadata || owner !== sessionWallet.value) {\n      validationError.value = $t('error.fetch_nft_metadata_failed')\n      nftIds.value = []\n      return\n    }\n\n    isNftIdConfirmed.value = true\n  } catch (err) {\n    validationError.value = (err as Error).message\n    nftIds.value = []\n    isNftIdConfirmed.value = false\n  }\n}\n\nasync function fetchNFTMetadata () {\n  try {\n    isVerifyingNFTId.value = true\n    if (!nftIds.value.length || nftIds.value[0] === undefined) {\n      nftImage.value = ''\n      return\n    }\n    try {\n      const metadata = await getNFTMetadata(classId.value, nftIds.value[0])\n      nftImage.value = parseImageURLFromMetadata(metadata?.image || '')\n      return metadata\n    } catch (err) {\n      nftImage.value = ''\n      if ((err as { data?: { code?: number } })?.data?.code === 2) {\n        nftIdError.value = 'NFT not found'\n      } else {\n        nftIdError.value = (err as Error).toString()\n      }\n    }\n  } catch (err) {\n    error.value = {\n      message: (err as Error).toString(),\n      actions: []\n    }\n    showErrorToast((err as Error).toString())\n  } finally {\n    isVerifyingNFTId.value = false\n  }\n}\n\nasync function fetchNextNFTId (_count = 1) {\n  try {\n    nftIds.value = []\n    nftIdError.value = ''\n    if (!wallet.value || !signer.value) {\n      await validateWalletConsistency()\n    }\n    if (!ownerWallet.value) {\n      throw new Error('Missing owner wallet')\n    }\n\n    const balance = await getBalanceOf(classId.value, ownerWallet.value) as bigint\n    if (balance < BigInt(_count)) {\n      throw new Error(`No NFTs available for classId: ${classId.value} in wallet: ${ownerWallet.value}`)\n    }\n\n    const collected: number[] = []\n\n    for (let idx = 0; idx < Number(balance); idx++) {\n      const tokenId = await getTokenIdByOwnerIndex(classId.value, ownerWallet.value, idx)\n      if (tokenId !== 0n) {\n        collected.push(Number(tokenId))\n        if (collected.length >= _count) {\n          break\n        }\n      }\n    }\n\n    if (collected.length < _count) {\n      throw new Error(`Failed to collect enough available NFTs. Collected ${collected.length}/${_count}`)\n    }\n\n    nftIds.value = collected\n    nftIdInput.value = collected.map(String)\n    isNftIdConfirmed.value = true\n\n    await fetchNFTMetadata()\n  } catch (err) {\n    const message = (err as Error).toString()\n    nftIdError.value = message\n    error.value = {\n      message,\n      actions: [\n        {\n          label: $t('button.restock_nft'),\n          variant: 'outline',\n          color: 'error',\n          click: () => {\n            showRestockModal.value = true\n          }\n        }\n      ]\n    }\n    showErrorToast(message)\n  }\n}\n\nfunction onCheckOwnedIds () {\n  window.open(`${NFT_ITEM_URL}/${classId.value}`, '_blank', 'noopener')\n}\n\nasync function onSendNFTStart () {\n  if (isSendButtonDisabled.value) { return }\n  try {\n    isLoading.value = true\n    if (!wallet.value || !signer.value) {\n      await validateWalletConsistency()\n    }\n    if (!wallet.value || !signer.value) { return }\n    if (nftIds.value) {\n      const owners = await Promise.all(nftIds.value.map((nftId: number) => getNFTOwner(classId.value, nftId)))\n      const mismatchNftIdIndex = owners.findIndex(owner => owner !== ownerWallet.value)\n      if (mismatchNftIdIndex >= 0) {\n        const mismatchNftId = nftIds.value[mismatchNftIdIndex]\n        throw new Error(`NFT classId: ${classId.value} nftId:${mismatchNftId} is not owned by sender!`)\n      }\n    } else {\n      await fetchNextNFTId(orderInfo.value.quantity || 1)\n    }\n\n    const txParams = {\n      address: classId.value as `0x${string}`,\n      abi: LIKE_NFT_CLASS_ABI,\n      functionName: 'batchTransferWithMemo',\n      args: [\n        wallet.value,\n        Array(orderInfo.value.quantity).fill(orderInfo.value.wallet),\n        nftIds.value,\n        Array(orderInfo.value.quantity).fill(memo.value)\n      ]\n    }\n\n    await assertSufficientBalanceForTransaction({\n      wallet: wallet.value,\n      ...txParams\n    })\n\n    const txHash = await writeContractAsync(txParams)\n    const receipt = await waitForTransactionReceipt({ hash: txHash })\n    if (receipt?.status === 'success') {\n      await $fetch(`${LIKE_CO_API}/likernft/book/purchase/${classId.value}/sent/${paymentId.value}`,\n        {\n          method: 'POST',\n          body: {\n            txHash,\n            quantity: orderInfo.value.quantity || 1\n          },\n          headers: {\n            authorization: `Bearer ${token.value}`\n          }\n        })\n\n      await navigateTo(localeRoute({\n        name: 'my-books-status-classId',\n        params: {\n          classId: classId.value\n        }\n      }))\n    }\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error(err)\n    error.value = {\n      message: (err as Error).toString(),\n      actions: []\n    }\n    showErrorToast((err as Error).toString())\n  } finally {\n    isLoading.value = false\n  }\n}\n\nfunction handleFinishRestock () {\n  showRestockModal.value = false\n  fetchNextNFTId(orderInfo.value.quantity || 1)\n}\n\n</script>\n"],"names":["_hoisted_1","_openBlock","_createElementBlock","_createElementVNode","_renderSlot","_ctx","isFullWidthChar","char","useMessageCharCount","memo","limit","messageCharCount","computed","value","count","i","isLimitReached","$t","useI18n","LIKE_CO_API","useRuntimeConfig","store","useWalletStore","wallet","signer","storeToRefs","validateWalletConsistency","bookstoreApiStore","useBookstoreApiStore","token","sessionWallet","nftStore","useNftStore","lazyFetchClassMetadataById","route","useRoute","localeRoute","useLocaleRoute","writeContractAsync","useWriteContract","getBalanceOf","getTokenIdByOwnerIndex","useNFTContractReader","assertSufficientBalanceForTransaction","waitForTransactionReceipt","useNFTContractWriter","showErrorToast","useToastComposable","error","ref","isLoading","classId","paymentId","ownerWallet","AUTHOR_MESSAGE_LIMIT","getNFTMetadata","getNFTOwner","nftIdInput","nftIds","isVerifyingNFTId","nftIdError","isNftIdConfirmed","nftIdInputRef","orderInfo","nftImage","showRestockModal","validationError","NFT_ITEM_URL","hasValidNftInput","id","isSendButtonDisabled","isSingleQuantity","nftClassName","watch","newIsLoading","_","oldVal","onMounted","data","fetchNextNFTId","handleConfirmNFTId","firstNftId","metadata","ownerResult","fetchNFTMetadata","err","parseImageURLFromMetadata","_count","balance","collected","idx","tokenId","message","onCheckOwnedIds","onSendNFTStart","mismatchNftIdIndex","nftId","owner","mismatchNftId","txParams","LIKE_NFT_CLASS_ABI","txHash","navigateTo","handleFinishRestock","_createBlock","_component_PageBody","_unref","_component_UAlert","_component_UProgress","_cache","_component_UCard","_createVNode","_component_UButton","_hoisted_2","_hoisted_3","_toDisplayString","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_component_UFormField","_component_UTextarea","$event","_hoisted_19","_normalizeClass","_Fragment","_renderList","_component_UInput","_hoisted_20","_component_USeparator","_component_PlaceholderCard","_component_UModal","_component_LiteMintNFT"],"mappings":"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"}