import{_ as Q}from"./BRD0zS0z.js";import{_ as Y}from"./D3om2a5D.js";import{g as G,Q as J,A as X,B as Z,R as ee,e as m,V as te,o as oe,l as w,m as S,n as r,p as n,q as t,W as $,L as x,ab as ne,$ as g,c as I,a0 as ae,Y as le,a9 as re,a1 as se,N as C,M as V,ae as ie,af as ce,S as ue}from"./9S2XGRg9.js";import{_ as de}from"./Bu69eulW.js";import{_ as _e}from"./drKZnbC8.js";import{_ as he}from"./CLuOJMie.js";import{_ as fe}from"./Bzm9dzjm.js";import{p as me}from"./Do9u-xqN.js";import"./DVNOgE3D.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};i.SENTRY_RELEASE={id:"cd189bad150b481aa5ecb2e95de26ec677010e55"}}catch{}})();try{(function(){var i=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},o=new i.Error().stack;o&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[o]="50effef9-4da6-419b-9466-b44585879bb1",i._sentryDebugIdIdentifier="sentry-dbid-50effef9-4da6-419b-9466-b44585879bb1")})()}catch{}const be={class:"flex justify-center"},pe={class:"font-bold font-mono"},ke={class:"flex items-center gap-2"},U="key,url",Re=G({__name:"batch-short-links",setup(i){const{t:o}=J(),v=X(),L=Z(),B=ee(),q=[{label:"Bitly",value:"bitly"},{label:"Short.io",value:"shortio"}],h=m(L.query.provider||"bitly"),R=I(()=>h.value==="shortio"),b=m(""),p=m(L.query.title_prefix||o("batch_short_links.default_title_prefix")),d=m(""),D=`${U}
example01,https://example01.com,
example02,https://example02.com,`,f=m(""),E=I(()=>{switch(h.value){case"bitly":return o("batch_short_links.bitly_token");case"shortio":return o("batch_short_links.shortio_api_key");default:return""}}),k=m([]);te({title:"Batch Create Book Short Links",ogTitle:"Batch Create Book Short Links"}),oe(()=>{try{const s=sessionStorage.getItem("nft_book_press_batch_shorten_url");s&&(d.value=s,sessionStorage.removeItem("nft_book_press_batch_shorten_url"))}catch(s){console.error(s)}});async function P({url:s,key:e}){try{const a=await $fetch("https://api-ssl.bitly.com/v4/bitlinks",{method:"POST",headers:{Authorization:`Bearer ${f.value}`},body:{long_url:s,domain:"bit.ly",title:[p.value,e].join(" - "),tags:["nft-book-press"]}});if(!a)throw new Error(o("batch_short_links.bitly_no_data"));return a.link}catch(a){return console.error(a),v.add({icon:"i-heroicons-exclamation-circle",title:a.toString(),duration:0,color:"error"}),"error"}}async function A({url:s,key:e}){try{const a=await $fetch("https://api.short.io/links/public",{method:"POST",headers:{Authorization:f.value},body:{allowDuplicates:!0,domain:b.value,originalURL:s,title:[p.value,e].join(" - "),tags:["nft-book-press"]}});if(!a)throw new Error(o("batch_short_links.shortio_no_data"));return a.shortURL}catch(a){return console.error(a),v.add({icon:"i-heroicons-exclamation-circle",title:a.toString(),duration:0,color:"error"}),"error"}}async function N(){let s=[];try{let e=d.value;e.includes(U)||(e=`${U}
${e}`),s=me(e,{columns:!0,skip_empty_lines:!0})}catch(e){console.error(e),v.add({icon:"i-heroicons-exclamation-circle",title:e.toString(),duration:0,color:"error"});return}try{for(const{key:e,url:a}of s){let c="";switch(h.value){case"bitly":c=await P({url:a,key:e});break;case"shortio":c=await A({url:a,key:e});break;default:break}k.value.push({key:e,url:c,destination:a})}}catch(e){console.error(e),v.add({icon:"i-heroicons-exclamation-circle",title:e.toString(),duration:0,color:"error"})}}function j(){ie({data:k.value,fileName:"shortened_links.csv",fileType:"csv"})}async function F(){sessionStorage.setItem("nft_book_press_batch_qrcode",ce(k.value)),await ue(B({name:"batch-qrcode"}))}function K(s){const e=s.target?.files;if(!e?.length)return;const a=e[0];if(!a)return;const c=new FileReader;c.onload=u=>{const _=u.target?.result;typeof _=="string"&&(d.value=_)},c.readAsText(a)}return(s,e)=>{const a=Q,c=Y,u=ne,_=ae,O=re,z=de,T=le,y=se,M=_e,W=he,H=fe;return S(),w(H,null,{default:r(()=>[n(a,{title:t(o)("batch_short_links.page_title")},null,8,["title"]),n(W,null,{default:r(()=>[n(u,{label:t(o)("batch_short_links.provider_label"),required:!0},{default:r(()=>[n(c,{modelValue:t(h),"onUpdate:modelValue":e[0]||(e[0]=l=>g(h)?h.value=l:null),items:q},null,8,["modelValue"])]),_:1},8,["label"]),n(u,{label:t(E),required:!0},{default:r(()=>[n(_,{modelValue:t(f),"onUpdate:modelValue":e[1]||(e[1]=l=>g(f)?f.value=l:null),class:"font-mono",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label"]),t(R)?(S(),w(u,{key:0,label:t(o)("batch_short_links.shortio_domain"),required:!0},{default:r(()=>[n(_,{modelValue:t(b),"onUpdate:modelValue":e[2]||(e[2]=l=>g(b)?b.value=l:null),class:"font-mono",placeholder:"link.liker.land",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label"])):$("",!0),n(u,{label:t(o)("batch_short_links.title_prefix")},{default:r(()=>[n(_,{modelValue:t(p),"onUpdate:modelValue":e[3]||(e[3]=l=>g(p)?p.value=l:null),hint:t(o)("batch_short_links.optional")},null,8,["modelValue","hint"])]),_:1},8,["label"]),n(T,{ui:{body:"space-y-2"}},{default:r(()=>[n(u,{label:t(o)("batch_short_links.upload_csv")},{default:r(()=>[n(_,{type:"file",accept:"csv",onChange:K})]),_:1},8,["label"]),n(O,{class:"print:hidden",label:t(o)("batch_short_links.or_divider")},null,8,["label"]),n(u,{label:t(o)("batch_short_links.input_csv")},{default:r(()=>[n(z,{modelValue:t(d),"onUpdate:modelValue":e[4]||(e[4]=l=>g(d)?d.value=l:null),class:"font-mono",placeholder:D,resize:!0},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),x("div",be,[n(y,{label:t(o)("batch_short_links.start"),size:"lg",disabled:!t(d)||!t(f)||t(R)&&!t(b),onClick:N},null,8,["label","disabled"])]),t(k).length?(S(),w(T,{key:1,ui:{header:"flex justify-between items-center gap-2",body:"p-0"}},{header:r(()=>[x("h3",pe,V(t(o)("batch_short_links.results")),1),x("div",ke,[n(y,{label:t(o)("batch_short_links.download_csv"),variant:"outline",onClick:j},null,8,["label"]),n(y,{label:t(o)("batch_short_links.convert_to_qr"),variant:"outline",onClick:F},null,8,["label"])])]),default:r(()=>[n(M,{columns:[{accessorKey:"key",header:t(o)("batch_short_links.key_column")},{accessorKey:"url",header:t(o)("batch_short_links.url_column")},{accessorKey:"destination",header:t(o)("batch_short_links.destination_column")}],data:t(k)},{"url-cell":r(({row:l})=>[n(y,{class:"font-mono",to:l.original.url,target:"_blank",rel:"noopener",variant:"link"},{default:r(()=>[C(V(l.original.url),1)]),_:2},1032,["to"])]),"destination-cell":r(({row:l})=>[n(y,{class:"font-mono",to:l.original.destination,target:"_blank",rel:"noopener",variant:"link"},{default:r(()=>[C(V(l.original.destination),1)]),_:2},1032,["to"])]),_:1},8,["columns","data"])]),_:1})):$("",!0)]),_:1})]),_:1})}}});export{Re as default};
