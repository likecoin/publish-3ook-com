{"version":3,"file":"Cj48bdP5.js","sources":["../../../components/NFTClassMetadataLoader.vue","../../../pages/my-books/index.vue"],"sourcesContent":["<template>\n  <slot :is-loading=\"isLoading\" />\n</template>\n\n<script setup lang=\"ts\">\nconst nftStore = useNftStore()\n\nconst props = defineProps({\n  classId: {\n    type: String,\n    required: true\n  }\n})\n\nconst isLoading = ref(false)\n\nonMounted(async () => {\n  try {\n    isLoading.value = true\n    await nftStore.lazyFetchClassMetadataById(props.classId)\n  } catch {\n    // ignore\n  } finally {\n    isLoading.value = false\n  }\n})\n</script>\n","<template>\n  <PageBody :ui=\"{ constrained: '' }\">\n    <UAlert\n      v-if=\"error\"\n      class=\"mt-4\"\n      icon=\"i-heroicons-exclamation-triangle\"\n      color=\"error\"\n      variant=\"soft\"\n      :title=\"`${error}`\"\n      :close=\"{ icon: 'i-heroicons-x-mark-20-solid', color: 'error', variant: 'link' }\"\n      @close=\"error = ''\"\n    />\n\n    <UProgress v-if=\"isLoading\" animation=\"carousel\">\n      <template #indicator>\n        Loading...\n      </template>\n    </UProgress>\n\n    <UCard\n      :ui=\"{ header: 'flex justify-between items-center gap-4' }\"\n    >\n      <UTabs\n        v-model=\"selectedTabItemIndex\"\n        class=\"w-full\"\n        :items=\"tabItems\"\n      >\n        <template #content=\"{ item }\">\n          <UCard\n            :key=\"item.value\"\n            :ui=\"{\n              header: 'flex justify-between items-center gap-4',\n              body: 'divide-y divide-gray-200 dark:divide-gray-700 p-0',\n            }\"\n          >\n            <template #header>\n              <div class=\"flex justify-between items-center w-full\">\n                <div class=\"flex gap-2 items-center\">\n                  <UPagination\n                    v-model:page=\"tablePage\"\n                    :items-per-page=\"tableRowsPerPage\"\n                    :total=\"tableRows.length\"\n                  />\n                  <span class=\"text-sm leading-5\">\n                    {{ $t('table.showing_rows', { from: tablePageRowFrom, to: tablePageRowTo, total: tableRows.length }) }}\n                  </span>\n                </div>\n                <UInput v-model=\"searchInput\" icon=\"i-heroicons-magnifying-glass-20-solid\" :placeholder=\"$t('table.search_placeholder')\" />\n              </div>\n            </template>\n            <!-- Table -->\n            <UTable\n              :columns=\"tableColumns\"\n              :data=\"paginatedTableRows\"\n              @select=\"selectTableRow\"\n            >\n              <template #priceInUSD-cell=\"{ row }\">\n                <ul class=\"flex gap-1\">\n                  <li\n                    v-for=\"price in row.original.prices\"\n                    :key=\"price\"\n                  >\n                    <UBadge\n                      :label=\"`$${price}`\"\n                      variant=\"solid\"\n                      size=\"xs\"\n                      color=\"neutral\"\n                      class=\"rounded-full\"\n                    />\n                  </li>\n                </ul>\n              </template>\n              <template #className-cell=\"{ row }\">\n                <NFTClassMetadataLoader :class-id=\"row.original.classId\">\n                  <template #default=\"{ isLoading: isLoadingMetadata }\">\n                    <UProgress v-if=\"isLoadingMetadata || !row.original.className\" />\n                    <div v-else class=\"max-w-xs truncate\">\n                      {{ row.original.className }}\n                    </div>\n                  </template>\n                </NFTClassMetadataLoader>\n              </template>\n            </UTable>\n          </UCard>\n        </template>\n      </UTabs>\n    </UCard>\n\n    <div class=\"mt-4 text-center text-sm text-gray-500 dark:text-gray-400\">\n      <ULink\n        :to=\"authorPromoFormUrl\"\n        target=\"_blank\"\n        class=\"underline\"\n      >\n        {{ $t('my_books.author_promo_form') }}\n      </ULink>\n    </div>\n  </PageBody>\n</template>\n\n<script setup lang=\"ts\">\nconst route = useRoute()\nconst localeRoute = useLocaleRoute()\nconst { t: $t } = useI18n()\nconst bookstoreApiStore = useBookstoreApiStore()\nconst nftStore = useNftStore()\nconst { listingList: bookList, moderatedBookList, token, wallet } = storeToRefs(bookstoreApiStore)\nconst likerStore = useLikerStore()\nconst { getLikerInfoByWallet } = storeToRefs(likerStore)\nconst stripeStore = useStripeStore()\nconst { getStripeConnectStatusByWallet } = storeToRefs(stripeStore)\nconst { lazyFetchClassMetadataById } = nftStore\nconst { fetchBookListing, fetchModeratedBookList } = bookstoreApiStore\n\nconst error = ref('')\nconst isLoading = ref(false)\n\nconst authorPromoFormUrl = computed(() => {\n  const likerInfo = getLikerInfoByWallet.value(wallet.value || '')\n  const stripeStatus = getStripeConnectStatusByWallet.value(wallet.value || '')\n  const likerId = likerInfo?.user || ''\n  const evmWallet = wallet.value || ''\n  const email = stripeStatus?.email || ''\n  const baseUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSdiV9jIUFcDjoFoLtz6KMmq1YRFjU7uXR7ka36JKhVespsP6w/viewform'\n  const params = new URLSearchParams({\n    usp: 'pp_url',\n    'entry.1466422015': likerId,\n    'entry.1252262934': evmWallet,\n    'entry.1672981182': email\n  })\n  return `${baseUrl}?${params.toString()}`\n})\n\nuseSeoMeta({\n  title: () => $t('seo_titles.book_listing_management'),\n  ogTitle: () => $t('seo_titles.book_listing_management')\n})\n\n// Tabs\nconst tabItems = computed(() => [\n  { label: $t('bookstore.current_listing'), value: 'current' },\n  { label: $t('bookstore.viewable_listing'), value: 'viewable' }\n])\n\nconst selectedTabItemIndex = ref(route.query.tab as string || 'current')\n\nwatch(selectedTabItemIndex, (value) => {\n  if (value) {\n    navigateTo(localeRoute({ query: { tab: value } }), { replace: true })\n  }\n})\n\n// Search\nconst searchInput = ref('')\n\nconst sort = ref({\n  column: 'pendingAction',\n  direction: 'desc' as 'asc' | 'desc'\n})\n\n// Pagination\nconst tableRowsPerPage = ref(50)\n\nconst tablePage = ref(1)\nconst tablePageRowFrom = computed(() => (tablePage.value - 1) * tableRowsPerPage.value + 1)\nconst tablePageRowTo = computed(() => Math.min(tablePage.value * tableRowsPerPage.value, tableRows.value.length))\n\n// Rows\nconst tableRows = computed(() => (selectedTabItemIndex.value === 'viewable' ? moderatedBookList : bookList).value.map(b => ({\n  classId: b.classId,\n  className: nftStore.getClassMetadataById(b.classId)?.name,\n  priceInUSD: b.prices?.[0]?.price,\n  prices: b.prices?.map(p => p.price),\n  pendingAction: b.pendingNFTCount,\n  sold: b.sold\n})).filter((b) => {\n  if (!searchInput.value) { return true }\n  const normalizedSearchInput = searchInput.value.toLowerCase()\n  return b.classId.toLowerCase().includes(normalizedSearchInput) || b.className?.toLowerCase().includes(normalizedSearchInput)\n}))\n\nconst sortedTableRows = computed(() => {\n  const { column, direction } = sort.value\n  return [...tableRows.value].sort((a, b) => {\n    const aVal = a[column as keyof typeof a] ?? ''\n    const bVal = b[column as keyof typeof b] ?? ''\n    if (aVal < bVal) {\n      return direction === 'asc' ? -1 : 1\n    }\n    if (aVal > bVal) {\n      return direction === 'asc' ? 1 : -1\n    }\n    return 0\n  })\n})\n\nconst paginatedTableRows = computed(() => {\n  return sortedTableRows.value.slice((tablePage.value - 1) * tableRowsPerPage.value, tablePage.value * tableRowsPerPage.value)\n})\n\n// Columns\nconst tableColumns = computed(() => [\n  {\n    accessorKey: 'pendingAction',\n    header: $t('table.pending_action')\n  },\n  {\n    accessorKey: 'className',\n    header: $t('table.class_name')\n  },\n  {\n    accessorKey: 'priceInUSD',\n    header: $t('table.price_in_usd')\n  },\n  {\n    accessorKey: 'sold',\n    header: $t('table.sold')\n  },\n  {\n    accessorKey: 'classId',\n    header: $t('bookstore.class_id'),\n    meta: { class: { td: 'font-mono' } }\n  }\n])\n\nwatch(isLoading, (newIsLoading) => {\n  if (newIsLoading) { error.value = '' }\n})\n\nwatch(selectedTabItemIndex, () => {\n  searchInput.value = ''\n  tablePage.value = 1\n})\n\nwatch(tableRowsPerPage, () => {\n  tablePage.value = 1\n})\n\nonMounted(async () => {\n  const promises: Promise<unknown>[] = [fetchBookListing()]\n  if (token.value) {\n    promises.push(fetchModeratedBookList())\n  }\n  if (wallet.value) {\n    promises.push(likerStore.lazyFetchLikerInfoByWallet(wallet.value))\n    promises.push(stripeStore.fetchStripeConnectStatusByWallet(wallet.value))\n  }\n  await Promise.all(promises)\n\n  const classIds: Set<string> = new Set(bookList.value.map(b => b.classId).concat(moderatedBookList.value.map(m => m.classId)))\n  classIds.forEach(classId => lazyFetchClassMetadataById(classId))\n})\n\nasync function selectTableRow (row: { original: { classId: string } }) {\n  await navigateTo(localeRoute({\n    name: 'my-books-status-classId',\n    params: { classId: row.original.classId }\n  }))\n}\n</script>\n"],"names":["nftStore","useNftStore","props","__props","isLoading","ref","onMounted","_renderSlot","_ctx","_unref","route","useRoute","localeRoute","useLocaleRoute","$t","useI18n","bookstoreApiStore","useBookstoreApiStore","bookList","moderatedBookList","token","wallet","storeToRefs","likerStore","useLikerStore","getLikerInfoByWallet","stripeStore","useStripeStore","getStripeConnectStatusByWallet","lazyFetchClassMetadataById","fetchBookListing","fetchModeratedBookList","error","authorPromoFormUrl","computed","likerInfo","stripeStatus","likerId","evmWallet","email","baseUrl","params","useSeoMeta","tabItems","selectedTabItemIndex","watch","value","navigateTo","searchInput","sort","tableRowsPerPage","tablePage","tablePageRowFrom","tablePageRowTo","tableRows","b","p","normalizedSearchInput","sortedTableRows","column","direction","a","aVal","bVal","paginatedTableRows","tableColumns","newIsLoading","promises","m","classId","selectTableRow","row","_createBlock","_component_PageBody","_component_UAlert","_component_UProgress","_cache","_createVNode","_component_UCard","_component_UTabs","$event","_withCtx","item","_createElementVNode","_hoisted_1","_hoisted_2","_component_UPagination","_hoisted_3","_toDisplayString","_component_UInput","_component_UTable","_hoisted_4","_openBlock","_createElementBlock","_Fragment","price","_component_UBadge","_component_NFTClassMetadataLoader","isLoadingMetadata","_hoisted_5","_hoisted_6","_component_ULink"],"mappings":"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"}