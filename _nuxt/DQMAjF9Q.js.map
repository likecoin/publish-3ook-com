{"version":3,"file":"DQMAjF9Q.js","sources":["../../../composables/useNFTClassCreator.ts"],"sourcesContent":["import { useWriteContract } from '@wagmi/vue'\nimport { LIKE_NFT_ABI } from '~/contracts/likeNFT'\nimport { DEFAULT_MAX_SUPPLY } from '~/constant'\nimport { formatISCNTxPayload } from '~/utils/iscn'\nimport type { ISCNFormData } from '~/utils/iscn.type'\n\nexport function useNFTClassCreator () {\n  const walletStore = useWalletStore()\n  const { wallet } = storeToRefs(walletStore)\n  const {\n    assertSufficientBalanceForTransaction,\n    waitForTransactionReceipt\n  } = useNFTContractWriter()\n  const { writeContractAsync } = useWriteContract()\n  const {\n    LIKE_NFT_CONTRACT_ADDRESS,\n    LIKE_EVM_NFT_TARGET_ADDRESS\n  } = useRuntimeConfig().public\n\n  async function createNFTClass (params: {\n    iscnFormData: Ref<ISCNFormData>\n  }): Promise<{ classId: string; txHash: string }> {\n    const { payload, computeISCNSalt } = useISCN({ iscnFormData: params.iscnFormData })\n\n    const contentMetadata = formatISCNTxPayload(payload.value)\n    const metadata = {\n      ...contentMetadata,\n      symbol: 'BOOK',\n      image: contentMetadata?.thumbnailUrl || '',\n      external_link: contentMetadata?.url || '',\n      nft_meta_collection_id: 'nft_book',\n      nft_meta_collection_name: 'NFT Book',\n      nft_meta_collection_description: 'NFT Book by Liker Land',\n      recordTimestamp: new Date().toISOString()\n    }\n\n    const salt = computeISCNSalt(wallet.value!)\n\n    const txParams = {\n      address: LIKE_NFT_CONTRACT_ADDRESS as `0x${string}`,\n      abi: LIKE_NFT_ABI,\n      functionName: 'newBookNFT' as const,\n      args: [\n        salt,\n        {\n          creator: wallet.value!,\n          updaters: [wallet.value!, LIKE_EVM_NFT_TARGET_ADDRESS],\n          minters: [wallet.value!, LIKE_EVM_NFT_TARGET_ADDRESS],\n          config: {\n            name: metadata.name,\n            symbol: 'BOOK',\n            metadata: JSON.stringify(metadata),\n            max_supply: DEFAULT_MAX_SUPPLY\n          }\n        },\n        500\n      ]\n    }\n\n    await assertSufficientBalanceForTransaction({\n      wallet: wallet.value!,\n      ...txParams\n    })\n\n    const txHash = await writeContractAsync(txParams)\n    const receipt = await waitForTransactionReceipt({ hash: txHash, confirmations: 2 })\n\n    if (!receipt || receipt.status !== 'success') {\n      throw new Error('NFT class creation failed')\n    }\n    if (!receipt.logs?.[0]?.address) {\n      throw new Error('Invalid class ID in receipt')\n    }\n\n    const classId = receipt.logs[0].address\n    return { classId, txHash }\n  }\n\n  return { createNFTClass }\n}\n"],"names":["useNFTClassCreator","walletStore","useWalletStore","wallet","storeToRefs","assertSufficientBalanceForTransaction","waitForTransactionReceipt","useNFTContractWriter","writeContractAsync","useWriteContract","LIKE_NFT_CONTRACT_ADDRESS","LIKE_EVM_NFT_TARGET_ADDRESS","useRuntimeConfig","createNFTClass","params","payload","computeISCNSalt","useISCN","contentMetadata","formatISCNTxPayload","metadata","salt","txParams","LIKE_NFT_ABI","DEFAULT_MAX_SUPPLY","txHash","receipt"],"mappings":"ktBAMO,SAASA,GAAsB,CACpC,MAAMC,EAAcC,EAAA,EACd,CAAE,OAAAC,CAAA,EAAWC,EAAYH,CAAW,EACpC,CACJ,sCAAAI,EACA,0BAAAC,CAAA,EACEC,EAAA,EACE,CAAE,mBAAAC,CAAA,EAAuBC,EAAA,EACzB,CACJ,0BAAAC,EACA,4BAAAC,CAAA,EACEC,IAAmB,OAEvB,eAAeC,EAAgBC,EAEkB,CAC/C,KAAM,CAAE,QAAAC,EAAS,gBAAAC,GAAoBC,EAAQ,CAAE,aAAcH,EAAO,aAAc,EAE5EI,EAAkBC,EAAoBJ,EAAQ,KAAK,EACnDK,EAAW,CACf,GAAGF,EACH,OAAQ,OACR,MAAOA,GAAiB,cAAgB,GACxC,cAAeA,GAAiB,KAAO,GACvC,uBAAwB,WACxB,yBAA0B,WAC1B,gCAAiC,yBACjC,gBAAiB,IAAI,KAAA,EAAO,YAAA,CAAY,EAGpCG,EAAOL,EAAgBb,EAAO,KAAM,EAEpCmB,EAAW,CACf,QAASZ,EACT,IAAKa,EACL,aAAc,aACd,KAAM,CACJF,EACA,CACE,QAASlB,EAAO,MAChB,SAAU,CAACA,EAAO,MAAQQ,CAA2B,EACrD,QAAS,CAACR,EAAO,MAAQQ,CAA2B,EACpD,OAAQ,CACN,KAAMS,EAAS,KACf,OAAQ,OACR,SAAU,KAAK,UAAUA,CAAQ,EACjC,WAAYI,CAAA,CACd,EAEF,GAAA,CACF,EAGF,MAAMnB,EAAsC,CAC1C,OAAQF,EAAO,MACf,GAAGmB,CAAA,CACJ,EAED,MAAMG,EAAS,MAAMjB,EAAmBc,CAAQ,EAC1CI,EAAU,MAAMpB,EAA0B,CAAE,KAAMmB,EAAQ,cAAe,EAAG,EAElF,GAAI,CAACC,GAAWA,EAAQ,SAAW,UACjC,MAAM,IAAI,MAAM,2BAA2B,EAE7C,GAAI,CAACA,EAAQ,OAAO,CAAC,GAAG,QACtB,MAAM,IAAI,MAAM,6BAA6B,EAI/C,MAAO,CAAE,QADOA,EAAQ,KAAK,CAAC,EAAE,QACd,OAAAD,CAAA,CACpB,CAEA,MAAO,CAAE,eAAAZ,CAAA,CACX"}