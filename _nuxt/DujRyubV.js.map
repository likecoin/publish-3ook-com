{"version":3,"file":"DujRyubV.js","sources":["../../../pages/sales-report/payouts/[payoutId].vue"],"sourcesContent":["<template>\n  <PageBody class=\"space-y-10 pb-10\">\n    <div class=\"flex justify-between gap-4\">\n      <h1 class=\"text-lg font-bold font-mono flex-wrap\">\n        {{ $t('user_settings.payout_details') }} - {{ payoutId }}\n      </h1>\n    </div>\n\n    <UProgress v-if=\"isLoading\" animation=\"carousel\">\n      <template #indicator>\n        {{ $t('loading.progress') }}\n      </template>\n    </UProgress>\n\n    <UCard\n      :ui=\"{\n        header: 'flex justify-between items-center',\n        body: 'p-0'\n      }\"\n    >\n      <template #header>\n        <h3 class=\"font-bold font-mono\">\n          {{ $t('user_settings.payout_details') }}\n        </h3>\n\n        <UButton\n          icon=\"i-heroicons-arrow-down-tray\"\n          variant=\"outline\"\n          size=\"sm\"\n          :disabled=\"isLoading || !payoutDataRows.length\"\n          @click=\"exportPayoutData\"\n        >\n          {{ $t('common.export_csv', { length: payoutDataRows.length }) }}\n        </UButton>\n      </template>\n\n      <UTable\n        :columns=\"[\n          { accessorKey: 'id', header: $t('table.id') },\n          { accessorKey: 'createdTs', header: $t('table.created') },\n          { accessorKey: 'currency', header: $t('table.currency') },\n          { accessorKey: 'amount', header: $t('table.payout_amount') },\n          { accessorKey: 'status', header: $t('table.status') },\n          { accessorKey: 'arrivalTs', header: $t('table.arrived') },\n        ]\"\n        :data=\"payoutDataRows\"\n        :loading=\"isLoading\"\n        :ui=\"{ th: 'text-center', td: 'text-center' }\"\n      />\n    </UCard>\n\n    <UCard :ui=\"{ body: 'p-0', header: 'flex justify-between items-center' }\">\n      <template #header>\n        <h3 class=\"text-sm font-bold font-mono\">\n          {{ $t('user_settings.payout_details') }}\n        </h3>\n\n        <UButton\n          icon=\"i-heroicons-arrow-down-tray\"\n          variant=\"outline\"\n          size=\"sm\"\n          :disabled=\"isLoading || !payoutItemRows.length\"\n          @click=\"exportPayoutItems\"\n        >\n          {{ $t('common.export_csv', { length: payoutItemRows.length }) }}\n        </UButton>\n      </template>\n      <UTable\n        :columns=\"[\n          { accessorKey: 'commissionId', header: $t('table.id') },\n          { accessorKey: 'createdTs', header: $t('table.created') },\n          { accessorKey: 'currency', header: $t('table.currency') },\n          { accessorKey: 'amount', header: $t('table.commission_amount') },\n          { accessorKey: 'description', header: $t('common.description') },\n          { accessorKey: 'status', header: $t('table.status') },\n          { accessorKey: 'metadata', header: $t('table.metadata') },\n        ]\"\n        :data=\"payoutItemRows\"\n        :loading=\"isLoading\"\n        :ui=\"{ th: 'text-center', td: 'text-center' }\"\n      >\n        <template #metadata-cell=\"{ row }\">\n          <UButton\n            :label=\"$t('buttons.view_edit')\"\n            color=\"neutral\"\n            @click=\"modalMetadata = row.original.metadata\"\n          />\n        </template>\n      </UTable>\n    </UCard>\n\n    <UModal v-model:open=\"isModalMetadataOpen\">\n      <template #header>\n        <h4 class=\"font-mono font-bold\" v-text=\"$t('table.metadata')\" />\n\n        <UButton\n          color=\"neutral\"\n          variant=\"ghost\"\n          icon=\"i-heroicons-x-mark-20-solid\"\n          square\n          @click=\"isModalMetadataOpen = false\"\n        />\n      </template>\n\n      <template #body>\n        <pre v-text=\"modalMetadata\" />\n      </template>\n    </UModal>\n  </PageBody>\n</template>\n\n<script setup lang=\"ts\">\nimport type { PayoutData, PayoutItemDetail } from '~/types'\n\nconst { t: $t } = useI18n()\n\nconst { LIKE_CO_API } = useRuntimeConfig().public\nconst bookstoreApiStore = useBookstoreApiStore()\nconst { token } = storeToRefs(bookstoreApiStore)\n\nconst route = useRoute()\n\nconst payoutData = ref<PayoutData>({} as PayoutData)\nconst payoutItemDetails = ref<PayoutItemDetail[]>([])\n\nconst error = ref('')\nconst isLoading = ref(false)\nconst payoutId = ref(route.params.payoutId as string)\n\nconst modalMetadata = ref('')\nconst isModalMetadataOpen = computed({\n  get: () => !!modalMetadata.value,\n  set: (value) => {\n    if (!value) {\n      modalMetadata.value = ''\n    }\n  }\n})\n\nwatch(isLoading, (newIsLoading) => {\n  if (newIsLoading) { error.value = '' }\n})\n\nconst payoutDataRows = computed(() => {\n  if (!payoutData.value) { return [] }\n  const {\n    id,\n    createdTs,\n    amount,\n    status,\n    currency,\n    arrivalTs\n  } = payoutData.value\n  return [\n    {\n      id,\n      createdTs: new Date(createdTs * 1000).toLocaleString(),\n      amount: formatNumberWithCurrency(amount, currency),\n      status,\n      currency: formatCurrency(currency),\n      arrivalTs: arrivalTs ? new Date(arrivalTs * 1000).toLocaleString() : ''\n    }\n  ]\n})\n\nconst payoutItemRows = computed(() => {\n  return payoutItemDetails.value.map((row) => {\n    const {\n      commissionId,\n      createdTs,\n      amount,\n      currency,\n      description,\n      status,\n      metadata\n    } = row\n    return {\n      commissionId,\n      createdTs: new Date(createdTs * 1000).toLocaleString(),\n      amount: formatNumberWithCurrency(amount, currency),\n      currency: formatCurrency(currency),\n      description,\n      status,\n      metadata: JSON.stringify(metadata, null, 2)\n    }\n  })\n})\n\nonMounted(async () => {\n  try {\n    isLoading.value = true\n    const data = await $fetch(`${LIKE_CO_API}/likernft/book/user/payouts/${payoutId.value}`,\n      {\n        headers: {\n          authorization: `Bearer ${token.value}`\n        }\n      })\n    payoutData.value = data as PayoutData\n    if (payoutData.value.items) {\n      payoutItemDetails.value = payoutData.value.items\n    }\n  } finally {\n    isLoading.value = false\n  }\n})\n\nasync function exportPayoutData () {\n  if (!payoutDataRows.value.length) { return }\n\n  const date = new Date().toISOString().split('T')[0]\n\n  const columns = [\n    { accessorKey: 'id', header: $t('table.id') },\n    { accessorKey: 'createdTs', header: $t('table.created') },\n    { accessorKey: 'amount', header: $t('table.payout_amount') },\n    { accessorKey: 'currency', header: $t('table.currency') },\n    { accessorKey: 'status', header: $t('table.status') },\n    { accessorKey: 'arrivalTs', header: $t('table.arrived') }\n  ]\n\n  const { id, createdTs, amount, currency, status, arrivalTs } = payoutData.value\n  const data = [{\n    id,\n    createdTs: new Date(createdTs * 1000).toLocaleString(),\n    currency: formatCurrency(currency),\n    amount: convertDecimalToAmount(amount, currency),\n    status,\n    arrivalTs: arrivalTs ? new Date(arrivalTs * 1000).toLocaleString() : ''\n  }]\n\n  await downloadCSV(data, columns, `payout-details-${payoutId.value}-${date}.csv`)\n}\n\nasync function exportPayoutItems () {\n  if (!payoutItemRows.value.length) { return }\n\n  const date = new Date().toISOString().split('T')[0]\n\n  const columns = [\n    { accessorKey: 'commissionId', header: $t('table.id') },\n    { accessorKey: 'createdTs', header: $t('table.created') },\n    { accessorKey: 'amount', header: $t('table.commission_amount') },\n    { accessorKey: 'currency', header: $t('table.currency') },\n    { accessorKey: 'description', header: $t('common.description') },\n    { accessorKey: 'status', header: $t('table.status') },\n    { accessorKey: 'metadata', header: $t('table.metadata') }\n  ]\n\n  const data = payoutItemDetails.value.map(row => ({\n    commissionId: row.commissionId,\n    createdTs: new Date(row.createdTs * 1000).toLocaleString(),\n    currency: formatCurrency(row.currency),\n    amount: convertDecimalToAmount(row.amount, row.currency),\n    description: row.description || '',\n    status: row.status,\n    metadata: row.metadata ? JSON.stringify(row.metadata, null, 2) : ''\n  }))\n\n  await downloadCSV(data, columns, `payout-items-${payoutId.value}-${date}.csv`)\n}\n</script>\n"],"names":["$t","useI18n","LIKE_CO_API","useRuntimeConfig","bookstoreApiStore","useBookstoreApiStore","token","storeToRefs","route","useRoute","payoutData","ref","payoutItemDetails","error","isLoading","payoutId","modalMetadata","isModalMetadataOpen","computed","value","watch","newIsLoading","payoutDataRows","id","createdTs","amount","status","currency","arrivalTs","formatNumberWithCurrency","formatCurrency","payoutItemRows","row","commissionId","description","metadata","onMounted","data","exportPayoutData","date","columns","convertDecimalToAmount","downloadCSV","exportPayoutItems","_createBlock","_component_PageBody","_createElementVNode","_hoisted_1","_hoisted_2","_toDisplayString","_unref","_component_UProgress","_createVNode","_component_UCard","_hoisted_3","_component_UButton","_component_UTable","_hoisted_4","_withCtx","_component_UModal","$event"],"mappings":"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"}